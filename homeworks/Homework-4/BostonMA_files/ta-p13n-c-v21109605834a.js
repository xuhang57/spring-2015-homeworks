(function(d,f){var a=0;var e=navigator.userAgent.match(/iPad/g)?true:false;var c=false;var b=function(i,h){if(i==="t"&&h===32){return"neighborhood"}if(d.has("vrSpecificAttributeJson")){var j=d.retrieve("vrSpecificAttributeJson");if(j[i]&&j[i][h]){return j[i][h]}}var g=false;switch(i){case"y":g="style";break;case"t":g="style";break;case"a":g="jfy_amenities";break;case"s":g="hotel_class";break;case"b":g="brand";break;case"z":g="size";break;case"d":case"r":g="neighborhood";break;case"p":g="price";break}return g};f.wizard={updateSortBarText:function(k,i,h){if($$(".JFY_sort_type."+h).length===0){return}$$(".JFY_sort_type.display").toggleClass("display",false);$$(".JFY_sort_type."+h).toggleClass("display",true);$$(".jfy_sort.selected").toggleClass("selected",false);$$(".jfy_sort."+h).toggleClass("selected",true);$$(".jfy_sort.hovered").toggleClass("hovered",false);var j=d.retrieve("ta.p13n.jfyFilterSet");if(j){var m=j.sort;if(m){var l=m.inner.getElements(".jfy_sort.selected");if(l.length>0){l[0].toggleClass("selected",false)}var g=m.inner.getElements(".jfy_sort."+h);if(g.length>0){g[0].toggleClass("selected",true)}}}d.store("ta.p13n.jfyFilterSet",j)},updateSortBarContent:function(i,g,m,l){var k=$$(".sort_bar_test1_wrap");var h=$$(".description_holder");if(k&&h){if(m==="recommended"){k.toggleClass("with_recommended",false);h.toggleClass("with_recommended",false)}if(l==="recommended"){k.toggleClass("with_recommended",true);h.toggleClass("with_recommended",true)}if(m==="availability"||m==="popularity"){k.toggleClass("clickable",false);h.toggleClass("clickable",false)}if(l==="availability"||l==="popularity"){k.toggleClass("clickable",true);h.toggleClass("clickable",true)}$$(".description.display").toggleClass("display",false);$$(".description."+l).toggleClass("display",true)}var j=d.find("#p13n_hotels_list_sorting_header_blue_plus");if(j&&!j.hasClass("dont_hide")){if(l!=="recommended"){j.toggleClass("hidden",true)}if(l==="recommended"){j.toggleClass("hidden",false)}}},changeSortClick:function(k,j,g,h){if(d.retrieve("hotels_sort_interaction_tracking.enabled")&&d.retrieve("canUseLocalStorage")){var l="hotels_sort_changed_by_user.reported";if(!localStorage.getItem(l)){localStorage.setItem("hotels_sort_changed_by_user",true)}}var i=d.retrieve("ta.p13n.currentSort");d.trackEventOnPage("p13n_filter_change","manual_click","f_"+i+"_t_"+g);d.p13n.wizard.changeSort(k,j,g,h)},changeSort:function(m,l,h,j){d.p13n.wizard.updateSortBarText(m,l,h);var k=d.retrieve("ta.p13n.currentSort");if(!k){var i=$$(".JFY_sort_type.display");if(i.length>0){k=i[0].getAttribute("data-type")||i[0].id}}d.p13n.wizard.updateSortBarContent(m,l,k,h);if(d.retrieve("hotels_sort_change_reset_to_first_page.enabled")||h==="priceSaver"){d.keep("hac.filter.changed",{o:"a0"})}if(j&&j===true){d.pages.hac.hacSortChangedToValueWithoutUpdateResults(h)}else{d.remove("ta.p13n.jfyInformationInline");d.pages.hac.hacSortChangedToValue(h)}d.trackEventOnPage("p13n_filter_change","f_"+k+"_t_"+h);d.store("ta.p13n.currentSort",h);if(h==="priceSaver"){var g="";if(l.hasClass("jfy_sort")){g="dropdown"}else{if(l.hasClass("tab")||l.hasClass("inline")){g="inline"}else{if(l.hasClass("priceSaverButton")){g="hotels_flyout"}else{g="hr_flyout"}}}d.trackEventOnPage("PRICE_SAVER_SORT","CLICK",g)}var n=d.retrieve("p13n_callback_on_sort_change");if(n){n()}d.fireEvent("onSortChange")},moveAmongTheSelected:function(h){var g=undefined;if($$(".p13n_tag_cloud")[0]&&$$(".p13n_tag_cloud")[0].getChildren(":not(.selected)")){g=$$(".p13n_tag_cloud")[0].getChildren(":not(.selected)")[0]}if(g){h.parentNode.insertBefore(h,g)}else{h.parentNode.appendChild(h)}},moveAfterTheSelectedInTheCloud:function(h){var g=undefined;if($$(".p13n_tag_cloud")[0]&&$$(".p13n_tag_cloud")[0].getChildren(":not(.selected)")){g=$$(".p13n_tag_cloud")[0].getChildren(":not(.selected)")[1]}if(g){h.parentNode.insertBefore(h,g)}else{h.parentNode.appendChild(h)}},updateCloud:function(h){var g=h.hasClass("selected");if(g){d.p13n.wizard.moveAmongTheSelected(h)}else{d.p13n.wizard.moveAfterTheSelectedInTheCloud(h)}d.p13n.wizard.adjustCloudHeight()},getCloudTagTypeAndValue:function(j){if(!j){return undefined}var h=j.get("class").split(" ");var l="";if(h){h.each(function(m){if(m&&m.contains("jfy_filter_")){l=m}})}var g="jfy_filter_".length;var i=l.slice(g,g+1);var k=l.slice(g+2);return{type:i,value:k}},getFilterTagByTypeAndValue:function(g){if(!g){return undefined}var h=document.getElements(".jfy_filter_overlay_set .jfy_filter_"+g.type+"_"+g.value);if(h&&h.length===1){return h[0]}},getCloudTagByTypeAndValue:function(h){if(!h){return undefined}var g=$$(".jfy_cloud.jfy_filter_"+h.type+"_"+h.value);if(g&&g.length===1){return g[0]}return null},checkPricesVisibility:function(i){var g=$$(".p13n_tag_cloud")[0];var j=undefined;try{j=d.widgets.calendar.getCheckRatesData()}catch(h){return}if(g&&!j){g.getChildren(".priceRelated.selected").each(function(m){var l=d.p13n.wizard.getCloudTagTypeAndValue(m);var k=d.p13n.wizard.getFilterTagByTypeAndValue(l);if(k){d.call("ta.p13n.wizard.toggleTagStateInner",i,m,"p",l.value,null,false)}})}if(g&&!j){g.getChildren(".tag.priceRelated").each(function(k){d.p13n.wizard.updateCloud(k)})}},adjustCloudHeight:function(){var h=[];var i=$$(".p13n_tag_cloud")[0];if(!i){return}i.getChildren(".selected").each(function(k){if(k&&k.isVisible()&&-1===h.indexOf(k.offsetTop)){h.push(k.offsetTop)}});var j=h.length;if(j<=1){i.addClass("one_line");i.addClass("orig_one_line");i.removeClass("more_lines");i.style.height="30px"}else{i.removeClass("one_line");i.removeClass("orig_one_line");i.addClass("more_lines");var g=36;i.style.height=""+((g*j)-3)+"px"}},getOnly:function(g){var h=$$(g);if(h&&h.length==1){return h[0]}else{return undefined}},specifierToAttributeCategory:function(g){switch(g){case"y":case"t":return"style";case"d":return"neighborhood";case"a":return"amenities";default:return null}},toggleFilterState:function(g,h,k,l,p){d.remove("keep_users_on_hotels_v2.id");d.p13n.wizard.resetHACResultsToFirstPage(h,g);d.store("ta.p13n.user.greenbar.interacted",true);var j=d.id("p13n_jfy_small_geo_selections");if(j){j.removeClass("hidden")}var q=document.getElements(".jfy_filter_"+k+"_"+l);if(q){for(var n=0;n<q.length;n++){q[n].toggleClass("selected");if(q[n].hasClass("hidden")&&q[n].hasClass("selected")){q[n].removeClass("hidden")}}}var o=d.p13n.wizard.getCloudTagByTypeAndValue({type:k,value:l});if(o&&o!=-1){if(d.retrieve("ta.p13n.dynamic_tag_ordering")){d.p13n.wizard.updateCloud(o)}}var m=h.hasClass("selected");if(d.retrieve("ta.prodp13n_greenbar_test1.enabled")){d.p13n.wizard.switchBetweenMessageAndTagsInGreenBar()}d.call("ta.p13n.wizard.updateJewelState",g,this,k,l,m);d.call("ta.p13n.wizard.selectTag",g,this,k,l,p,m,"filter");if(m){d.p13n.wizard.refreshAds(p)}},toggleRadiusButtonStates:function(g,h,k,m){var i=d.retrieve("p13n_radius_button_selected_zff");if(d.retrieve("autobroaden_preselect")&&!i&&i!==0){var l=d.id("preselectedRadius");if(l){i=parseInt(l.getAttribute("data-zff"),10);d.store("p13n_radius_button_selected_zff",i)}}var o=0;if(m==3){o=25}else{if(m==2){o=41}}var j=document.getElement(".p13n_radius_button.all_radius_button.disabled");if(j&&i&&i===k){return false}if(k!=o){h.toggleClass("selected")}var n=d.id("p13n_jfy_small_geo_selections");if(n){n.removeClass("hidden")}if(i&&i===k){d.call("ta.p13n.wizard.toggleRadiusTag",g,h,i,m,false);d.call("ta.p13n.wizard.toggleRadiusTag",g,h,o,m,true);d.store("p13n_radius_button_selected_zff",o);if(d.hac.filters.style.v2){d.hac.filters.style.v2.doRadiusButtonClick(h,o)}if(d.retrieve("autobroaden_preselect")){d.autobroadenPreselect.trackUnselect(h)}}else{if(!i&&(k==18||k==19||k==20)){i=18;d.call("ta.p13n.wizard.toggleRadiusTag",g,h,19,m,false);d.call("ta.p13n.wizard.toggleRadiusTag",g,h,20,m,false)}else{if(!i){i=o}}d.call("ta.p13n.wizard.toggleRadiusTag",g,h,i,m,false);d.call("ta.p13n.wizard.toggleRadiusTag",g,h,k,m,true);d.store("p13n_radius_button_selected_zff",k);if(d.hac.filters.style.v2){d.hac.filters.style.v2.doRadiusButtonClick(h,k)}if(d.retrieve("autobroaden_preselect")||d.retrieve("autobroaden_preselect_tracking")){d.autobroadenPreselect.trackSelect(h)}}},toggleRadiusTag:function(i,k,r,u,o){var g=false;if(r==0||r==25||r==41){g=true}if(!g){var j="jfy_selection_bar_radius_zff_"+r+"_cat_"+u;var l=d.id(j);if(l){if(o){l.removeClass("hidden");l.addClass("selected")}else{l.addClass("hidden");l.removeClass("selected")}}var m="p13n_radius_overlay_tag_zff_"+r+"_cat_"+u;var s=document.getElement(".jfy_filter_bar_radius ."+m);var n=document.getElement("#jfy_filter_bar_radius ."+m);if(s){if(o){s.addClass("selected")}else{s.removeClass("selected")}}if(n){if(o){n.addClass("selected")}else{n.removeClass("selected")}}var h=d.select(".JFY_hotel_filter_wrap.radius .jfy_filter_bar_jewel");if(h&&h.length>0){var p=h[0];if(o){p.removeClass("hidden");p.getParent().addClass("hasJewel");p.innerHTML=1}else{p.addClass("hidden");p.getParent().removeClass("hasJewel")}}}var t="p13n_radius_tag_zff_"+r+"_cat_"+u;var q=d.id(t);if(q){if(o){q.addClass("selected")}else{q.removeClass("selected")}}},refreshAds:function(g){if(g){try{d.store("ads.triptype",g);d.common.ads.refreshAdsWithStyle(g)}catch(h){d.util.error.record(h,"unable to refresh ads on style change")}}},switchBetweenMessageAndTagsInGreenBar:function(){var h=$$(".p13n_tag_cloud")[0];var i=$$(".p13n_tag_cloud_side_text")[0];var g=$$(".p13n_tag_cloud_get_started_text")[0];if(!h||!i||!g){return}var j=d.retrieve("ta.p13n.user.greenbar.interacted")||false;var k=h.getChildren(".selected").length;h.removeClass("hidden");i.removeClass("display_table_cell");i.removeClass("hidden");g.removeClass("hidden");if(k===0&&!j){h.addClass("hidden");i.addClass("hidden")}else{i.addClass("display_table_cell");g.addClass("hidden")}},toggleTagState:function(l,i,k,j,g,h){d.remove("keep_users_on_hotels_v2.id");d.p13n.wizard.resetHACResultsToFirstPage(i,l);i.removeClass("hidden");if(!i.hasClass("selected")&&k==="p"&&d.retrieve("meta.hotels_no_prices")&&!d.widgets.calendar.hasPageDates()){d.call("ta.overlays.Factory.loadDatePickerOverlay",l,i,j)}else{d.call("ta.p13n.wizard.toggleTagStateInner",l,i,k,j,g,h)}if(d.retrieve("ta.prodp13n_greenbar_test1.enabled")){d.p13n.wizard.switchBetweenMessageAndTagsInGreenBar()}if(i.hasClass("selected")){d.p13n.wizard.refreshAds(g)}},resetHACResultsToFirstPage:function(g,h){new Event(h).preventDefault();d.keep("hac.filter.changed",{o:"a0"});d.store("hac.pageChanged",true);d.remove("meta.isFromPaging");if(d.p13n&&d.p13n.wizard){if($$(".JFY_sort_wrap")&&$$(".JFY_sort_wrap").isVisible()){$$(".JFY_sort_wrap").toggleClass("hidden",true)}}d.remove("ta.p13n.jfyInformationInline")},toggleTagStateInner:function(g,h,j,k,p,o){var q=document.getElements(".jfy_filter_"+j+"_"+k);if(q){for(var n=0;n<q.length;n++){q[n].toggleClass("selected")}}var m=h.hasClass("selected");d.call("ta.p13n.wizard.updateJewelState",g,this,j,k,m);var l=d.p13n.wizard.positionOfTheTagInCloud(j,k);if(d.retrieve("ta.p13n.dynamic_tag_ordering")){d.p13n.wizard.updateCloud(h)}if(o!==true){d.call("ta.p13n.wizard.selectTag",g,this,j,k,p,m,"cloud",l)}},updateJewelState:function(g,j,k,l,m,i){var h=d.select(".JFY_hotel_filter_wrap."+b(k,l)+" .jfy_filter_bar_jewel");if(h&&h.length>0){var n=h[0];var o=parseInt(n.innerHTML);if(!isNaN(o)){if(i){if((!d.retrieve("meta.hotels_no_prices")||d.widgets.calendar.hasPageDates())&&o!==0){n.removeClass("hidden");n.getParent().addClass("hasJewel")}else{n.addClass("hidden");n.getParent().removeClass("hasJewel")}}else{var p=(m?o+1:o-1);if(p<0){p=0}n.innerHTML=p;if(o===0){n.removeClass("hidden");n.getParent().addClass("hasJewel")}else{if(p===0){n.addClass("hidden");n.getParent().removeClass("hasJewel")}}}}}},positionOfTheTagInCloud:function(j,i){var g=d.p13n.wizard.getCloudTagByTypeAndValue({type:j,value:i});if(!g){return -1}var h=-1;g.getParent().getChildren("span.jfy_cloud").each(function(l,k){if(l===g){h=k}});return h},positionOfTheTagInFilter:function(l,k,m){var g=m?m:d.p13n.wizard.getFilterTagByTypeAndValue({type:l,value:k});if(!g){return -1}var i=-1;var j;if(d.retrieve("hotels_checkbox_filters_2015")){var h=g.getParent();if(h&&h.hasClass("filter_col")){h=h.getParent()}j=h?h.getElements(".jfy_checkbox"):[]}else{j=g.getParent().getChildren("span.jfy_tag_style")}j.each(function(o,n){if(o===g){i=n}});return i},selectTag:function(h,j,l,m,s,q,g,r){if(!g){g=""}if(l==="y"&&m===200){var p;if(g==="cloud"){p="VR_CLOUD_H"}else{p="VR_STYLE_H"}new Request({url:"/ActionRecord?action="+p+"&geo="+modelGeoId}).send()}d.call("ta.p13n.wizard.selectTags",h,this,[{name:l,val:m}],q,g);var p="";if(q===true){p="select"}else{if(q===false){p="unselect"}else{p=q}}if(d.trackEventOnPage&&s&&s.length>0){var i=l+m+"_"+s;var u=r;if(u===null||u===undefined){u=d.p13n.wizard.positionOfTheTagInCloud(l,m)}var o=null;if(d.retrieve("hotels_checkbox_filters_2015")&&j&&j.hasClass&&j.hasClass("jfy_checkbox")){o=j;if(g==="filter"&&o&&o.getParent()&&o.getParent().hasClass("filter_col")){g="filter_lightbox"}}var n=p+":src="+g+":cpos="+u+":fpos="+d.p13n.wizard.positionOfTheTagInFilter(l,m,o);d.trackEventOnPage("p13n_tag",n,i)}if(d.retrieve("ta.p13n.popOrderIfNoTags")){var t=$$(".jfy_sort_bar .display");if(t.length>0){var k=t[0].id;if(p==="unselect"&&f.wizard.getSelectedTags()===""&&k==="recommended"){d.call("ta.p13n.wizard.updateSortBarText",h,this,"popularity")}else{if(p==="select"&&k==="popularity"){d.call("ta.p13n.wizard.updateSortBarText",h,this,"recommended")}}}}},selectTags:function(k,i,g,j,l){var m={};m.a="selectTags";m.tag=JSON.stringify(g);m.sel=j;m.src=l;var h=f.wizard.getSelectedTags();d.store("ta.p13n.tagsWithSave",h);var n="";new Request({url:"/PersonalizationAjax",trackPath:n,onSuccess:function(p){try{d.hac.filters.updateResults()}catch(o){d.util.error.record(o,"p13n.wizard.selectTags - Error making hac request from jfy button",k)}},onFailure:function(o){d.util.error.record(o,"p13n.wizard.selectTags - Error making request",k)},data:m,method:"post"}).send()},toggleShowUnavailableTag:function(h,g){d.store("ta.p13n.showUnavailable",!d.retrieve("ta.p13n.showUnavailable"));d.call("ta.p13n.wizard.selectTags",h,g,[{name:"c",val:"2"}],d.retrieve("ta.p13n.showUnavailable"),"unavailable_tag")},updateVrContentIfTagSelected:function(){var g=d.id("jfy_tag_cloud_y_200");if(g&&g.hasClass("selected")){d.p13n.wizard.vrTagSelected()}},vrTagSelected:function(){var g=d.widgets.calendar.getCheckRatesData();var i="vrHtmlForP13n";if(g){for(var h in g){i+=g[h]}}if(d.has(i)){d.p13n.wizard.insertVrHtml(d.retrieve(i))}else{d.p13n.wizard.fetchAndInsertVrHtml(g,i)}},fetchAndInsertVrHtml:function(g,i){var h={};if(g){h=g}h.a="VRS_FOR_HOTEL_P13N";h.geo=modelGeoId;new Request({url:"/VacationRentalsAjax",data:h,method:"get",onSuccess:function(j){d.store(i,j);d.p13n.wizard.insertVrHtml(j)},onFailure:function(j){d.util.error.record(j,"p13n.wizard.fetchAndInsertVrHtml - Error making request",event)}}).send()},insertVrHtml:function(g){var k="vrP13n";var i=d.id(k);if(i!==null){i.set("html",g);return}var h=d.select(".listing");var j=null;if(!h||h.length===0){j=d.id("count_and_sort_div_id")}else{j=h.length>2?h[2]:h[h.length-1]}if(j){new Element("div",{id:k,html:g}).inject(j,"after")}},getSelectedTags:function(){var i="";var j=d.select(".jfy_filter_overlay_set .selected");var h,g;for(g=0;g<j.length;++g){h=j[g].getAttribute("value");if(h&&h.length>0){i+=(i.length>0?",":"")+h}}j=d.select(".p13n_tag_cloud .selected");for(g=0;g<j.length;++g){h=j[g].getAttribute("value");if(h&&h.length>0){i+=(i.length>0?",":"")+h}}return i},loadLibrary:function(){},showFilters:function(i,g){f.wizard.showFilter("INLINE_COUNT","inline");f.wizard.showFilter("hotelFilters");f.wizard.showFilter("header_tab_wrap","inline-block");f.wizard.showFilter("headingWrapper");f.wizard.showFilter("js_filter_table_cat_1","table");if(d.id("js_filter_table_cat_1")&&d.id("js_filter_table_cat_1").getParent()&&d.id("js_filter_table_cat_1").getParent().getParent()){d.id("js_filter_table_cat_1").getParent().getParent().removeClass("jfy_hidden")}if(d.id("js_filter_table_cat_3")&&d.id("js_filter_table_cat_3").getParent()&&d.id("js_filter_table_cat_3").getParent().getParent()){d.id("js_filter_table_cat_3").getParent().getParent().removeClass("jfy_hidden")}if(d.id("ad728X90")&&d.id("ad728X90").getParent()){d.id("ad728X90").getParent().removeClass("hidden")}f.wizard.showFilter("filterControls");var h=d.find(".metaDatePicker");d.find(".filterControls").appendChild(h);f.wizard.showFilter("style_button_container");if(d.id("BODYCON")){if(d.retrieve("p13n.bodyconExtraPadding")){d.id("BODYCON").addClass("adjust_padding")}}f.wizard.hideFilter("jfy_beta");f.wizard.hideFilter("jfy_member_greeting");f.wizard.hideFilter("p13n_tag_header_wrap")},hideFilters:function(h,g){f.wizard.hideFilter("INLINE_COUNT");f.wizard.hideFilter("hotelFilters");f.wizard.hideFilter("js_filter_table_cat_1");if(d.id("js_filter_table_cat_1")&&d.id("js_filter_table_cat_1").getParent()&&d.id("js_filter_table_cat_1").getParent().getParent()){d.id("js_filter_table_cat_1").getParent().getParent().addClass("jfy_hidden")}if(d.id("js_filter_table_cat_3")&&d.id("js_filter_table_cat_3").getParent()&&d.id("js_filter_table_cat_3").getParent().getParent()){d.id("js_filter_table_cat_3").getParent().getParent().addClass("jfy_hidden")}f.wizard.hideFilter("header_tab_wrap");f.wizard.hideFilter("headingWrapper");if(d.id("ad728X90")&&d.id("ad728X90").getParent()){d.id("ad728X90").getParent().addClass("hidden")}f.wizard.hideFilter("filterControls");if(d.id("BODYCON")){if(d.id("BODYCON").hasClass("adjust_padding")){d.store("p13n.bodyconExtraPadding",true);d.id("BODYCON").removeClass("adjust_padding")}}f.wizard.showFilter("jfy_member_greeting");f.wizard.showFilter("jfy_beta","inline");f.wizard.showFilter("p13n_tag_header_wrap")},showFilter:function(h,j){var g=d.id(h);if(g){g.show(j)}else{var i=d.select("."+h);if(i&&i.length>0){i[0].show(j)}}},hideFilter:function(h){var g=d.id(h);if(g){g.hide()}else{var i=d.select("."+h);if(i&&i.length>0){i[0].hide()}}},reloadTagHeader:function(k,i,h,j){if(d.retrieve("ta.p13n.prodP13nError")){return}d.store("p13n_radius_button_selected_zff",false);d.remove("ta.p13n.priceFilterWithCalender.content");var l=d.widgets.calendar.getDateArgsObject();if(l===null){l={}}l.a="getTagHeader";l.g=h;l.c=j;l.cat=j;l.geo=h;l.sortOrder=d.p13n.wizard.findCurrentSort();if(d.retrieve("hotels_checkbox_filters_2015")){l.tst=d.retrieve("hotels_checkbox_toggle_state");l.jfye=d.retrieve("jfy_sort_visible")?"true":"false"}d.remove("ta.p13n.jfyFilterSet");d.remove("ta.p13n.jfyInformationFlyout");var m="";var g=d.retrieve("hotels_checkbox_filters_2015");new Request({url:"/PersonalizationAjax",trackPath:m,onSuccess:function(H){if(d.id("p13n_tag_header_wrap")!==null){var I=d.find(".jfy_header_tabs_holder").innerHTML;var D=d.find(".jfy_header_dates_holder").innerHTML;var q=g?d.find(".hotels_above_filter_area"):null;var C=q?q.innerHTML:null;var G=g?d.find(".map_launch_stub"):null;var o=G?G.innerHTML:null;d.id("p13n_tag_header_wrap").parentElement.innerHTML=H;d.find(".jfy_header_tabs_holder").innerHTML=I;var u=$$(".p13n_filter_header_v3 #p13n_PROPTYPE_BOX .tab");Array.each(u,function(J){if(J.hasClass("cat_"+j)){J.addClass("current")}else{J.removeClass("current")}});d.find(".jfy_header_dates_holder").innerHTML=D;if(C){q=d.find(".hotels_above_filter_area");if(q){q.innerHTML=C}}if(o){G=d.find(".map_launch_stub");if(G){G.innerHTML=o}}if(d.retrieve("p13n_tag_tab_redesign")){d.p13n.wizard.adjustCloudHeight()}}else{var B=document.createElement("div");B.innerHTML=H;var A=document.getElement(".filter_header_v3");if(A!==null){A.parentElement.insertBefore(B,A)}}d.servlet.HACSearch.updateSpecialOffers(j);d.store("ta.p13n.loadedTagHeader",true);d.p13n.wizard.grabDatePicker(k,i);var w=d.id("p13n_tag_header_wrap");if(w){w.removeAttribute("style")}var s=d.retrieve("p13n_callback_on_sort_change");if(s){s()}var x=d.id("BIG_MAP"),p=d.id("BIG_MAP_IMG"),n=d.retrieve("hotels.big_map_img"),F=document.getElement(".p13n_tag_cloud_green_bg"),r=d.id("JFY_hotel_filters"),z=d.id("p13n_tag_header"),t=d.id("BIG_MAP_WRAPPER");if(x&&p&&n&&r){if(g){x.addClass("with_border");if(z&&t){var v=z.getSize().y;t.setStyle("height",v)}}else{x.setStyle("bottom",r.getSize().y-1)}if(d.retrieve("hotels.big_map_img.1280")){if(g&&t&&z){var v=z.getSize().y;var y=z.getElement(".hotels_special_offers");if(y){v-=(y.getSize().y/2);if(document.getElement(".bg_reset.empty_special_offer_header")){v+=2}}t.setStyle("height",v)}else{if(F&&!g){x.setStyle("bottom",(F.getSize().y+r.getSize().y)-1)}}}p.set("html",n)}var E=d.id("p13n_hotels_list_sorting_header_test1");if(E&&j==1&&!g){E.removeClass("hidden");d.trackEventOnPage("prodp13nPreferencesOverlay","viewingHeaderBar","clickableFromJavascript");d.p13n.wizard.checkForAppropriateSortAndChange()}else{if(E){E.addClass("hidden")}}window.fireEvent("p13nTagHeaderLoaded")},onFailure:function(n){d.util.error.record(n,"p13n.wizard.reloadTagHeader - failed to load tag header from server")},data:l,method:"post"}).send()},checkForAppropriateSortAndChange:function(){var i=d.retrieve("ta.p13n.p13n_show_jfy_sort");var h=d.retrieve("ta.p13n.currentSort");var g="popularity";if(i){g="recommended"}else{if(h&&h!="recommended"){g=h}}d.p13n.wizard.changeSort(null,null,g)},reloadGrayWrap:function(j,h,g,i,m){if(d.retrieve("ta.p13n.prodP13nError")){return}d.remove("ta.p13n.jfyFilterSet");d.remove("ta.p13n.jfyInformationFlyout");d.remove("ta.p13n.priceFilterWithCalender.content");var k=d.widgets.calendar.getDateArgsObject();if(k===null){k={}}k.a="reloadGrayWrap";k.g=g;k.c=i;k.cat=i;k.geo=g;k.rad=d.p13n.wizard.getRadiusParameter(""+m);if(d.retrieve("hotels_checkbox_filters_2015")){k.tst=d.retrieve("hotels_checkbox_toggle_state")}k.sortOrder=d.p13n.wizard.findCurrentSort();var l="";new Request({url:"/PersonalizationAjax",trackPath:l,onSuccess:function(q){if(d.id("p13n_gray_cloud_wrap")!==null){var n=d.find(".JFY_hotel_filter_wrap.radius").innerHTML;var o=d.find("#jfy_filter_bar_radius").innerHTML;d.id("p13n_gray_cloud_wrap").parentElement.innerHTML=q;d.find(".JFY_hotel_filter_wrap.radius").innerHTML=n;d.find("#jfy_filter_bar_radius").innerHTML=o}else{var p=document.createElement("div");p.innerHTML=q;var r=d.id("p13n_tag_header");if(r!==null){r.parentElement.insertAfter(p,r)}}window.fireEvent("p13nGrayWrapLoaded")},onFailure:function(n){d.util.error.record(n,"p13n.wizard.reloadGrayWrap - failed to load gray wrap from server")},data:k,method:"post"}).send()},getRadiusParameter:function(k){var h,j,g,l,i;if(d.has("isUsingMiles")){i=d.retrieve("isUsingMiles");if(i){l="mi"}else{l="km"}if(k){if(i){switch(k){case"18":g="5";break;case"19":g="10";break;case"20":g="25";break;default:g="0";break}}else{switch(k){case"18":g="10";break;case"19":g="25";break;case"20":g="50";break;default:g="0";break}}h=g+l;if(g=="0"){h="0"}}}return h},grabDatePicker:function(j,h){if(typeof d!==undefined){var i=d.find(".metaDatePicker");var g=d.find(".jfy_header_dates_holder");g.appendChild(i);if(d.servlet&&d.servlet.HACSearch){d.servlet.HACSearch.destroyAnimatedDateCTA(true,function(){var k=d.widgets.calendar.getDateArgsObject();if(k==null){d.servlet.HACSearch.loadAnimatedDateCTA()}})}}},backToAllHotels:function(j,i,h,g){f.wizard.backToGeneric(j,i,h,g,a);if(typeof d!==undefined&&d.servlet&&d.servlet.HACSearch){d.servlet.HACSearch.destroyAnimatedDateCTA()}},backToGeneric:function(l,k,j,h,m){var g=document.getElement(".js_zff_"+m);if(g&&h===1){f.wizard.showFilters(l,k,h);g.click()}else{if(h===1&&m!==0){window.location="Hotels-g"+j+"-zff"+m}else{var n="geo="+j+"&c=1&zff=0";var i=d.widgets.calendar.getCheckRatesData();if(i){n=n+"&"+Object.toQueryString(i);d.store("hac.filters.isUpdateDatesRequest",true)}new Request({url:"/FilterState",data:n,method:"post",onSuccess:function(o){window.location=JSON.decode(o).url}}).send()}}},requestAds:function(i,h,g){d.store("p13n.requestAds",true)},toggleFilterExpansion:function(g,j,m){g.stopPropagation();if(m===undefined){return}if(document.getElement(".horizontal_filters_wrap")){var h=document.getElement(".jfy_filter_bar_top");if(h){h.toggleClass("expanded");var l=h.hasClass("expanded");h.getElements(".resizer_link.less, .resizer.sprite-tag_list_compress").toggleClass("hidden",!l);h.getElements(".resizer_link.all, .resizer.sprite-tag_list_expand").toggleClass("hidden",l);if(!h.hasClass("expanded")){var k=(d.retrieve("ta.p13n.jfyFilterSet")||{})[m==="amenities"?"jfy_amenities":m];if(k){k.overrideHoverDelayOnce(750)}}}}else{var i;if(m==="amenities"){i=d.select(".jfy_filter_bar_jfy_"+m)}else{i=d.select(".jfy_filter_bar_"+m)}if(i&&i.length>0){$$(".jfy_filter_bar .jfy_filter_"+m+"_link.all").removeClass("hidden");$$(".jfy_filter_bar .jfy_filter_"+m+"_link.less").removeClass("hidden");$$(".jfy_filter_bar .jfy_filter_"+m+"_bar_tags_resizer.sprite-tag_list_expand").removeClass("hidden");$$(".jfy_filter_bar .jfy_filter_"+m+"_bar_tags_resizer.sprite-tag_list_compress").removeClass("hidden");var h=i[0];h.toggleClass("expanded");if(h.hasClass("expanded")){$$(".jfy_filter_bar .jfy_filter_"+m+"_link.all").addClass("hidden");$$(".jfy_filter_bar .jfy_filter_"+m+"_bar_tags_resizer.sprite-tag_list_expand").addClass("hidden")}else{$$(".jfy_filter_bar .jfy_filter_"+m+"_link.less").addClass("hidden");$$(".jfy_filter_bar .jfy_filter_"+m+"_bar_tags_resizer.sprite-tag_list_compress").addClass("hidden");var o=d.retrieve("ta.p13n.jfyFilterSet");if(o){var n=o[m==="amenities"?"jfy_amenities":m];if(n){n.overrideHoverDelayOnce(750)}}}}}},expandTagOnSimilarTab:function(i,g,l,k){var j=d.select(".tagDisplay_oneLine_"+l);var h=d.select(".tagDisplay_all_"+l);if(j&&h&&k!==undefined){j.toggle("hidden",!k);h.toggle("hidden",k)}},track:function(j,g,i,h){if(d.trackEventOnPage){d.trackEventOnPage("p13n_wizard",j,g,i,h)}},loadDatePickerOverlay:function(m,k,g){d.store("ta.p13n.currentTagPriceElmt",k);d.store("ta.p13n.currentTagPriceValue",g);var j=d.retrieve("ta.overlays.filters.PriceOverlay.showCalendarLightbox");if(typeof(j)!=="function"){var l;l=d.id("PriceFilterCalendarOverlayContent");if(!l){return}l.show();var i={style:"priceFilterCalendarOverlay",innerDiv:"skv3",content:l,autoShow:false,backdrop:d.overlays.BACKDROP_ALWAYS,closeButtonClass:"roundOuterClose",permanent_except_same:true,type:"p13nPriceOverlay",onShow:function(){d.remove("ta.calendar.isOutDateTrigger");d.store("ta.calendar.isPriceOverlayCalendar",true);var p=null;var o=document.getElement("date_picker_in_PriceFilterCalendar");setTimeout(function(){d.overlays.Factory.loadDatePicker(p,o,"PriceFilterCalendar","",d.servlet.HACSearch.doMetaDateSearch)},100);if(this.calendar){this.calendar.reposition()}},onClose:function(){d.remove("ta.calendar.isOutDateTrigger");d.remove("ta.calendar.isPriceOverlayCalendar")},onHide:function(){var p=d.retrieve("ta.p13n.currentTagPriceElmt");var o=d.retrieve("ta.p13n.currentTagPriceValue");if(p&&o&&(!d.retrieve("meta.hotels_no_prices")||d.widgets.calendar.hasPageDates())){d.call("ta.p13n.wizard.toggleTagStateInner",m,p,"p",o)}d.remove("ta.p13n.currentTagPriceValue")}};var n=d.id("HEADING");var h=new d.overlays.CenteredOverlay(i,n);d.store("ta.overlays.filters.PriceOverlay.showCalendarLightbox",function(){h.show()})}j=d.retrieve("ta.overlays.filters.PriceOverlay.showCalendarLightbox");j()},doPriceOverlayOnHover:function(h,g){if(!d.retrieve("meta.hotels_no_prices")||d.widgets.calendar.hasPageDates()){d.call("ta.overlays.Factory.loadJFYHotelsFilter",h,g,"price")}else{d.call("ta.p13n.wizard._disablePriceOverlay",h)}},doPriceOverlayOnClick:function(h,g){if(!d.retrieve("meta.hotels_no_prices")||d.widgets.calendar.hasPageDates()){if(!d.retrieve("ta.p13n.filterOnHover")){d.call("ta.overlays.Factory.loadJFYHotelsFilter",h,g,"price")}}else{d.call("ta.p13n.wizard._disablePriceOverlay",h);d.call("ta.overlays.Factory.loadDatePickerOverlay",h,g,null)}},_disablePriceOverlay:function(h){h.stop();var g=d.retrieve("ta.p13n.jfyFilterSet");if(g){var i=g.price;if(i){i.disable()}}},adjustFilterHeader:function(){var i=d.id("JFY_hotel_filters");var h=d.id("MAINWRAP");if(i&&h){var g=window.getScroll().y;if(g<h.getPosition().y){i.removeClass("JFY_hotel_filters_sticky");c=false}if(g>h.getPosition().y-i.getHeight()&&!c){c=true;i.addClass("JFY_hotel_filters_sticky")}}},propertyClicked:function(i,h,g){var k=d.id("hotel_"+g);if(!k){return}try{d.fireEvent("propertyClick",[g])}catch(j){d.util.error.record(j,"prodp13n property clicked tracking failed")}},showLocationInFilter:function(m,j){var j=d.id(j);var l=j.getAttribute("data-locationType");var g=".jfy_filter_bar.jfy_filter_bar_neighborhood";var h={popular:d.select(g+" .location_popular"),neighborhood:d.select(g+" .location_neighborhood"),attraction:d.select(g+" .location_attraction")};var k={popular:d.select(g+" .lnk_popular"),neighborhood:d.select(g+" .lnk_neighborhood"),attraction:d.select(g+" .lnk_attraction")};for(var i in h){if(h.hasOwnProperty(i)&&h[i]!==undefined){var n=(i===l);h[i].toggleClass("hidden",!n);k[i].toggleClass("selected",n)}}},fixSEOUrl:function(i,h,g){if(window.history&&window.history.pushState){window.history.pushState(g,"",g)}},highlightSortOption:function(i,h,g){if(!i){return}$$(".jfy_sort.selected").toggleClass("selected",false);$$(".jfy_sort."+g).toggleClass("selected",true)},justifyRightSortOption:function(){var g=d.p13n.wizard.findCurrentSort();$$(".jfy_sort.selected").toggleClass("hidden",false);$$(".jfy_sort.selected").toggleClass("selected",false);$$(".jfy_sort."+g).toggleClass("selected",true)},findCurrentSort:function(){var h=d.retrieve("ta.p13n.currentSort");if(!h){var g=$$(".JFY_sort_type.display");if(g.length>0){h=g[0].getAttribute("data-type")||g[0].id;d.store("ta.p13n.currentSort",h)}}if(!h){return""}return h},hideAvailabilitySort:function(k,i){var j=document.getElement(".jfy_sort.availability");var h=document.getElement(".JFY_sort_type.availability");if(j&&h){if(!d.retrieve("ta.p13n.currentSort")||d.retrieve("ta.p13n.currentSort")==="availability"){var g=document.getElement(".jfy_sort.recommended");if(g&&!g.hasClass("hidden")){d.call("ta.p13n.wizard.changeSort",k,i,"recommended",true)}else{if(d.retrieve("ta.p13n.showFriendSort")){d.call("ta.p13n.wizard.changeSort",k,i,"friends",true)}else{d.call("ta.p13n.wizard.changeSort",k,i,"popularity",true)}}}j.addClass("hidden");h.addClass("hidden")}},showAvailabilitySort:function(j,h){var i=document.getElement(".jfy_sort.availability");var g=document.getElement(".JFY_sort_type.availability");if(i&&g){i.removeClass("hidden");g.removeClass("hidden");if(d.p13n.wizard.findCurrentSort()!=="recommended"){d.p13n.wizard.changeSort(j,h,"availability",true)}}},closeCalendarFilter:function(j,g,i){var h=d.retrieve("ta.p13n.jfyFilterSet");if(h){var k=h.price;if(k){k.overridePinnableOption(i);if(k.visible){k.hideNow()}}}d.store("ta.p13n.jfyFilterSet",h)},createPreferencesOverlay:function(l,i,k,h){var g=new d.overlays.Overlay({backdrop:1,autoShow:false,noPadding:true,showCloseButton:false,backdropColor:"#fff",style:"overlayNoBorderFadeOut",innerDivClass:"prodp13nPreferencesOverlay",backdropOpacity:0.95,noScroll:true}).addEvents({onClose:function(o){}});var n="";if(!k){k=1}var m={};m.a="preferencesOverlay";m.g=h;m.step=k;var j=d.retrieve("ta.p13n.wizard.preferenceList");if(j){m.preferenceList=j}new Request({url:"/PersonalizationAjax",trackPath:n,onSuccess:function(o){g.loadRemoteSuccess(o);g.show();if($$(".whiteBackground")&&$$(".whiteBackground").length>0){$$(".whiteBackground")[0].addEventListener("wheel",d.p13n.wizard.whiteBackgroundOnScroll,false)}d.trackEventOnPage("prodp13nPreferencesOverlay","viewingOverlayPage",null,k);d.store("ta.p13n.prodp13nPreferencesOverlay",g)},onFailure:function(o){d.util.error.record(o,"Unable to load preferencesOverlay")},data:m,method:"post"}).send();d.p13n.wizard.addPreferencesHashHandler()},createPreferencesOverlayFromHeaderBar:function(k,i,j,h,l){var g=d.p13n.wizard.findCurrentSort();if(g==="recommended"||g==="availability"||g==="popularity"){d.trackEventOnPage("prodp13nPreferencesOverlay","clickedOnSortHeader",l);d.p13n.wizard.createPreferencesOverlay(k,i,j,h)}},closePreferencesOverlay:function(i,h){d.trackEventOnPage("prodp13nPreferencesOverlay","closingOverlay","closePreferencesOverlayFunction");var g=d.retrieve("ta.p13n.prodp13nPreferencesOverlay");d.p13n.wizard.preferencesHandleHashLocation();if(d.has("ta.p13n.wizard.preferenceList.interacted")){if($$(".JFY_sort_type.recommended").length>0){$$(".jfy_sort_type.recommended").toggleClass("hidden",false);d.call("ta.p13n.wizard.changeSort",i,h,"recommended",false)}else{d.p13n.wizard.preferencesHandleHashLocation();window.location.reload()}}},whiteBackgroundClosePreferencesOverlay:function(h,g){if(h&&h.target&&h.target.hasClass("whiteBackground")){d.trackEventOnPage("prodp13nPreferencesOverlay","closingOverlay","fromWhiteSpace");d.call("ta.p13n.wizard.closePreferencesOverlay",h,g)}},whiteBackgroundOnScroll:function(h){var g=$$(".preferencesList")[0];g.scrollTo(g.scrollLeft,g.scrollTop+h.deltaY)},selectPreference:function(l,g,k,j,n){var i=d.retrieve("ta.p13n.wizard.preferenceList");if(!i){i={}}var m=""+k+j;var h=g.getParent().getParent().getElements(".selectorButton.selected");if(h){h.each(function(o){o.removeClass("selected")})}g.addClass("selected");i[m]=n;d.trackEventOnPage("prodp13nPreferencesOverlay","selectedPreferenceTag",m,n);d.store("ta.p13n.wizard.preferenceList",i);d.store("ta.p13n.wizard.preferenceList.interacted",true);d.p13n.wizard.savePreferenceSelection()},togglePreferenceSelection:function(k,g,j,i){var h=d.retrieve("ta.p13n.wizard.preferenceList");if(!h){h={}}var l=""+j+i;if(g.hasClass("selected")){g.removeClass("selected");h[l]=0;d.trackEventOnPage("prodp13nPreferencesOverlay","selectedPreferenceTag",l,0)}else{g.addClass("selected");h[l]=3;d.trackEventOnPage("prodp13nPreferencesOverlay","selectedPreferenceTag",l,3)}d.store("ta.p13n.wizard.preferenceList",h);d.store("ta.p13n.wizard.preferenceList.interacted",true);d.p13n.wizard.savePreferenceSelection()},savePreferenceSelection:function(){var h={};h.a="selectPreferences";var g=d.retrieve("ta.p13n.wizard.preferenceList");if(g){h.preferenceList=g}var i="";new Request({url:"/PersonalizationAjax",trackPath:i,onSuccess:function(j){},onFailure:function(j){d.util.error.record(j,"Unable to save preference selection in ta.p13n.wizard.savePreferenceSelection")},data:h,method:"post"}).send()},addPreferencesHashHandler:function(){if(!!(window.history&&window.history.pushState)){var g={state:true};if(window.location.hash=="#preferences"){d.store("ta.p13n.wizard.preferencesList.alreadyHadHash",true)}history.pushState(g,"title","#preferences");window.onpopstate=function(){d.p13n.wizard.preferencesHandleHashLocation()}}},ensureJustForYou:function(){if(d.retrieve("ta.p13n.just_for_you_sort_checked")){return}d.store("ta.p13n.just_for_you_sort_checked",true);d.p13n.wizard.checkForAppropriateSortAndChange()},setAttributeTagAndReloadResults:function(h,j,g,i){var k={};k.a="clearSelectionAndForceTag";k.prodP13nTagsWithSave=h+" "+j;var l="";new Request({url:"/PersonalizationAjax",trackPath:l,onSuccess:function(o){try{var m=d.id("categoryCrossSellContainer");if(m){m.addClass("hidden")}d.p13n.wizard.reloadTagHeader(null,null,g,i);if(d.hac.filters&&d.hac.filters.changeCategory){d.hac.filters.changeCategory(i)}else{d.hac.filters.updateResults()}}catch(n){d.util.error.record(n,"placement: prodp13n_category_cross_sells - error upon opening new tab")}},onFailure:function(m){d.util.error.record(m,"placement: prodp13n_category_cross_sells - Error making request in setFilterAndReloadResults")},data:k,method:"post"}).send()},preferencesHandleHashLocation:function(){var g=d.retrieve("ta.p13n.prodp13nPreferencesOverlay");if((!!(window.history&&window.history.pushState))&&window.location.hash=="#preferences"&&!d.has("ta.p13n.wizard.preferencesList.alreadyHadHash")&&g){window.history.back()}else{if((window.location.hash==""||d.has("ta.p13n.wizard.preferencesList.alreadyHadHash"))&&g){d.trackEventOnPage("prodp13nPreferencesOverlay","closingOverlay","fromHandleHashLocation");g.hide()}}}};if(!e){if(d.retrieve("ta.p13n.persistentFilters")){window.addEvent("scroll",f.wizard.adjustFilterHeader)}}d.p13n.wizard.adjustCloudHeight();d.on("onCalendarRangeSelect",function(){if(d.retrieve("ta.p13n.priceFilterWithCalendar.isEnabled")){d.p13n.wizard.closeCalendarFilter(null,null,false)}d.p13n.wizard.checkPricesVisibility(window.event)})}(ta,ta.p13n||(ta.p13n={})));(function(a,b){b.ltquestions={createQuestionsOverlayFromHeaderBar:function(f,d,e,c,g){a.trackEventOnPage("prodp13nQuestionsOverlay","clickedOnSortHeader",g);a.p13n.ltquestions.createQuestionsOverlay(f,d,e,c)},createCompactQuestionsOverlayFromHeaderBar:function(f,d,e,c,g){a.trackEventOnPage("prodp13nQuestionsOverlay","clickedOnSortHeader",g);a.p13n.ltquestions.createCompactQuestionsOverlay(f,d,e,c,g);f.stopPropagation()},createQuestionsOverlay:function(h,e,g,d){var c=new a.overlays.Overlay({backdrop:1,autoShow:false,noPadding:true,showCloseButton:false,backdropColor:"#fff",style:"overlayNoBorderFadeOut",innerDivClass:"prodp13nPreferencesOverlay",backdropOpacity:0.95,noScroll:true}).addEvents({onClose:function(k){}});var j="";if(!g){g=1}var i={};i.a="ltQuestionsOverlay";i.g=d;i.step=g;var f=a.retrieve("ta.p13n.ltquestions.questionsList");if(f){i.questionsList=f}new Request({url:"/PersonalizationAjax",trackPath:j,onSuccess:function(k){c.loadRemoteSuccess(k);c.show();a.trackEventOnPage("prodp13nQuestionsOverlay","viewingOverlayPage",null,g);a.store("ta.p13n.prodp13nQuestionsOverlay",c)},onFailure:function(k){a.util.error.record(k,"Unable to load ltQuestionsOverlay")},data:i,method:"post"}).send();a.p13n.ltquestions.addPreferencesHashHandler()},createCompactQuestionsOverlay:function(c,e,f,d,k){var g=new a.overlays.Overlay({backdrop:1,autoShow:false,noPadding:true,showCloseButton:false,backdropColor:"#222",style:"overlayNoBorderFadeOut",innerDivClass:"prodp13nPreferencesOverlay compact",backdropOpacity:0.9,noScroll:true}).addEvents({onClose:function(l){}});var h="";if(!f&&f!==0){f=1}var i={};i.a="ltQuestionsOverlay";i.g=d;i.step=f;i.barType=k;var j=a.retrieve("ta.p13n.ltquestions.questionsList");if(j){i.questionsList=j}new Request({url:"/PersonalizationAjax",trackPath:h,onSuccess:function(m){g.loadRemoteSuccess(m);g.show();a.trackEventOnPage("prodp13nQuestionsOverlay","viewingOverlayPage",null,f);a.store("ta.p13n.prodp13nQuestionsOverlay",g);if(($$(".hotels_list_placement").length==1)&&($$("#pointerToPreferences").length==1)){if($$(".hotels_list_placement")[0]&&$$(".hotels_list_placement")[0].getPosition()&&$$("#pointerToPreferences")[0]){var l=798+$$(".hotels_list_placement")[0].getPosition().x-window.pageXOffset;var n=-95+$$(".hotels_list_placement")[0].getPosition().y-window.pageYOffset;if(n<0){n=n+170;if($$("#pointerToPreferences .arrowDown").length>0){$$("#pointerToPreferences .arrowDown")[0].addClass("arrowUp");$$("#pointerToPreferences .arrowDown")[0].removeClass("arrowDown")}}if(window.getSize().x-l<100){l=l+10000}$$("#pointerToPreferences")[0].setStyle("margin-left",""+l+"px");$$("#pointerToPreferences")[0].setStyle("margin-top",""+n+"px")}}},onFailure:function(l){a.util.error.record(l,"Unable to load ltQuestionsOverlay")},data:i,method:"post"}).send();a.p13n.ltquestions.addPreferencesHashHandler()},backgroundClosePreferencesOverlay:function(d,c){if(d&&d.target&&d.target.hasClass("darkSpaceBackground")){a.trackEventOnPage("prodp13nPreferencesOverlay","closingOverlay","fromWhiteSpace");a.call("ta.p13n.ltquestions.closeQuestionsOverlay",d,c,"fromWhiteSpace")}},closeQuestionsOverlay:function(g,e,f){var c=a.retrieve("ta.p13n.prodp13nQuestionsOverlay");a.p13n.ltquestions.preferencesHandleHashLocation();if(f&&typeof f==="string"){a.trackEventOnPage("prodp13nPreferencesOverlay","closingOverlay",f)}else{a.trackEventOnPage("prodp13nPreferencesOverlay","closingOverlay","unknown")}var d=a.retrieve("ta.p13n.reload_sort_header");if(d){d()}if(a.has("ta.p13n.ltquestions.questionsList.interacted")){if($$(".JFY_sort_type.recommended").length>0){a.call("ta.p13n.wizard.changeSort",g,e,"recommended",false)}else{a.p13n.ltquestions.preferencesHandleHashLocation();window.location.reload()}}},addPreferencesHashHandler:function(){if(!!(window.history&&window.history.pushState)){var c={state:true};if(window.location.hash=="#ltquestions"){a.store("ta.p13n.ltquestions.questionsList.alreadyHadHash",true)}history.pushState(c,"title","#ltquestions");window.onpopstate=function(){a.p13n.ltquestions.preferencesHandleHashLocation()}}},preferencesHandleHashLocation:function(){var c=a.retrieve("ta.p13n.prodp13nQuestionsOverlay");if((!!(window.history&&window.history.pushState))&&window.location.hash=="#ltquestions"&&!a.has("ta.p13n.ltquestions.questionsList.alreadyHadHash")&&c){window.history.back()}else{if((window.location.hash==""||a.has("ta.p13n.ltquestions.questionsList.alreadyHadHash"))&&c){c.hide()}}},toggleQuestionSelection:function(g,c,f,e){var d=a.retrieve("ta.p13n.ltquestions.questionsList");if(!d){d={}}var h=""+f+e;if(c.hasClass("selected")){c.removeClass("selected");d[h]=false;a.trackEventOnPage("prodp13nQuestionsOverlay","selectedQuestionTag",h,0)}else{c.addClass("selected");d[h]=true;a.trackEventOnPage("prodp13nQuestionsOverlay","selectedQuestionTag",h,1)}a.store("ta.p13n.ltquestions.questionsList",d);a.store("ta.p13n.ltquestions.questionsList.interacted",true);a.p13n.ltquestions.saveQuestionSelection()},saveQuestionSelection:function(){var d={};d.a="selectQuestions";var c=a.retrieve("ta.p13n.ltquestions.questionsList");if(c){d.questionsList=c}var e="";new Request({url:"/PersonalizationAjax",trackPath:e,onSuccess:function(f){},onFailure:function(f){a.util.error.record(f,"Unable to save preference selection in ta.p13n.ltquestions.saveQuestionSelection")},data:d,method:"post"}).send()},showAllOptions:function(d,c){$$(".moreOptions").addClass("displayed");$$(".moreOptionsLink").addClass("hidden")},whiteBackgroundCloseLtQuestionsOverlay:function(d,c){if(d&&d.target&&(d.target.hasClass("whiteBackground")||d.target.hasClass("preferenceOverlayBody")||d.target.hasClass("preferenceOverlayBodyOffset"))){a.trackEventOnPage("prodp13nQuestionsOverlay","closingOverlay","fromWhiteSpace");a.call("ta.p13n.ltquestions.closeQuestionsOverlay",d,c)}}}}(ta,ta.p13n||(ta.p13n={})));ta.p13n.recommendations={jfyRateRecommendation:function(e,d){if(!d){return}d=ta.id(d);var c="selected";var b="unselected";var f;var g=d.parentNode.id.match(/rateRec_(\d+)/)[1];if(d.hasClass(c)){d.removeClass(c);d.addClass(b);f="NoThumb"}else{d.removeClass(b);d.addClass(c);f=(d.hasClass("yes")?"ThumbsUp":"ThumbsDown");var h=d.getSiblings(".jfy_yes_no");if(h.length){var a=h[0];if(a){a.removeClass(c);a.addClass(b)}}}ta.p13n.recommendations.setThumbState(g,f)},setThumbState:function(c,a){var b={};b.a="setThumbState";b.l=c;b.t=a;new Request({url:"/PersonalizationAjax",onFailure:function(d){ta.util.error.record(d,"p13n.recommendations.setThumbState - failed to set state")},data:b,method:"post"}).send()}};