(function(){this.MooTools={version:"1.3.1dev",build:"%build%"};var n=this.typeOf=function(r){if(r==null){return"null"}if(r.$family){return r.$family()}if(r.nodeName){if(r.nodeType==1){return"element"}if(r.nodeType==3){return(/\S/).test(r.nodeValue)?"textnode":"whitespace"}}else{if(typeof r.length=="number"){if(r.callee){return"arguments"}if("item" in r){return"collection"}}}return typeof r};var h=this.instanceOf=function(t,r){if(t==null){return false}var s=t.$constructor||t.constructor;while(s){if(s===r){return true}s=s.parent}return t instanceof r};var f=this.Function;var o=true;for(var j in {toString:1}){o=null}if(o){o=["hasOwnProperty","valueOf","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","constructor"]}f.prototype.overloadSetter=function(s){var r=this;return function(u,t){if(u==null){return this}if(s||typeof u!="string"){for(var v in u){r.call(this,v,u[v])}if(o){for(var w=o.length;w--;){v=o[w];if(u.hasOwnProperty(v)){r.call(this,v,u[v])}}}}else{r.call(this,u,t)}return this}};f.prototype.overloadGetter=function(s){var r=this;return function(u){var v,t;if(s||typeof u!="string"){v=u}else{if(arguments.length>1){v=arguments}}if(v){t={};for(var w=0;w<v.length;w++){t[v[w]]=r.call(this,v[w])}}else{t=r.call(this,u)}return t}};f.prototype.extend=function(r,s){this[r]=s}.overloadSetter();f.prototype.implement=function(r,s){this.prototype[r]=s}.overloadSetter();var m=Array.prototype.slice;f.from=function(r){return(n(r)=="function")?r:function(){return r}};Array.from=function(r){if(r==null){return[]}return(a.isEnumerable(r)&&typeof r!="string")?(n(r)=="array")?r:m.call(r):[r]};Number.from=function(s){var r=parseFloat(s);return isFinite(r)?r:null};String.from=function(r){return r+""};f.implement({hide:function(){this.$hidden=true;return this},protect:function(){this.$protected=true;return this}});var a=this.Type=function(u,t){if(u){var s=u.toLowerCase();var r=function(v){return(n(v)==s)};a["is"+u]=r;if(t!=null){t.prototype.$family=(function(){return s}).hide()}}if(t==null){return null}t.extend(this);t.$constructor=a;t.prototype.$constructor=t;return t};var e=Object.prototype.toString;a.isEnumerable=function(r){return(r!=null&&typeof r.length=="number"&&e.call(r)!="[object Function]")};var p={};var q=function(r){var s=n(r.prototype);return p[s]||(p[s]=[])};var b=function(s,w){if(w&&w.$hidden){return this}var r=q(this);for(var t=0;t<r.length;t++){var v=r[t];if(n(v)=="type"){b.call(v,s,w)}else{v.call(this,s,w)}}var u=this.prototype[s];if(u==null||!u.$protected){this.prototype[s]=w}if(this[s]==null&&n(w)=="function"){l.call(this,s,function(x){return w.apply(x,m.call(arguments,1))})}return this};var l=function(r,t){if(t&&t.$hidden){return this}var s=this[r];if(s==null||!s.$protected){this[r]=t}return this};a.implement({implement:b.overloadSetter(),extend:l.overloadSetter(),alias:function(r,s){b.call(this,r,this.prototype[s])}.overloadSetter(),mirror:function(r){q(this).push(r);return this}});new a("Type",a);var d=function(r,v,t){var s=(v!=Object),z=v.prototype;if(s){v=new a(r,v)}for(var w=0,u=t.length;w<u;w++){var A=t[w],y=v[A],x=z[A];if(y){y.protect()}if(s&&x){delete z[A];z[A]=x.protect()}}if(s){v.implement(z)}return d};d("String",String,["charAt","charCodeAt","concat","indexOf","lastIndexOf","match","quote","replace","search","slice","split","substr","substring","toLowerCase","toUpperCase"])("Array",Array,["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice","indexOf","lastIndexOf","filter","forEach","every","map","some","reduce","reduceRight"])("Number",Number,["toExponential","toFixed","toLocaleString","toPrecision"])("Function",f,["apply","call","bind"])("RegExp",RegExp,["exec","test"])("Object",Object,["create","defineProperty","defineProperties","keys","getPrototypeOf","getOwnPropertyDescriptor","getOwnPropertyNames","preventExtensions","isExtensible","seal","isSealed","freeze","isFrozen"])("Date",Date,["now"]);Object.extend=l.overloadSetter();Date.extend("now",function(){return +(new Date)});new a("Boolean",Boolean);Number.prototype.$family=function(){return isFinite(this)?"number":"null"}.hide();Number.extend("random",function(s,r){return Math.floor(Math.random()*(r-s+1)+s)});Object.extend("forEach",function(r,t,u){for(var s in r){if(r.hasOwnProperty(s)){t.call(u,r[s],s,r)}}});Object.each=Object.forEach;Array.implement({forEach:function(t,u){for(var s=0,r=this.length;s<r;s++){if(s in this){t.call(u,this[s],s,this)}}},each:function(r,s){Array.forEach(this,r,s);return this}});var k=function(r){switch(n(r)){case"array":return r.clone();case"object":return Object.clone(r);default:return r}};Array.implement("clone",function(){var r=this.length,s=new Array(r);while(r--){s[r]=k(this[r])}return s});var g=function(s,r,t){switch(n(t)){case"object":if(n(s[r])=="object"){Object.merge(s[r],t)}else{s[r]=Object.clone(t)}break;case"array":s[r]=t.clone();break;default:s[r]=t}return s};Object.extend({merge:function(y,t,s){if(n(t)=="string"){return g(y,t,s)}for(var x=1,r=arguments.length;x<r;x++){var u=arguments[x];for(var w in u){g(y,w,u[w])}}return y},clone:function(r){var t={};for(var s in r){t[s]=k(r[s])}return t},append:function(v){for(var u=1,s=arguments.length;u<s;u++){var r=arguments[u]||{};for(var t in r){v[t]=r[t]}}return v}});["Object","WhiteSpace","TextNode","Collection","Arguments"].each(function(r){new a(r)});var c=Date.now();String.extend("uniqueID",function(){return(c++).toString(36)})})();Array.implement({invoke:function(a){var b=Array.slice(arguments,1);return this.map(function(c){return c[a].apply(c,b)})},every:function(c,d){for(var b=0,a=this.length;b<a;b++){if((b in this)&&!c.call(d,this[b],b,this)){return false}}return true},filter:function(d,e){var c=[];for(var b=0,a=this.length;b<a;b++){if((b in this)&&d.call(e,this[b],b,this)){c.push(this[b])}}return c},clean:function(){return this.filter(function(a){return a!=null})},indexOf:function(c,d){var a=this.length;for(var b=(d<0)?Math.max(0,a+d):d||0;b<a;b++){if(this[b]===c){return b}}return -1},map:function(d,e){var c=[];for(var b=0,a=this.length;b<a;b++){if(b in this){c[b]=d.call(e,this[b],b,this)}}return c},some:function(c,d){for(var b=0,a=this.length;b<a;b++){if((b in this)&&c.call(d,this[b],b,this)){return true}}return false},associate:function(c){var d={},b=Math.min(this.length,c.length);for(var a=0;a<b;a++){d[c[a]]=this[a]}return d},link:function(c){var a={};for(var e=0,b=this.length;e<b;e++){for(var d in c){if(c[d](this[e])){a[d]=this[e];delete c[d];break}}}return a},contains:function(a,b){return this.indexOf(a,b)!=-1},append:function(a){this.push.apply(this,a);return this},getLast:function(){return(this.length)?this[this.length-1]:null},getRandom:function(){return(this.length)?this[Number.random(0,this.length-1)]:null},include:function(a){if(!this.contains(a)){this.push(a)}return this},combine:function(c){for(var b=0,a=c.length;b<a;b++){this.include(c[b])}return this},erase:function(b){for(var a=this.length;a--;){if(this[a]===b){this.splice(a,1)}}return this},empty:function(){this.length=0;return this},flatten:function(){var d=[];for(var b=0,a=this.length;b<a;b++){var c=typeOf(this[b]);if(c=="null"){continue}d=d.concat((c=="array"||c=="collection"||c=="arguments"||instanceOf(this[b],Array))?Array.flatten(this[b]):this[b])}return d},pick:function(){for(var b=0,a=this.length;b<a;b++){if(this[b]!=null){return this[b]}}return null},hexToRgb:function(b){if(this.length!=3){return null}var a=this.map(function(c){if(c.length==1){c+=c}return c.toInt(16)});return(b)?a:"rgb("+a+")"},rgbToHex:function(d){if(this.length<3){return null}if(this.length==4&&this[3]==0&&!d){return"transparent"}var b=[];for(var a=0;a<3;a++){var c=(this[a]-0).toString(16);b.push((c.length==1)?"0"+c:c)}return(d)?b:"#"+b.join("")}});var Event=new Type("Event",function(a,j){if(!j){j=window}var p=j.document;a=a||j.event;if(a.$extended){return a}this.$extended=true;var o=a.type,l=a.target||a.srcElement,n={},c={};while(l&&l.nodeType==3){l=l.parentNode}if(o.indexOf("key")!=-1){var b=a.which||a.keyCode;var r=Object.keyOf(Event.Keys,b);if(o=="keydown"){var d=b-111;if(d>0&&d<13){r="f"+d}}if(!r){r=String.fromCharCode(b).toLowerCase()}}else{if((/click|mouse|menu/i).test(o)){p=(!p.compatMode||p.compatMode=="CSS1Compat")?p.html:p.body;n={x:(a.pageX!=null)?a.pageX:a.clientX+p.scrollLeft,y:(a.pageY!=null)?a.pageY:a.clientY+p.scrollTop};c={x:(a.pageX!=null)?a.pageX-j.pageXOffset:a.clientX,y:(a.pageY!=null)?a.pageY-j.pageYOffset:a.clientY};if((/DOMMouseScroll|mousewheel/).test(o)){var m=(a.wheelDelta)?a.wheelDelta/120:-(a.detail||0)/3}var h=(a.which==3)||(a.button==2),q=null;if((/over|out/).test(o)){q=a.relatedTarget||a[(o=="mouseover"?"from":"to")+"Element"];var k=function(){while(q&&q.nodeType==3){q=q.parentNode}return true};var g=(Browser.firefox2)?k.attempt():k();q=(g)?q:null}}else{if((/gesture|touch/i).test(o)){this.rotation=a.rotation;this.scale=a.scale;this.targetTouches=a.targetTouches;this.changedTouches=a.changedTouches;var f=this.touches=a.touches;if(f&&f[0]){var e=f[0];n={x:e.pageX,y:e.pageY};c={x:e.clientX,y:e.clientY}}}else{if((/drag(enter|leave|over)|drop/i).test(o)){this.dataTransfer=a.dataTransfer}}}}return Object.append(this,{event:a,type:o,page:n,client:c,rightClick:h,wheel:m,relatedTarget:document.id(q),target:document.id(l),code:b,key:r,keyCode:a.keyCode,clientX:a.clientX,clientY:a.clientY,shift:a.shiftKey,control:a.ctrlKey,alt:a.altKey,meta:a.metaKey})});Event.Keys={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46};Event.implement({stop:function(){return this.stopPropagation().preventDefault()},stopPropagation:function(){if(this.event.stopPropagation){this.event.stopPropagation()}else{this.event.cancelBubble=true}return this},preventDefault:function(){if(this.event.preventDefault){this.event.preventDefault()}else{this.event.returnValue=false}return this}});Function.extend({attempt:function(){for(var b=0,a=arguments.length;b<a;b++){try{return arguments[b]()}catch(c){}}return null}});Function.implement({attempt:function(a,c){try{return this.apply(c,Array.from(a))}catch(b){}return null},bind:function(c){var a=this,b=(arguments.length>1)?Array.slice(arguments,1):null;return function(){if(!b&&!arguments.length){return a.call(c)}if(b&&arguments.length){return a.apply(c,b.concat(Array.from(arguments)))}return a.apply(c,b||arguments)}},pass:function(b,c){var a=this;if(b!=null){b=Array.from(b)}return function(){return a.apply(c,b||arguments)}},delay:function(b,c,a){return setTimeout(this.pass((a==null?[]:a),c),b)},periodical:function(c,b,a){return setInterval(this.pass((a==null?[]:a),b),c)}});Number.implement({limit:function(b,a){return Math.min(a,Math.max(b,this))},round:function(a){a=Math.pow(10,a||0).toFixed(a<0?-a:0);return Math.round(this*a)/a},times:function(b,c){for(var a=0;a<this;a++){b.call(c,a,this)}},toFloat:function(){return parseFloat(this)},toInt:function(a){return parseInt(this,a||10)}});Number.alias("each","times");(function(b){var a={};b.each(function(c){if(!Number[c]){a[c]=function(){return Math[c].apply(null,[this].concat(Array.from(arguments)))}}});Number.implement(a)})(["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","sin","sqrt","tan"]);Object.extend({subset:function(c,f){var e={};for(var d=0,a=f.length;d<a;d++){var b=f[d];e[b]=c[b]}return e},map:function(a,d,e){var c={};for(var b in a){if(a.hasOwnProperty(b)){c[b]=d.call(e,a[b],b,a)}}return c},filter:function(a,c,d){var b={};Object.each(a,function(f,e){if(c.call(d,f,e,a)){b[e]=f}});return b},every:function(a,c,d){for(var b in a){if(a.hasOwnProperty(b)&&!c.call(d,a[b],b)){return false}}return true},some:function(a,c,d){for(var b in a){if(a.hasOwnProperty(b)&&c.call(d,a[b],b)){return true}}return false},keys:function(a){var c=[];for(var b in a){if(a.hasOwnProperty(b)){c.push(b)}}return c},values:function(b){var a=[];for(var c in b){if(b.hasOwnProperty(c)){a.push(b[c])}}return a},getLength:function(a){return Object.keys(a).length},keyOf:function(a,c){for(var b in a){if(a.hasOwnProperty(b)&&a[b]===c){return b}}return null},contains:function(a,b){return Object.keyOf(a,b)!=null},toQueryString:function(a,b){var c=[];Object.each(a,function(g,f){if(b){f=b+"["+f+"]"}var e;switch(typeOf(g)){case"object":e=Object.toQueryString(g,f);break;case"array":var d={};g.each(function(j,h){d[h]=j});e=Object.toQueryString(d,f);break;default:e=f+"="+encodeURIComponent(g)}if(g!=null){c.push(e)}});return c.join("&")}});String.implement({test:function(a,b){return((typeOf(a)=="regexp")?a:new RegExp(""+a,b)).test(this)},contains:function(a,b){return(b)?(b+this+b).indexOf(b+a+b)>-1:this.indexOf(a)>-1},trim:function(){return this.replace(/^\s+|\s+$/g,"")},clean:function(){return this.replace(/\s+/g," ").trim()},camelCase:function(){return this.replace(/-\D/g,function(a){return a.charAt(1).toUpperCase()})},hyphenate:function(){return this.replace(/[A-Z]/g,function(a){return("-"+a.charAt(0).toLowerCase())})},capitalize:function(){return this.replace(/\b[a-z]/g,function(a){return a.toUpperCase()})},escapeRegExp:function(){return this.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},toInt:function(a){return parseInt(this,a||10)},toFloat:function(){return parseFloat(this)},hexToRgb:function(b){var a=this.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return(a)?a.slice(1).hexToRgb(b):null},rgbToHex:function(b){var a=this.match(/\d{1,3}/g);return(a)?a.rgbToHex(b):null},substitute:function(a,b){return this.replace(b||(/\\?\{([^{}]+)\}/g),function(d,c){if(d.charAt(0)=="\\"){return d.slice(1)}return(a[c]!=null)?a[c]:""})}});(function(){var l,o,m,g,a={},c={},n=/\\/g;var e=function(r,q){if(r==null){return null}if(r.Slick===true){return r}r=(""+r).replace(/^\s+|\s+$/g,"");g=!!q;var p=(g)?c:a;if(p[r]){return p[r]}l={Slick:true,expressions:[],raw:r,reverse:function(){return e(this.raw,true)}};o=-1;while(r!=(r=r.replace(k,b))){}l.length=l.expressions.length;return p[r]=(g)?h(l):l};var j=function(p){if(p==="!"){return" "}else{if(p===" "){return"!"}else{if((/^!/).test(p)){return p.replace(/^!/,"")}else{return"!"+p}}}};var h=function(v){var s=v.expressions;for(var q=0;q<s.length;q++){var u=s[q];var r={parts:[],tag:"*",combinator:j(u[0].combinator)};for(var p=0;p<u.length;p++){var t=u[p];if(!t.reverseCombinator){t.reverseCombinator=" "}t.combinator=t.reverseCombinator;delete t.reverseCombinator}u.reverse().push(r)}return v};var f=function(p){return p.replace(/[-[\]{}()*+?.\\^$|,#\s]/g,"\\$&")};var k=new RegExp("^(?:\\s*(,)\\s*|\\s*(<combinator>+)\\s*|(\\s+)|(<unicode>+|\\*)|\\#(<unicode>+)|\\.(<unicode>+)|\\[\\s*(<unicode1>+)(?:\\s*([*^$!~|]?=)(?:\\s*(?:([\"']?)(.*?)\\9)))?\\s*\\](?!\\])|:+(<unicode>+)(?:\\((?:(?:([\"'])([^\\12]*)\\12)|((?:\\([^)]+\\)|[^()]*)+))\\))?)".replace(/<combinator>/,"["+f(">+~`!@$%^&={}\\;</")+"]").replace(/<unicode>/g,"(?:[\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])").replace(/<unicode1>/g,"(?:[:\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])"));function b(y,t,E,A,s,D,r,C,B,z,v,G,w,q,x){if(t||o===-1){l.expressions[++o]=[];m=-1;if(t){return""}}if(E||A||m===-1){E=E||" ";var u=l.expressions[o];if(g&&u[m]){u[m].reverseCombinator=j(E)}u[++m]={combinator:E,tag:"*"}}var p=l.expressions[o][m];if(s){p.tag=s.replace(n,"")}else{if(D){p.id=D.replace(n,"")}else{if(r){r=r.replace(n,"");if(!p.classList){p.classList=[]}if(!p.classes){p.classes=[]}p.classList.push(r);p.classes.push({value:r,regexp:new RegExp("(^|\\s)"+f(r)+"(\\s|$)")})}else{if(G){x=x||q;x=x?x.replace(n,""):null;if(!p.pseudos){p.pseudos=[]}p.pseudos.push({key:G.replace(n,""),value:x})}else{if(C){C=C.replace(n,"");v=(v||"").replace(n,"");var F,H;switch(B){case"^=":H=new RegExp("^"+f(v));break;case"$=":H=new RegExp(f(v)+"$");break;case"~=":H=new RegExp("(^|\\s)"+f(v)+"(\\s|$)");break;case"|=":H=new RegExp("^"+f(v)+"(-|$)");break;case"=":F=function(I){return v==I};break;case"*=":F=function(I){return I&&I.indexOf(v)>-1};break;case"!=":F=function(I){return v!=I};break;default:F=function(I){return !!I}}if(v==""&&(/^[*$^]=$/).test(B)){F=function(){return false}}if(!F){F=function(I){return I&&H.test(I)}}if(!p.attributes){p.attributes=[]}p.attributes.push({key:C,operator:B,value:v,test:F})}}}}}return""}var d=(this.Slick||{});d.parse=function(p){return e(p)};d.escapeRegExp=f;if(!this.Slick){this.Slick=d}}).apply(this);(function(){var b={};b.isNativeCode=function(c){return(/\{\s*\[native code\]\s*\}/).test(""+c)};b.isXML=function(c){return(!!c.xmlVersion)||(!!c.xml)||(Object.prototype.toString.call(c)==="[object XMLDocument]")||(c.nodeType===9&&c.documentElement.nodeName!=="HTML")};b.setDocument=function(o){if(o.nodeType===9){}else{if(o.ownerDocument){o=o.ownerDocument}else{if(o.navigator){o=o.document}else{return}}}if(this.document===o){return}this.document=o;var p=this.root=o.documentElement;this.isXMLDocument=this.isXML(o);this.brokenStarGEBTN=this.starSelectsClosedQSA=this.idGetsName=this.brokenMixedCaseQSA=this.brokenGEBCN=this.brokenCheckedQSA=this.brokenEmptyAttributeQSA=this.isHTMLDocument=false;var j,k,q,l;var m,c;var r=o.createElement("div");p.appendChild(r);try{c="slick_getbyid_test";r.innerHTML='<a id="'+c+'"></a>';this.isHTMLDocument=!!o.getElementById(c)}catch(n){}if(this.isHTMLDocument){r.style.display="none";r.appendChild(o.createComment(""));k=(r.getElementsByTagName("*").length>0);try{r.innerHTML="foo</foo>";m=r.getElementsByTagName("*");j=(m&&m.length&&m[0].nodeName.charAt(0)=="/")}catch(n){}this.brokenStarGEBTN=k||j;if(r.querySelectorAll){try{r.innerHTML="foo</foo>";m=r.querySelectorAll("*");this.starSelectsClosedQSA=(m&&m.length&&m[0].nodeName.charAt(0)=="/")}catch(n){}}try{c="slick_id_gets_name";r.innerHTML='<a name="'+c+'"></a><b id="'+c+'"></b>';this.idGetsName=o.getElementById(c)===r.firstChild}catch(n){}try{r.innerHTML='<a class="MiXedCaSe"></a>';this.brokenMixedCaseQSA=!r.querySelectorAll(".MiXedCaSe").length}catch(n){}try{r.innerHTML='<a class="f"></a><a class="b"></a>';r.getElementsByClassName("b").length;r.firstChild.className="b";l=(r.getElementsByClassName("b").length!=2)}catch(n){}try{r.innerHTML='<a class="a"></a><a class="f b a"></a>';q=(r.getElementsByClassName("a").length!=2)}catch(n){}this.brokenGEBCN=l||q;try{r.innerHTML='<select><option selected="selected">a</option></select>';this.brokenCheckedQSA=(r.querySelectorAll(":checked").length==0)}catch(n){}try{r.innerHTML='<a class=""></a>';this.brokenEmptyAttributeQSA=(r.querySelectorAll('[class*=""]').length!=0)}catch(n){}}p.removeChild(r);r=null;this.hasAttribute=(p&&this.isNativeCode(p.hasAttribute))?function(t,s){return t.hasAttribute(s)}:function(t,s){t=t.getAttributeNode(s);return !!(t&&(t.specified||t.nodeValue))};this.contains=(p&&this.isNativeCode(p.contains))?function(s,t){return s.contains(t)}:(p&&p.compareDocumentPosition)?function(s,t){return s===t||!!(s.compareDocumentPosition(t)&16)}:function(s,t){if(t){do{if(t===s){return true}}while((t=t.parentNode))}return false};this.documentSorter=(p.compareDocumentPosition)?function(t,s){if(!t.compareDocumentPosition||!s.compareDocumentPosition){return 0}return t.compareDocumentPosition(s)&4?-1:t===s?0:1}:("sourceIndex" in p)?function(t,s){if(!t.sourceIndex||!s.sourceIndex){return 0}return t.sourceIndex-s.sourceIndex}:(o.createRange)?function(v,t){if(!v.ownerDocument||!t.ownerDocument){return 0}var u=v.ownerDocument.createRange(),s=t.ownerDocument.createRange();u.setStart(v,0);u.setEnd(v,0);s.setStart(t,0);s.setEnd(t,0);return u.compareBoundaryPoints(Range.START_TO_END,s)}:null;this.getUID=(this.isHTMLDocument)?this.getUIDHTML:this.getUIDXML};b.search=function(k,x,F,q){var w=this.found=(q)?null:(F||[]);if(!k){return w}if(k.navigator){k=k.document}else{if(!k.nodeType){return w}}var t,E;var o=this.uniques={};if(this.document!==(k.ownerDocument||k)){this.setDocument(k)}var y=!!(F&&F.length);if(y){for(E=w.length;E--;){this.uniques[this.getUID(w[E])]=true}}if(typeof x=="string"){for(E=this.overrides.length;E--;){var u=this.overrides[E];if(u.regexp.test(x)){var v=u.method.call(k,x,w,q);if(v===false){continue}if(v===true){return w}return v}}t=this.Slick.parse(x);if(!t.length){return w}}else{if(x==null){return w}else{if(x.Slick){t=x}else{if(this.contains(k.documentElement||k,x)){(w)?w.push(x):w=x;return w}else{return w}}}}this.posNTH={};this.posNTHLast={};this.posNTHType={};this.posNTHTypeLast={};this.push=(!y&&(q||(t.length==1&&t.expressions[0].length==1)))?this.pushArray:this.pushUID;if(w==null){w=[]}var D,B,A;var C,K,z,J,G,s,p;var r,l,c,H,I=t.expressions;search:for(E=0;(l=I[E]);E++){for(D=0;(c=l[D]);D++){C="combinator:"+c.combinator;if(!this[C]){continue search}K=(this.isXMLDocument)?c.tag:c.tag.toUpperCase();z=c.id;J=c.classList;G=c.classes;s=c.attributes;p=c.pseudos;H=(D===(l.length-1));this.bitUniques={};if(H){this.uniques=o;this.found=w}else{this.uniques={};this.found=[]}if(D===0){this[C](k,K,z,G,s,p,J);if(q&&H&&w.length){break search}}else{if(q&&H){for(B=0,A=r.length;B<A;B++){this[C](r[B],K,z,G,s,p,J);if(w.length){break search}}}else{for(B=0,A=r.length;B<A;B++){this[C](r[B],K,z,G,s,p,J)}}}r=this.found}}if(y||(t.expressions.length>1)){this.sort(w)}return(q)?(w[0]||null):w};b.uidx=1;b.uidk="slick:uniqueid";b.getUIDXML=function(j){var c=j.getAttribute(this.uidk);if(!c){c=this.uidx++;j.setAttribute(this.uidk,c)}return c};b.getUIDHTML=function(c){return c.uniqueNumber||(c.uniqueNumber=this.uidx++)};b.sort=function(c){if(!this.documentSorter){return c}c.sort(this.documentSorter);return c};b.cacheNTH={};b.matchNTH=/^([+-]?\d*)?([a-z]+)?([+-]\d+)?$/;b.parseNTHArgument=function(m){var k=m.match(this.matchNTH);if(!k){return false}var l=k[2]||false;var j=k[1]||1;if(j=="-"){j=-1}var c=+k[3]||0;k=(l=="n")?{a:j,b:c}:(l=="odd")?{a:2,b:1}:(l=="even")?{a:2,b:0}:{a:0,b:j};return(this.cacheNTH[m]=k)};b.createNTHPseudo=function(l,j,c,k){return function(o,m){var q=this.getUID(o);if(!this[c][q]){var w=o.parentNode;if(!w){return false}var n=w[l],p=1;if(k){var v=o.nodeName;do{if(n.nodeName!==v){continue}this[c][this.getUID(n)]=p++}while((n=n[j]))}else{do{if(n.nodeType!==1){continue}this[c][this.getUID(n)]=p++}while((n=n[j]))}}m=m||"n";var r=this.cacheNTH[m]||this.parseNTHArgument(m);if(!r){return false}var u=r.a,t=r.b,s=this[c][q];if(u==0){return t==s}if(u>0){if(s<t){return false}}else{if(t<s){return false}}return((s-t)%u)==0}};b.pushArray=function(l,c,n,k,j,m){if(this.matchSelector(l,c,n,k,j,m)){this.found.push(l)}};b.pushUID=function(m,c,o,l,j,n){var k=this.getUID(m);if(!this.uniques[k]&&this.matchSelector(m,c,o,l,j,n)){this.uniques[k]=true;this.found.push(m)}};b.matchNode=function(n,c){var k=this.Slick.parse(c);if(!k){return true}if(k.length==1&&k.expressions[0].length==1){var o=k.expressions[0][0];return this.matchSelector(n,(this.isXMLDocument)?o.tag:o.tag.toUpperCase(),o.id,o.classes,o.attributes,o.pseudos)}var j=this.search(this.document,k);for(var l=0,m;m=j[l++];){if(m===n){return true}}return false};b.matchPseudo=function(m,c,l){var j="pseudo:"+c;if(this[j]){return this[j](m,l)}var k=this.getAttribute(m,c);return(l)?l==k:!!k};b.matchSelector=function(k,q,c,l,m,o){if(q){if(q=="*"){if(k.nodeName<"@"){return false}}else{if(k.nodeName!=q){return false}}}if(c&&k.getAttribute("id")!=c){return false}var n,j,p;if(l){for(n=l.length;n--;){p=("className" in k)?k.className:k.getAttribute("class");if(!(p&&l[n].regexp.test(p))){return false}}}if(m){for(n=m.length;n--;){j=m[n];if(j.operator?!j.test(this.getAttribute(k,j.key)):!this.hasAttribute(k,j.key)){return false}}}if(o){for(n=o.length;n--;){j=o[n];if(!this.matchPseudo(k,j.key,j.value)){return false}}}return true};var a={" ":function(l,r,c,m,n,p,k){var o,q,j;if(this.isHTMLDocument){getById:if(c){q=this.document.getElementById(c);if((!q&&l.all)||(this.idGetsName&&q&&q.getAttributeNode("id").nodeValue!=c)){j=l.all[c];if(!j){return}if(!j[0]){j=[j]}for(o=0;q=j[o++];){if(q.getAttributeNode("id").nodeValue==c){this.push(q,r,null,m,n,p);break}}return}if(!q){if(this.contains(this.document.documentElement,l)){return}else{break getById}}else{if(this.document!==l&&!this.contains(l,q)){return}}this.push(q,r,null,m,n,p);return}getByClass:if(m&&l.getElementsByClassName&&!this.brokenGEBCN){j=l.getElementsByClassName(k.join(" "));if(!(j&&j.length)){break getByClass}for(o=0;q=j[o++];){this.push(q,r,c,null,n,p)}return}}getByTag:{j=l.getElementsByTagName(r);if(!(j&&j.length)){break getByTag}if(!this.brokenStarGEBTN){r=null}for(o=0;q=j[o++];){this.push(q,r,c,m,n,p)}}},">":function(l,c,n,k,j,m){if((l=l.firstChild)){do{if(l.nodeType===1){this.push(l,c,n,k,j,m)}}while((l=l.nextSibling))}},"+":function(l,c,n,k,j,m){while((l=l.nextSibling)){if(l.nodeType===1){this.push(l,c,n,k,j,m);break}}},"^":function(l,c,n,k,j,m){l=l.firstChild;if(l){if(l.nodeType===1){this.push(l,c,n,k,j,m)}else{this["combinator:+"](l,c,n,k,j,m)}}},"~":function(m,c,o,l,j,n){while((m=m.nextSibling)){if(m.nodeType!==1){continue}var k=this.getUID(m);if(this.bitUniques[k]){break}this.bitUniques[k]=true;this.push(m,c,o,l,j,n)}},"++":function(l,c,n,k,j,m){this["combinator:+"](l,c,n,k,j,m);this["combinator:!+"](l,c,n,k,j,m)},"~~":function(l,c,n,k,j,m){this["combinator:~"](l,c,n,k,j,m);this["combinator:!~"](l,c,n,k,j,m)},"!":function(l,c,n,k,j,m){while((l=l.parentNode)){if(l!==this.document){this.push(l,c,n,k,j,m)}}},"!>":function(l,c,n,k,j,m){l=l.parentNode;if(l!==this.document){this.push(l,c,n,k,j,m)}},"!+":function(l,c,n,k,j,m){while((l=l.previousSibling)){if(l.nodeType===1){this.push(l,c,n,k,j,m);break}}},"!^":function(l,c,n,k,j,m){l=l.lastChild;if(l){if(l.nodeType===1){this.push(l,c,n,k,j,m)}else{this["combinator:!+"](l,c,n,k,j,m)}}},"!~":function(m,c,o,l,j,n){while((m=m.previousSibling)){if(m.nodeType!==1){continue}var k=this.getUID(m);if(this.bitUniques[k]){break}this.bitUniques[k]=true;this.push(m,c,o,l,j,n)}}};for(var h in a){b["combinator:"+h]=a[h]}var g={empty:function(c){var j=c.firstChild;return !(j&&j.nodeType==1)&&!(c.innerText||c.textContent||"").length},not:function(c,j){return !this.matchNode(c,j)},contains:function(c,j){return(c.innerText||c.textContent||"").indexOf(j)>-1},"first-child":function(c){while((c=c.previousSibling)){if(c.nodeType===1){return false}}return true},"last-child":function(c){while((c=c.nextSibling)){if(c.nodeType===1){return false}}return true},"only-child":function(k){var j=k;while((j=j.previousSibling)){if(j.nodeType===1){return false}}var c=k;while((c=c.nextSibling)){if(c.nodeType===1){return false}}return true},"nth-child":b.createNTHPseudo("firstChild","nextSibling","posNTH"),"nth-last-child":b.createNTHPseudo("lastChild","previousSibling","posNTHLast"),"nth-of-type":b.createNTHPseudo("firstChild","nextSibling","posNTHType",true),"nth-last-of-type":b.createNTHPseudo("lastChild","previousSibling","posNTHTypeLast",true),index:function(j,c){return this["pseudo:nth-child"](j,""+c+1)},even:function(j,c){return this["pseudo:nth-child"](j,"2n")},odd:function(j,c){return this["pseudo:nth-child"](j,"2n+1")},"first-of-type":function(c){var j=c.nodeName;while((c=c.previousSibling)){if(c.nodeName===j){return false}}return true},"last-of-type":function(c){var j=c.nodeName;while((c=c.nextSibling)){if(c.nodeName===j){return false}}return true},"only-of-type":function(k){var j=k,l=k.nodeName;while((j=j.previousSibling)){if(j.nodeName===l){return false}}var c=k;while((c=c.nextSibling)){if(c.nodeName===l){return false}}return true},enabled:function(c){return(c.disabled===false)},disabled:function(c){return(c.disabled===true)},checked:function(c){return c.checked||c.selected},focus:function(c){return this.isHTMLDocument&&this.document.activeElement===c&&(c.href||c.type||this.hasAttribute(c,"tabindex"))},root:function(c){return(c===this.root)},selected:function(c){return c.selected}};for(var d in g){b["pseudo:"+d]=g[d]}b.attributeGetters={"class":function(){return("className" in this)?this.className:this.getAttribute("class")},"for":function(){return("htmlFor" in this)?this.htmlFor:this.getAttribute("for")},href:function(){return("href" in this)?this.getAttribute("href",2):this.getAttribute("href")},style:function(){return(this.style)?this.style.cssText:this.getAttribute("style")}};b.getAttribute=function(k,c){var l=this.attributeGetters[c];if(l){return l.call(k)}var j=k.getAttributeNode(c);return j?j.nodeValue:null};b.overrides=[];b.override=function(c,j){this.overrides.push({regexp:c,method:j})};var f=/\[.*[*$^]=(?:["']{2})?\]/;b.override(/./,function(p,n,o){if(!this.querySelectorAll||this.nodeType!=9||!b.isHTMLDocument||b.brokenMixedCaseQSA||(b.brokenCheckedQSA&&p.indexOf(":checked")>-1)||(b.brokenEmptyAttributeQSA&&f.test(p))||e.disableQSA){return false}var j,m;try{if(o){return this.querySelector(p)||null}else{j=this.querySelectorAll(p)}}catch(k){return false}var l,c=!!(n.length);if(b.starSelectsClosedQSA){for(l=0;m=j[l++];){if(m.nodeName>"@"&&(!c||!b.uniques[b.getUIDHTML(m)])){n.push(m)}}}else{for(l=0;m=j[l++];){if(!c||!b.uniques[b.getUIDHTML(m)]){n.push(m)}}}if(c){b.sort(n)}return true});b.override(/^[\w-]+$|^\*$/,function(p,n,o){var j=p;if(j=="*"&&b.brokenStarGEBTN){return false}var k=this.getElementsByTagName(j);if(o){return k[0]||null}var l,m,c=!!(n.length);for(l=0;m=k[l++];){if(!c||!b.uniques[b.getUID(m)]){n.push(m)}}if(c){b.sort(n)}return true});b.override(/^\.[\w-]+$/,function(o,q,m){if(!b.isHTMLDocument||(!this.getElementsByClassName&&this.querySelectorAll)){return false}var c,k,l,j=!!(q&&q.length),p=o.substring(1);if(this.getElementsByClassName&&!b.brokenGEBCN){c=this.getElementsByClassName(p);if(m){return c[0]||null}for(l=0;k=c[l++];){if(!j||!b.uniques[b.getUIDHTML(k)]){q.push(k)}}}else{var n=new RegExp("(^|\\s)"+e.escapeRegExp(p)+"(\\s|$)");c=this.getElementsByTagName("*");for(l=0;k=c[l++];){p=k.className;if(!p||!n.test(p)){continue}if(m){return k}if(!j||!b.uniques[b.getUIDHTML(k)]){q.push(k)}}}if(j){b.sort(q)}return(m)?null:true});b.override(/^#[\w-]+$/,function(m,k,l){if(!b.isHTMLDocument||this.nodeType!=9){return false}var n=m.substring(1),j=this.getElementById(n);if(!j){return k}if(b.idGetsName&&j.getAttributeNode("id").nodeValue!=n){return false}if(l){return j||null}var c=!!(k.length);if(!c||!b.uniques[b.getUIDHTML(j)]){k.push(j)}if(c){b.sort(k)}return true});if(typeof document!="undefined"){b.setDocument(document)}var e=b.Slick=(this.Slick||{});e.version="0.9dev";e.search=function(j,k,c){return b.search(j,k,c)};e.find=function(c,j){return b.search(c,j,null,true)};e.contains=function(c,j){b.setDocument(c);return b.contains(c,j)};e.getAttribute=function(j,c){return b.getAttribute(j,c)};e.match=function(j,c){if(!(j&&c)){return false}if(!c||c===j){return true}if(typeof c!="string"){return false}b.setDocument(j);return b.matchNode(j,c)};e.defineAttributeGetter=function(c,j){b.attributeGetters[c]=j;return this};e.lookupAttributeGetter=function(c){return b.attributeGetters[c]};e.definePseudo=function(c,j){b["pseudo:"+c]=function(l,k){return j.call(l,k)};return this};e.lookupPseudo=function(c){var j=b["pseudo:"+c];if(j){return function(k){return j.call(this,k)}}return null};e.override=function(j,c){b.override(j,c);return this};e.isXML=b.isXML;e.uidOf=function(c){return b.getUIDHTML(c)};if(!this.Slick){this.Slick=e}}).apply(this);(function(){var document=this.document;var window=document.window=this;var UID=1;this.$uid=(window.ActiveXObject)?function(item){return(item.uid||(item.uid=[UID++]))[0]}:function(item){return item.uid||(item.uid=UID++)};$uid(window);$uid(document);var ua=navigator.userAgent.toLowerCase(),platform=navigator.platform.toLowerCase(),UA=ua.match(/(opera|ie|firefox|chrome|trident|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0];if(UA[1]=="trident"){UA[1]="ie";UA[2]=parseInt(UA[2],10)+4}var mode=UA[1]=="ie"&&document.documentMode;var Browser=this.Browser={extend:Function.prototype.extend,name:(UA[1]=="version")?UA[3]:UA[1],version:mode||parseFloat((UA[1]=="opera"&&UA[4])?UA[4]:UA[2]),Platform:{name:ua.match(/ip(?:ad|od|hone)/)?"ios":(ua.match(/(?:webos|android)/)||platform.match(/mac|win|linux/)||["other"])[0]},Features:{xpath:!!(document.evaluate),air:!!(window.runtime),query:!!(document.querySelector),json:!!(window.JSON)},Plugins:{}};Browser[Browser.name]=true;Browser[Browser.name+parseInt(Browser.version,10)]=true;Browser.Platform[Browser.Platform.name]=true;Browser.Request=(function(){var XMLHTTP=function(){return new XMLHttpRequest()};var MSXML2=function(){return new ActiveXObject("MSXML2.XMLHTTP")};var MSXML=function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Function.attempt(function(){XMLHTTP();return XMLHTTP},function(){MSXML2();return MSXML2},function(){MSXML();return MSXML})})();Browser.Features.xhr=!!(Browser.Request);var version=(Function.attempt(function(){return navigator.plugins["Shockwave Flash"].description},function(){return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")})||"0 r0").match(/\d+/g);Browser.Plugins.Flash={version:Number(version[0]||"0."+version[1])||0,build:Number(version[2])||0};Browser.exec=function(text,force){if(!text){return text}if(window.execScript){window.execScript(text)}else{if(Browser.firefox&&force){window.eval(text)}else{var script=document.createElement("script");script.setAttribute("type","text/javascript");script.text=text;document.head.appendChild(script);document.head.removeChild(script)}}return text};String.implement("stripScripts",function(exec,force){var scripts="";var text=this.replace(/<script([^>]*)>([\s\S]*?)<\/script>/gi,function(all,attribs,code){if(/type=['"]text\/html['"]/.test(attribs)&&exec===true){var script=document.createElement("script");script.setAttribute("type","text/html");if(/id=['"]([^'"]+)['"]/.test(attribs)){script.setAttribute("id",RegExp.$1)}script.text=code;document.head.appendChild(script);return""}scripts+=code+"\n";return""});if(exec===true){Browser.exec(scripts,force)}else{if(typeOf(exec)=="function"){exec(scripts,text)}}return text});Browser.extend({Document:this.Document,Window:this.Window,Element:this.Element,Event:this.Event});this.Window=this.$constructor=new Type("Window",function(){});this.$family=Function.from("window").hide();Window.mirror(function(name,method){window[name]=method});this.Document=document.$constructor=new Type("Document",function(){});document.$family=Function.from("document").hide();Document.mirror(function(name,method){document[name]=method});document.html=document.documentElement;document.head=document.getElementsByTagName("head")[0];if(document.execCommand){try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}}if(this.attachEvent&&!this.addEventListener){var unloadEvent=function(){this.detachEvent("onunload",unloadEvent);document.head=document.html=document.window=null};this.attachEvent("onunload",unloadEvent)}var arrayFrom=Array.from;try{arrayFrom(document.html.childNodes)}catch(e){Array.from=function(item){if(typeof item!="string"&&Type.isEnumerable(item)&&typeOf(item)!="array"){var i=item.length,array=new Array(i);while(i--){array[i]=item[i]}return array}return arrayFrom(item)};var prototype=Array.prototype,slice=prototype.slice;["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice"].each(function(name){var method=prototype[name];Array[name]=function(item){return method.apply(Array.from(item),slice.call(arguments,1))}})}})();(function(){var a=this.Class=new Type("Class",function(h){if(instanceOf(h,Function)){h={initialize:h}}var g=function(){e(this);if(g.$prototyping){return this}this.$caller=null;var j=(this.initialize)?this.initialize.apply(this,arguments):this;this.$caller=this.caller=null;return j}.extend(this).implement(h);g.$constructor=a;g.prototype.$constructor=g;g.prototype.parent=c;return g});var c=function(){if(!this.$caller){throw new Error('The method "parent" cannot be called.')}var g=this.$caller.$name,h=this.$caller.$owner.parent,j=(h)?h.prototype[g]:null;if(!j){throw new Error('The method "'+g+'" has no parent.')}return j.apply(this,arguments)};var e=function(g){for(var h in g){var k=g[h];switch(typeOf(k)){case"object":var j=function(){};j.prototype=k;g[h]=e(new j);break;case"array":g[h]=k.clone();break}}return g};var b=function(g,h,k){if(k.$origin){k=k.$origin}var j=function(){if(k.$protected&&this.$caller==null){throw new Error('The method "'+h+'" cannot be called.')}var m=this.caller,n=this.$caller;this.caller=n;this.$caller=j;var l=k.apply(this,arguments);this.$caller=n;this.caller=m;return l}.extend({$owner:g,$origin:k,$name:h});return j};var f=function(h,j,g){if(a.Mutators.hasOwnProperty(h)){j=a.Mutators[h].call(this,j);if(j==null){return this}}if(typeOf(j)=="function"){if(j.$hidden){return this}this.prototype[h]=(g)?j:b(this,h,j)}else{Object.merge(this.prototype,h,j)}return this};var d=function(g){g.$prototyping=true;var h=new g;delete g.$prototyping;return h};a.implement("implement",f.overloadSetter());a.Mutators={Extends:function(g){this.parent=g;this.prototype=d(g)},Implements:function(g){Array.from(g).each(function(k){var h=new k;for(var j in h){f.call(this,j,h[j],true)}},this)}}})();(function(){this.Chain=new Class({$chain:[],chain:function(){this.$chain.append(Array.flatten(arguments));return this},callChain:function(){return(this.$chain.length)?this.$chain.shift().apply(this,arguments):false},clearChain:function(){this.$chain.empty();return this}});var a=function(b){return b.replace(/^on([A-Z])/,function(c,d){return d.toLowerCase()})};this.Events=new Class({$events:{},addEvent:function(d,c,b){d=a(d);this.$events[d]=(this.$events[d]||[]).include(c);if(b){c.internal=true}return this},addEvents:function(b){for(var c in b){this.addEvent(c,b[c])}return this},fireEvent:function(e,c,b){e=a(e);var d=this.$events[e];if(!d){return this}c=Array.from(c);d.each(function(f){if(b){f.delay(b,this,c)}else{f.apply(this,c)}},this);return this},removeEvent:function(e,d){e=a(e);var c=this.$events[e];if(c&&!d.internal){var b=c.indexOf(d);if(b!=-1){delete c[b]}}return this},removeEvents:function(d){var e;if(typeOf(d)=="object"){for(e in d){this.removeEvent(e,d[e])}return this}if(d){d=a(d)}for(e in this.$events){if(d&&d!=e){continue}var c=this.$events[e];for(var b=c.length;b--;){if(b in c){this.removeEvent(e,c[b])}}}return this}});this.Options=new Class({setOptions:function(){var b=this.options=Object.merge.apply(null,[{},this.options].append(arguments));if(this.addEvent){for(var c in b){if(typeOf(b[c])!="function"||!(/^on[A-Z]/).test(c)){continue}this.addEvent(c,b[c]);delete b[c]}}return this}})})();var Element=function(b,g){var h=Element.Constructors[b];if(h){return h(g)}if(typeof b!="string"){return document.id(b).set(g)}if(!g){g={}}if(!(/^[\w-]+$/).test(b)){var e=Slick.parse(b).expressions[0][0];b=(e.tag=="*")?"div":e.tag;if(e.id&&g.id==null){g.id=e.id}var d=e.attributes;if(d){for(var f=0,c=d.length;f<c;f++){var a=d[f];if(a.value!=null&&a.operator=="="&&g[a.key]==null){g[a.key]=a.value}}}if(e.classList&&g["class"]==null){g["class"]=e.classList.join(" ")}}return document.newElement(b,g)};if(Browser.Element){Element.prototype=Browser.Element.prototype}new Type("Element",Element).mirror(function(a){if(Array.prototype[a]){return}var b={};b[a]=function(){var h=[],e=arguments,j=true;for(var g=0,d=this.length;g<d;g++){var f=this[g],c=h[g]=f[a].apply(f,e);j=(j&&typeOf(c)=="element")}return(j)?new Elements(h):h};Elements.implement(b)});if(!Browser.Element){Element.parent=Object;Element.Prototype={"$family":Function.from("element").hide()};Element.mirror(function(a,b){Element.Prototype[a]=b})}Element.Constructors={};var IFrame=new Type("IFrame",function(){var e=Array.link(arguments,{properties:Type.isObject,iframe:function(f){return(f!=null)}});var c=e.properties||{},b;if(e.iframe){b=document.id(e.iframe)}var d=c.onload||function(){};delete c.onload;c.id=c.name=[c.id,c.name,b?(b.id||b.name):"IFrame_"+String.uniqueID()].pick();b=new Element(b||"iframe",c);var a=function(){d.call(b.contentWindow)};if(window.frames[c.id]){a()}else{b.addListener("load",a)}return b});var Elements=this.Elements=function(a){if(a&&a.length){var e={},d;for(var c=0;d=a[c++];){var b=Slick.uidOf(d);if(!e[b]){e[b]=true;this.push(d)}}}};Elements.prototype={length:0};Elements.parent=Array;new Type("Elements",Elements).implement({filter:function(a,b){if(!a){return this}return new Elements(Array.filter(this,(typeOf(a)=="string")?function(c){return c.match(a)}:a,b))}.protect(),push:function(){var d=this.length;for(var b=0,a=arguments.length;b<a;b++){var c=document.id(arguments[b]);if(c){this[d++]=c}}return(this.length=d)}.protect(),unshift:function(){var b=[];for(var c=0,a=arguments.length;c<a;c++){var d=document.id(arguments[c]);if(d){b.push(d)}}return Array.prototype.unshift.apply(this,b)}.protect(),concat:function(){var b=new Elements(this);for(var c=0,a=arguments.length;c<a;c++){var d=arguments[c];if(Type.isEnumerable(d)){b.append(d)}else{b.push(d)}}return b}.protect(),append:function(c){for(var b=0,a=c.length;b<a;b++){this.push(c[b])}return this}.protect(),empty:function(){while(this.length){delete this[--this.length]}return this}.protect()});(function(){var g=Array.prototype.splice,b={"0":0,"1":1,length:2};g.call(b,1,1);if(b[1]==1){Elements.implement("splice",function(){var e=this.length;g.apply(this,arguments);while(e>=this.length){delete this[e--]}return this}.protect())}Elements.implement(Array.prototype);Array.mirror(Elements);var f;try{var a=document.createElement("<input name=x>");f=(a.name=="x")}catch(c){}var d=function(e){return(""+e).replace(/&/g,"&amp;").replace(/"/g,"&quot;")};Document.implement({newElement:function(e,h){if(h&&h.checked!=null){h.defaultChecked=h.checked}if(f&&h){e="<"+e;if(h.name){e+=' name="'+d(h.name)+'"'}if(h.type){e+=' type="'+d(h.type)+'"'}e+=">";delete h.name;delete h.type}return this.id(this.createElement(e)).set(h)}})})();Document.implement({newTextNode:function(a){return this.createTextNode(a)},getDocument:function(){return this},getWindow:function(){return this.window},id:(function(){var a={string:function(d,c,b){d=Slick.find(b,"#"+d.replace(/(\W)/g,"\\$1"));return(d)?a.element(d,c):null},element:function(b,c){$uid(b);if(!c&&!b.$family&&!(/^(?:object|embed)$/i).test(b.tagName)){Object.append(b,Element.Prototype)}return b},object:function(c,d,b){if(c.toElement){return a.element(c.toElement(b),d)}return null}};a.textnode=a.whitespace=a.window=a.document=function(b){return b};return function(c,e,d){if(c&&c.$family&&c.uid){return c}var b=typeOf(c);return(a[b])?a[b](c,e,d||document):null}})()});if(window.$==null){Window.implement("$",function(a,b){return document.id(a,b,this.document)})}Window.implement({getDocument:function(){return this.document},getWindow:function(){return this}});[Document,Element].invoke("implement",{getElements:function(a){return Slick.search(this,a,new Elements)},getElement:function(a){return document.id(Slick.find(this,a))}});if(window.$$==null){Window.implement("$$",function(a){if(arguments.length==1){if(typeof a=="string"){return Slick.search(this.document,a,new Elements)}else{if(Type.isEnumerable(a)){return new Elements(a)}}}return new Elements(arguments)})}(function(){var l={},j={};var o={input:"checked",option:"selected",textarea:"value"};var e=function(q){return(j[q]||(j[q]={}))};var k=function(r){if(r.removeEvents){r.removeEvents()}if(r.clearAttributes){r.clearAttributes()}var q=r.uid;if(q!=null){delete l[q];delete j[q]}return r};var p=["defaultValue","accessKey","cellPadding","cellSpacing","colSpan","frameBorder","maxLength","readOnly","rowSpan","tabIndex","useMap"];var d=["compact","nowrap","ismap","declare","noshade","checked","disabled","readOnly","multiple","selected","noresize","defer","defaultChecked"];var g={html:"innerHTML","class":"className","for":"htmlFor",text:(function(){var q=document.createElement("div");return(q.innerText==null)?"textContent":"innerText"})()};var n=["type"];var h=["value","defaultValue"];var m=/^(?:href|src|usemap)$/i;d=d.associate(d);p=p.associate(p.map(String.toLowerCase));n=n.associate(n);Object.append(g,h.associate(h));var c={before:function(r,q){var s=q.parentNode;if(s){s.insertBefore(r,q)}},after:function(r,q){var s=q.parentNode;if(s){s.insertBefore(r,q.nextSibling)}},bottom:function(r,q){q.appendChild(r)},top:function(r,q){q.insertBefore(r,q.firstChild)}};c.inside=c.bottom;var b=function(t,s){if(!t){return s}t=Slick.parse(t);var r=t.expressions;for(var q=r.length;q--;){r[q][0].combinator=s}return t};Element.implement({set:function(s,r){var q=Element.Properties[s];(q&&q.set)?q.set.call(this,r):this.setProperty(s,r)}.overloadSetter(),get:function(r){var q=Element.Properties[r];return(q&&q.get)?q.get.apply(this):this.getProperty(r)}.overloadGetter(),erase:function(r){var q=Element.Properties[r];(q&&q.erase)?q.erase.apply(this):this.removeProperty(r);return this},setProperty:function(r,s){r=p[r]||r;if(s==null){return this.removeProperty(r)}var q=g[r];(q)?this[q]=s:(d[r])?this[r]=!!s:this.setAttribute(r,""+s);return this},setProperties:function(q){for(var r in q){this.setProperty(r,q[r])}return this},getProperty:function(r){r=p[r]||r;var q=g[r]||n[r];return(q)?this[q]:(d[r])?!!this[r]:(m.test(r)?this.getAttribute(r,2):(q=this.getAttributeNode(r))?q.nodeValue:null)||null},getProperties:function(){var q=Array.from(arguments);return q.map(this.getProperty,this).associate(q)},removeProperty:function(r){r=p[r]||r;var q=g[r];(q)?this[q]="":(d[r])?this[r]=false:this.removeAttribute(r);return this},removeProperties:function(){Array.each(arguments,this.removeProperty,this);return this},hasClass:function(q){return this.className.clean().contains(q," ")},addClass:function(q){if(!this.hasClass(q)){this.className=(this.className+" "+q).clean()}return this},removeClass:function(q){this.className=this.className.replace(new RegExp("(^|\\s)"+q+"(?:\\s|$)"),"$1");return this},toggleClass:function(q,r){if(r==null){r=!this.hasClass(q)}return(r)?this.addClass(q):this.removeClass(q)},adopt:function(){var t=this,q,v=Array.flatten(arguments),u=v.length;if(u>1){t=q=document.createDocumentFragment()}for(var s=0;s<u;s++){var r=document.id(v[s],true);if(r){t.appendChild(r)}}if(q){this.appendChild(q)}return this},appendText:function(r,q){return this.grab(this.getDocument().newTextNode(r),q)},grab:function(r,q){c[q||"bottom"](document.id(r,true),this);return this},inject:function(r,q){c[q||"bottom"](this,document.id(r,true));return this},replaces:function(q){q=document.id(q,true);q.parentNode.replaceChild(this,q);return this},wraps:function(r,q){r=document.id(r,true);return this.replaces(r).grab(r,q)},getPrevious:function(q){return document.id(Slick.find(this,b(q,"!~")))},getAllPrevious:function(q){return Slick.search(this,b(q,"!~"),new Elements)},getNext:function(q){return document.id(Slick.find(this,b(q,"~")))},getAllNext:function(q){return Slick.search(this,b(q,"~"),new Elements)},getFirst:function(q){return document.id(Slick.search(this,b(q,">"))[0])},getLast:function(q){return document.id(Slick.search(this,b(q,">")).getLast())},getParent:function(q){return document.id(Slick.find(this,b(q,"!")))},getParents:function(q){return Slick.search(this,b(q,"!"),new Elements)},getSiblings:function(q){return Slick.search(this,b(q,"~~"),new Elements)},getChildren:function(q){return Slick.search(this,b(q,">"),new Elements)},getWindow:function(){return this.ownerDocument.window},getDocument:function(){return this.ownerDocument},getElementById:function(q){return document.id(Slick.find(this,"#"+(""+q).replace(/(\W)/g,"\\$1")))},getSelected:function(){this.selectedIndex;return new Elements(Array.from(this.options).filter(function(q){return q.selected}))},toQueryString:function(){var q=[];this.getElements("input, select, textarea").each(function(s){var r=s.type;if(!s.name||s.disabled||r=="submit"||r=="reset"||r=="file"||r=="image"){return}var t=(s.get("tag")=="select")?s.getSelected().map(function(u){return document.id(u).get("value")}):((r=="radio"||r=="checkbox")&&!s.checked)?null:s.get("value");Array.from(t).each(function(u){if(typeof u!="undefined"){q.push(encodeURIComponent(s.name)+"="+encodeURIComponent(u))}})});return q.join("&")},destroy:function(){var q=k(this).getElementsByTagName("*");Array.each(q,k);Element.dispose(this);return null},empty:function(){Array.from(this.childNodes).each(Element.dispose);return this},dispose:function(){return(this.parentNode)?this.parentNode.removeChild(this):this},match:function(q){return !q||Slick.match(this,q)}});var a=function(v,u,s){var q=v.getAttributeNode("id");if(q){v.removeAttributeNode(q)}if(s){v.setAttribute("id",u.getAttribute("id"))}if(Browser.ie){v.clearAttributes();v.mergeAttributes(u);v.removeAttribute("uid");if(v.options){var w=v.options,r=u.options;for(var t=w.length;t--;){w[t].selected=r[t].selected}}}var x=o[u.tagName.toLowerCase()];if(x&&u[x]){v[x]=u[x]}};Element.implement("clone",function(s,q){s=s!==false;var x=this.cloneNode(s);if(s){var t=x.getElementsByTagName("*"),v=this.getElementsByTagName("*");for(var r=t.length;r--;){a(t[r],v[r],q)}}a(x,this,q);if(Browser.ie){var u=x.getElementsByTagName("object"),w=this.getElementsByTagName("object");for(var r=u.length;r--;){u[r].outerHTML=w[r].outerHTML}}return document.id(x)});var f={contains:function(q){return Slick.contains(this,q)}};if(!document.contains){Document.implement(f)}if(!document.createElement("div").contains){Element.implement(f)}[Element,Window,Document].invoke("implement",{addListener:function(t,s){if(t=="unload"){var q=s,r=this;s=function(){r.removeListener("unload",s);q()}}else{l[$uid(this)]=this}if(this.addEventListener){this.addEventListener(t,s,!!arguments[2])}else{this.attachEvent("on"+t,s)}return this},removeListener:function(r,q){if(this.removeEventListener){this.removeEventListener(r,q,!!arguments[2])}else{this.detachEvent("on"+r,q)}return this},retrieve:function(r,q){var t=e($uid(this)),s=t[r];if(q!=null&&s==null){s=t[r]=q}return s!=null?s:null},store:function(r,q){var s=e($uid(this));s[r]=q;return this},eliminate:function(q){var r=e($uid(this));delete r[q];return this}});if(window.attachEvent&&!window.addEventListener){window.addListener("unload",function(){Object.each(l,k);if(window.CollectGarbage){CollectGarbage()}})}})();Element.Properties={};Element.Properties.style={set:function(a){this.style.cssText=a},get:function(){return this.style.cssText},erase:function(){this.style.cssText=""}};Element.Properties.tag={get:function(){return this.tagName.toLowerCase()}};(function(a){if(a!=null){Element.Properties.maxlength=Element.Properties.maxLength={get:function(){var b=this.getAttribute("maxLength");return b==a?null:b}}}})(document.createElement("input").getAttribute("maxLength"));Element.Properties.html=(function(){var c=Function.attempt(function(){var e=document.createElement("table");e.innerHTML="<tr><td></td></tr>"});var d=document.createElement("div");var a={table:[1,"<table>","</table>"],select:[1,"<select>","</select>"],tbody:[2,"<table><tbody>","</tbody></table>"],tr:[3,"<table><tbody><tr>","</tr></tbody></table>"]};a.thead=a.tfoot=a.tbody;var b={set:function(){var f=Array.flatten(arguments).join("");var g=(!c&&a[this.get("tag")]);if(g){var h=d;h.innerHTML=g[1]+f+g[2];for(var e=g[0];e--;){h=h.firstChild}this.empty().adopt(h.childNodes)}else{this.innerHTML=f}}};b.erase=b.set;return b})();(function(){var c=document.html;Element.Properties.styles={set:function(f){this.setStyles(f)}};var e=(c.style.opacity!=null);var d=/alpha\(opacity=([\d.]+)\)/i;var b=function(g,f){if(!g.currentStyle||!g.currentStyle.hasLayout){g.style.zoom=1}if(e){g.style.opacity=f}else{f=(f==1)?"":"alpha(opacity="+f*100+")";var h=g.style.filter||g.getComputedStyle("filter")||"";g.style.filter=d.test(h)?h.replace(d,f):h+f}};Element.Properties.opacity={set:function(g){var f=this.style.visibility;if(g==0&&f!="hidden"){this.style.visibility="hidden"}else{if(g!=0&&f!="visible"){this.style.visibility="visible"}}b(this,g)},get:(e)?function(){var f=this.style.opacity||this.getComputedStyle("opacity");return(f=="")?1:f}:function(){var f,g=(this.style.filter||this.getComputedStyle("filter"));if(g){f=g.match(d)}return(f==null||g==null)?1:(f[1]/100)}};var a=(c.style.cssFloat==null)?"styleFloat":"cssFloat";Element.implement({getComputedStyle:function(h){if(this.currentStyle){return this.currentStyle[h.camelCase()]}var g=Element.getDocument(this).defaultView,f=g?g.getComputedStyle(this,null):null;return(f)?f.getPropertyValue((h==a)?"float":h.hyphenate()):null},setOpacity:function(f){b(this,f);return this},getOpacity:function(){return this.get("opacity")},setStyle:function(g,f){switch(g){case"opacity":return this.set("opacity",parseFloat(f));case"float":g=a}g=g.camelCase();if(typeOf(f)!="string"){var h=(Element.Styles[g]||"@").split(" ");f=Array.from(f).map(function(k,j){if(!h[j]){return""}return(typeOf(k)=="number")?h[j].replace("@",Math.round(k)):k}).join(" ")}else{if(f==String(Number(f))){f=Math.round(f)}}this.style[g]=f;return this},getStyle:function(m){switch(m){case"opacity":return this.get("opacity");case"float":m=a}m=m.camelCase();var f=this.style[m];if(!f||m=="zIndex"){f=[];for(var l in Element.ShortStyles){if(m!=l){continue}for(var k in Element.ShortStyles[l]){f.push(this.getStyle(k))}return f.join(" ")}f=this.getComputedStyle(m)}if(f){f=String(f);var h=f.match(/rgba?\([\d\s,]+\)/);if(h){f=f.replace(h[0],h[0].rgbToHex())}}if(Browser.opera||(Browser.ie&&isNaN(parseFloat(f)))){if((/^(height|width)$/).test(m)){var g=(m=="width")?["left","right"]:["top","bottom"],j=0;g.each(function(n){j+=this.getStyle("border-"+n+"-width").toInt()+this.getStyle("padding-"+n).toInt()},this);return this["offset"+m.capitalize()]-j+"px"}if(Browser.opera&&String(f).indexOf("px")!=-1){return f}if((/^border(.+)Width|margin|padding/).test(m)){return"0px"}}return f},setStyles:function(g){for(var f in g){this.setStyle(f,g[f])}return this},getStyles:function(){var f={};Array.flatten(arguments).each(function(g){f[g]=this.getStyle(g)},this);return f}});Element.Styles={left:"@px",top:"@px",bottom:"@px",right:"@px",width:"@px",height:"@px",maxWidth:"@px",maxHeight:"@px",minWidth:"@px",minHeight:"@px",backgroundColor:"rgb(@, @, @)",backgroundPosition:"@px @px",color:"rgb(@, @, @)",fontSize:"@px",letterSpacing:"@px",lineHeight:"@px",clip:"rect(@px @px @px @px)",margin:"@px @px @px @px",padding:"@px @px @px @px",border:"@px @ rgb(@, @, @) @px @ rgb(@, @, @) @px @ rgb(@, @, @)",borderWidth:"@px @px @px @px",borderStyle:"@ @ @ @",borderColor:"rgb(@, @, @) rgb(@, @, @) rgb(@, @, @) rgb(@, @, @)",zIndex:"@",zoom:"@",fontWeight:"@",textIndent:"@px",opacity:"@"};Element.ShortStyles={margin:{},padding:{},border:{},borderWidth:{},borderStyle:{},borderColor:{}};["Top","Right","Bottom","Left"].each(function(m){var l=Element.ShortStyles;var g=Element.Styles;["margin","padding"].each(function(n){var o=n+m;l[n][o]=g[o]="@px"});var k="border"+m;l.border[k]=g[k]="@px @ rgb(@, @, @)";var j=k+"Width",f=k+"Style",h=k+"Color";l[k]={};l.borderWidth[j]=l[k][j]=g[j]="@px";l.borderStyle[f]=l[k][f]=g[f]="@";l.borderColor[h]=l[k][h]=g[h]="rgb(@, @, @)"})})();(function(){var h=document.createElement("div"),e=document.createElement("div");h.style.height="0";h.appendChild(e);var d=(e.offsetParent===h);h=e=null;var m=function(n){return l(n,"position")!="static"||a(n)};var j=function(n){return m(n)||(/^(?:table|td|th)$/i).test(n.tagName)};Element.implement({scrollTo:function(n,o){if(a(this)){this.getWindow().scrollTo(n,o)}else{this.scrollLeft=n;this.scrollTop=o}return this},getSize:function(){if(a(this)){return this.getWindow().getSize()}return{x:this.offsetWidth,y:this.offsetHeight}},getScrollSize:function(){if(a(this)){return this.getWindow().getScrollSize()}return{x:this.scrollWidth,y:this.scrollHeight}},getScroll:function(){if(a(this)){return this.getWindow().getScroll()}return{x:this.scrollLeft,y:this.scrollTop}},getScrolls:function(){var o=this.parentNode,n={x:0,y:0};while(o&&!a(o)){n.x+=o.scrollLeft;n.y+=o.scrollTop;o=o.parentNode}return n},getOffsetParent:d?function(){var n=this;if(a(n)||l(n,"position")=="fixed"){return null}var o=(l(n,"position")=="static")?j:m;while((n=n.parentNode)){if(o(n)){return n}}return null}:function(){var n=this;if(a(n)||l(n,"position")=="fixed"){return null}try{return n.offsetParent}catch(o){}return null},getOffsets:function(){if(this.getBoundingClientRect&&!Browser.Platform.ios){var s=this.getBoundingClientRect(),p=document.id(this.getDocument().documentElement),r=p.getScroll(),u=this.getScrolls(),t=(l(this,"position")=="fixed");return{x:s.left.toInt()+u.x+((t)?0:r.x)-p.clientLeft,y:s.top.toInt()+u.y+((t)?0:r.y)-p.clientTop}}var o=this,n={x:0,y:0};if(a(this)){return n}while(o&&!a(o)){n.x+=o.offsetLeft;n.y+=o.offsetTop;if(Browser.firefox){if(!c(o)){n.x+=b(o);n.y+=g(o)}var q=o.parentNode;if(q&&l(q,"overflow")!="visible"){n.x+=b(q);n.y+=g(q)}}else{if(o!=this&&Browser.safari){n.x+=b(o);n.y+=g(o)}}o=o.offsetParent}if(Browser.firefox&&!c(this)){n.x-=b(this);n.y-=g(this)}return n},getPosition:function(q){if(a(this)){return{x:0,y:0}}var r=this.getOffsets(),o=this.getScrolls();var n={x:r.x-o.x,y:r.y-o.y};if(q&&(q=document.id(q))){var p=q.getPosition();return{x:n.x-p.x-b(q),y:n.y-p.y-g(q)}}return n},getCoordinates:function(p){if(a(this)){return this.getWindow().getCoordinates()}var n=this.getPosition(p),o=this.getSize();var q={left:n.x,top:n.y,width:o.x,height:o.y};q.right=q.left+q.width;q.bottom=q.top+q.height;return q},computePosition:function(n){return{left:n.x-k(this,"margin-left"),top:n.y-k(this,"margin-top")}},setPosition:function(n){return this.setStyles(this.computePosition(n))}});[Document,Window].invoke("implement",{getSize:function(){var n=f(this);return{x:n.clientWidth,y:n.clientHeight}},getScroll:function(){var o=this.getWindow(),n=f(this);return{x:o.pageXOffset||n.scrollLeft,y:o.pageYOffset||n.scrollTop}},getScrollSize:function(){var p=f(this),o=this.getSize(),n=this.getDocument().body;return{x:Math.max(p.scrollWidth,n.scrollWidth,o.x),y:Math.max(p.scrollHeight,n.scrollHeight,o.y)}},getPosition:function(){return{x:0,y:0}},getCoordinates:function(){var n=this.getSize();return{top:0,left:0,bottom:n.y,right:n.x,height:n.y,width:n.x}}});var l=Element.getComputedStyle;function k(n,o){return l(n,o).toInt()||0}function c(n){return l(n,"-moz-box-sizing")=="border-box"}function g(n){return k(n,"border-top-width")}function b(n){return k(n,"border-left-width")}function a(n){return(/^(?:body|html)$/i).test(n.tagName)}function f(n){var o=n.getDocument();return(!o.compatMode||o.compatMode=="CSS1Compat")?o.html:o.body}})();Element.alias({position:"setPosition"});[Window,Document,Element].invoke("implement",{getHeight:function(){return this.getSize().y},getWidth:function(){return this.getSize().x},getScrollTop:function(){return this.getScroll().y},getScrollLeft:function(){return this.getScroll().x},getScrollHeight:function(){return this.getScrollSize().y},getScrollWidth:function(){return this.getScrollSize().x},getTop:function(){return this.getPosition().y},getLeft:function(){return this.getPosition().x}});(function(){Element.Properties.events={set:function(c){this.addEvents(c)}};[Element,Window,Document].invoke("implement",{addEvent:function(g,j){var k=this.retrieve("events",{});if(!k[g]){k[g]={keys:[],values:[]}}if(k[g].keys.contains(j)){return this}k[g].keys.push(j);var h=g,c=Element.Events[g],e=j,l=this;if(c){if(c.onAdd){c.onAdd.call(this,j)}if(c.condition){e=function(m){if(c.condition.call(this,m)){return j.call(this,m)}return true}}h=c.base||h}var f=function(){return j.call(l)};var d=Element.NativeEvents[h];if(d){if(d==2){f=function(m){m=new Event(m,l.getWindow());if(e.call(l,m)===false){m.stop()}}}this.addListener(h,f,arguments[2])}k[g].values.push(f);return this},removeEvent:function(f,e){var d=this.retrieve("events");if(!d||!d[f]){return this}var j=d[f];var c=j.keys.indexOf(e);if(c==-1){return this}var h=j.values[c];delete j.keys[c];delete j.values[c];var g=Element.Events[f];if(g){if(g.onRemove){g.onRemove.call(this,e)}f=g.base||f}return(Element.NativeEvents[f])?this.removeListener(f,h,arguments[2]):this},addEvents:function(c){for(var d in c){this.addEvent(d,c[d])}return this},removeEvents:function(c){var e;if(typeOf(c)=="object"){for(e in c){this.removeEvent(e,c[e])}return this}var d=this.retrieve("events");if(!d){return this}if(!c){for(e in d){this.removeEvents(e)}this.eliminate("events")}else{if(d[c]){d[c].keys.each(function(f){this.removeEvent(c,f)},this);delete d[c]}}return this},fireEvent:function(f,d,c){var e=this.retrieve("events");if(!e||!e[f]){return this}d=Array.from(d);e[f].keys.each(function(g){if(c){g.delay(c,this,d)}else{g.apply(this,d)}},this);return this},cloneEvents:function(f,e){f=document.id(f);var d=f.retrieve("events");if(!d){return this}if(!e){for(var c in d){this.cloneEvents(f,c)}}else{if(d[e]){d[e].keys.each(function(g){this.addEvent(e,g)},this)}}return this}});try{if(typeof HTMLElement!="undefined"){HTMLElement.prototype.fireEvent=Element.prototype.fireEvent}}catch(b){}Element.NativeEvents={click:2,dblclick:2,mouseup:2,mousedown:2,contextmenu:2,mousewheel:2,DOMMouseScroll:2,mouseover:2,mouseout:2,mousemove:2,selectstart:2,selectend:2,keydown:2,keypress:2,keyup:2,orientationchange:2,touchstart:2,touchmove:2,touchend:2,touchcancel:2,gesturestart:2,gesturechange:2,gestureend:2,focus:2,blur:2,change:2,reset:2,select:2,submit:2,load:2,unload:1,beforeunload:2,resize:1,move:1,DOMContentLoaded:1,readystatechange:1,error:1,abort:1,scroll:1};var a=function(c){var d=c.relatedTarget;if(d==null){return true}if(!d){return false}return(d!=this&&d.prefix!="xul"&&typeOf(this)!="document"&&!this.contains(d))};Element.Events={mouseenter:{base:"mouseover",condition:a},mouseleave:{base:"mouseout",condition:a},mousewheel:{base:(Browser.firefox)?"DOMMouseScroll":"mousewheel"}}})();(function(){var f=this.Fx=new Class({Implements:[Chain,Events,Options],options:{fps:60,unit:false,duration:500,frames:null,frameSkip:true,link:"ignore"},initialize:function(g){this.subject=this.subject||this;this.setOptions(g)},getTransition:function(){return function(g){return -(Math.cos(Math.PI*g)-1)/2}},step:function(g){if(this.options.frameSkip){var h=(this.time!=null)?(g-this.time):0,j=h/this.frameInterval;this.time=g;this.frame+=j}else{this.frame++}if(this.frame<this.frames){var k=this.transition(this.frame/this.frames);this.set(this.compute(this.from,this.to,k))}else{this.frame=this.frames;this.set(this.compute(this.from,this.to,1));this.stop()}},set:function(g){return g},compute:function(j,h,g){return f.compute(j,h,g)},check:function(){if(!this.isRunning()){return true}switch(this.options.link){case"cancel":this.cancel();return true;case"chain":this.chain(this.caller.pass(arguments,this));return false}return false},start:function(l,k){if(!this.check(l,k)){return this}this.from=l;this.to=k;this.frame=(this.options.frameSkip)?0:-1;this.time=null;this.transition=this.getTransition();var j=this.options.frames,h=this.options.fps,g=this.options.duration;this.duration=f.Durations[g]||g.toInt();this.frameInterval=1000/h;this.frames=j||Math.round(this.duration/this.frameInterval);this.fireEvent("start",this.subject);b.call(this,h);return this},stop:function(){if(this.isRunning()){this.time=null;d.call(this,this.options.fps);if(this.frames==this.frame){this.fireEvent("complete",this.subject);if(!this.callChain()){this.fireEvent("chainComplete",this.subject)}}else{this.fireEvent("stop",this.subject)}}return this},cancel:function(){if(this.isRunning()){this.time=null;d.call(this,this.options.fps);this.frame=this.frames;this.fireEvent("cancel",this.subject).clearChain()}return this},pause:function(){if(this.isRunning()){this.time=null;d.call(this,this.options.fps)}return this},resume:function(){if((this.frame<this.frames)&&!this.isRunning()){b.call(this,this.options.fps)}return this},isRunning:function(){var g=e[this.options.fps];return g&&g.contains(this)}});f.compute=function(j,h,g){return(h-j)*g+j};f.Durations={"short":250,normal:500,"long":1000};var e={},c={};var a=function(){var h=Date.now();for(var j=this.length;j--;){var g=this[j];if(g){g.step(h)}}};var b=function(h){var g=e[h]||(e[h]=[]);g.push(this);if(!c[h]){c[h]=a.periodical(Math.round(1000/h),g)}};var d=function(h){var g=e[h];if(g){g.erase(this);if(!g.length&&c[h]){delete e[h];c[h]=clearInterval(c[h])}}}})();Fx.CSS=new Class({Extends:Fx,prepare:function(c,d,b){b=Array.from(b);if(b[1]==null){b[1]=b[0];b[0]=c.getStyle(d)}var a=b.map(this.parse);return{from:a[0],to:a[1]}},parse:function(a){a=Function.from(a)();a=(typeof a=="string")?a.split(" "):Array.from(a);return a.map(function(c){c=String(c);var b=false;Object.each(Fx.CSS.Parsers,function(f,e){if(b){return}var d=f.parse(c);if(d||d===0){b={value:d,parser:f}}});b=b||{value:c,parser:Fx.CSS.Parsers.String};return b})},compute:function(d,c,b){var a=[];(Math.min(d.length,c.length)).times(function(e){a.push({value:d[e].parser.compute(d[e].value,c[e].value,b),parser:d[e].parser})});a.$family=Function.from("fx:css:value");return a},serve:function(c,b){if(typeOf(c)!="fx:css:value"){c=this.parse(c)}var a=[];c.each(function(d){a=a.concat(d.parser.serve(d.value,b))});return a},render:function(a,d,c,b){a.setStyle(d,this.serve(c,b))},search:function(a){if(Fx.CSS.Cache[a]){return Fx.CSS.Cache[a]}var c={},b=new RegExp("^"+a.escapeRegExp()+"$");Array.each(document.styleSheets,function(f,e){var d=f.href;if(d&&d.contains("://")&&!d.contains(document.domain)){return}var g=f.rules||f.cssRules;Array.each(g,function(k,h){if(!k.style){return}var j=(k.selectorText)?k.selectorText.replace(/^\w+/,function(l){return l.toLowerCase()}):null;if(!j||!b.test(j)){return}Object.each(Element.Styles,function(m,l){if(!k.style[l]||Element.ShortStyles[l]){return}m=String(k.style[l]);c[l]=((/^rgb/).test(m))?m.rgbToHex():m})})});return Fx.CSS.Cache[a]=c}});Fx.CSS.Cache={};Fx.CSS.Parsers={Color:{parse:function(a){if(a.match(/^#[0-9a-f]{3,6}$/i)){return a.hexToRgb(true)}return((a=a.match(/(\d+),\s*(\d+),\s*(\d+)/)))?[a[1],a[2],a[3]]:false},compute:function(c,b,a){return c.map(function(e,d){return Math.round(Fx.compute(c[d],b[d],a))})},serve:function(a){return a.map(Number)}},Number:{parse:parseFloat,compute:Fx.compute,serve:function(b,a){return(a)?b+a:b}},String:{parse:Function.from(false),compute:function(b,a){return a},serve:function(a){return a}}};Fx.Morph=new Class({Extends:Fx.CSS,initialize:function(b,a){this.element=this.subject=document.id(b);this.parent(a)},set:function(a){if(typeof a=="string"){a=this.search(a)}for(var b in a){this.render(this.element,b,a[b],this.options.unit)}return this},compute:function(e,d,c){var a={};for(var b in e){a[b]=this.parent(e[b],d[b],c)}return a},start:function(b){if(!this.check(b)){return this}if(typeof b=="string"){b=this.search(b)}var e={},d={};for(var c in b){var a=this.prepare(this.element,c,b[c]);e[c]=a.from;d[c]=a.to}return this.parent(e,d)}});Element.Properties.morph={set:function(a){this.get("morph").cancel().setOptions(a);return this},get:function(){var a=this.retrieve("morph");if(!a){a=new Fx.Morph(this,{link:"cancel"});this.store("morph",a)}return a}};Element.implement({morph:function(a){this.get("morph").start(a);return this}});Fx.Tween=new Class({Extends:Fx.CSS,initialize:function(b,a){this.element=this.subject=document.id(b);this.parent(a)},set:function(b,a){if(arguments.length==1){a=b;b=this.property||this.options.property}this.render(this.element,b,a,this.options.unit);return this},start:function(c,e,d){if(!this.check(c,e,d)){return this}var b=Array.flatten(arguments);this.property=this.options.property||b.shift();var a=this.prepare(this.element,this.property,b);return this.parent(a.from,a.to)}});Element.Properties.tween={set:function(a){this.get("tween").cancel().setOptions(a);return this},get:function(){var a=this.retrieve("tween");if(!a){a=new Fx.Tween(this,{link:"cancel"});this.store("tween",a)}return a}};Element.implement({tween:function(a,c,b){this.get("tween").start(arguments);return this},fade:function(c){var e=this.get("tween"),d="opacity",a;c=[c,"toggle"].pick();switch(c){case"in":e.start(d,1);break;case"out":e.start(d,0);break;case"show":e.set(d,1);break;case"hide":e.set(d,0);break;case"toggle":var b=this.retrieve("fade:flag",this.get("opacity")==1);e.start(d,(b)?0:1);this.store("fade:flag",!b);a=true;break;default:e.start(d,arguments)}if(!a){this.eliminate("fade:flag")}return this},highlight:function(c,a){if(!a){a=this.retrieve("highlight:original",this.getStyle("background-color"));a=(a=="transparent")?"#fff":a}var b=this.get("tween");b.start("background-color",c||"#ffff88",a).chain(function(){this.setStyle("background-color",this.retrieve("highlight:original"));b.callChain()}.bind(this));return this}});(function(){var a=("onprogress" in new Browser.Request);var c=this.Request=new Class({Implements:[Chain,Events,Options],options:{url:"",data:"",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*"},async:true,format:false,method:"post",link:"ignore",isSuccess:null,emulation:true,urlEncoded:true,encoding:"utf-8",evalScripts:false,evalResponse:false,timeout:0,noCache:false},initialize:function(d){this.xhr=new Browser.Request();this.setOptions(d);this.headers=this.options.headers},onStateChange:function(){var d=this.xhr;if(d.readyState!=4||!this.running){return}this.running=false;this.status=0;Function.attempt(function(){var e=d.status;this.status=(e==1223)?204:e}.bind(this));d.onreadystatechange=function(){};clearTimeout(this.timer);this.response={text:this.xhr.responseText||"",xml:this.xhr.responseXML};if(this.options.isSuccess.call(this,this.status)){this.success(this.response.text,this.response.xml)}else{this.failure()}},isSuccess:function(){var d=this.status;return(d>=200&&d<300)},isRunning:function(){return !!this.running},processScripts:function(d){if(this.options.evalResponse||(/(ecma|java)script/).test(this.getHeader("Content-type"))){return Browser.exec(d)}return d.stripScripts(this.options.evalScripts,true)},success:function(e,d){this.onSuccess(this.processScripts(e),d)},onSuccess:function(){this.fireEvent("complete",arguments).fireEvent("success",arguments).callChain()},failure:function(){this.onFailure()},onFailure:function(){this.fireEvent("complete").fireEvent("failure",this.xhr)},loadstart:function(d){this.fireEvent("loadstart",[d,this.xhr])},progress:function(d){this.fireEvent("progress",[d,this.xhr])},timeout:function(){this.fireEvent("timeout",this.xhr)},setHeader:function(d,e){this.headers[d]=e;return this},getHeader:function(d){return Function.attempt(function(){return this.xhr.getResponseHeader(d)}.bind(this))},check:function(){if(!this.running){return true}switch(this.options.link){case"cancel":this.cancel();return true;case"chain":this.chain(this.caller.pass(arguments,this));return false}return false},send:function(o){if(!this.check(o)){return this}this.options.isSuccess=this.options.isSuccess||this.isSuccess;this.running=true;var l=typeOf(o);if(l=="string"||l=="element"){o={data:o}}var g=this.options;o=Object.append({data:g.data,url:g.url,method:g.method},o);var j=o.data,e=String(o.url),d=o.method.toLowerCase();switch(typeOf(j)){case"element":j=document.id(j).toQueryString();break;case"object":case"hash":j=Object.toQueryString(j)}if(this.options.format){var m="format="+this.options.format;j=(j)?m+"&"+j:m}if(this.options.emulation&&!["get","post"].contains(d)){var k="_method="+d;j=(j)?k+"&"+j:k;d="post"}if(this.options.urlEncoded&&["post","put"].contains(d)){var f=(this.options.encoding)?"; charset="+this.options.encoding:"";this.headers["Content-type"]="application/x-www-form-urlencoded"+f}if(!e){e=document.location.pathname}var h=e.lastIndexOf("/");if(h>-1&&(h=e.indexOf("#"))>-1){e=e.substr(0,h)}if(this.options.noCache){e+=(e.contains("?")?"&":"?")+String.uniqueID()}if(j&&d=="get"){e+=(e.contains("?")?"&":"?")+j;j=null}var n=this.xhr;if(a){n.onloadstart=this.loadstart.bind(this);n.onprogress=this.progress.bind(this)}n.open(d.toUpperCase(),e,this.options.async,this.options.user,this.options.password);if((this.options.user||this.options.withCredentials)&&"withCredentials" in n){n.withCredentials=true}n.onreadystatechange=this.onStateChange.bind(this);Object.each(this.headers,function(q,p){try{n.setRequestHeader(p,q)}catch(r){this.fireEvent("exception",[p,q])}},this);this.fireEvent("request");n.send(j);if(!this.options.async){this.onStateChange()}if(this.options.timeout){this.timer=this.timeout.delay(this.options.timeout,this)}return this},cancel:function(){if(!this.running){return this}this.running=false;var d=this.xhr;d.abort();clearTimeout(this.timer);d.onreadystatechange=d.onprogress=d.onloadstart=function(){};this.xhr=new Browser.Request();this.fireEvent("cancel");return this}});var b={};["get","post","put","delete","GET","POST","PUT","DELETE"].each(function(d){b[d]=function(f){var e={method:d};if(f!=null){e.data=f}return this.send(e)}});c.implement(b);Element.Properties.send={set:function(d){var e=this.get("send").cancel();e.setOptions(d);return this},get:function(){var d=this.retrieve("send");if(!d){d=new c({data:this,link:"cancel",method:this.get("method")||"post",url:this.get("action")});this.store("send",d)}return d}};Element.implement({send:function(d){var e=this.get("send");e.send({data:this,url:d||e.options.url});return this}})})();Request.HTML=new Class({Extends:Request,options:{update:false,append:false,evalScripts:true,filter:false,headers:{Accept:"text/html, application/xml, text/xml, */*"}},success:function(e){var d=this.options,b=this.response;b.html=e.stripScripts(function(f){b.javascript=f});var c=b.html.match(/<body[^>]*>([\s\S]*?)<\/body>/i);if(c){b.html=c[1]}var a=new Element("div").set("html",b.html);b.tree=a.childNodes;b.elements=a.getElements("*");if(d.filter){b.tree=b.elements.filter(d.filter)}if(d.update){document.id(d.update).empty().set("html",b.html)}else{if(d.append){document.id(d.append).adopt(a.getChildren())}}if(d.evalScripts){Browser.exec(b.javascript)}this.onSuccess(b.tree,b.elements,b.html,b.javascript)}});Element.Properties.load={set:function(a){var b=this.get("load").cancel();b.setOptions(a);return this},get:function(){var a=this.retrieve("load");if(!a){a=new Request.HTML({data:this,link:"cancel",update:this,method:"get"});this.store("load",a)}return a}};Element.implement({load:function(){this.get("load").send(Array.link(arguments,{data:Type.isObject,url:Type.isString}));return this}});Request.JSON=new Class({Extends:Request,options:{secure:true},initialize:function(a){this.parent(a);Object.append(this.headers,{Accept:"application/json","X-Request":"JSON"})},success:function(c){var b=this.options.secure;var a=this.response.json=Function.attempt(function(){return JSON.decode(c,b)});if(a==null){this.onFailure()}else{this.onSuccess(a,c)}}});var Cookie=new Class({Implements:Options,options:{path:"/",domain:false,duration:false,secure:false,document:document,encode:true},initialize:function(b,a){this.key=b;this.setOptions(a)},write:function(b){if(this.options.encode){b=encodeURIComponent(b)}if(this.options.domain){b+="; domain="+this.options.domain}if(this.options.path){b+="; path="+this.options.path}if(this.options.duration){var a=new Date();a.setTime(a.getTime()+this.options.duration*24*60*60*1000);b+="; expires="+a.toGMTString()}if(this.options.secure){b+="; secure"}this.options.document.cookie=this.key+"="+b;return this},read:function(){var a=this.options.document.cookie.match("(?:^|;)\\s*"+this.key.escapeRegExp()+"=([^;]*)");return(a)?decodeURIComponent(a[1]):null},dispose:function(){new Cookie(this.key,Object.merge({},this.options,{duration:-1})).write("");return this}});Cookie.write=function(b,c,a){return new Cookie(b,a).write(c)};Cookie.read=function(a){return new Cookie(a).read()};Cookie.dispose=function(b,a){return new Cookie(b,a).dispose()};(function(k,m){var n,g,f=[],c,b,o=true;try{o=k.frameElement!=null}catch(j){}var h=function(){clearTimeout(b);if(n){return}Browser.loaded=n=true;m.removeListener("DOMContentLoaded",h).removeListener("readystatechange",a);m.fireEvent("domready");k.fireEvent("domready")};var a=function(){for(var e=f.length;e--;){if(f[e]()){h();return true}}return false};var l=function(){clearTimeout(b);if(!a()){b=setTimeout(l,10)}};m.addListener("DOMContentLoaded",h);var d=m.createElement("div");if(d.doScroll&&!o){f.push(function(){try{d.doScroll();return true}catch(p){}return false});c=true}if(m.readyState){f.push(function(){var e=m.readyState;return(e=="loaded"||e=="complete")})}if("onreadystatechange" in m){m.addListener("readystatechange",a)}else{c=true}if(c){l()}Element.Events.domready={onAdd:function(e){if(n){e.call(this)}}};Element.Events.load={base:"load",onAdd:function(e){if(g&&this==k){e.call(this)}},condition:function(){if(this==k){h();delete Element.Events.load}return true}};k.addEvent("load",function(){g=true})})(window,document);if(typeof JSON=="undefined"){this.JSON={}}Object.append(JSON,{$specialChars:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},$replaceChars:function(a){return JSON.$specialChars[a]||"\\u00"+Math.floor(a.charCodeAt()/16).toString(16)+(a.charCodeAt()%16).toString(16)},encode:function(b){switch(typeOf(b)){case"string":return'"'+b.replace(/[\x00-\x1f\\"]/g,JSON.$replaceChars)+'"';case"array":return"["+String(b.map(JSON.encode).clean())+"]";case"object":case"hash":var a=[];Object.each(b,function(e,d){var c=JSON.encode(e);if(c){a.push(JSON.encode(d)+":"+c)}});return"{"+a+"}";case"number":case"boolean":return String(b);case"null":return"null"}return null},decode:function(string,secure){if(typeOf(string)!="string"||!string.length){return null}if(secure&&!(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(string.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,""))){return null}return eval("("+string+")")}});Class.Mutators.Binds=function(a){if(!this.prototype.initialize){this.implement("initialize",function(){})}return a};Class.Mutators.initialize=function(a){return function(){Array.from(this.Binds).each(function(b){var c=this[b];if(c){this[b]=c.bind(this)}},this);return a.apply(this,arguments)}};Class.Occlude=new Class({occlude:function(c,b){b=document.id(b||this.element);var a=b.retrieve(c||this.property);if(a&&this.occluded!=null){return this.occluded=a}this.occluded=false;b.store(c||this.property,this);return this.occluded}});Class.refactor=function(b,a){Object.each(a,function(e,d){var c=b.prototype[d];if(c&&c.$origin){c=c.$origin}if(typeof e=="function"){b.implement(d,function(){var f=this.previous;this.previous=c||function(){};var g=e.apply(this,arguments);this.previous=f;return g})}else{b.implement(d,e)}});return b};(function(){var a=function(b){return b!=null};Object.extend({getFromPath:function(e,d){var f=d.split(".");for(var c=0,b=f.length;c<b;c++){if(e.hasOwnProperty(f[c])){e=e[f[c]]}else{return null}}return e},cleanValues:function(b,c){c=c||a;for(key in b){if(!c(b[key])){delete b[key]}}return b},erase:function(b,c){if(b.hasOwnProperty(c)){delete b[c]}return b},run:function(c){var b=Array.slice(arguments,1);for(key in c){if(c[key].apply){c[key].apply(c,b)}}return c}})})();Element.implement({isDisplayed:function(){return this.getStyle("display")!="none"},isVisible:function(){var a=this.offsetWidth,b=this.offsetHeight;return(a==0&&b==0)?false:(a>0&&b>0)?true:this.style.display!="none"},toggle:function(){return this[this.isDisplayed()?"hide":"show"]()},hide:function(){var b;try{b=this.getStyle("display")}catch(a){}if(b=="none"){return this}return this.store("element:_originalDisplay",b||"").setStyle("display","none")},show:function(a){if(!a&&this.isDisplayed()){return this}a=a||this.retrieve("element:_originalDisplay")||"block";return this.setStyle("display",(a=="none")?"block":a)},swapClass:function(a,b){return this.removeClass(a).addClass(b)}});Document.implement({clearSelection:function(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var a=window.getSelection();if(a&&a.removeAllRanges){a.removeAllRanges()}}}}});Elements.from=function(e,d){if(d||d==null){e=e.stripScripts()}var b,c=e.match(/^\s*<(t[dhr]|tbody|tfoot|thead)/i);if(c){b=new Element("table");var a=c[1].toLowerCase();if(["td","th","tr"].contains(a)){b=new Element("tbody").inject(b);if(a!="tr"){b=new Element("tr").inject(b)}}}return(b||new Element("div")).set("html",e).getChildren()};Events.Pseudos=function(f,c,d){var b="monitorEvents:";var a=function(g){return{store:g.store?function(h,j){g.store(b+h,j)}:function(h,j){(g.$monitorEvents||(g.$monitorEvents={}))[h]=j},retrieve:g.retrieve?function(h,j){return g.retrieve(b+h,j)}:function(h,j){if(!g.$monitorEvents){return j}return g.$monitorEvents[h]||j}}};var e=function(h){if(h.indexOf(":")==-1){return null}var g=Slick.parse(h).expressions[0][0],j=g.pseudos;return(f&&f[j[0].key])?{event:g.tag,value:j[0].value,pseudo:j[0].key,original:h}:null};return{addEvent:function(m,o,j){var n=e(m);if(!n){return c.call(this,m,o,j)}var k=a(this),s=k.retrieve(m,[]),p=f[n.pseudo],t=p.options||{};var r=this;var q=function(){p.listener.call(r,n,o,arguments,t)};s.include({event:o,monitor:q});k.store(m,s);var g=n.event,h=t[g]||{},l=Array.slice(arguments,2);if(h.args){l.append(Array.from(h.args))}if(h.base){g=h.base}c.apply(this,[m,o].concat(l));return c.apply(this,[g,q].concat(l))},removeEvent:function(l,n){var m=e(l);if(!m){return d.call(this,l,n)}var j=a(this),p=j.retrieve(l),o=f[m.pseudo],q=o.options||{};if(!p){return this}var g=m.event,h=q[g]||{},k=Array.slice(arguments,2);if(h.args){k.append(Array.from(h.args))}if(h.base){g=h.base}d.apply(this,[l,n].concat(k));p.each(function(r,s){if(!n||r.event==n){d.apply(this,[g,r.monitor].concat(k))}delete p[s]},this);j.store(l,p);return this}}};(function(b){var c={once:{listener:function(e,f,d){f.apply(this,d);this.removeEvent(e.original,f)}}};Events.definePseudo=function(d,e){c[d]=Type.isFunction(e)?{listener:e}:e;return this};var a=Events.prototype;Events.implement(Events.Pseudos(c,a.addEvent,a.removeEvent));["Request","Fx"].each(function(d){if(b[d]){b[d].implement(Events.prototype)}})})(this);(function(){var b={once:{listener:function(d,e,c){e.apply(this,c);this.removeEvent(d.original,e)}}};Event.definePseudo=function(c,d){b[c]=Type.isFunction(d)?{listener:d}:d;return this};var a=Element.prototype;[Element,Window,Document].invoke("implement",Events.Pseudos(b,a.addEvent,a.removeEvent))})();(function(){var a=!(window.attachEvent&&!window.addEventListener),b=Element.NativeEvents;b.focusin=2;b.focusout=2;Event.definePseudo("relay",{listener:function(h,j,g,l){var c=g[0],e=l[h.event],d=e?e.condition:null;for(var f=c.target;f&&f!=this;f=f.parentNode){var k=document.id(f);if(Slick.match(f,h.value)&&(!d||d.call(k,c))){if(k){j.call(k,c,k)}return}}},options:{mouseenter:{base:"mouseover",condition:Element.Events.mouseenter.condition},mouseleave:{base:"mouseout",condition:Element.Events.mouseleave.condition},focus:{base:"focus"+(a?"":"in"),args:[true]},blur:{base:a?"blur":"focusout",args:[true]}}})})();Fx.Elements=new Class({Extends:Fx.CSS,initialize:function(b,a){this.elements=this.subject=$$(b);this.parent(a)},compute:function(g,h,j){var c={};for(var d in g){var a=g[d],e=h[d],f=c[d]={};for(var b in a){f[b]=this.parent(a[b],e[b],j)}}return c},set:function(b){for(var c in b){if(!this.elements[c]){continue}var a=b[c];for(var d in a){this.render(this.elements[c],d,a[d],this.options.unit)}}return this},start:function(c){if(!this.check(c)){return this}var h={},j={};for(var d in c){if(!this.elements[d]){continue}var f=c[d],a=h[d]={},g=j[d]={};for(var b in f){var e=this.prepare(this.elements[d],b,f[b]);a[b]=e.from;g[b]=e.to}}return this.parent(h,j)}});(function(){var b=null,a={},d={};var c=function(f){if(instanceOf(f,e.Set)){return f}else{return a[f]}};var e=this.Locale={define:function(f,k,h,j){var g;if(instanceOf(f,e.Set)){g=f.name;if(g){a[g]=f}}else{g=f;if(!a[g]){a[g]=new e.Set(g)}f=a[g]}if(k){f.define(k,h,j)}if(!b){b=f}return f},use:function(f){f=c(f);if(f){b=f;this.fireEvent("change",f)}return this},getCurrent:function(){return b},get:function(g,f){return(b)?b.get(g,f):""},inherit:function(f,g,h){f=c(f);if(f){f.inherit(g,h)}return this},list:function(){return Object.keys(a)}};Object.append(e,new Events);e.Set=new Class({sets:{},inherits:{locales:[],sets:{}},initialize:function(f){this.name=f||""},define:function(j,g,h){var f=this.sets[j];if(!f){f={}}if(g){if(typeOf(g)=="object"){f=Object.merge(f,g)}else{f[g]=h}}this.sets[j]=f;return this},get:function(r,j,q){var p=Object.getFromPath(this.sets,r);if(p!=null){var m=typeOf(p);if(m=="function"){p=p.apply(null,Array.from(j))}else{if(m=="object"){p=Object.clone(p)}}return p}var h=r.indexOf("."),o=h<0?r:r.substr(0,h),k=(this.inherits.sets[o]||[]).combine(this.inherits.locales).include("en-US");if(!q){q=[]}for(var g=0,f=k.length;g<f;g++){if(q.contains(k[g])){continue}q.include(k[g]);var n=a[k[g]];if(!n){continue}p=n.get(r,j,q);if(p!=null){return p}}return""},inherit:function(g,h){g=Array.from(g);if(h&&!this.inherits.sets[h]){this.inherits.sets[h]=[]}var f=g.length;while(f--){(h?this.inherits.sets[h]:this.inherits.locales).unshift(g[f])}return this}})})();Locale.define("en-US","Date",{months:["January","February","March","April","May","June","July","August","September","October","November","December"],months_abbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],days_abbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dateOrder:["month","date","year"],shortDate:"%m/%d/%Y",shortTime:"%I:%M%p",AM:"AM",PM:"PM",ordinal:function(a){return(a>3&&a<21)?"th":["th","st","nd","rd","th"][Math.min(a%10,4)]},lessThanMinuteAgo:"less than a minute ago",minuteAgo:"about a minute ago",minutesAgo:"{delta} minutes ago",hourAgo:"about an hour ago",hoursAgo:"about {delta} hours ago",dayAgo:"1 day ago",daysAgo:"{delta} days ago",weekAgo:"1 week ago",weeksAgo:"{delta} weeks ago",monthAgo:"1 month ago",monthsAgo:"{delta} months ago",yearAgo:"1 year ago",yearsAgo:"{delta} years ago",lessThanMinuteUntil:"less than a minute from now",minuteUntil:"about a minute from now",minutesUntil:"{delta} minutes from now",hourUntil:"about an hour from now",hoursUntil:"about {delta} hours from now",dayUntil:"1 day from now",daysUntil:"{delta} days from now",weekUntil:"1 week from now",weeksUntil:"{delta} weeks from now",monthUntil:"1 month from now",monthsUntil:"{delta} months from now",yearUntil:"1 year from now",yearsUntil:"{delta} years from now"});(function(){var a=this.Date;a.Methods={ms:"Milliseconds",year:"FullYear",min:"Minutes",mo:"Month",sec:"Seconds",hr:"Hours"};["Date","Day","FullYear","Hours","Milliseconds","Minutes","Month","Seconds","Time","TimezoneOffset","Week","Timezone","GMTOffset","DayOfYear","LastMonth","LastDayOfMonth","UTCDate","UTCDay","UTCFullYear","AMPM","Ordinal","UTCHours","UTCMilliseconds","UTCMinutes","UTCMonth","UTCSeconds","UTCMilliseconds"].each(function(t){a.Methods[t.toLowerCase()]=t});var p=function(v,u,t){if(!t){t="0"}return new Array(u-String(v).length+1).join(t)+v};a.implement({set:function(v,u){v=v.toLowerCase();var t=a.Methods;if(t[v]){this["set"+t[v]](u)}return this}.overloadSetter(),get:function(u){u=u.toLowerCase();var t=a.Methods;if(t[u]){return this["get"+t[u]]()}return null},clone:function(){return new a(this.get("time"))},increment:function(t,v){t=t||"day";v=v!=null?v:1;switch(t){case"year":return this.increment("month",v*12);case"month":var u=this.get("date");this.set("date",1).set("mo",this.get("mo")+v);return this.set("date",u.min(this.get("lastdayofmonth")));case"week":return this.increment("day",v*7);case"day":return this.set("date",this.get("date")+v)}if(!a.units[t]){throw new Error(t+" is not a supported interval")}return this.set("time",this.get("time")+v*a.units[t]())},decrement:function(t,u){return this.increment(t,-1*(u!=null?u:1))},isLeapYear:function(){return a.isLeapYear(this.get("year"))},clearTime:function(){return this.set({hr:0,min:0,sec:0,ms:0})},diff:function(u,t){if(typeOf(u)=="string"){u=a.parse(u)}return((u-this)/a.units[t||"day"](3,3)).round()},getLastDayOfMonth:function(){return a.daysInMonth(this.get("mo"),this.get("year"))},getDayOfYear:function(){return(a.UTC(this.get("year"),this.get("mo"),this.get("date")+1)-a.UTC(this.get("year"),0,1))/a.units.day()},getWeek:function(){return(this.get("dayofyear")/7).ceil()},getOrdinal:function(t){return a.getMsg("ordinal",t||this.get("date"))},getTimezone:function(){return this.toString().replace(/^.*? ([A-Z]{3}).[0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3")},getGMTOffset:function(){var t=this.get("timezoneOffset");return((t>0)?"-":"+")+p((t.abs()/60).floor(),2)+p(t%60,2)},setAMPM:function(t){t=t.toUpperCase();var u=this.get("hr");if(u>11&&t=="AM"){return this.decrement("hour",12)}else{if(u<12&&t=="PM"){return this.increment("hour",12)}}return this},getAMPM:function(){return(this.get("hr")<12)?"AM":"PM"},parse:function(t){this.set("time",a.parse(t));return this},isValid:function(t){return !isNaN((t||this).valueOf())},format:function(u){if(!this.isValid()){return"invalid date"}if(!u){u="%x %X"}var t=u.toLowerCase();if(s[t]){return s[t](this)}u=f[t]||u;var v=this;return u.replace(/%([a-z%])/gi,function(x,w){switch(w){case"a":return a.getMsg("days_abbr")[v.get("day")];case"A":return a.getMsg("days")[v.get("day")];case"b":return a.getMsg("months_abbr")[v.get("month")];case"B":return a.getMsg("months")[v.get("month")];case"c":return v.format("%a %b %d %H:%M:%S %Y");case"d":return p(v.get("date"),2);case"e":return p(v.get("date"),2," ");case"H":return p(v.get("hr"),2);case"I":return p((v.get("hr")%12)||12,2);case"j":return p(v.get("dayofyear"),3);case"k":return p(v.get("hr"),2," ");case"l":return p((v.get("hr")%12)||12,2," ");case"L":return p(v.get("ms"),3);case"m":return p((v.get("mo")+1),2);case"M":return p(v.get("min"),2);case"o":return v.get("ordinal");case"p":return a.getMsg(v.get("ampm"));case"s":return Math.round(v/1000);case"S":return p(v.get("seconds"),2);case"U":return p(v.get("week"),2);case"w":return v.get("day");case"x":return v.format(a.getMsg("shortDate"));case"X":return v.format(a.getMsg("shortTime"));case"y":return v.get("year").toString().substr(2);case"Y":return v.get("year");case"T":return v.format("%H:%M:%S");case"z":return v.get("GMTOffset");case"Z":return v.get("Timezone")}return w})},toISOString:function(){return this.format("iso8601")}});a.alias("toJSON","toISOString");a.alias("compare","diff");a.alias("strftime","format");var f={db:"%Y-%m-%d %H:%M:%S",compact:"%Y%m%dT%H%M%S",iso8601:"%Y-%m-%dT%H:%M:%S%z","short":"%d %b %H:%M","long":"%B %d, %Y %H:%M"};var k=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var s={rfc822:function(t){return k[t.get("day")]+t.format(", %d ")+g[t.get("month")]+t.format(" %Y %H:%M:%S %Z")},rfc2822:function(t){return k[t.get("day")]+t.format(", %d ")+g[t.get("month")]+t.format(" %Y %H:%M:%S %z")}};var c=[];var n=a.parse;var r=function(w,y,v){var u=-1;var x=a.getMsg(w+"s");switch(typeOf(y)){case"object":u=x[y.get(w)];break;case"number":u=x[y];if(!u){throw new Error("Invalid "+w+" index: "+y)}break;case"string":var t=x.filter(function(z){return this.test(z)},new RegExp("^"+y,"i"));if(!t.length){throw new Error("Invalid "+w+" string")}if(t.length>1){throw new Error("Ambiguous "+w)}u=t[0]}return(v)?x.indexOf(u):u};a.extend({getMsg:function(u,t){return Locale.get("Date."+u,t)},units:{ms:Function.from(1),second:Function.from(1000),minute:Function.from(60000),hour:Function.from(3600000),day:Function.from(86400000),week:Function.from(608400000),month:function(u,t){var v=new a;return a.daysInMonth(u!=null?u:v.get("mo"),t!=null?t:v.get("year"))*86400000},year:function(t){t=t||new a().get("year");return a.isLeapYear(t)?31622400000:31536000000}},daysInMonth:function(u,t){return[31,a.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][u]},isLeapYear:function(t){return((t%4===0)&&(t%100!==0))||(t%400===0)},parse:function(w){var v=typeOf(w);if(v=="number"){return new a(w)}if(v!="string"){return w}w=w.clean();if(!w.length){return null}var u;c.some(function(x){var t=x.re.exec(w);return(t)?(u=x.handler(t)):false});if(!(u&&u.isValid())){u=new a(n(w));if(!(u&&u.isValid())){u=new a(w.toInt())}}return u},parseDay:function(t,u){return r("day",t,u)},parseMonth:function(u,t){return r("month",u,t)},parseUTC:function(u){var t=new a(u);var v=a.UTC(t.get("year"),t.get("mo"),t.get("date"),t.get("hr"),t.get("min"),t.get("sec"),t.get("ms"));return new a(v)},orderIndex:function(t){return a.getMsg("dateOrder").indexOf(t)+1},defineFormat:function(t,u){f[t]=u},defineFormats:function(t){for(var u in t){a.defineFormat(u,t[u])}},defineParser:function(t){c.push((t.re&&t.handler)?t:l(t))},defineParsers:function(){Array.flatten(arguments).each(a.defineParser)},define2DigitYearStart:function(t){o=t%100;h=t-o}});var h=1900;var o=70;var d=function(t){return new RegExp("(?:"+a.getMsg(t).map(function(u){return u.substr(0,3)}).join("|")+")[a-z]*")};var m=function(t){switch(t){case"T":return"%H:%M:%S";case"x":return((a.orderIndex("month")==1)?"%m[-./]%d":"%d[-./]%m")+"([-./]%y)?";case"X":return"%H([.:]%M)?([.:]%S([.:]%s)?)? ?%p? ?%z?"}return null};var j={d:/[0-2]?[0-9]|3[01]/,H:/[01]?[0-9]|2[0-3]/,I:/0?[1-9]|1[0-2]/,M:/[0-5]?\d/,s:/\d+/,o:/[a-z]*/,p:/[ap]\.?m\.?/,y:/\d{2}|\d{4}/,Y:/\d{4}/,z:/Z|[+-]\d{2}(?::?\d{2})?/};j.m=j.I;j.S=j.M;var e;var b=function(t){e=t;j.a=j.A=d("days");j.b=j.B=d("months");c.each(function(v,u){if(v.format){c[u]=l(v.format)}})};var l=function(v){if(!e){return{format:v}}var t=[];var u=(v.source||v).replace(/%([a-z])/gi,function(x,w){return m(w)||x}).replace(/\((?!\?)/g,"(?:").replace(/ (?!\?|\*)/g,",? ").replace(/%([a-z%])/gi,function(x,w){var y=j[w];if(!y){return w}t.push(w);return"("+y.source+")"}).replace(/\[a-z\]/gi,"[a-z\\u00c0-\\uffff;&]");return{format:v,re:new RegExp("^"+u+"$","i"),handler:function(z){z=z.slice(1).associate(t);var w=new a().clearTime(),y=z.y||z.Y;if(y!=null){q.call(w,"y",y)}if("d" in z){q.call(w,"d",1)}if("m" in z||z.b||z.B){q.call(w,"m",1)}for(var x in z){q.call(w,x,z[x])}return w}}};var q=function(t,u){if(!u){return this}switch(t){case"a":case"A":return this.set("day",a.parseDay(u,true));case"b":case"B":return this.set("mo",a.parseMonth(u,true));case"d":return this.set("date",u);case"H":case"I":return this.set("hr",u);case"m":return this.set("mo",u-1);case"M":return this.set("min",u);case"p":return this.set("ampm",u.replace(/\./g,""));case"S":return this.set("sec",u);case"s":return this.set("ms",("0."+u)*1000);case"w":return this.set("day",u);case"Y":return this.set("year",u);case"y":u=+u;if(u<100){u+=h+(u<o?100:0)}return this.set("year",u);case"z":if(u=="Z"){u="+00"}var v=u.match(/([+-])(\d{2}):?(\d{2})?/);v=(v[1]+"1")*(v[2]*60+(+v[3]||0))+this.getTimezoneOffset();return this.set("time",this-v*60000)}return this};a.defineParsers("%Y([-./]%m([-./]%d((T| )%X)?)?)?","%Y%m%d(T%H(%M%S?)?)?","%x( %X)?","%d%o( %b( %Y)?)?( %X)?","%b( %d%o)?( %Y)?( %X)?","%Y %b( %d%o( %X)?)?","%o %b %d %X %z %Y","%T","%H:%M( ?%p)?");Locale.addEvent("change",function(t){if(Locale.get("Date")){b(t)}}).fireEvent("change",Locale.getCurrent())})();(function(){var c={a:/[àáâãäåăą]/g,A:/[ÀÁÂÃÄÅĂĄ]/g,c:/[ćčç]/g,C:/[ĆČÇ]/g,d:/[ďđ]/g,D:/[ĎÐ]/g,e:/[èéêëěę]/g,E:/[ÈÉÊËĚĘ]/g,g:/[ğ]/g,G:/[Ğ]/g,i:/[ìíîï]/g,I:/[ÌÍÎÏ]/g,l:/[ĺľł]/g,L:/[ĹĽŁ]/g,n:/[ñňń]/g,N:/[ÑŇŃ]/g,o:/[òóôõöøő]/g,O:/[ÒÓÔÕÖØ]/g,r:/[řŕ]/g,R:/[ŘŔ]/g,s:/[ššş]/g,S:/[ŠŞŚ]/g,t:/[ťţ]/g,T:/[ŤŢ]/g,ue:/[ü]/g,UE:/[Ü]/g,u:/[ùúûůµ]/g,U:/[ÙÚÛŮ]/g,y:/[ÿý]/g,Y:/[ŸÝ]/g,z:/[žźż]/g,Z:/[ŽŹŻ]/g,th:/[þ]/g,TH:/[Þ]/g,dh:/[ð]/g,DH:/[Ð]/g,ss:/[ß]/g,oe:/[œ]/g,OE:/[Œ]/g,ae:/[æ]/g,AE:/[Æ]/g},b={" ":/[\xa0\u2002\u2003\u2009]/g,"*":/[\xb7]/g,"'":/[\u2018\u2019]/g,'"':/[\u201c\u201d]/g,"...":/[\u2026]/g,"-":/[\u2013]/g,"&raquo;":/[\uFFFD]/g};var a=function(e,f){var d=e;for(key in f){d=d.replace(f[key],key)}return d};String.implement({standardize:function(){return a(this,c)},repeat:function(d){return new Array(d+1).join(this)},pad:function(d,g,f){if(this.length>=d){return this}var e=(g==null?" ":""+g).repeat(d-this.length).substr(0,d-this.length);if(!f||f=="right"){return this+e}if(f=="left"){return e+this}return e.substr(0,(e.length/2).floor())+this+e.substr(0,(e.length/2).ceil())},tidy:function(){return a(this,b)},truncate:function(d,e,h){var g=this;if(e==null&&arguments.length==1){e="…"}if(g.length>d){g=g.substring(0,d);if(h){var f=g.lastIndexOf(h);if(f!=-1){g=g.substr(0,f)}}if(e){g+=e}}return g}})})();(function(){var a=function(b,c){b=b||"";var d=c?"<"+b+"(?!\\w)[^>]*>([\\s\\S]*?)</"+b+"(?!\\w)>":"</?"+b+"([^>]+)?>";reg=new RegExp(d,"gi");return reg};String.implement({getTags:function(b,c){return this.match(a(b,c))||[]},stripTags:function(b,c){return this.replace(a(b,c),"")}})})();var Asset={javascript:function(f,c){if(!c){c={}}var a=new Element("script",{src:f,type:"text/javascript"}),g=c.document||document,b=0,d=c.onload||c.onLoad;var e=d?function(){if(++b==1){d.call(this)}}:function(){};delete c.onload;delete c.onLoad;delete c.document;return a.addEvents({load:e,readystatechange:function(){if(["loaded","complete"].contains(this.readyState)){e.call(this)}}}).set(c).inject(g.head)},css:function(d,a){if(!a){a={}}var b=new Element("link",{rel:"stylesheet",media:"screen",type:"text/css",href:d});var c=a.onload||a.onLoad,e=a.document||document;delete a.onload;delete a.onLoad;delete a.document;if(c){b.addEvent("load",c)}return b.set(a).inject(e.head)},image:function(c,b){b=Object.merge({onload:function(){},onabort:function(){},onerror:function(){}},b);var d=new Image();var a=document.id(d)||new Element("img");["load","abort","error"].each(function(e){var g="on"+e;var f=e.capitalize();if(b["on"+f]){b[g]=b["on"+f];delete b["on"+f]}var h=b[g];delete b[g];d[g]=function(){if(!d){return}if(!a.parentNode){a.width=d.width;a.height=d.height}d=d.onload=d.onabort=d.onerror=null;h.delay(1,a,a);a.fireEvent(e,a,1)}});d.src=a.src=c;if(d&&d.complete){d.onload.delay(1)}return a.set(b)},images:function(c,b){b=Object.merge({onComplete:function(){},onProgress:function(){},onError:function(){},properties:{}},b);c=Array.from(c);var a=0;return new Elements(c.map(function(e,d){return Asset.image(e,Object.append(b.properties,{onload:function(){a++;b.onProgress.call(this,a,d,e);if(a==c.length){b.onComplete()}},onerror:function(){a++;b.onError.call(this,a,d,e);if(a==c.length){b.onComplete()}}}))}))}};var IframeShim=new Class({Implements:[Options,Events,Class.Occlude],options:{className:"iframeShim",src:'javascript:false;document.write("");',display:false,zIndex:null,margin:0,offset:{x:0,y:0},browsers:(Browser.ie6||(Browser.firefox&&Browser.version<3&&Browser.Platform.mac))},property:"IframeShim",initialize:function(b,a){this.element=document.id(b);if(this.occlude()){return this.occluded}this.setOptions(a);this.makeShim();return this},makeShim:function(){if(this.options.browsers){var c=this.element.getStyle("zIndex").toInt();if(!c){c=1;var b=this.element.getStyle("position");if(b=="static"||!b){this.element.setStyle("position","relative")}this.element.setStyle("zIndex",c)}c=((this.options.zIndex!=null||this.options.zIndex===0)&&c>this.options.zIndex)?this.options.zIndex:c-1;if(c<0){c=1}this.shim=new Element("iframe",{src:this.options.src,scrolling:"no",frameborder:0,styles:{zIndex:c,position:"absolute",border:"none",filter:"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)"},"class":this.options.className}).store("IframeShim",this);var a=(function(){this.shim.inject(this.element,"after");this[this.options.display?"show":"hide"]();this.fireEvent("inject")}).bind(this);if(!IframeShim.ready){window.addEvent("load",a)}else{a()}}else{this.position=this.hide=this.show=this.dispose=Function.from(this)}},position:function(){if(!IframeShim.ready||!this.shim){return this}var a=this.element.measure(function(){return this.getSize()});if(this.options.margin!=undefined){a.x=a.x-(this.options.margin*2);a.y=a.y-(this.options.margin*2);this.options.offset.x+=this.options.margin;this.options.offset.y+=this.options.margin}this.shim.set({width:a.x,height:a.y}).position({relativeTo:this.element,offset:this.options.offset});return this},hide:function(){if(this.shim){this.shim.setStyle("display","none")}return this},show:function(){if(this.shim){this.shim.setStyle("display","block")}return this.position()},dispose:function(){if(this.shim){this.shim.dispose()}return this},destroy:function(){if(this.shim){this.shim.destroy()}return this}});window.addEvent("load",function(){IframeShim.ready=true});Request.JSONP=new Class({Implements:[Chain,Events,Options],options:{onRequest:function(a){if(this.options.log&&window.console&&console.log){console.log("JSONP retrieving script with url:"+a)}},onError:function(a){if(this.options.log&&window.console&&console.warn){console.warn("JSONP "+a+" will fail in Internet Explorer, which enforces a 2083 bytes length limit on URIs")}},url:"",callbackKey:"callback",injectScript:document.head,data:"",link:"ignore",timeout:0,log:false},initialize:function(a){this.setOptions(a)},send:function(c){if(!Request.prototype.check.call(this,c)){return this}this.running=true;var d=typeOf(c);if(d=="string"||d=="element"){c={data:c}}c=Object.merge(this.options,c||{});var e=c.data;switch(typeOf(e)){case"element":e=document.id(e).toQueryString();break;case"object":case"hash":e=Object.toQueryString(e)}var b=this.index=Request.JSONP.counter++;var f=c.url+(c.url.test("\\?")?"&":"?")+(c.callbackKey)+"=Request.JSONP.request_map.request_"+b+(e?"&"+e:"");if(f.length>2083){this.fireEvent("error",f)}Request.JSONP.request_map["request_"+b]=function(){this.success(arguments,b)}.bind(this);var a=this.getScript(f).inject(c.injectScript);this.fireEvent("request",[a.get("src"),a]);if(c.timeout){this.timeout.delay(c.timeout,this)}return this},getScript:function(a){if(!this.script){this.script=new Element("script[type=text/javascript]",{async:true,src:a})}return this.script},success:function(b,a){if(!this.running){return false}this.clear().fireEvent("complete",b).fireEvent("success",b).callChain()},cancel:function(){if(this.running){this.clear().fireEvent("cancel")}return this},isRunning:function(){return !!this.running},clear:function(){this.running=false;if(this.script){this.script.destroy();this.script=null}return this},timeout:function(){if(this.running){this.running=false;this.fireEvent("timeout",[this.script.get("src"),this.script]).fireEvent("failure").cancel()}return this}});Request.JSONP.counter=0;Request.JSONP.request_map={};
/*
Copyright (c) 2009 Arieh Glazer

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE
*/
(function(a){function b(){}a.instantiate=function(d,g){b.prototype=d.prototype;var e=new b(),c=d.apply(e,g);return c||e};a.implement({instantiate:function(c){return a.instantiate(this,c)}})})(Function);IdleTimer=new Class({Implements:[Events,Options],options:{timeout:60000,events:["mousemove","keydown","mousewheel","mousedown"]},initialize:function(b,a){this.setOptions(a);this.element=$(b);this.activeBound=this.active.bind(this);this.isIdle=false;this.started=false},stop:function(){clearTimeout(this.timer);for(var a in this.options.events){this.element.removeEvent(this.options.events[a],this.activeBound)}this.bound=false;this.started=false;this.fireEvent("stop");return this},active:function(){clearTimeout(this.timer);if(this.isIdle){this.fireEvent("active")}this.isIdle=false;this.start()},idle:function(){if(this.timer){clearTimeout(this.timer)}this.isIdle=true;this.fireEvent("idle")},start:function(){this.timer=this.idle.delay(this.options.timeout,this);this.lastActive=new Date().getTime();if(!this.bound){this.bind()}this.started=true;return this},bind:function(){for(var a in this.options.events){this.element.addEvent(this.options.events[a],this.activeBound)}this.bound=true;this.fireEvent("start")},getIdleTime:function(a){return a?Math.round((Date.now()-this.lastActive)/1000):Date.now()-this.lastActive},setTimeout:function(c,d){var b=this.options.timeout;this.options.timeout=c;if(d){return this}clearTimeout(this.timer);this.fireEvent("timeoutChanged",c);var a=this.getIdleTime();if(a<c&&this.isIdle){this.fireEvent("active");this.isIdle=false}else{if(a>=c){this.idle();return this}}this.timer=this.idle.delay(c-a,this);return this}});Element.Properties.idle={set:function(a){var b=this.retrieve("idle");if(b){b.stop()}return this.eliminate("idle").store("idle:options",a)},get:function(a){if(a||!this.retrieve("idle")){if(a||!this.retrieve("idle:options")){this.set("idle",a)}this.store("idle",new IdleTimer(this,this.retrieve("idle:options")))}return this.retrieve("idle")}};Element.Events.idle={onAdd:function(a){var b=this.get?false:true;var c=b?window.idleTimer:this.get("idle");if(b&&!c){c=window.idleTimer=new IdleTimer(this)}if(!c.started){c.start()}c.addEvent("idle",a)}};Element.Events.active={onAdd:function(a){(this.get?this.get("idle"):window.idleTimer).addEvent("active",a)}};var HoverIntent=new Class({Implements:[Options,Events],options:{sensitivity:7,interval:100,timeout:0,over:function(){},out:function(){}},initialize:function(c,b){this.setOptions(b);this.ob=c;var a=this;this.ob.addEvents({mouseenter:function(d){a.handleHover(d)},mouseleave:function(d){a.handleHover(d)}})},track:function(a){this.cX=a.page.x;this.cY=a.page.y},_compare:function(c,b){var a=this;b.hoverIntent_t=clearTimeout(b.hoverIntent_t);if((Math.abs(this.pX-this.cX)+Math.abs(this.pY-this.cY))<this.options.sensitivity){b.removeEvent("mousemove",a.track);b.hoverIntent_s=1;return this.options.over.apply(b,[c])}else{this.pX=this.cX;this.pY=this.cY;b.hoverIntent_t=(function(){a._compare(c,b)}).delay(this.options.interval)}},_delay:function(b,a){a.hoverIntent_t=clearTimeout(a.hoverIntent_t);a.hoverIntent_s=0;return this.options.out.apply(a,[b])},handleHover:function(c){var b=c;var a=this;if(this.ob.hoverIntent_t!==undefined){this.ob.hoverIntent_t=clearTimeout(a.ob.hoverIntent_t)}if(c.type=="mouseover"){this.pX=b.page.x;this.pY=b.page.y;this.ob.addEvent("mousemove",function(d){a.track(d)});if(this.ob.hoverIntent_s!=1){this.ob.hoverIntent_t=(function(){a._compare(b,a.ob)}).delay(a.options.interval)}}else{this.ob.removeEvent("mousemove",function(d){a.track(d)});if(this.ob.hoverIntent_s==1){this.ob.hoverIntent_t=(function(){a._delay(b,a.ob)}).delay(a.options.interval)}}}});Element.implement({hoverIntent:function(a){new HoverIntent(this,a);return this}});Array.implement({getRandomIndex:function(){return Number.random(0,this.length-1)},copy:function(){return this.splice(0,this.length)},toQueryString:function(){var a=this.map(function(c,b){switch(typeOf(c)){case"element":return ta.id(c).toQueryString();break;case"object":return Object.toQueryString(c)}});return a.join("&")}});Cookie=Class.refactor(Cookie,{write:function(b){if(this.options.encode){b=encodeURIComponent(b)}if(this.options.domain){b+="; domain="+this.options.domain}if(this.options.path){b+="; path="+this.options.path}if(this.options.duration){var a=new Date();a.setTime(a.getTime()+this.options.duration*24*60*60*1000);b+="; expires="+a.toGMTString()}if(this.options.time){var a=new Date();a.setTime(a.getTime()+this.options.time*1000);b+="; expires="+a.toGMTString()}if(this.options.expires){var a=new Date(this.options.expires);b+="; expires="+a.toGMTString()}if(this.options.secure){b+="; secure"}this.options.document.cookie=this.key+"="+b;return this},readRaw:function(a){var b=this.options.document.cookie.match("(?:^|;)\\s*"+this.key.escapeRegExp()+"=([^;]*)");return b?b[1]:false}});Cookie.exist=function(a){return document.cookie.match("(?:^|;)\\s*"+a.escapeRegExp()+"=([^;]*)")!=null};Cookie.readSession=function(c,a){if(a==null){a={}}var b=new Cookie("TASession",{encode:false}).readRaw();var d=a.pattern?a.pattern:"[^\\*]+";var e=new RegExp("(\\*|^)"+c+"\\.("+d+")");if(e.test(b)){return{cookie:b,pattern:e,start:RegExp.$1,value:RegExp.$2}}return{cookie:b,pattern:e}};Cookie.writeSession=function(d,e,c){var a=this.readSession(d,c);if(!a.cookie){return false}var b;if(a.value){b=a.cookie.replace(a.pattern,a.start+d+"."+e)}else{b=a.cookie+"*"+d+"."+e}new Cookie("TASession",{domain:cookieDomain,encode:false}).write(b);return true};Cookie.readRaw=function(a){return new Cookie(a).readRaw()};(function(){var a=Asset.javascript;Asset.javascript=function(c,b){if(!b){b={}}try{if(window.CDNHOST&&c.indexOf&&c.indexOf(window.CDNHOST)==0&&!b.crossorigin){b.crossorigin="anonymous"}}catch(d){if(window.ta&&ta.util&&ta.util.error&&ta.util.error.record){ta.util.error.record(d,"Asset.javascript - error attempting to add crossorgin property")}}a(c,b)}})();Element.implement({getParentBySelector:function(a){try{if(!a){return $(this.parentNode)}return this.getParents(a)[0]||null}catch(b){ta.util.error.record(b,"Element.extend - getParentBySelector",null,{selector:a})}},findParentByClass:function(b){if(!this.parentNode){return null}var a=$(this.parentNode);if(a==document){return null}if(a.hasClass(b)){return a}return a.findParentByClass(b)},getLastElement:function(a){return $(this.getElements(a,true).reverse()[0]||false)},centerOnScreen:function(){var a=this.getCoordinates();this.style.left=Math.round((Window.getWidth()-a.width)/2)+Window.getScrollLeft()+"px";this.style.top=Math.round((Window.getHeight()-a.height)/2)+Window.getScrollTop()+"px"},positionOnScreen:function(b,a){this.style.left=Window.getScrollLeft()+b+"px";this.style.top=Window.getScrollTop()+a+"px"},containsEvent:function(c){if(!c||!c.page||!c.client){return false}c=new Event(c);var b=c.page;var a=this.getCoordinates();if("fixed"==(this.getOffsetParent()||this).style.position){b=c.client}return(b.y>=a.top&&b.y<=a.bottom&&b.x>=a.left&&b.x<=a.right)},overlaps:function(b){var h=this.getCoordinates();var g=b.getCoordinates();var a=(g.left>h.left&&g.left<h.right)||(g.right>h.left&&g.right<h.right);var f=g.top>h.top&&g.top<h.bottom;var d=g.bottom>h.top&&g.bottom<h.bottom;return(f&&a)||(d&&a)},linkify:function(){var b=new Element("a",{"class":this.className,href:"javascript:;"}).set("html",this.innerHTML).replaces(this);_processLink(b);return b},setContent:function(a){if(a instanceof Array||typeOf(a)=="elements"){a.each(function(b){this.adopt($(b))},this)}else{if(typeOf(a)=="string"){this.set("html",a)}else{this.adopt($(a))}}return this},isHidden:function(){return this.getStyle("display")=="none"},inDocument:function(){return this.parentNode!=null&&this.parentNode.nodeType!=11},isFullyVisible:function(){if(this.isVisible()){var b=this.getCoordinates().top;var a=window.getScroll().y+window.getSize().y;return b<=a}else{return false}},removePropertyEvent:function(d,b){if(d.substr(0,2)!=="on"){d="on"+d}var j="ta.call(",h=this.getProperty(d),a=h&&h.indexOf(b),g=h&&h.indexOf(")",a),f;if(!h||a<0){return}if(h.charAt(g+1)==";"){g++}if(h.charAt(a+b.length)=="("){f=h.slice(0,a)+h.slice(g+1)}else{if(a>=j.length+1&&h.substr(a-j.length-1,j.length)==j){a-=j.length+1;f=h.slice(0,a)+h.slice(g+1)}}this.setProperty(d,f&&f.trim())}});Function.implement({invokeLater:function(b,c,a){return setTimeout(this.pass(a,c),b)},executeContinuations:function(b,d){var c=Array.prototype.slice.apply(arguments);if(c.length>2){d=c[2]}if(b.length>0){var a=b[0];var e=Function.executeContinuations.partial(b.slice(1),null,d);a(e,d)}else{}},inContinuationPassingForm:function(a){return function(c,b){if(a()){if(c){c()}}else{if(b){b()}}}}});Function.implement({_:{},partial:function(){var d=this;var b=Function._;var a=Array.prototype.slice.call(arguments);var f=[],e;for(var c=0;c<arguments.length;c++){arguments[c]==b&&f.push(c)}return function(){var h=a.concat(Array.prototype.slice.call(arguments,f.length));for(var g=0;g<Math.min(f.length,arguments.length);g++){h[f[g]]=arguments[g]}for(var g=0;g<h.length;g++){if(h[g]==b){return d.partial.apply(d,h)}}return d.apply(this,h)}}});Request=Class.refactor(Request,{initialize:function(b){if(b.url){var a=String(b.url);if(!/^http/.test(a)){b.url=window.location.protocol+"//"+window.location.host+a}else{if(/^(\w+):\/\/([\w.\-]+)\/(.*)/.test(a)&&RegExp.$2!=window.location.host){b.url=RegExp.$1+"://"+window.location.host+"/"+RegExp.$3}}}if(b&&b.data&&b.data.constructor&&(b.data instanceof Array)){b.data=b.data.toQueryString()}try{if(b.trackEvent&&ta&&ta.analytics){var d=ta.analytics._toEvtParams(b.trackEvent);if(d){if(b.data){if(typeof b.data=="string"){b.data=b.data+"&"+Object.toQueryString(d)}else{if(typeof b.data=="object"){b.data=Object.merge(b.data,d)}}}else{b.data=d}}}}catch(c){if(ta&&ta.util&&ta.util.error&&ta.util.error.record){ta.util.error.record(c,"Request.Absolute.initialize.trackEvent")}}return this.previous(b)},processScripts:function(c){if(this.options.keepScripts){return c}var a=c;try{a=this.previous(c)}catch(b){ta.util.error.record(b,"Request.processScripts",null,{"request url":this.options.url})}return a},send:function(a){var c=this.previous(a);if(ta&&ta.util&&ta.util.cookie){ta.util.cookie.removePIDCookie()}try{if(this.options&&ta&&ta.analytics){if(this.options.trackEvent){ta.analytics._trackEventAfterAjax(this.options.trackEvent)}if(this.options.trackPath){ta.analytics._trackEventPathAfterAjax(this.options.trackPath)}}}catch(b){if(ta&&ta.util&&ta.util.error&&ta.util.error.record){ta.util.error.record(b,"Request.Absolute.send.trackEventAfterAjax")}}return c}});(function(){var x=this;var t=x._;var d={};var n=Array.prototype,D=Object.prototype,F=Function.prototype;var m=n.push,v=n.slice,z=n.unshift,y=D.toString,r=D.hasOwnProperty;var q=n.forEach,l=n.map,B=n.reduce,g=n.reduceRight,p=n.filter,b=n.every,A=n.some,w=n.indexOf,h=n.lastIndexOf,e=Array.isArray,C=Object.keys,o=F.bind;var E=function(H){return new k(H)};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=E}exports._=E}else{x._=E}E.VERSION="1.3.3";var f=E.each=E.forEach=function(M,L,K){if(M==null){return}if(q&&M.forEach===q){M.forEach(L,K)}else{if(M.length===+M.length){for(var J=0,H=M.length;J<H;J++){if(L.call(K,M[J],J,M)===d){return}}}else{for(var I in M){if(E.has(M,I)){if(L.call(K,M[I],I,M)===d){return}}}}}};E.defaults=function(H){f(v.call(arguments,1),function(I){for(var J in I){if(H[J]==null){H[J]=I[J]}}});return H};E.extend=function(H){f(v.call(arguments,1),function(I){for(var J in I){H[J]=I[J]}});return H};E.escape=function(H){return(""+H).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var u=/.^/;var a={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"};for(var G in a){a[a[G]]=G}var c=/\\|'|\r|\n|\t|\u2028|\u2029/g;var j=/\\(\\|'|r|n|t|u2028|u2029)/g;var s=function(H){return H.replace(j,function(I,J){return a[J]})};E.template=function(M,L,J){J=E.defaults(J||{},E.templateSettings);var K="__p+='"+M.replace(c,function(N){return"\\"+a[N]}).replace(J.escape||u,function(N,O){return"'+\n((__t=("+s(O)+"))==null?'':_.escape(__t))+\n'"}).replace(J.interpolate||u,function(N,O){return"'+\n((__t=("+s(O)+"))==null?'':__t)+\n'"}).replace(J.evaluate||u,function(N,O){return"';\n"+s(O)+"\n__p+='"})+"';\n";if(!J.variable){K="with(obj||{}){\n"+K+"}\n"}K="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'')};\n"+K+"return __p;\n";var I=new Function(J.variable||"obj","_",K);if(L){return I(L,E)}var H=function(N){return I.call(this,N,E)};H.source="function("+(J.variable||"obj")+"){\n"+K+"}";return H};var k=function(H){this._wrapped=H}}).call(this);if(window.IS_DEBUG==null){var IS_DEBUG=false}if(window.VERSION_MAP==null){var VERSION_MAP={}}if(window.CDNHOST==null){var CDNHOST=""}ta={overlays:{},maps:{},bmaps:{},common:{},phac:{},servlet:{},support:{},util:{},widgets:{},commerce:{},mobfull:{},photos:{},media:{},hac:{filters:{}},t4b:{},api:{maps:{}},p13n:{},registration:{},meta:{},reviews:{}};ta.id=function(a){try{return document.id(a)}catch(b){if(ta.util.error){ta.util.error.record(b,"ta.id - trouble wrapping",null,{elmtArg:ta.util.error.describe(a)})}}};ta.select=function(){var b=Array.from(arguments),c=b.length>1&&(("string"===typeof b[0])?b.pop():b.shift())||document,a=b.shift();return Slick.search(c,a,new Elements)};ta.invoke=function(a,b){a.each(function(c){c[b]()})};ta.selectInvoke=function(a,b){ta.invoke($$(a),b)};ta.css=function(b,a){return Asset.css(b,Object.merge({media:"screen, print"},a))};var api=ta;api.extend=_.extend;api.bind=function(a,b){return Function.prototype.bind.apply(a,Array.from(arguments).slice(1))};api.addEvent=function(a,c,b){return a&&$(a).addEvent(c,b)};api.removeEvent=function(a,c,b){return a&&$(a).removeEvent(c,b)};api.createElement=function(a,b){return new Element(a,b)};api.getSize=function(a){return a&&$(a).getSize()};api.getPosition=function(a){return a&&$(a).getPosition()};api.addClass=function(a,b){return a&&$(a).addClass(b)};api.removeClass=function(a,b){return a&&$(a).removeClass(b)};api.find=function(a,b){return $(b||document).getElement(a)};api.bindAll=function(a){if(arguments.length>1){Array.from(arguments).slice(1).each(function(b){a[b]=api.bind(a[b],a)})}else{Object.each(a,function(c,b){a[b]=api.bind(c,a)})}return a};api.checkBrowser=function(){return Array.from(arguments).some(function(a){return !!Browser[a]})};(function(a){var b={};a.store=function(c,d){b[c]=d;return d};a.retrieve=function(c){return b[c]};a.has=function(c){return typeof(b[c])!="undefined"};a.retrieveOrStore=function(c,d){var e=b[c];if(typeof(e)=="undefined"){b[c]=d;e=d}return e};a.remove=function(c){var d=b[c];delete b[c];return d};a.keep=function(e,f){var d=[];var c=a.retrieve(e);if(c){if(c instanceof Array){d=c}else{d.push(c)}}if(f instanceof Array){d=d.combine(f)}else{d.push(f)}a.store(e,d)};a.merge=function(c,e){var d=a.retrieve(c)||{};a.store(c,Object.merge(d,e))};a.asInt=function(d,c){var e=parseInt(a.retrieve(d));return isNaN(e)?(c||0):e};a.asFloat=function(d,c){var e=parseFloat(a.retrieve(d));return isNaN(e)?(c||0):e}})(ta);ta.load=function(b,f){var e=false;var c=ta.findFileKey(b);if(c){e=VERSION_MAP[c]}if(e){var a=c+"_callback";if(ta.has(a)){var d=ta.retrieve(a);d.push(f);ta.store(a,d)}else{ta.store(a,[function(){delete VERSION_MAP[c];if(f){f()}}]);Asset.javascript(e,{onLoad:function(){var g=ta.remove(a);g.each(function(h){if(h){h()}})}})}}return e};ta.findFileKey=function(f){if(typeof f!="string"||!VERSION_MAP){return}var d=false;var c=false;if(VERSION_MAP[f]){c=f}else{if(VERSION_MAP[f+".js"]){c=f+".js"}else{var a=f.split(".");var b=0;while(a&&a.length>1&&b<10){a=a.slice(0,-1);var e=a.join("-")+".js";if(e&&VERSION_MAP[e]){c=e;break}b++}}}return c};(function(ta){var _eventListeners={};ta.call=function(funcName,evnt,elmt){if(evnt==null){if(IS_DEBUG){alert("You must pass the event.\n\nUsage:\nta.call('ta.namespace.Class.function', event);")}return false}if(funcName==null){if(IS_DEBUG){alert("ta.call of undefined function")}return false}var func=funcName;if(typeof(funcName)==="function"){funcName="<func>"}else{if(!/^ta\.[\w\d\.]+$/.test(funcName)){if(IS_DEBUG){alert("Invalid function name. Must be of the form: ta.namespace.Class.function")}return false}}var e=new Event(evnt||window.event);if(!elmt){elmt=e.target}elmt=ta.id(elmt);if(!elmt){ta.util.error.record(null,"ta.call re-wrap fail (non-DOM element) - "+funcName,evnt,{elmtArg:ta.util.error.describe({none:"none"}),funcName:funcName})}else{if(!elmt.$family){ta.util.error.record(null,"ta.call re-wrap fail - "+funcName,evnt,{elmtArg:ta.util.error.describe(elmt),funcName:funcName})}}var argSet=arguments;var args=Array.from(argSet).slice(3);args.splice(0,0,e,elmt);try{args.unshift({callback:_ta_call_defer,evt:e});args.unshift(func);return ta.run.apply(null,args)}catch(_ex){ta.util.error.record(_ex,"ta.call - "+funcName,evnt)}return false};var _ta_call_defer=function(func,options){if(options){delete (options.evt)}ta.run.apply(null,arguments)};ta.run=function(func,options){var argSet=arguments,args=Array.from(argSet).slice(2);try{var fn=ta.fn(func);if(fn&&typeOf(fn)==="function"){var retVal=fn.apply(window,Array.from(args));if(options&&options.onComplete){var completeFun=ta.fn(options.onComplete);if(completeFun){completeFun(retVal)}}return retVal}else{if(options&&options.evt){new Event(options.evt).preventDefault()}}var callback=options&&options.callback;ta.load(func,(callback||ta.run).pass(arguments))}catch(_ex){ta.util.error.record(_ex,"ta.run - "+func)}return false};ta.on=function(name,f){var v=_eventListeners[name];if(!v){v=_eventListeners[name]=[]}v.push(f)};ta.fireEvent=function(name){var args=Array.from(arguments),listeners=_eventListeners[name];args.shift();if(listeners){listeners.each(function(callback){callback.attempt(args)})}};ta.off=function(name,f){var v=_eventListeners[name],index;if(v instanceof Array){index=v.indexOf(f);if(index>=0){v.splice(index,1)}}};var OneTimeFunctionQueue=function(evtName){var _queue=[];var _runNow=false;var _execFn=function(fn,name){try{fn()}catch(_ex){try{ta.util.error.record(_ex,"OneTimeFunctionQueue "+evtName+(name?"-"+name:""))}catch(ignore){}}};var _runQueuedFunctions=function(){var startTiming=new Date();var funcTimings={};var anonFuncCounter=1;var recordTiming=ta.has("ta.js_load_tracking")&&evtName=="load";_queue.sort(function(a,b){return(a.priority-b.priority)||(a.subpriority-b.subpriority)});for(var i=0;i<_queue.length;++i){var funcStartTime=new Date();_execFn(_queue[i].func,_queue[i].name);if(recordTiming){var funcEndTime=new Date();var funcName=_queue[i].name;if(!funcName){funcName="Anon "+(anonFuncCounter++)}funcTimings[funcName]=funcEndTime.getTime()-funcStartTime.getTime()}}_queue=[];if(recordTiming){var endTiming=new Date();var totalTime=endTiming.getTime()-startTiming.getTime();ta.util.perf.loadPingback(totalTime,funcTimings)}};if(evtName!=null){window.addEvent(evtName,function(){_runNow=true;_runQueuedFunctions()})}this.addToQueue=function(fn,priority,name){if(!fn){ta.util.error.record(null,"addToQueue for "+evtName+" queue - no function");return}if(typeof priority==="string"){name=priority;priority=false}if(_runNow){_execFn(fn,name)}else{priority=priority||(100+_queue.length);_queue.push({func:fn,priority:priority,name:name,subpriority:_queue.length})}};this.executeQueue=function(){_runQueuedFunctions()}};var _readyQ=new OneTimeFunctionQueue("domready");var _loadQ=new OneTimeFunctionQueue("load");var _lazyImgQ=new OneTimeFunctionQueue(null);ta.queueForReady=function(fn,priority,name){_readyQ.addToQueue(fn,priority,name)};ta.queueForLoad=function(fn,priority,name){if(typeof IS_DEBUG!="undefined"&&IS_DEBUG){var tempName=name;if(typeof priority==="string"){tempName=priority}}_loadQ.addToQueue(fn,priority,name)};ta.queueLazyImg=function(element){var priority;try{priority=element.priority||1000}catch(ignore){return}var _fn=function(){try{if(element.oSRC!==""){element.src=element.oSRC;element.oSRC="";element.priority=""}}catch(e){ta.util.error.record(e,"lazy img",null,{src:element.src,oSRC:element.oSRC})}};_lazyImgQ.addToQueue(_fn,priority)};ta.manualProcessLoadQueue=function(){_loadQ.executeQueue()};ta.processLazyImages=function(){_lazyImgQ.executeQueue()};ta.fn=function(fn){switch(typeof(fn)){case"function":return fn;case"string":var f=false;try{f=eval(fn)}catch(e){}if(!f){var ns=fn.split("."),n=ns.pop();try{ns=eval(ns.join("."));f=ns&&ns._magic&&ns._magic.partial(n)}catch(e){}}if(f&&typeof(f)==="function"){return f}break}return null}}(ta));(function(C,e,k){e=C.ta=C.ta||{};e.analytics||(e.analytics={});var H=8;var c="impressionTrackingTree";var f=0,g=1,p=2;var j=[];var B=30;var E=function(Q){return typeof Q==="function"};var x=function(){var R=["MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],T;if(C.XMLHttpRequest){T=new XMLHttpRequest()}else{for(var Q=0;Q<R.length;Q++){try{T=new ActiveXObject(R[Q]);break}catch(S){}}}return T};var n=function(Q,R){try{if(!Q||typeof R!=="object"){return}if(C.JSON&&JSON.stringify){var S=JSON.stringify(R);if(S&&S.length<100000){j.push([Q,S]);if(j.length>B){j.shift()}}}}catch(T){}};var t=function(V,R,W){if(!V||typeof R!=="object"){A(new Error("postUrl/dataObj is null/empty/undefined"),"TA.Record _simpleAjaxPost",null,arguments);if(W){W()}return}var S;if(typeof Request!=="undefined"){S={url:V,method:"post",data:R};if(W){S.onComplete=W;S.timeout=3000}var T=new Request(S).send();n(V,R);return T}else{if(typeof Zepto!=="undefined"&&Zepto&&E(Zepto.ajax)){S={type:"POST",url:V,data:R,error:function(Y,X){A(new Error("XHR error, errorType = "+X),"TA.Record _simpleAjaxPost",null,arguments)}};if(W){S.complete=W;S.timeout=3000}Zepto.ajax(S)}else{if(typeof jQuery=="function"){S={url:V,type:"POST",data:R};if(W){S.complete=W;S.timeout=3000}jQuery.ajax(S)}else{var Q=x(),U=h(R);Q.open("POST",V,false);Q.setRequestHeader("Content-type","application/x-www-form-urlencoded");Q.setRequestHeader("Content-length",U.length);Q.send(U)}}}n(V,R)};var A=function(){if(e&&e.util&&e.util.error&&e.util.error.record){e.util.error.record.apply(this,arguments)}else{if(e&&e.m&&E(e.m.recordJSError)){e.m.recordJSError(arguments)}}};var a=function(){return typeof _gaq!="undefined"&&_gaq.push};var y=function(Q){if(Q===k||Q==null){return""}if(typeof Q!=="string"){Q=Q.toString()}return Q.replace(/!/g,"!!").replace(/\./g,"!.").replace(/\*/g,"!*")};var P=function(T){var Q=[];for(var R in T){var S=T[R];Q.push(y(R)+"."+y(S))}return Q.join("*")};var r=function(Q){var R=/(https?:\/\/[^\/]+)?\/([^#.?-]*)/;var S=R.exec(Q);if(S){if(typeof S[2]!="undefined"){return(S[2])?S[2]:"Home"}}return null};var M=function(){var Q=e.analytics.pageData&&e.analytics.pageData.length&&e.analytics.pageData[e.analytics.pageData.length-1];if(Q&&Q.url){return Q.url.substring(1)}else{var R=/\/([^-]*)/.exec(C.location.pathname);return R?R[1]:null}};var N=function(S,Q,T){var R=new RegExp("(-"+Q+"([0-9]+))|([?&]"+T+"=([0-9]+))");var U=R.exec(S);if(U){if(typeof U[2]!="undefined"){return U[2]}if(typeof U[4]!="undefined"){return U[4]}}return null};var G=function(Q){return N(Q,"d","detail")||N(Q,"g","geo")};var s=function(T,U,R){try{var Q;if(R.encode){U=encodeURIComponent(U)}if(R.domain){U+="; domain="+R.domain}if(R.path){U+="; path="+R.path}if(R.duration){Q=new Date();Q.setTime(Q.getTime()+R.duration*1000);U+="; expires="+Q.toGMTString()}if(R.secure){U+="; secure"}document.cookie=T+"="+U}catch(S){A(S,"_setCookieInSeconds",null,arguments)}};var O=function(){if(e.m&&e.m.store&&e.m.store.has("bookingSessionId")){return e.m.store.get("bookingSessionId")}return null};var z=function(){var Q=false;if(typeof e.userLoggedIn==="boolean"){if(typeof e.userSecurelyLoggedIn==="boolean"){Q=e.userLoggedIn?(e.userSecurelyLoggedIn?p:g):f}else{Q=e.userLoggedIn}}return Q};var K=function(T,R){var Q={gac:T[1],gaa:T[2],gal:T[3],gav:T[4],gani:T[5],gass:M(),gasl:G(document.location.href),gads:r(R),gadl:G(R),gapu:e.uid,gams:z()},S=O();if(!Q.gass){throw new Error("Src servlet undefined, gac:"+Q.gac+", gaa:"+Q.gaa+", gal:"+Q.gal)}if(!Q.gads){throw new Error("Dst servlet undefined. gac:"+Q.gac+", gaa:"+Q.gaa+", gal:"+Q.gal)}if(e.has&&e.has("gatt")){Q.gatt=e.retrieve("gatt")}if(S){Q.bsid=S}s("EVT",P(Q),{domain:cookieDomain,duration:5,encode:true})};var L=function(T){if(!T||!T.className||!T.firstChild){return false}var S=new RegExp("\\b"+c+"\\b"),Q=T.firstChild.nodeType,R=T.firstChild.nodeValue;return S.test(T.className)&&Q===H&&R!==""};e.analytics._GARecordRequest=function(W,T){var S={gac:W[1],gaa:W[2],gal:W[3],gav:W[4],gani:W[5],gass:M(),gasl:G(document.location.href),gapu:e.uid,gams:z()},U=O(),Q,V=e.retrieve&&e.retrieve("garecord.async")?true:false;if(T){S.gacl=T}if(e.has&&e.has("gatt")){S.gatt=e.retrieve("gatt")}if(U){S.bsid=U}if(typeof Request!="undefined"){Q=new Request({url:"/GARecord",data:S})}else{var R=new XMLHttpRequest();R.open("GET","/GARecord?"+h(S),V);Q={get:function(){R.send(null)}}}n("/GARecord",S);return Q};var h=function(R){var S=[];for(var Q in R){S.push(encodeURIComponent(Q)+"="+encodeURIComponent(R[Q]))}return S.join("&")};e.urlArgLookup=function(T,Q){var S=new RegExp("[\\?&]"+T+"=(\\w+)");var R=S.exec(Q);if(R&&typeof R[1]!==k){return R[1]}return null};e.analytics._JSON_parse=function(Q){if(JSON.parse){return JSON.parse(Q)}if(JSON.decode){return JSON.decode(Q)}throw new Error("No JSON.parse or JSON.decode")};e.analytics._insertGAScriptElement=function(){try{var W=document.createElement("script");W.type="text/javascript";W.async=true;W.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var U=document.getElementsByTagName("script");var T=U[0];var S=false;for(var R=0;R<U.length;R++){if(U[R].src){S=U[R];break}}var Q=S||T;Q.parentNode.insertBefore(W,Q)}catch(V){A(V,"loading ga.js problem")}};e.analytics._validatedTrackEventArray=function(S,U,Q,T,R){if(S&&typeof S!="string"){S=S.toString()}if(U&&typeof U!="string"){U=U.toString()}if(Q&&typeof Q!="string"){Q=Q.toString()}if(!T){T=0}else{if(typeof T!="number"){T=parseFloat(T);if(isNaN(T)){T=0}}}if(typeof R!="boolean"){R=(R===true)}return["_trackEvent",S,U,Q,T,R]};e.analytics._toEvtParams=function(S){try{if(a()){var Q={gac:S.module,gaa:S.action,gal:S.context,gav:S.value,gani:S.noninteraction};Q.gass=M();Q.gasl=G(document.location.href);Q.gapu=e.uid;Q.gams=z();return Q}}catch(R){A(R,"ta.analytics._toEvtParams",null,S)}};e.analytics._trackEventAfterAjax=function(S){try{if(a()){var Q=e.analytics._validatedTrackEventArray(S.module,S.action,S.context,S.value,S.noninteraction);_gaq.push(Q);e.trackDMPBehavior(S.module,S.action,S.context,S.value,S.noninteraction)}}catch(R){A(R,"ta.analytics._trackEventAfterAjax",null,S)}};e.getEventPathOptions=function(V,S,R){try{var U=u(R,V);if(!U){A(null,"ta.getEventPathOptions - invalid element",null,arguments);return}var Q=F(U);if(S){Q.noninteraction=S}return Q}catch(T){A(T,"ta.getEventPathOptions",null,arguments)}};e.analytics._trackEventPathAfterAjax=function(Q){try{e.trackEventOnPage(Q.category,Q.action,Q.label,Q.value,Q.noninteraction)}catch(R){A(R,"ta.analytics._trackEventPathAfterAjax",null,arguments)}};e.trackPhysicalCommerce=function(S,R,V,Q){try{if(a()){var T=e.analytics._validatedTrackEventArray(S,"Commerce-Physical",R,V,false);_gaq.push(T);e.analytics._GARecordRequest(T,Q).get()}}catch(U){A(U,"ta.trackPhysicalCommerce",null,arguments)}};e.trackAttemptedCommerce=function(R,Q,T,U){try{if(a()){_gaq.push(["_setCustomVar",15,"Provider",T],e.analytics._validatedTrackEventArray(R,"Commerce-Attempted",Q,U,false),["_deleteCustomVar",15]);e.trackDMPBehavior(R,Q,T,null,null)}}catch(S){A(S,"ta.trackAttemptedCommerce",null,arguments)}};e.trackPhysicalAndAttemptedCommerce=function(S,R,T,U,Q){e.trackPhysicalCommerce(S,R,U,Q);e.trackAttemptedCommerce(S,R,T,U)};e.trackEventOnPage=function(R,V,Q,U,T){try{if(a()){var S=e.analytics._validatedTrackEventArray(R,V,Q,U,T);_gaq.push(S);e.analytics._GARecordRequest(S).get();e.trackDMPBehavior(R,V,Q,U,T)}}catch(W){A(W,"ta.trackEventOnPage",null,arguments)}};e.trackEventOnPageOnce=function(T,V,S){var Q="eventsAlreadyTracked";var U=e.retrieve(Q);if(!U){U={};e.store(Q,U)}var R=T+"|"+V+"|"+S;if(!U[R]){e.trackEventOnPage(T,V,S,0,false);U[R]=true}};e.trackDMPBehavior=function(R,U,Q,T,S){try{if(e.common&&e.common.dmp&&e.common.dmp.isEnabled()){e.common.dmp.sendGABehavior(R,U,Q,T,S)}}catch(V){A(V,"Error adding and sending GARecord behavior to DMP")}};e.setEvtCookie=function(S,V,R,U,Q){try{if(a()){var T=e.analytics._validatedTrackEventArray(S,V,R,U,false);K(T,Q)}if(e.common&&e.common.dmp&&e.common.dmp.isEnabled()){e.common.dmp.sendEventBehavior(S,V,R,U,J())}}catch(W){A(W,"ta.setEvtCookie",null,arguments)}};var m="trk";var b=m.length;var I="etk";var q=/^([A-Z]{1,2}:)?[A-Za-z_0-9\-\.]+$/;var J=function(){var Q=(typeof event!="undefined")?event:C.event;if(Q){return Q.target||Q.srcElement}return document.activeElement};e.analytics.getCommentTrackingPath=function(Q,R){return u(Q,R)};var u=function(W,Y){if(!W){W=J();if(!W){A(null,"_getCommentTrackingPath - no element provided or event target element",null,arguments);return null}}if(W.nodeType!=1){return null}var ab=[];if(Y&&typeof Y=="string"&&Y!==""){if(q.test(Y)){if(Y.substring(0,2)=="P:"){ab.push(Y.substring(2));return ab}else{ab.push(Y)}}}if(typeof W.previousSibling==="undefined"){A(null,"_getCommentTrackingPath - browser does not support previousSibling",null,arguments);return ab}LOOP_PARENT_NODES:for(var T=W;T!=document.body;T=T.parentNode){if(T==null){A(null,"_getCommentTrackingPath - LOOP_PARENT_NODES got unexpected null node",null,arguments);break}var Z=0;for(var Q=T.previousSibling;Q!=null;Q=Q.previousSibling){if(Q.nodeType==H){var S=Q.nodeValue;if(S==I){Z++;continue}if(S.substring(0,b)!=m){continue}if(Z>0){Z--;continue}var V=S.substring(b).split("/");if(!V){A(null,'ta._getCommentTrackingPath - cannot split context class: "'+S+'"',null,arguments)}for(var aa=V.length-1;aa>=0;aa--){var R=V[aa];var X=q.exec(R);if(!X){A(null,'ta._getCommentTrackingPath - tracking prefix used with invalid context: "'+V[aa]+'"',null,arguments);continue}if(X[1]=="P:"){var U=X[0].substring(2);ab.push(U);break LOOP_PARENT_NODES}else{ab.push(X[0])}}}}}return ab};var F=function(S){if(S.length===0){return null}var Q={action:S[0],label:"",value:"1",category:S[S.length-1]};S.shift();for(var R=S.length-2;R>=0;R--){Q.label+=S[R];if(R>0){Q.label+="/"}if(S[R].substring(0,2)=="N:"){Q.value=S[R].substring(2)}}if(Q.label===""){Q.label="Unknown"}return Q};e.trk=function(X,T,S,U){try{var W=u(S,X);if(!W){A(null,"ta.trk - invalid element for "+X,null,arguments);return}if(U&&U.length>0&&W.length&&W.splice){for(var R=U.length-1;R>=0;R--){if(typeof(U[R])==="string"){W.splice(1,0,U[R])}}}var Q=F(W);e.trackEventOnPage(Q.category,Q.action,Q.label,Q.value,T)}catch(V){A(V,"ta.trk",null,arguments)}};e.trkImpTree=function(R,T){try{if(!L(R)){A(null,"ta.trkImpTree called with invalid trackTreeElem!",null,arguments);if(T){T()}return}var Q=R.firstChild.nodeValue;o(Q,T)}catch(S){A(S,"ta.trkImpTree",null,arguments);if(T){T()}}};e.recordImpression=function(Q,S){if(!Q){if(S){S()}return}try{o(D(Q),S)}catch(R){A(R,"ta.recordImpression",null,arguments);if(S){S()}}};var w="<!--";var v="-->";var D=function(Q){var R=Q.indexOf(w),S=0,T=Q.indexOf(v);if(R!==-1){S=R+w.length}if(T===-1){T=Q.length}return Q.substring(S,T)};e.analytics.stripCommentsFromTree=D;var l="\\";var d="/";e.analytics.appendAscendTokens=function(R){var T=0,S=0,Q=0;for(T=0;T<R.length;T++){if(R[T]===d){Q++}else{if(R[T]===l){S=T+1;while(S<R.length&&R[S]===l){Q--;T=S;S++}}}}if(Q>0){for(T=0;T<Q;T++){R+=l}}return R};var o=function(Q,S){var R={tTreeStr:Q,tTreeUid:e.uid,tTreeLastReferrer:C.location.href,tTreeIsMemberSignedIn:z()};if(e.m&&e.m.store&&e.m.store.has("bookingSessionId")){R.bsid=e.m.store.get("bookingSessionId")}t("/ImpressionRecord",R,S)};e.setEvtCookieAndPath=function(V,Q,S){try{if(!S){S=J()}var U=u(S,V);if(!U){A(null,"ta.setEvtCookieAndPath - invalid element for "+V,null,arguments);return}var R=F(U);if(!Q){while(S.nodeName!="A"){if(S==document.body){break}S=S.parentNode}Q=S.href;if(!Q){A(null,"ta.setEvtCookieAndPath - no url parameter and cannot find a.href",null,arguments);return}}e.setEvtCookie(R.category,R.action,R.label,R.value,Q)}catch(T){A(T,"ta.setEvtCookieAndPath",null,arguments)}};e.recordPageview=function(R,U){if(!R){return}var Q=r(R),T="/PageviewRecord",S=U?U:{};if(Q){S.servletName=Q;t(T,S)}};e.recordGAPageview=function(R){if(!R){return}var S=C._gaq,Q=r(R);if(Q&&typeof S!=="undefined"){Q="/"+Q;S.push(["_set","page",Q]);S.push(["_trackPageview"])}};e.resetPageDataUrl=function(){var Q;if(e&&e.analytics&&e.analytics.pageData){Q=e.analytics.pageData&&e.analytics.pageData.length&&e.analytics.pageData[e.analytics.pageData.length-1];if(Q){Q.url=""}}};e.getRecentTARecords=function(){return j}})(window,ta);(function(){var f=[];var a=3000;function b(l,n){var g=f.length;f.push({name:l,properties:[]});for(var m in n){var h=true;if(g>0){for(var j=0;h&&j<g;j++){if(f[j].properties.indexOf(m)!=-1){h=false}}}if(h){f[g].properties.push(m)}}}b("node",document.createTextNode(""));b("Element",Element.prototype);f[1].properties.push("uid");b("element",document.createElement("div"));b("input",document.createElement("input"));f[3].properties.push("autocomplete");var e={element:"E",number:"N","function":"F",string:"S","boolean":"B",object:"O",collection:"C",whitespace:"W"};function d(h){var g=typeOf(h);return null==h?"_":(e[g]?e[g]:(g=="null"?"!":g))}ta.util.error={types:f,override:false,errorCount:0,record:function(z,h,t,v,o){if(ta.has("ta.error.record.inFlight")||ta.util.error.errorCount>9){return}ta.util.error.errorCount++;ta.store("ta.error.record.inFlight",true);var q=false;try{q=document.getElement("body").hasClass("js_logging")}catch(C){}if(!q){return}var F=true;if(v&&v.hasOwnProperty("error_script")&&!ta.util.error.isInternalScript(v.error_script)&&!ta.util.error.isScriptInline(v.error_script)){F=false}var n={};var E=false;try{if(t||window.event){t=new Event(t||window.event);E=ta.id(t.target);n.eTarg=this.getSelectorString(E)}}catch(s){}if(typeof(debugCacheKey)!="undefined"){n.key=debugCacheKey}var g=window.pageServlet;if(!g){g="unknown"}n.servlet=g;if(!o||typeof o!="string"){o="ERROR"}if(!F){o="WARN";n.warnReason="externalError"}else{if(!IS_DEBUG&&ta.util.error.errorCount>1){o="WARN";n.warnReason="notFirstJSError"}}var I={extraInfoError:"Problem storing extra info"};var H="";var m={};try{var k="";try{k=window.navigator.userAgent}catch(u){}var l="";var j="";if(E){l=E.id;j=E.className}var x=false;try{x=doCookieCheck()}catch(C){}var A="";if(typeof serverPool!="undefined"&&serverPool){A=serverPool}var w="";if(window.MooTools){w+="MooTools "}if(window.jQuery){w+="jQuery ";o="WARN";n.warnReason="jquery"}m={TARGET_ID:l,TARGET_CLASS:j,PAGE_UID:ta.uid,INTERNAL_JS:ta.util.error.getScriptSrcs(),CLIENT_POOL:A,COOKIES_ENABLED:x,JS_LIBS:w};if(!F){m.INTERNAL_ERROR="false"}if(ta.util.error.errorCount>1){m.PRIOR_JS_PAGE_ERRORS=ta.util.error.errorCount-1}}catch(B){v=I}n.xInfo=ta.util.error._getExtraInfoString(m,v);try{n.eUrl=window.location.href}catch(s){}var p="No Error";try{if(z){if(Object.prototype.toString.call(z)===Object.prototype.toString.call(new Error)){p=z.name+"-"+z.message}else{if(typeof z==="object"){p="non-Error object "+Object.prototype.toString.call(z)+" passed, sample properties - ";var G=0;for(prop in z){if(z.hasOwnProperty(prop)){p+=prop.substring(0,30)+": "+(z[prop]&&z[prop].toString?z[prop].toString().substring(0,20):z[prop])+", ";if(++G>4){break}}}}else{p="non-Object error passed: "+(""+z).substring(0,30)}}p=p.replace(/[\r\n]/g,"")}}catch(s){}n.eMsg=p;var y="";try{y=ta.util.error.getErrorBlock(h).substring(0,150);n.eBlk=y}catch(s){}try{if(y.indexOf("window.onerror")!=0){var D=ta.util.error.getErrorStack(z);if(D){n.eStak=D}}}catch(s){}try{if(ta.widgets&&ta.widgets.calendar){n.eDates=ta.widgets.calendar.getErrorDates()}}catch(s){}try{if(ta.has("abMarkerSet")){n.xABSet=ta.retrieve("abMarkerSet")+""}}catch(s){}n.eLogLevel=o;try{new Request({url:"/JSErrorRecord",data:n}).send()}catch(C){n={eBlk:"JSErrorRecord Error",servlet:g,eLogLevel:"ERROR",eMsg:"no error retrieved"};new Request({url:"/JSErrorRecord",data:n}).send()}if(IS_DEBUG){(window.ERRORS||(window.ERRORS=[])).push(n)}if(ta.util.error.override){if(ta.util.error.override.match(/alert/)){ta.util.error.alert(n)}if(ta.util.error.override.match(/console/)&&console){ta.util.error.console(n)}}ta.remove("ta.error.record.inFlight");if(IS_DEBUG&&z&&o==="ERROR"&&false){throw z}if(IS_DEBUG){var r=ta.util.error._buildToolbarElement(p,h,o);if(ta.has("debug.toolbar.loaded")){ta.util.error.addErrorInJSToolbar(r)}else{ta.util.error._jsToolbarErrorsToAdd.push(r)}}},_jsToolbarErrorsToAdd:[],_buildToolbarElement:function(j,h,g){var k="<td class='"+g+"'>"+g+"</td><td><b>Error Block</b>:: "+h+", <b>Error Message</b>:: "+j+"</td>";return new Element("tr",{html:k})},addErrorInJSToolbar:function(j){var g=document.getElement("#DEBUG_JS_ERROR_DETAILS tbody"),h=document.getElement(".perfButtonWrap .jsErrors");if(!j){return}if(g){j.inject(g)}if(j.innerHTML&&j.innerHTML.indexOf("ERROR")>-1){h.addClass("ERROR")}else{h.addClass("WARN")}},_getExtraInfoString:function(q,g){var m="_extraInfoError_:Problem storing extra info.";var o={};var r="";try{var p=typeOf(g);var j={};if(p==="array"||p==="arguments"){for(var l=0;l<g.length;l++){var h=g[l];var n=typeof h;if(n==="string"||n==="number"||n==="boolean"){j[l]=h}else{j[l]=typeof h}}g=j}o=Object.merge(q,g);r=JSON.encode(o);if(r){if(r.length>a){r=r.substring(0,a)}return r.replace(/[\r\n]/g,"")}}catch(k){}try{o=q;r=JSON.encode(o);if(r){if(r.length>a){r=r.substring(0,a)}return r.replace(/[\r\n]/g,"")}}catch(k){}return m},getErrorBlock:function(g){if(typeof g!="undefined"&&g!==null){return g.toString().replace(/[\r\n]/g,"")}return"null or undefined"},getErrorStack:function(n){var o="";try{if(arguments&&arguments.callee&&!Browser.chrome){var q=[];var h=arguments.callee.caller;h=h.caller;var l=0;while(h&&l++<20){var j=h.toString();if(j.match(/onErrorFunc/)){h=h.caller;continue}var g=j.length;var k=g>100?100:g;var r=j.substring(0,k);r=r.replace(/(\n|\r|\'|\")/g,"");r+="::";q.push(r);h=h.caller}return q.join(" ")}}catch(m){o="-arguments.callee issue"}if(n&&n.stack){var p=n.stack.split("\n");p=p.map(function(t){var s=t.lastIndexOf("/");if(s>0){t=t.substr(s+1)}return t});return p.join()}return"none"+o},getSelectorString:function(h){if(!h){return""}var g=[h];while(typeof h!="undefined"&&h&&typeof h.parentNode!="undefined"){g.push(h=h.parentNode)}g=g.map(function(k){if(k&&k.tagName){var j=k.tagName;if(k.id){j+="#"+k.id}if(k.className){j+="."+k.className}return j}return""});g=g.reverse().join(">");g=g.replace(/\s+/g,".");return g},ajaxFailure:function(j,h,g){ta.util.error.record(null,j,null,Object.merge({status:h.status},g))},alert:function(g){var h="";Object.each(g,function(l,j){h=h+j+": "+l+"\n"});window.alert(h)},console:function(g){if(console){console.error(g)}},getScriptSrcs:function(){var g="";Array.each(document.getElementsByTagName("script"),function(l,h){if(!l){return}var k=l.src;if(ta.util.error.isInternalScript(k)){var j="";if(g!=""){j=", "}k=k.substring(k.indexOf("/js")+1);g=g+j+k}});if(g.length>a){g=g.substring(0,a)}return g},isInternalScript:function(g){if(!g||!g.indexOf){return false}var h=window.CDNHOST||"";if(window.IS_DEBUG&&h==""){return g.match(/(js3\/|js\/)/)!=null}else{return g.indexOf(h)==0}},isScriptInline:function(h){if(!h||!h.indexOf){return false}var g="noPage";try{g=window.location.href}catch(j){}if(h===g){return true}return false},describe:function(h){if(null==h){return"_N"}var k=d(h),j=[],m,n;for(var l in h){m=false;for(var g=0;!m&&g<f.length;g++){if(f[g].properties.indexOf(l)!=-1){m=true;if(j.indexOf(f[g].name)==-1){j.push(f[g].name)}}}if(!m){k+=","+l+":"+d(h[l])}}if(j.length>0){k+=","+j.join(",")}return k}};var c=Cookie.read("JS_ERROR_HANDLING");if(c){ta.util.error.override=c}})();window.ta||(window.ta={});(function(){var p=false,e="taLsTest",d="1",k="TALocalStorageCurrentSessionId",g=false,h="session-",f=false;var n=function(t){if(!g&&!f){ta.util&&ta.util.error&&ta.util.error.record(null,"Accessing localStorage session cookie before session logic intialized: "+t);return false}return true};var j=function(t){var u;try{u=p.getItem(t)}catch(v){}return u};var r=function(t){try{p.removeItem(t)}catch(u){}};var s=function(t){try{var v=p.getItem(t);if(v!==null&&v!==undefined){return true}}catch(u){}return false};var a=function(t,u){try{p.setItem(t,u)}catch(v){}};var l=function(t){f=true;if(!t){ta.util&&ta.util.error&&ta.util.error.record(null,"Attempting to initialize localStorage with invalid sesion key: "+t);return false}if(!ta.localStorage.enabled){return false}g=j(k);if(!g||g!=t){g=t;a(k,g);b();if(s(k)){ta.store&&ta.store("isFirstSessionPageView",true)}}};var b=function(){try{var v=h+g;var t=new RegExp("^"+h);if(p.keys&&p.length){for(var u=0;u<p.length;u++){var x=p.keys[u];try{if(t.test(x)&&x!=v){r(x)}}catch(w){}}}}catch(y){}};var o=function(){var u=false;try{if(p&&p.setItem){p.setItem(e,d);u=p.getItem(e)!=d;p.removeItem(e);if(u){p=false}return !!p}}catch(t){}return false};var c=function(t){try{p.setItem("session-"+g,JSON.stringify(t))}catch(u){}};var m=function(){try{var t=p.getItem("session-"+g);if(t){return JSON.parse(t)}}catch(u){}return{}};var q={enabled:o(),get:j,set:a,remove:r,has:s,updateSessionId:l,getSessionKey:function(u){if(!n(u)){return null}var t=m();if(t){return t[u]}return null},setSessionKey:function(u,v){if(!n(u)){return}var t=m();if(!t){t={}}t[u]=v;c(t)},removeSessionKey:function(u){if(!n(u)){return}var t=m();if(!t){return}delete t[u];c(t)},hasSessionKey:function(u){if(!n(u)){return false}var t=m();if(t){var v=t[u];if(v!==null&&v!==undefined){return true}}return false},setStorage:function(t){p=t;this.enabled=o()}};window.ta.localStorage=q}());(function(){var b=false;try{b=window.localStorage}catch(a){}b||(b={});ta.localStorage.setStorage(b)}());(function(){ta=window.ta=window.ta||{};var b=ta.prerender||(ta.prerender={});b.states={PREFETCH_SENT:"prefetchSent",CLEAR:"clear"};var a=function(f){if(ta&&ta.util&&ta.util.error&&ta.util.error.record){ta.util.error.record(f)}};var e=function(j,l,g,k,h){if(ta.analytics&&ta.analytics._validatedTrackEventArray&&ta.analytics._GARecordRequest){var f=ta.analytics._validatedTrackEventArray(j,l,g,k,h);ta.analytics._GARecordRequest(f).get();return true}return false};var d=function(){if("visibilityState" in document){b._visibilityState="visibilityState";b._visibilitystatechanged="visibilitychange";return}var g=["webkit","moz","ms","o"];for(var f=0;f<g.length;f++){if((g[f]+"VisibilityState") in document){b._visibilityState=g[f]+"VisibilityState";b._visibilitystatechanged=g[f]+"visibilitychange"}}};var c=function(){try{if(b._state===b.states.PREFETCH_SENT&&document[b._visibilityState]!=="prerender"){e("Prerender","shown","",0,true);b._state=b.states.CLEAR}}catch(f){a(f)}};b._init=function(f){try{b._enabled=f;b._state=b.states.CLEAR;d();if(!b.isSupported()||!b.isEnabled()){return}if(document[b._visibilityState]==="prerender"){if(e("Prerender","prefetch","",0,true)){b._state=b.states.PREFETCH_SENT;document.addEventListener(b._visibilitystatechanged,c,false)}}}catch(g){a(g)}};b.isEnabled=function(){return b._enabled};b.isSupported=function(){return b._visibilityState!==undefined}})();(function(){if(typeof performancePingbackInit=="undefined"||performancePingbackInit.initialized){return}performancePingbackInit.initialized=true;ta.queueForReady(function(){if(typeof performancePingbackInit!="undefined"){performancePingbackInit.domready=new Date().getTime()}},0,"perf.recordReady");ta.queueForLoad(function(){if(typeof performancePingbackInit!="undefined"){performancePingbackInit.load=new Date().getTime();setTimeout(function(){a()},0)}},10000000,"perf.recordLoad");function b(){var c=performancePingbackInit.domready-performancePingbackInit.start;var d=performancePingbackInit.load-performancePingbackInit.start;var g="/PerformancePingback?ppuid="+performancePingbackInit.uid+"&load="+d+"&domready="+c+"&servlet="+performancePingbackInit.servlet;if(performancePingbackInit.behaviorEnd&&performancePingbackInit.behaviorStart){var f=performancePingbackInit.behaviorEnd-performancePingbackInit.behaviorStart;g+="&behavior="+f}if(window.performance&&window.performance.timing){for(var e in window.performance.timing){var h=window.performance.timing[e];if(typeof h==="number"){g+="&"+e+"="+h}}}g+="&coldcache="+(!performancePingbackInit.isTaReferrer);new Request({url:g}).send()}function a(){if(typeof performancePingbackInit!="undefined"&&performancePingbackInit.enabled&&performancePingbackInit.domready&&performancePingbackInit.load){if(!("readyState" in document)||!("onreadystatechange" in document)||!("addListener" in document)){b();return}if(document.readyState==="complete"){setTimeout(function(){b()},0)}else{document.addListener("readystatechange",function(){if(document.readyState==="complete"){setTimeout(function(){b()},0)}})}}}})();(function(){ta.util.perf={loadPingback:function(c,d){try{var a={};var f="";var b=false;f+="[[";Object.each(d,function(h,e){if(b){f+=","}f+=e+":"+h;b=true});f+="]]";a.functionTimes=f;a.totalTime=c;if(ta.has("abMarkerSet")){a.xABSet=ta.retrieve("abMarkerSet")+""}if(ta.uid){a.uid=ta.uid+""}a.errorsOnLoad=ta.has("ta.onload.errors");a.servlet=window.pageServlet;new Request({url:"/LoadRecord",data:a}).send()}catch(g){ta.util.error.record(g,"ta.util.perf.loadPingback",false,{totalLoadTime:c,funcTimes:d})}}}})();(function(a){Object.append(a,{isHotelsRedesign2011:function(){if(ta.has("hac.isHotelsRedesign2011")){return ta.retrieve("hac.isHotelsRedesign2011")}if(window.pageServlet=="LastMinute"){ta.store("hac.isHotelsRedesign2011",true);return true}var c=ta.id("HAC_SMRY");var b=c&&c.hasClass("hotels_re_2011");ta.store("hac.isHotelsRedesign2011",b);return b},isSmartDealsFilters:function(){if(ta.has("smartdeals.isSmartDealsFilters")){return ta.retrieve("smartdeals.isSmartDealsFilters")}var b=ta.id("DEALS");var c=b&&b.hasClass("sdfilters");ta.store("smartdeals.isSmartDealsFilters",c);return c},isDHTMLCRRedesign2012:function(){if(ta.has("overlays.isDHTMLCRRedesignBasic")){return ta.retrieve("overlays.isDHTMLCRRedesignBasic")}var b=$$(".overlay");var c=b&&b.hasClass("rgba_flyout");ta.store("overlays.isDHTMLCRRedesignBasic",c);return c},isRestaurantsRedesign2012:function(){if(ta.has("eateries.isRestaurants")){return ta.retrieve("eateries.isRestaurants")}var c=ta.id("EATERIES_2012");var b=c&&c.hasClass("gridA");ta.store("eateries.isRestaurants",b);return b},isAttractionsRedesign2012:function(){if(ta.has("attractions.isAttractions")){return ta.retrieve("attractions.isAttractions")}var b=ta.id("ATTRACTIONS_2012");var c=b&&b.hasClass("gridA");ta.store("attractions.isAttractions",c);return c},isMetaHomepageIntegration2013:function(){if(ta.has("home.isMetaHomepageIntegration2013")){return ta.retrieve("home.isMetaHomepageIntegration2013")}var c=ta.id("PPT");var b=c&&c.hasClass("ppt_container");ta.store("home.isMetaHomepageIntegration2013",b);return b},isMetaHotels2013:function(){if(ta.has("hotelsMeta.isMetaHotels2013")){return ta.retrieve("hotelsMeta.isMetaHotels2013")}var c=ta.id("PAGE");var b=c&&c.hasClass("meta_hotels");ta.store("hotelsMeta.isMetaHotels2013",b);return b},isMetaHotel2013:function(){if(ta.has("hotel.meta2013")){return ta.retrieve("hotel.meta2013")}var d=ta.id("MAIN"),c=d&&(d.hasClass("Hotel_Review")||d.hasClass("ShowUserReviews")||d.hasClass("Hotels")||d.hasClass("HACSearch"));ta.store("hotel.meta2013",c);return c},isFlights2013:function(){return $$(".new_lander").length>0},isMetaHotelsRequest:function(){return ta.has("isMetaHotelsRequest")},isHacMap:function(){return ta.has("hac.maps.isHacMap")},isFall2013MastheadRefresh:function(){return ta.has("fall_2013_masthead_refresh")},isHRTabs2014:function(){return ta.has("hr_tabs_2014")},isTabletAlbumViewer:function(){return ta.retrieve("tabletAlbumPhotoLightbox.enabled")},isTabletAlbumViewerCTA:function(){return ta.retrieve("tabletAlbumPhotoLightboxCTA.enabled")},isTabletRotationCTATest:function(){return ta.retrieve("tabletRotationCTATest.enabled")},isWarUsabilityTest:function(){return document.body.hasClass("war_usability")}})})(ta);(function(a,c,b,d){b.browser=(function(g){var f=function(){return navigator.userAgent.contains("MSIE 10.0")},h=function(){return g.retrieve("ta.isIE11orHigher")},e=function(){var o=g.retrieve("metaCheckRatesDebugFeatureEnabled"),k=null,l=h(),m=l?127:0,j=(c.innerWidth==screen.width&&((screen.height-c.innerHeight)===m));if(o){return true}try{k=!!new ActiveXObject("htmlfile")}catch(n){k=false}return !k&&j&&(l||f())};return{isIE9orHigher:function(){if(h()||(Browser.ie&&Browser.version>=9)){return true}return false},isIE10Metro:function(){return f()&&e()},isIEMetro:function(){return e()}}}(b))}(document,window,ta));(function(a,f,b,h){var g="screenSizeRecord";function c(){var m=a.documentElement,k=a.body,l=f.innerWidth||m.clientWidth||k.clientWidth,j=f.innerHeight||m.clientHeight||k.clientHeight,o=screen.width,n=screen.height;return"s"+o+"x"+n+"b"+l+"x"+j}function e(l){var j=c(),k=b.localStorage.getSessionKey(g);if(j!==k){b.localStorage.setSessionKey(g,j);b.trackEventOnPage("screenSizeRecord",l,j)}}function d(){if(!b.retrieve("screenSizeRecord")||!b.localStorage.enabled){return}e("load");var j;f.addEvent("resize",function(){if(j){clearTimeout(j)}j=setTimeout(function(){e("resize")},250)})}b.queueForLoad(d,"ScreenSizeRecord.onLoad")})(document,window,ta);ta.reviews.DELAYED_INJECT_LIST="reviews.delayed_inj";ta.reviews.NONNATIVE_INJECT_LIST="reviews.nonnative_inj";function initInjektReviewsContent(){var b={};ta.store(ta.reviews.NONNATIVE_INJECT_LIST,b);var a={};ta.store(ta.reviews.DELAYED_INJECT_LIST,a)}function injShowReview(d,b){if(!ta.has(ta.reviews.NONNATIVE_INJECT_LIST)){callAjaxFunByType(d,b);return}var c=ta.retrieve(ta.reviews.NONNATIVE_INJECT_LIST);if(c.hasOwnProperty(b)){var a=c[b]+":"+d;c[b]=a}else{c[b]=d}}function injShowReviewBlock(g,b,h,c,f){if(!ta.has(ta.reviews.NONNATIVE_INJECT_LIST)){showReviewBlock(g,b,h,c,f);return}var d=ta.retrieve(ta.reviews.NONNATIVE_INJECT_LIST);var e=b+":"+h+":"+c;if(d.hasOwnProperty(e)){var a=d[e]+":"+g;d[e]=a}else{d[e]=g}}function injektReviewsContent(){if(!ta.has(ta.reviews.NONNATIVE_INJECT_LIST)){return}var b=false;var c=ta.retrieve(ta.reviews.NONNATIVE_INJECT_LIST);for(var a in c){callAjaxFunByType(c[a],a);b=true}if(!b){postInjektCall()}ta.remove(ta.reviews.NONNATIVE_INJECT_LIST)}function postInjektCall(){if(!ta.has("reviews.ajax.post")){return}var a;var b=ta.remove("reviews.ajax.post");for(a=0;a<b.length;a++){b[a]()}}function callBeforePIC(a){var b=function(){var c=a.apply(this,arguments);postInjektCall();return c};return b}function callAjaxFunByType(c,a){if(null==a){ta.util.error.ajaxFailure.partial("reviews:callAjaxFunByType - null stype");return}var b=a.split(":");if(b.length==3){return showReviewBlock(c,b[0],b[1],b[2])}if(a=="reviewWithAnswers"||a=="reviewWithAnswersTrans"){_showReviewWithAnswers(c,"16",a)}else{showReview(c,a)}}function fixMTHelpfulUrl2(d,a){var c=ta.id(d);if(null==c){return}var e=c.getElement("input[name=returnTo]");if(e){var b=document.location.href;if(b.indexOf("#")>=0){b=b.substring(0,b.indexOf("#"))}e.value=b+"#mtreview_"+a}}function alignFirstReview(f,c){try{if(f.hasClass("first_aph")){f.removeClass("first_aph")}else{var b=c.getElementsByClassName("inlineReviewUpdate");if(b&&b.length>0){var a=b[0];if(a.hasClass("first")){a.removeClass("first")}}}}catch(d){}}function rpcParseReviewsBlock(b){try{var c=document.createElement("div");c.innerHTML=b;var h=false;for(var f=0;f<c.childNodes.length;f++){var a=c.childNodes[f];if(a==null||a.id==null){continue}var j=a.id;var d=j.split("_");if(d.length==2&&isFinite(d[1])){fixMTHelpfulUrl2(a,d[1])}var l=document.getElementById(a.id);if(l){if(!h){alignFirstReview(l,a);h=true}l.innerHTML=a.innerHTML}else{ta.util.error.ajaxFailure.partial("reviews:rpcParseReviewsBlock - element not found "+a.id)}}}catch(g){ta.util.error.record(g,"rpcParseReviewsBlock")}}function updateResponseText(a,b){if(b&&b!=""){var c=document.getElementById("response_"+a);if(c){c.innerHTML=b}}}function rpcParseReviews(reply){try{var reviews=eval("("+reply+")");if(reviews){var reviewCnt=reviews.length;for(var i=0;i<reviewCnt;++i){var rid=reviews[i].id;var r=ta.id("review_text_"+rid);if(r){r.set("html",reviews[i].body);var reviewTitle=ta.id("rn"+rid);if(!reviewTitle){reviewTitle=ta.id("r"+rid)}if(reviewTitle){reviewTitle.set("html",reviews[i].title)}var disclaimerTxt=reviews[i].disclaimer;if(disclaimerTxt!=""){elm=document.getElementById("disclaimer_"+rid+"_more");if(elm){elm.innerHTML="<br />"+disclaimerTxt}}updateResponseText(rid,reviews[i].response)}}}}catch(e){ta.util.error.record(e,"rpcParseReviews",null,{reviewCnt:reviewCnt})}}function rpcParseReviewWithAnswers(reply){var reviewAnswers=eval("("+reply+")");var reviewAnswerCnt=reviewAnswers.length;for(var i=0;i<reviewAnswerCnt;++i){var typeId=reviewAnswers[i].typeid;if(typeId==0){var rid=reviewAnswers[i].id;var elm=document.getElementById("review_text_"+rid);elm.innerHTML=reviewAnswers[i].body;var disclaimerTxt=reviewAnswers[i].disclaimer;if(disclaimerTxt!=""){elm=document.getElementById("disclaimer_"+rid+"_more");elm.innerHTML="<br />"+disclaimerTxt}var name=document.getElementById("review_quote_"+rid);if(name&&typeof(reviewAnswers[i].name)!="undefined"&&reviewAnswers[i].name){name.innerHTML="&#x201c;"+reviewAnswers[i].name+"&#x201d;"}updateResponseText(rid,reviewAnswers[i].response)}else{var rid=reviewAnswers[i].reviewid;var qid=reviewAnswers[i].questionid;var elm=document.getElementById("review_"+rid+"_answer_"+qid);elm.innerHTML=reviewAnswers[i].answer}}}function _showReviewWithAnswers(b,a,d){var c="http://"+document.domain;new Request({url:c+"/UserReviewController?a="+d+"&r="+b+"&n="+a,onSuccess:callBeforePIC(rpcParseReviewWithAnswers),onFailure:callBeforePIC(function(e){if(e.status!==408){ta.util.error.ajaxFailure("reviews:showReviewWithAnswers",e)}})}).get()}function showReviewBlock(c,d,g,b,f){var e="http://"+document.domain;var a=e+"/UserReviewController?a="+d+"&r="+c+"&type="+g+"&tr="+b+"&n=16";if(typeof f!=="undefined"&&f){a+="&l="+f.toString()}new Request({url:a,onSuccess:callBeforePIC(rpcParseReviewsBlock),onFailure:function(){var h=new Request({url:a,onSuccess:callBeforePIC(function(j){rpcParseReviewsBlock(j)}),onFailure:callBeforePIC(ta.util.error.ajaxFailure.partial("reviews:showReview - second fail"))});h.get.delay(1000,h)}}).get()}function showReview(b,c,e){var d="http://"+document.domain;var a=d+"/UserReviewController?a="+c+"&r="+b;new Request({url:a,onSuccess:e?e:callBeforePIC(rpcParseReviews),onFailure:function(){var f=new Request({url:a,onSuccess:e?e:callBeforePIC(function(g){rpcParseReviews(g)}),onFailure:e?e:callBeforePIC(ta.util.error.ajaxFailure.partial("reviews:showReview - second fail"))});f.get.delay(1000,f)}}).get()}ta.util.cookie={expireTimeForPID:5,expireTimeForPID_remove:0,cookiePIDName:"NPID",setPIDCookie:function(a){try{Cookie.write(ta.util.cookie.cookiePIDName,a,{domain:cookieDomain,time:ta.util.cookie.expireTimeForPID})}catch(b){var c="";if(typeof cookieDomain!="undefined"){c=cookieDomain}ta.util.error.record(b,"set pid cookie",null,{pid:a,cookieDomain:c})}},removePIDCookie:function(){try{Cookie.write(ta.util.cookie.cookiePIDName,"",{domain:cookieDomain,time:ta.util.cookie.expireTimeForPID_remove})}catch(a){}},openWindowWithPID:function(b,a){if(a){ta.util.cookie.setPIDCookie(a)}window.open(b,"_blank");ta.util.cookie.removePIDCookie()},setAjaxAction:function(c,a){if(c[0]!="/"){c="/"+c}c="target:"+c;try{var f=Array.from(arguments).join("|");Cookie.write("ajaxAction",f,{domain:cookieDomain,path:"/"})}catch(b){var d="";if(typeof cookieDomain!="undefined"){d=cookieDomain}ta.util.error.record(b,"set pid cookie",null,{pid:pid,cookieDomain:d})}},setPID:function(b,a){if(ta.id(a).get("tag")!="a"){a=a.getParent("a")}if(pid=a.className.match(/pid(\d+)/)){ta.util.cookie.setPIDCookie(pid[1])}},setPIDNoA:function(a){pid=a.className.match(/pid(\d+)/);if(pid){ta.util.cookie.setPIDCookie(pid[1])}},showCookieBanner:function(){try{var b=ta.id("COOKIE_BANNER"),c=$(document.body);if(b&&c){b.inject(c,"top");b.setStyles({position:"fixed",top:-3000,left:-3000});b.show();var a=b.getHeight();b.setStyle("margin-top",0-a);b.hide();b.setStyles({top:0,left:0,position:"relative"});b.show();b.set("tween",{duration:"long"});b.tween("margin-top",0);Cookie.write("cookieconsent","1",{duration:3600})}}catch(d){ta.util.error.record(d,"ta.util.cookie.showCookieBanner")}}};setPID=ta.util.cookie.setPIDCookie;ta.util.ASDF={asdf:function(b,a){if(a){ta.util.cookie.setPIDCookie(a)}window.location=asdf(b)},asdfPxlAndPid:function(d,b,a){var e="http://ad.doubleclick.net/ad/";var c=";sz=1x1";if(a){ta.util.cookie.setPIDCookie(a)}if(b){new Element("img",{src:e+b+c})}window.location=asdf(d)},asdfPopup:function(b,a){if(a){ta.util.cookie.setPIDCookie(a)}ta.servlet.Popup.open(asdf(b))},asdfPopupEmail:function(a){ta.servlet.Popup.open(asdf(a),"email",580,460,30,25)},asdfPopupGuide:function(a){ta.servlet.Popup.open(asdf(a),"dest_guide",565,700,(screen.width-700)/2,(screen.height-600)/2)},asdfPopupTerms:function(a){ta.servlet.Popup.open(asdf(a),"terms",300,300,30,25)},asdfPopupDir:function(a){new Request({url:"/ActionRecord?action=getDirectionsListings"}).send();ta.servlet.Popup.open(asdf(a),null,800,600)},asdfDcd:function(a){return asdf(a)}};function getOffset(a){if(a>=97&&a<=122){return a-61}if(a>=65&&a<=90){return a-55}if(a>=48&&a<=71){return a-48}return -1}function asdf(d){var g={"":["&","=","p","6","?","H","%","B",".com","k","9",".html","n","M","r","www.","h","b","t","a","0","/","d","O","j","http://","_","L","i","f","1","e","-","2",".","N","m","A","l","4","R","C","y","S","o","+","7","I","3","c","5","u",0,"T","v","s","w","8","P",0,"g",0],q:[0,"__3F__",0,"Photos",0,"https://",".edu","*","Y",">",0,0,0,0,0,0,"`","__2D__","X","<","slot",0,"ShowUrl","Owners",0,"[","q",0,"MemberProfile",0,"ShowUserReviews",'"',"Hotel",0,0,"Expedia","Vacation","Discount",0,"UserReview","Thumbnail",0,"__2F__","Inspiration","V","Map",":","@",0,"F","help",0,0,"Rental",0,"Picture",0,0,0,"hotels",0,"ftp://"],x:[0,0,"J",0,0,"Z",0,0,0,";",0,"Text",0,"(","x","GenericAds","U",0,"careers",0,0,0,"D",0,"members","Search",0,0,0,"Post",0,0,0,"Q",0,"$",0,"K",0,"W",0,"Reviews",0,",","__2E__",0,0,0,0,0,0,0,"{","}",0,"Cheap",")",0,0,0,"#",".org"],z:[0,"Hotels",0,0,"Icon",0,0,0,0,".net",0,0,"z",0,0,"pages",0,"geo",0,0,0,"cnt","~",0,0,"]","|",0,"tripadvisor","Images","BookingBuddy",0,"Commerce",0,0,"partnerKey",0,"area",0,"Deals","from","\\",0,"urlKey",0,"'",0,"WeatherUnderground",0,"MemberSign","Maps",0,"matchID","Packages","E","Amenities","Travel",".htm",0,"!","^","G"]};var b="";for(var a=0;a<d.length;a++){var h=d.charAt(a);var e=h;if(g[h]&&a+1<d.length){a++;e+=d.charAt(a)}else{h=""}var f=getOffset(d.charCodeAt(a));if(f<0||typeof g[h][f]=="String"){b+=e}else{b+=g[h][f]}}return b}ta.util.Doer={doit:function(e,d){var c="/"+e;var b=0;for(var a in d){if(b===0){c+="?"}else{c+="&"}c+=a+"="+d[a];b++}return c},aimdoit:function(k,c,a,l){var b=ta.util.Doer.doit(k,c);new Event(a).preventDefault();var j=475;var d=390;var g=210;var f=5;if(l){j=980;d=800;g=240}else{if(screen.width>=1024&&screen.height>=768&&c&&(c.area.indexOf("Text")!=-1||c.area.indexOf("Thumbnail")!=-1)){j=900;d=768;g=240}else{if(screen.width>1024){j=800;d=600;g=240}else{if(screen.width>800){j=620;d=500;g=240}}}}ta.store("commerce.AIMWindow",ta.servlet.Popup.open(b,null,j,d,g,f,false,true));if(ta.retrieve("isDaoDao")){if(ta.retrieve("checkrates.check_more_re")){dd.commerce.checkrates.checkMorePopupAIM(a,c)}}else{var e=ta.retrieve("meta.popProPhotosCRLeavebehind")&&!ta.widgets.calendar.hasPageDates()&&c&&c.area!="Icon_Amenities";if(ta.retrieve("checkrates.isCRLB")&&!ta.id("CHECK_RATES_LB")&&(!ta.retrieve("checkrates.meta_ui_post_click_prices")||e)){ta.run("ta.overlays.Factory.loadCheckRatesLBOverlay",{},a,null,c)}}},tadoit:function(d,b,c,a){window.location=ta.util.Doer.tadoless(d,b,c,a)},tadoless:function(g,c,f,j,b){var a="/"+g;for(var h in c){a+="-"+h+c[h]}var e=f.length;for(var d=0;d<e;d++){a+="-"+f[d]}if(!b){a+=".html"}if(j.length>0){a+=j}return a}};ta.util.pending={};ta.util.pending.waitForMore=function(e,c,a,b,d){if(ta.has("pending."+e)){ta.util.pending.cancel(e)}ta.store("pending."+e,{timer:c.delay(a,d,b),fn:c,t:"m",n:a})};ta.util.pending.waitForFn=function(id,fn){try{var tmp=eval(fn),data;if(tmp){if(typeOf(tmp)==="function"){if(ta.has("pending.callback."+id)){ta.retrieve("pending.callback."+id)()}else{if(ta.has("pending."+id)){data=ta.retrieve("pending."+id);if(data.evnt){tmp.attempt([data.evnt,data.elmt])}else{tmp.attempt()}}else{tmp.attempt()}}}else{if(IS_DEBUG){alert("fn is not a function: "+typeOf(tmp))}}}else{ta.util.pending.waitForFnAgain(id,fn)}}catch(e){ta.util.pending.waitForFnAgain(id,fn)}};ta.util.pending.WAIT_DELAY=100;ta.util.pending.WAIT_TIMEOUT=50;ta.util.pending.waitForFnAgain=function(c,a){var b=ta.has("pending."+c)?ta.retrieve("pending."+c):{t:"f",fn:a,count:1};if(b.count<ta.util.pending.WAIT_TIMEOUT){b.count++;b.timer=ta.util.pending.waitForFn.invokeLater(ta.util.pending.WAIT_DELAY,null,[c,a]);ta.store("pending."+c,b)}else{if(IS_DEBUG&&!ta.has("pending.ignore."+c)){alert("timed out ("+(ta.util.pending.WAIT_TIMEOUT*ta.util.pending.WAIT_DELAY)+"ms) waiting for function: "+a)}}};ta.util.pending.waitForFile=function(c,a,b){if(ta.load(a)){ta.util.pending.waitForFn(c,b)}};ta.util.pending.waitForHandler=function(d,b,c,a){ta.store("pending."+d,{count:0,t:"f",fn:b,evnt:c,elmt:a});ta.util.pending.waitForFn(d,b)};ta.util.pending.cancel=function(b){var a=ta.remove("pending."+b);if(a&&a.timer){clearTimeout(a.timer)}};ta.util.pending.lock=function(d,b,c,a){if(ta.has("pending."+d)){return[a,false].pick()}ta.store("pending."+d,true);if(c){ta.util.pending.unlock.delay(c,null,d)}return b()};ta.util.pending.unlock=function(b){var a=ta.remove("pending."+b);if(a&&typeof a==="object"){a.count--;if(a.count===0){a.fn()}else{ta.store("pending."+b,a)}}};ta.util.pending.multilock=function(c,a,b){ta.store("pending."+c,{count:b,fn:a})};ta.util.pending.multilockUpdate=function(d,c){var b="pending."+d,a=ta.retrieve(b);if(a){a.count+=c}};ta.util.pending.wait=function(e,c,b,d,a){ta.store("pending."+e,{timer:c.delay(b,d,a)})};ta.util.pending.waitForElement=function(d,a,c){if(ta.has("pending."+d)){return}var b=$(a);if(b){ta.util.pending.cancel("pending."+d);c(b)}else{ta.store("pending."+d,{timer:ta.util.pending.waitForElement.delay(2,null,[d,a,c])})}};ta.util.pending.waitFor=function(a,c,b){if(a()){return c()}setTimeout(function(){ta.util.pending.waitFor(a,c,b)},b);return false};ta.util.i18n={};ta.util.i18n.isRtl=function(){return ta.id(document.body).hasClass("rtl")};ta.util.load={loadedMap:false,loadingMap:false,callbacks:[]};ta.util.load.GMaps=function loadGMaps(a){return ta.util.load.maps(a)};ta.util.load.maps=function(a){if(ta.util.load.loadedMap){a&&a()}else{if(ta.util.load.loadingMap){ta.util.load.callbacks.push(a)}else{ta.util.load.loadingMap=true;return ta.maps.load.library(function(){ta.util.load.loadedMap=true;ta.util.load.loadingMap=false;a&&a();ta.util.load.callbacks.each(function(b){b&&b()})})}}};ta.util.load.mapsLazy=function(a){return ta.run("ta.maps.load.library",{},a)};ta.util.load.GoogleLoader=function(a){if(ta.has("googleloader.state")){if(ta.retrieve("googleloader.state")=="loaded"){return a()}else{return ta.util.load.GoogleLoader.delay(500,this,a)}}else{ta.store("googleloader.state","loading");ta.store("googleloader.callback",a);new Asset.javascript("//www.google.com/jsapi?callback=ta.util.load.GoogleLoaderCallback")}};ta.util.load.GoogleLoaderCallback=function(){ta.store("googleloader.state","loaded");var a=ta.remove("googleloader.callback");a()};ta.util.load.LocalSearch=function(a){ta.util.load.GoogleLoader(function(){google.load("search","1",{callback:function(){}})})};ta.util.date={};ta.util.date.MS_IN_DAY=1000*60*60*24;ta.util.date.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31];ta.util.date.HOUR_CONST=12;ta.util.date.THAI_BUDDHIST_YEAR_OFFSET=543;ta.util.date.MAX_STAY_DURATION_DAYS=30;ta.util.date.inDateSet=function(c,b){if((c==null)||(b==null)){return false}var e=b.length;for(var d=0;d<e;d++){var f=b[d];if(f.length){var g=f[0].getTime();var a=f[1].getTime();if((g<=c.getTime())&&(a>=c.getTime())){return true}}else{if(c.getTime()==f.getTime()){return true}}}return false};ta.util.date.rangesIntersect=function(a,b){return Math.max(a[0].getTime(),b[0].getTime())<=Math.min(a[1].getTime(),b[1].getTime())};ta.util.date.getDaysInRange=function(b,a){return Math.round((a.getTime()-b.getTime())/ta.util.date.MS_IN_DAY)+1};ta.util.date.getLastDayOfMonth=function(a){var b=new Date();if(a){b=new Date(a.getTime())}b=new Date(ta.util.date.normalize(b));b.setDate(1);b.setMonth(b.getMonth()+1);b.setDate(0);return b.getDate()};ta.util.date.getDaysApart=function(c,b){var a=24*60*60*1000;if(c&&b){return Math.round(Math.abs((c.getTime()-b.getTime())/(a)))}return 0};ta.util.date.inSameMonth=function(b,a){return(b!=null)&&(a!=null)&&(b.getMonth()==a.getMonth())&&(b.getYear()==a.getYear())};ta.util.date.normalize=function(a){return a.setHours(ta.util.date.HOUR_CONST,0,0,0)};ta.util.date.create=function(a,b,c){return new Date(a,b,c,ta.util.date.HOUR_CONST)};ta.util.currency={};ta.util.currency.formatCurrency=function(c,a){var e=a?a:"USD";var b=currencySymbol[e];var d=ta.util.currency.formatThousands(Math.round(c));if(!b[1]){return b[0]+d}else{return d+b[0]}};ta.util.currency.formatThousands=function(b){if(typeof groupingSize=="undefined"||typeof groupingSeparator=="undefined"||groupingSize<1){return b}var a="";var d=""+b;for(var c=1;c<=d.length;c++){a=d.charAt(d.length-c)+a;if(c%groupingSize==0&&c<d.length){a=groupingSeparator+a}}return a};ta.util.currency.setCurrencyAndReload=function(a,b){var c="SetCurrency";Cookie.write(c,a,{time:15});b=b?b+"|":"";ta.trackEventOnPage("CurrencyPicker","Select",b+a);location.reload(true)};ta.util.Toggle={};ta.util.Toggle.siblings=function(c,b){c.preventDefault();var a=true;if(b.hasClass("closed")){a=false}b.toggleClass("closed sprite-arrow_toggle_blu_lft");b.getParent().getChildren().each(function(d){if(d!=b&&typeof d.hasClass!=="undefined"&&d.hasClass!=null&&!d.hasClass("ignore_toggle")){d.setStyle("display",a?"none":"block")}})};ta.util.Toggle.parentClass=function(c,a){c.preventDefault();var b=a.getParent(".toggle");b.toggleClass("off")};ta.util.Toggle.toggleTarget=function(d,b,c){d.preventDefault();var a=true;if($(b).hasClass("closed")){a=false}$(b).toggleClass("closed");$(b).toggleClass("open");$(c).setStyle("display",a?"none":"block")};ta.util.Toggle.toggleForm=function(b,d,c){var a=$(b).getParent(".formToggle");if(/sel_(\w+)/.test(a.className)){var e=RegExp.$1;a.removeClass("sel_"+e);a.getElement(".form_"+e).hide();var f=a.getElement(".header_"+e);if(f){f.hide()}}a.addClass("sel_"+d);var f=a.getElement(".header_"+d);if(f){f.show()}a.getElement(".form_"+d).show();return false};ta.util.Toggle.toggleLI=function(e,d,a){var c=e.getNext();for(var b=0;b<1000&&c&&c.id!=d.id;b++){if(a){c.show()}else{c.hide()}c=c.getNext()}if(a){e.hide()}else{e.show()}if(a){d.show()}else{d.hide()}};ta.util.Toggle.splitHotel=function(){var c=$$("#HOTEL_DESCRIPTION .descriptive_text").get("text").toString();var b=1000;if(c&&c.length>b){var a=c.substring(0,b);var d=c.substring(b,c.length);$$("#HOTEL_DESCRIPTION .descriptive_text").set("text",a);$$("#HOTEL_DESCRIPTION .description_ellipsis").show("inline");$$("#HOTEL_DESCRIPTION .more_description").show("inline");$$("#HOTEL_DESCRIPTION .descriptive_text_last").set("text",d)}};ta.util.Toggle.expandHotel=function(c,b){var a=b.getPrevious(".descriptive_text_last");var d=b.getNext(".less_description");b.hide();if(a){a.show("inline");a.getPrevious()&&a.getPrevious().hide()}d&&d.show("inline")};ta.util.Toggle.truncateHotel=function(c,b){var d=b.getPrevious(".more_description");var a=b.getPrevious(".descriptive_text_last");d&&d.show("inline");if(a){a.hide();a.getPrevious()&&a.getPrevious().show("inline")}b.hide()};ta.util.Toggle.toggleRecentReview=function(c,e,d){var b=c.getPrevious().getChildren();for(i=0;i<b.length;i++){var a=b[i];if(a.style.display=="none"){a.style.display=""}else{a.style.display="none"}}c.set("text",c.get("text").contains("<")?e+" > ":d+" < ")};ta.util.Toggle.expandList=function(c,a,f){try{var b=c.getChildren();if(b.length>a){for(i=a;i<b.length;i++){b[i].hide()}var g=new Element("span",{html:f,"class":"taLnk hvrIE6 moreLink",events:{click:function(){for(i=a;i<b.length;i++){b[i].show()}g.hide()}}});g.inject(c,"after")}}catch(d){ta.util.error.record(d,"Failed to Toggle.expandList")}};ta.util.URL={parse:function(c){if(/^(\w+):(.*)/.test(c)){c=RegExp.$2;switch(RegExp.$1){case"DOM":elmt=document.getElement(c);c=(elmt&&elmt.href)?elmt.href:"#";break;case"GMapsLC":if(c.length==0){break}tmp=c.split(",");ops={from:pageServlet,Action:tmp.shift()};tmp.each(function(d){if(/^g(\d+)$/.test(d)){ops.g=RegExp.$1}else{if("ext"==d){ops.ext="y"}else{if(/^(.*)=(.*)$/.test(d)){ops[RegExp.$1]=RegExp.$2}else{ops[d]=""}}}});c="/GMapsLocationController?"+Object.toQueryString(ops);break;case"ABS":var a=(window.location.port=="80"||window.location.port=="")?"":(":"+window.location.port);if(c.charAt(0)!="/"){c="/"+c}c=window.location.protocol+"//"+window.location.hostname+a+c;break;case"ABSPAGE":var a=(window.location.port=="80"||window.location.port=="")?"":(":"+window.location.port);if(c.charAt(0)!="/"){c="/"+c}c=window.location.protocol+"//"+window.location.hostname+a+c;if(c.indexOf(".html")==-1){c+=".html"}break;case"REL":var b=window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"));if(/\/$/.test(window.location.pathname)){b=window.location.pathname}var a=window.location.port=="80"?"":(":"+window.location.port);if(c.charAt(0)!="/"){c="/"+c}c=window.location.protocol+"//"+window.location.hostname+a+b+c;break;default:c=RegExp.$1+":"+c;break}}return c},getParameter:function(c,a){var b=new RegExp("[?&]"+a+"=([^&]+)");if(b.test(c)){return RegExp.$1}return false},getAbsoluteUrl:function(a){return location.protocol+"//"+location.hostname+a},https:function(a){a=a||"";if(a.indexOf("http")===-1){a=ta.util.URL.getAbsoluteUrl(a)}if(a.indexOf("https://")===0){return a}if(ta.retrieve("access_control_headers")){return a.replace("http://","https://")}return a},getServletNameFromUrl:function(a){return/^(?:\w+:\/\/.*)?\/([^-?]*).*/.exec(a)&&RegExp.$1}};ta.util.element={};ta.util.element.replaceContent=function(f,e,c){var d=f;var b=e;if(!b.getElement(".progresstab")){var a=c+(c.indexOf("?")==-1?"?":"&")+"xhr=true";var g=new Element("div",{"class":"progresstab"});g.inject(b);new Request({url:a,onSuccess:function(h,j){b.empty();b.innerHTML=h;if(window.behavior){window.behavior.apply(b)}b.fireEvent("onContentReplaced",[d,b])},evalScripts:true}).get()}};ta.util.element.trackIfMapView=function(){if(ta.retrieve("maps_v2_open")){ta.trackEventOnPage("QC_Meta_Map_Detail","map_open")}};ta.util.element.spinner=function(b,a){$(a).getParent(".spinnerReplaceable").getChildren().each(function(c){if(c.hasClass("spinner")){c.show()}else{c.hide()}})};ta.util.element.clearDefault=function(b,a){if(a.value==a.defaultValue){a.value=""}};ta.util.element.limitLength=function(b,a,c){if(a.value.length>=c){a.value=a.value.substr(0,c);return false}};ta.util.element.updateValue=function(a,b){if(a&&a.get("value")!=b){a.set("value",b);a.fireEvent("change",a)}};ta.util.element.moveContent=function(a,b){if(!a||!b){return}b.innerHTML=a.innerHTML;a.innerHTML=""};ta.util.element.keepInWindow=function(d,c){if(!d||!d.setStyle){return}if(!c){c={top:true,right:true,bottom:true,left:true}}function e(h,j){var k=parseInt(h.getStyle(j));return k||k===0}var g=2;var f=d.getCoordinates();var b=Window.getSize();var a=Window.getScroll();if(c.right&&e(d,"right")){if(f.left<a.x+g){d.setStyle("right",b.x+a.x-f.width-g)}else{if(f.right>b.x-a.x-g){d.setStyle("right",g)}}}else{if(c.left&&e(d,"left")){if(f.left<a.x+g){d.setStyle("left",g)}else{if(f.right>b.x-a.x-g){d.setStyle("left",b.x+a.x-f.width-g)}}}}if(c.bottom&&e(d,"bottom")){if(f.top<a.y+g){d.setStyle("bottom",b.y+a.y-f.height-g)}else{if(f.bottom>b.y-a.y-g){d.setStyle("bottom",g)}}}else{if(c.top&&e(d,"top")){if(f.top<a.y+g){d.setStyle("top",g)}else{if(f.bottom>b.y-a.y-g){d.setStyle("top",b.y+a.y-f.height-g)}}}}};ta.util.element.makeTextFit=function(d,p,r,b,c){c=c||1;b=b||8;var h=false;var k=ta.select(d);for(var l=0;l<k.length;l++){var f=k[l].getElement(r);var n=k[l].getElement(p);var a=f.getSize();var j=n.getSize();if(a.y<j.y){var q=n.getStyle("font-size");if(q){var e=function(t,s){return(s=="px"&&t>=b)||(s=="em"&&t>=0.5)||(s=="pt"&&t>6)||(s=="%"&&t>=50)};var m=q.replace(/[\d\.]/g,"");var g=parseFloat(q)*Math.sqrt(a.y/j.y);if(m=="px"){g=Math.max(parseInt(g),b)}if(e(g,m)){n.setStyle("font-size",g+m);h=true}}}}if(h>0&&c<4){var o=this;setTimeout(function(){o.makeTextFit(d,p,r,b,c+1)},1)}};ta.util.element.makeTextFitOneLine=(function(){var a=4;var b=0.9;var c=function(d,e){fontSize=d.getStyle("font-size");newSize=parseFloat(fontSize)*e;unit=fontSize.replace(/[\d\.]/g,"");if(unit=="px"&&newSize<8){newSize=8}if(unit=="em"&&newSize<0.5){newSize=0.5}if(unit=="pt"&&newSize<6){newSize=6}if(unit=="%"&&newSize<50){newSize=50}d.setStyle("font-size",newSize+unit)};return function(g,d){var e=ta.select(g);e.forEach(function(k){var h=(parseFloat(k.getStyle("padding-left"))||0)+(parseFloat(k.getStyle("padding-right"))||0);for(var j=0;j<a&&k.scrollWidth>k.clientWidth;j++){var l=(k.clientWidth-h)/(k.scrollWidth-h);c(k,l)}if(k.scrollWidth>k.clientWidth){c(k,b)}});if(d){var f;e.forEach(function(j){var h=j.getStyle("font-size");if(!f||parseFloat(h)<parseFloat(f)){f=h}});e.forEach(function(h){h.setStyle("font-size",f)})}}})();ta.util.element.makeSameWidth=function(a){var b=0;var c=document.getElements(a);if(c&&c.length>1){c.forEach(function(e){var d=Math.round(parseFloat(e.getStyle("width")));if(d&&d>b){b=d}});c.setStyle("width",b)}};ta.util.element.fitToContentsHorizontally=function(b,c,d,a){a=a||1;if(a<=0||c>d){return}var e=function(f){return f.scrollWidth>f.clientWidth||f.scrollHeight>f.clientHeight};ta.select(b).forEach(function(f){f.setStyle("width",c);for(var g=c;g<d&&e(f);g+=a){f.setStyle("width",g)}if(e(f)){f.setStyle("width",d)}})};ta.util.element.scrollIntoView=function(a){if(!a){return}var b=a.getPosition().y;window.scrollTo(0,b)};ta.util.element.isScrolledIntoView=function(d,g){if(!d){return false}var f;try{f=d.getBoundingClientRect()}catch(c){return false}var e=f.bottom;var b=f.top;if(g){var a=g.offsetHeight;var h=g.getPosition();if(a){if(h&&h.y==0){e-=a}else{b+=a}}}return(!!f&&e>=0&&f.right>=0&&b<=document.documentElement.clientHeight&&f.left<=document.documentElement.clientWidth)};ta.util.element.doIfElementIsVisible=function(d,e,b){function a(){if(d&&ta.util.element.isScrolledIntoView(d)){e.apply(null,b);window.removeEvent("scroll",a);window.removeEvent("resize",c)}}function c(){if(d&&ta.util.element.isScrolledIntoView(d)){e.apply(null,b);window.removeEvent("scroll",a);window.removeEvent("resize",c)}}if(d&&ta.util.element.isScrolledIntoView(d)){e.apply(null,b)}else{window.addEvent("scroll",a);window.addEvent("resize",c)}};ta.util.element.isScrolledIntoAdjustedView=function(c,l,d){if(!c){return false}var h;try{h=c.getBoundingClientRect()}catch(f){return false}var k=h.bottom,j=h.top,b=h.left,a=h.right;if(l){if(l.bottom){k=k+l.bottom>0?k+l.bottom:0}if(l.top){j=j+l.top>0?j+l.top:0}if(l.left){b=b+l.left>0?b+l.left:0}if(l.right){a=a+l.right>0?a+l.right:0}}if(d){var e=d.offsetHeight;var g=d.getPosition();if(e){if(g&&g.y==0){k-=e}else{j+=e}}}return(!!h&&k>=0&&a>=0&&j<=document.documentElement.clientHeight&&b<=document.documentElement.clientWidth)};ta.util.element.doIfElementAdjustedPositionIsVisible=function(d,f,e,b){function a(){if(d&&ta.util.element.isScrolledIntoAdjustedView(d,f)){e.apply(null,b);window.removeEvent("scroll",a);window.removeEvent("resize",c)}}function c(){if(d&&ta.util.element.isScrolledIntoAdjustedView(d,f)){e.apply(null,b);window.removeEvent("scroll",a);window.removeEvent("resize",c)}}if(d&&ta.util.element.isScrolledIntoAdjustedView(d,f)){e.apply(null,b)}else{window.addEvent("scroll",a);window.addEvent("resize",c)}};ta.util.element.getTotalWidth=function(b){if(!b){return 0}var a=b.getComputedStyle("width");if(a&&isNaN(parseInt(a))){return b.getWidth()}return(parseInt(b.getComputedStyle("width"))||0)+(parseInt(b.getComputedStyle("margin-left"))||0)+(parseInt(b.getComputedStyle("margin-right"))||0)+(parseInt(b.getComputedStyle("padding-left"))||0)+(parseInt(b.getComputedStyle("padding-right"))||0)+(parseInt(b.getComputedStyle("border-left-width"))||0)+(parseInt(b.getComputedStyle("border-right-width"))||0)};ta.util.element.getTotalHeight=function(a){if(!a){return 0}var b=a.getComputedStyle("height");if(b&&isNaN(parseInt(b))){return a.getHeight()}return(parseInt(a.getComputedStyle("height"))||0)+(parseInt(a.getComputedStyle("margin-top"))||0)+(parseInt(a.getComputedStyle("margin-bottom"))||0)+(parseInt(a.getComputedStyle("padding-top"))||0)+(parseInt(a.getComputedStyle("padding-bottom"))||0)+(parseInt(a.getComputedStyle("border-top-height"))||0)+(parseInt(a.getComputedStyle("border-bottom-height"))||0)};ta.util.link={ajaxSubmit:function(a,c,b){if(a){new Event(a).preventDefault()}if(b){ta.util.cookie.setPIDCookie(b)}if(!c.className.match(/\bform_(\w+)\b/)){return}var f=$(RegExp.$1);var e={url:c.href,data:f,onFailure:function(h){if(f){f.removeClass("ajaxInFlight")}ta.util.error.ajaxFailure("link - ajaxSubmit",h)}};var g=window["callback"+f.id];if(c.className.match(/method_(\w+)\b/)){e.method=RegExp["$1"]}if(c.className.match(/\btgt_(\w+)\b/)){e.update=RegExp["$1"]}else{e.onSuccess=function(h){if(f){f.removeClass("ajaxInFlight")}ta.overlays.showInLightbox(h);if(g&&typeOf(g)=="function"){g()}}}var d=window["validate"+f.id];if(d&&typeOf(d)=="function"&&d.apply(f)==false){return}f.addClass("ajaxInFlight");if(c.className.match(/\bevalScripts\b/)){e.evalScripts=true}(e.update?new Request.HTML(e):new Request(e)).send()},ajaxCall:function(a,b){if(a){new Event(a).preventDefault()}if(!(tgt=b.className.match(/\btgt_(\w+)\b/))){return}tgt=$(tgt[1]);new Request.HTML({url:b.href,update:tgt,onFailure:ta.util.error.ajaxFailure.partial("link - ajaxCall")}).send()},popResWidth:function(b,e,d){try{var a=475,f=390,j=210;if(screen.width>1024){a=800;f=600;j=240}else{if(screen.width>800){a=620;f=500;j=240}}var g=Object.merge({width:a,height:f,xOffset:j,yOffset:5},d);ta.util.link.popup(b,e,g)}catch(c){ta.util.error.record(c,"ta.util.link - popCustom",b,g)}},popPhoto:function(a,d,c){try{Cookie.write("PhotoPop","1",{domain:cookieDomain});var e=Object.merge({name:"media",width:782,height:820},c);ta.util.link.popup(a,d,e)}catch(b){ta.util.error.record(b,"ta.util.link - popPhoto",a,e)}},popup:function(n,a,k){try{var g=Object.merge({name:false,width:950,height:610,xOffset:false,yOffset:false,noScroll:0,aHref:false,fullOptions:true,ensureReferrer:false,isAsdf:false},k);new Event(n).preventDefault();var f=false,b="",m=false;var c=1;if(ta.has("ta.popups.popupIndex")&&typeof ta.retrieve("ta.popups.popupIndex")!="undefined"){c=ta.retrieve("ta.popups.popupIndex")}if(!g.aHref){g.aHref=a.href}g.aHref=g.aHref.replace("%7Cnavarea%7C",ta.meta.link.getPhotoNavArea(a));if(g.isAsdf&&g.aHref){if(ta.util.ASDF.asdfDcd){g.aHref=ta.util.ASDF.asdfDcd(g.aHref).replace(/&amp;/g,"&")}}if(g.aHref&&g.aHref.indexOf("p=HotelsCom")>-1){g.width=Math.max(g.width,960);try{g.height=Math.max(g.height,window.getHeight(),600)}catch(h){g.height=Math.max(g.height,600)}}if(g.width){b+=",width="+g.width}if(g.height){b+=",height="+g.height}if(g.xOffset){b+=",screenX="+g.xOffset+",left="+g.xOffset}if(g.yOffset){b+=",screenY="+g.yOffset+",top="+g.yOffset}if(!Browser.chrome){g.noScroll=1}if(g.fullOptions){var j=1;if(ta.browser.isIE9orHigher()){j=0}b="toolbar=1,resizable=1,menubar="+j+",location=1,status=1,scrollbars="+g.noScroll+b}else{b="toolbar=0,resizable=1,menubar=0,location=0,status=0,scrollbars="+g.noScroll+b}if(!g.name){g.name="p"+(c++)}ta.store("ta.popups.popupIndex",c);if(g.ensureReferrer&&Browser&&Browser.ie){try{m=new Element("a",{target:g.name,href:g.aHref});m.inject(ta.id(document.body),"bottom");f=window.open("",g.name,b);m.click();m.destroy()}catch(d){ta.util.error.record(d,"ta.util.link - pop ensure referrer",n,g)}}else{try{f=window.open(g.aHref,g.name,b)}catch(h){ta.util.error.record(h,"ta.util.link - popping window",n,{href:g.aHref,name:g.name,args:b})}}if(typeof f!="undefined"&&f!==null){try{f.opener=self;f.focus()}catch(d){}}}catch(l){ta.util.error.record(l,"ta.util.link - popup",n,g)}},directionsPop:function(a,c,b,d){if(d){new Request({url:"/ActionRecord?action="+d}).send()}if(ta.trackEventOnPage){ta.trackEventOnPage("map_pin_overlay","directions_click")}ta.util.link.popup(a,c,b)},directionsPopInfoCard:function(a,c,b,d){if(d){new Request({url:"/ActionRecord?action="+d}).send()}if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","map_info_window","directions_cta")}ta.util.link.popup(a,c,b)},targetBlank:function(a,d,c){try{var e=Object.merge({aHref:false,isAsdf:false},c);if(e.isAsdf&&e.aHref){if(ta.util.ASDF.asdfDcd){e.aHref=ta.util.ASDF.asdfDcd(e.aHref).replace(/&amp;/g,"&")}}var f=c&&c.action&&(c.action=="website"||c.action=="deals"||c.action=="packages");if(ta.retrieve("ta.bl_calendar_lb")&&!ta.widgets.calendar.hasPageDates()&&f){ta.run("ta.overlays.Factory.loadCheckRatesLBOverlay",{},a,d,{detail:c.detailId,gaContext:"BLLightbox-"+c.action})}if(e.newTab||navigator.appVersion.indexOf("MSIE 7.")!=-1){window.open(e.aHref,"_blank")}else{if(ta.retrieve("ta.bl_calendar_lb")&&f){ta.servlet.Popup.openExternalWithDefaultOptions(e.aHref)}else{window.open(e.aHref,"_blank")}}}catch(b){ta.util.error.record(b,"ta.util.link - targetBlank",a,e)}}};ta||(ta={});ta.util||(ta.util={});ta.util.localstorage=(function(a,d,b,e){var f="taLsTest",c="1";return{canUseLocalStore:function(){try{if(d.localStorage){localStorage.setItem(f,c);return(c===localStorage.getItem(f))}}catch(g){}return false},canUseSessionStore:function(){try{if(d.sessionStorage){sessionStorage.setItem(f,c);return(c===sessionStorage.getItem(f))}}catch(g){}return false}}}(document,window,ta));(function(){window.ta||(window.ta={});window.ta.util||(window.ta.util={});var a=["success","failure","always","progress"];var e={resolved:["success","always"],rejected:["failure","always"]};var g=function(){};function h(j){g.prototype[j]=function(l,k){return b(this,j,k?l.bind(k):l)}}for(var d=0;d<a.length;d++){h(a[d])}window.ta.util.Deferred=function(){var j="pending";var l=new g();l.queue=[];l.args=null;l.status=function(){return j};var k={notify:function(){if(c(j)){throw new Error("Promise has already been fulfilled.")}var n=Array.prototype.slice.call(arguments);var p,o,m;for(o=0,m=l.queue.length;o<m;o++){p=l.queue[o];if(p.hook==="progress"){p.callback.apply(null,n)}}return l},resolve:function(){if(c(j)){throw new Error("Promise has already been fulfilled.")}j="resolved";l.args=Array.prototype.slice.call(arguments);return f(l)},reject:function(){if(c(j)){throw new Error("Promise has already been fulfilled.")}j="rejected";l.args=Array.prototype.slice.call(arguments);return f(l)},promise:function(){return l}};return k};var c=function(j){return j==="resolved"||j==="rejected"};var b=function(k,j,l){k.queue.push({hook:j,callback:l});return f(k)};var f=function(l){var k,j;while(c(l.status())&&(k=l.queue.shift())){if(~e[l.status()].indexOf(k.hook)){j=k.callback.apply(null,l.args);if(j instanceof g){j.queue=j.queue.concat(l.queue);l=j}}}return l}}());ta.util.decoder={base64Decoder:function(g){g=g.replace(/\-/g,"+").replace(/\_/g,"/");if(g.length%4!==0){var h=4-g.length%4;for(var f=0;f<h;f++){g=g+"="}}var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a="",q,o,l="",p,n,k,j="";for(var e=0;e<g.length;e+=4){p=d.indexOf(g.charAt(e));n=d.indexOf(g.charAt(e+1));k=d.indexOf(g.charAt(e+2));j=d.indexOf(g.charAt(e+3));if(p==-1||n==-1||k==-1&&j==-1){ta.util.error.record(null,"Facebook signed request contains invalid base64 letter",null,{code:g});return}q=(p<<2)|(n>>4);o=((n&15)<<4)|(k>>2);l=((k&3)<<6)|j;a=a+String.fromCharCode(q);if(k!=64){a=a+String.fromCharCode(o)}if(j!=64){a=a+String.fromCharCode(l)}q=o=l="";p=n=k=j=""}return unescape(a)}};ta.util.replace=(function(){return{img:function(b,a){try{b.src=ta.retrieve(a).src}catch(c){}}}})();(function(a){a.util||(a.util={});a.util.ajax=function(f){f||(f={});try{if(f.trackEvent&&a.analytics){var l=a.analytics._toEvtParams(f.trackEvent);f.data=a.util.merge(f.data||{},l)}}catch(j){if(a.util&&a.util.error&&a.util.error.record){a.util.error.record(j,"ta.util.ajax.initialize.trackEvent")}}var d=a.util.Deferred();var h=function(e){};var k,c;var g={onComplete:typeof f.onComplete=="function"?f.onComplete:h,onSuccess:typeof f.onSuccess=="function"?f.onSuccess:h,onFailure:typeof f.onFailure=="function"?f.onFailure:h,onReadOnly:f.onReadOnly||h,onRedirect:f.onRedirect||h};f.onComplete=function(){var m;try{m=JSON.decode?JSON.decode(k.responseText):JSON.parse(k.responseText)}catch(n){m={text:k.responseText}}m||(m={text:k.responseText});if(!m.code){m.code=k.status||0}try{if(f&&f.trackEvent&&a.analytics){a.analytics._trackEventAfterAjax(this.options.trackEvent)}}catch(n){if(a&&a.util&&a.util.error&&a.util.error.record){a.util.error.record(n,"ta.util.ajax.onComplete.trackEventAfterAjax")}}if(m.code>=200&&m.code<300){m.status="ok";d.resolve(m)}else{if(m.code===301||m.code===302){m.status="redirect";d.reject(m)}else{m.status||(m.status="error");d.reject(m)}}};f.onCancel=function(){d.reject({code:0,status:"abort"})};f.onTimeout=function(){d.reject({code:0,status:"timeout"})};delete f.onLoadStart;delete f.onProgress;delete f.onException;delete f.onSuccess;delete f.onFailure;k=b(f);return d.promise().always(function(e){g.onComplete.call(k,e);if(e.status==="redirect"){g.onRedirect.call(k,e)}else{if(e.status==="readonly"){g.onReadOnly.call(k,e)}else{if(~["abort","timeout","error"].indexOf(e.status)){g.onFailure.call(k,e)}else{g.onSuccess.call(k,e)}}}})};function b(d){if(typeof Request!=="undefined"){return(new Request(d).send()).xhr}var h=new XMLHttpRequest();var k=h.abort.bind(h);var j=d.method.toUpperCase()||"GET";var g=d.url||"/";var c=[];var f,e;h.onreadystatechange=function(){if(this.readyState===4){clearTimeout(f);d.onComplete()}};h.abort=function(){k();d.onCancel()};if(d.timeout){f=setTimeout(function(){k();d.onTimeout()},d.timeout)}d.data||(d.data={});for(e in d.data){if(d.data.hasOwnProperty(e)&&d.data[e]!==null){c.push(e+"="+encodeURIComponent(d.data[e]))}}if(/GET/.test(d.method)){g+=(/\?/.test(g)?"&":"?")+c.join("&")}if(/POST/.test(d.method)){d.headers||(d.headers={});d.headers["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8"}h.open(d.method,g);for(e in d.headers){h.setRequestHeader(e,d.headers[e])}d.onRequest&&d.onRequest.call(h);h.send(/POST/.test(d.method)?c.join("&"):null);return h}}(ta));var TypeAhead=(function(e){var K={minChars:1,search:null,itemTemplate:function(P){return P&&P.value},listTemplate:function(Q){var P=Q.results?Q.results:Q;return'<div class="typeahead-choices">'+P.map(function(S,R){return'<div class="typeahead-choice">'+S.rendered+"</div>"}).join("")+"</div>"},errorTemplate:function(P){return'<div class="message">'+P+"</div>"},resolveSelection:function(P){return P&&P.value},equal:function(Q,P){return Q.value==P.value},shouldSubmit:function(){return true},validator:null,containerClass:"typeahead-container",itemSelector:".typeahead-choice",errorClass:"error",defaultTextClass:false,defaultValue:null,width:true,showOnFocus:true,onUserFocus:null,autoSelectFirst:false,selectOnBlur:true,assumeOnBlur:true,onUserBlur:null,restoreOnFocus:false,cycleInput:true,autopopulateHighlighted:true,selectInputText:true,onSelect:null,onRestore:null,onSync:null,onRender:null,onShow:null,onHide:null,onError:null,nextField:null,offsetY:0,offsetX:0,syncro:null,containerParent:document.body,positionRelative:false,unselectOnEscape:false,cacheResults:false,autoHighlightFirst:false,ignoreKeysWhenInvisible:false,name:"unknown",geoId:undefined,startEventOn:"focus",locBiased:null,queryLengthLimit:100,postResultsFn:null,showHistory:false,integrateHistory:false,highlightHistory:false,recentHistory:[],maxHistoryItems:5,historyTypes:["geo","eatery","hotel","attraction"],historyLinkType:"url",historyPredicate:null,minHistoryChars:null,jpFirefoxIME:false,jpFirefoxIMEInterval:500,clearDefaultTextOnFocus:true,focusOnCreation:false,searchParams:null,errorOnSearchFailure:"error"},M=8,I=9,C=13,o=16,k=17,m=18,A=20,n=27,u=37,J=38,y=39,z=40,v=46,w=91,d="click",q="enter",r="tab";var E=function(Q){var P=ta.util.Deferred();var R=this.getSearchParams();R.query=Q;R.action="API";R.uiOrigin=this.options.name;R.source=this.options.name;R.startTime=this.options.startTime;new ta.util.ajax({method:"GET",url:"/TypeAheadJson",data:R}).always(function(S){if(S){P.resolve(S)}else{P.reject(this.options.errorOnSearchFailure)}});return P.promise()};var g=function(R){var P=0;for(var Q=this.source.value.length-1;Q>=0;Q--){P++;var S=this.source.value.charCodeAt(Q);if((S>=19968&&S<=40959)||(S>=12352&&S<=12543)||(S>=44032&&S<=55295)){P++}if(!R&&P>=this.options.minChars){return true}}return R?P:false};var c=function(){var P=this.source;if(this.hasDefaultText()&&this.options.clearDefaultTextOnFocus!==true){window.setTimeout(function(){P.setSelectionRange(0,0)},0)}};var j=function(P){if(this.hasDefaultText()&&this.options.clearDefaultTextOnFocus!==true){e.removeClass(this.source,this.options.defaultTextClass);this.source.value=""}if(this.options.startEventOn==="type"){l.call(this)}if(this.options.ignoreKeysWhenInvisible&&!this.visible){return}switch(P.keyCode){case C:P.preventDefault();P.stopPropagation();if(this.selectedIndex>=0){this.select(true,q);x.call(this)}else{if(this.options.assumeOnBlur&&this.results&&this.results.length){if(typeof this.options.assumeOnBlur=="function"){this.setSelectedIndex(this.options.assumeOnBlur(this))}else{this.setSelectedIndex(0)}L.call(this);this.select(true,q);x.call(this)}if(this.options.shouldSubmit()){if(!this.options.validator||this.options.validator(P)){if(this.options.onSubmit){this.options.onSubmit(this)}this.source.form.submit()}}}break;case z:this.highlightNextChoice();P.preventDefault();P.stopPropagation();break;case J:this.hightlightPreviousChoice();P.preventDefault();P.stopPropagation();break;case n:this.restore();this.hide();break;case I:this.tabPressed=true;break}if(this.options.onKeyDown){this.options.onKeyDown(P,this)}};var H=function(P){setTimeout(F.bind(this),0)};var b=function(P){if(P){switch(P.keyCode){case I:case o:case k:case m:case A:case u:case J:case y:case z:case w:case C:case n:return}}F.call(this)};var F=function(){var Q=this.results&&this.results.length===0;if(!this.hasDefaultText()&&g.call(this)&&this.source.value!==this.query&&(this.selectedIndex<0||!this.results||Q||this.source.value!==this.results[this.selectedIndex].value)){this.search()}else{if(g.call(this,true)<this.options.minChars){this.selected&&e.removeClass(this.selected,"selected");e.removeClass(this.source,this.options.errorClass);this.results=null;this.error=null;this.setSelectedIndex(-1);this.selected=null;this.query=null;this.historyShown=false;var P=this.source&&(!this.source.value||D(this.source.value).trim().length==0);if(this.shouldShowHistory()&&(P||this.hasDefaultText())){this.showHistoryIfEnabled()}else{this.hide()}}}};var G=function(P){if(!(this.results&&this.results.length)){return}this.selectedIndex+=P;if(this.selectedIndex>=this.results.length){this.setSelectedIndex(this.options.cycleInput?-1:0)}else{if(this.selectedIndex<(this.options.cycleInput?-1:0)){this.setSelectedIndex(this.results.length-1)}}L.call(this)};var L=function(){this.selected&&e.removeClass(this.selected,"selected");if(-1===this.selectedIndex){this.selected=null;this.options.autopopulateHighlighted&&this.query&&(this.source.value=this.query);this.options.selectInputText&&this.source.select(false)}else{this.selected=this.items[this.selectedIndex];e.addClass(this.selected,"selected");this.options.autopopulateHighlighted&&this.results&&(this.source.value=this.options.resolveSelection(this.results[this.selectedIndex]))}};var s=function(U,S,Q,af,W,ac,ae,ab,T,aa,ag,X,R,Y,Z,P,V){var ad={uiOrigin:ag,global:aa>1?false:true,scope:aa>1?aa:undefined,fromHistory:Y,hadHistory:Z,type:S,value:af,eventType:U,source:ag,startTime:X,action:"RECORD",selDepth:W,totalNum:ac,userInteractionType:ab,errors:T,query:R,dataType:Q};if(P){ad=P(ad,V)}new Request({method:"GET",url:"/TypeAheadJson",data:ad,onSuccess:ae,onFailure:ae}).send()};var l=function(){if(!this.startNotificationSent){this.startNotificationSent=true;var P=new Date();this.options.startTime=P.getTime()+(P.getTimezoneOffset()*60*1000);var Q=this.options.geoId;var R=this.options.name;new Request({method:"GET",data:{action:"RECORD",eventType:"start",uiOrigin:this.options.name,startTime:this.options.startTime,source:R,global:Q?false:true,hadHistory:this.options.recentHistory.length>0,scope:Q},url:"/TypeAheadJson"}).send()}};var B=function(P){if(this.hasDefaultText()&&this.options.clearDefaultTextOnFocus===true){e.removeClass(this.source,this.options.defaultTextClass);this.source.value=""}c.call(this);if(!this.autoFocusing){if(this.options.onUserFocus){this.options.onUserFocus(this)}this.options.showOnFocus&&this.show();if(this.options.restoreOnFocus){this.restore()}if(this.options.showOnFocus&&this.query&&!this.results&&!this.error&&g.call(this)){this.search()}if(this.options.jpFirefoxIME){O.call(this)}this.showHistoryIfEnabled()}if(this.options.startEventOn==="focus"){l.call(this)}this.autoFocusing=false};var O=function(){if(this.source==document.activeElement){var P=function(){F.call(this);if(this.jpTypeAheadTimerId){clearTimeout(this.jpTypeAheadTimerId)}this.jpTypeAheadTimerId=setTimeout(P.bind(this),this.options.jpFirefoxIMEInterval)};P.call(this)}};var t=function(R,P){if(this.checkMenuInteraction()){return}this.hide();var Q=this.tabPressed;this.tabPressed=false;if(!this.options.restoreOnFocus&&!this.query){this.results=null;this.error=null;this.setSelectedIndex(-1);this.selected=null;this.items=[];this.container&&this.container.empty()}this.options.selectOnBlur&&-1!==this.selectedIndex&&this.select(Q,Q?r:undefined);if(this.options.assumeOnBlur&&-1===this.selectedIndex&&this.results&&this.results.length){if(typeof this.options.assumeOnBlur=="function"){this.setSelectedIndex(this.options.assumeOnBlur(this))}else{this.setSelectedIndex(0)}L.call(this);this.select(Q,Q?r:undefined)}if(this.source&&this.source.value===""){this.source.value=this.options.defaultValue;if(this.options.defaultTextClass){e.addClass(this.source,this.options.defaultTextClass)}}if(this.options.onUserBlur){this.options.onUserBlur(this)}if(this.jpTypeAheadTimerId){clearTimeout(this.jpTypeAheadTimerId)}};var a=function(R){var Q=R.target;if(Q.getParent(this.options.itemSelector)){Q=Q.getParent(this.options.itemSelector)}if(this.selected&&this.selected===Q){return}for(var P=this.items.length-1;P>=0;P--){if(this.items[P]===Q){this.setSelectedIndex(P);L.call(this);return}}};var f=function(P){c.call(this)};var x=function(){var P=this.source.tabIndex,R;if(false===this.options.nextField){return}if(this.options.nextField){if(typeof this.options.nextField==="string"){this.options.nextField=e.find(this.options.nextField)}else{if(typeof this.options.nextField==="function"){R=this.options.nextField(this)}else{R=this.options.nextField}}}if(false===R){return}if(!R&&P){P=parseInt(P,10)+1;R=e.find("[tabindex="+P+"]",this.source.form)}if(!R){for(var Q=this.source.form.elements.length-1;Q>=0;Q--){var S=this.source.form.elements[Q];if(this.source===S){R=this.source.form.elements[Q+1];break}}}R&&R.focus()};var p=function(){this.options.syncro&&this.options.syncro.sync(this,{query:this.query,value:this.source.value,result:this.selectedIndex>=0&&this.results[this.selectedIndex]})};var N=function(){(document.activeElement===this.source&&!this.aborted&&this.show())||t.call(this)};var h=function(S,R){this.setSource(S);var V=false;this.checkMenuInteraction=function(){return V};if(!K.containerParent){K.containerParent=document.body}this.options=e.extend({},K,R);if(!this.options.recentHistory){this.options.recentHistory=[]}else{this.applyOptionsToHistoryList()}this.historyShown=false;this.setSelectedIndex(-1);this.selected=null;this.visible=false;this.lastSuccessfulQuery="";this.source.autocomplete="off";if(!this.options.defaultValue&&this.options.defaultValue!=""){this.options.defaultValue=this.source.getAttribute("data-defaultValue")||this.source.defaultValue}if(!this.options.minHistoryChars){this.options.minHistoryChars=this.options.minChars}this.handlers={keyup:e.bind(b,this),focus:e.bind(B,this),blur:e.bind(t,this),click:e.bind(f,this)};this.handlers[e.checkBrowser("ie","safari","chrome")?"keydown":"keypress"]=e.bind(j,this);for(var T in this.handlers){e.addEvent(this.source,T,this.handlers[T])}this.source.addListener("paste",e.bind(H,this));this.source.addListener("cut",e.bind(H,this));var U="position: absolute; top: -999em;";if(e.find("body").hasClass("rtl")){U+="; right: -999em"}else{U+="; left: -999em"}this.container=e.createElement("div",{"class":this.options.containerClass,style:U});this.options.containerParent.appendChild(this.container);var Q=function(Z){V=false;if(!this.visible){return}var Y=e.getPosition(this.container),X=e.getSize(this.container);if(Z.clientX>=Y.x&&Z.clientX<=Y.x+X.x&&Z.clientY>=Y.y&&Z.clientY<=Y.y+X.y){return}this.setSelectedIndex(-1);L.call(this)};var P=function(X){V=true;X.stopPropagation();X.preventDefault()};var W=function(X){V=false;X.stopPropagation();X.preventDefault();this.select(true,d);x.call(this)};this.containerHandlers={mouseout:e.bind(Q,this),mousedown:e.bind(P,this),click:e.bind(W,this)};for(T in this.containerHandlers){e.addEvent(this.container,T,this.containerHandlers[T])}if(true===this.options.width){this.container.style.width=e.getSize(this.source).x+"px"}e.bindAll(this,"cleanUp","show","hide","processResults","renderResults","renderError");this.options.syncro&&this.options.syncro.add(this);if(this.options.showOnFocus&&document.activeElement===this.source){if(this.hasDefaultText()){if(this.options.clearDefaultTextOnFocus===true){e.removeClass(this.source,this.options.defaultTextClass);this.source.value=""}else{e.addClass(this.source,this.options.defaultTextClass)}}if(this.source.value!==this.options.defaultValue&&g.call(this)){if(this.source.value!==this.query){this.highlightResult=this.source.value}this.query&&(this.source.value=this.query);this.search()}}if(!Browser.ie11){if(window.onpagehide||null===window.onpagehide){window.addEventListener("pagehide",this.cleanUp,false)}else{e.addEvent(window,Browser.ie?"unload":"beforeunload",this.cleanUp)}}if(this.options.jpFirefoxIME){O.call(this)}if(this.options.startEventOn==="creation"){l.call(this)}if(this.options.focusOnCreation===true){this.autoFocusing=true;this.source.focus()}};h.prototype.setGeoId=function(P){this.options.geoId=P;this.clearCache();this.lastSuccessfulQuery=""};var D=function(P){return P&&P.replace(/\s+/g," ")};h.prototype.setSource=function(P){if(!this.source){this.source=P}};h.prototype.getNormalizedQuery=function(){if(this.query){return D(this.query)}else{return this.query}};h.prototype.reset=function(){if(this.options.defaultTextClass){e.addClass(this.source,this.options.defaultTextClass)}e.removeClass(this.source,this.options.errorClass);this.error=null;this.container&&this.render("");this.source.value=this.options.defaultValue||""};h.prototype.getChosenResult=function(){var Q=null;if(this.source&&this.source.value&&this.results){var S=this.source.value;for(var R=0;R<this.results.length;R++){var P=this.results[R];if(S.toLowerCase()===ta.util.string.stripHTMLFromText(P.name).toLowerCase()){Q=P;break}}}return Q};h.prototype.clearResults=function(){this.query="";this.render("")};h.prototype.search=function(Q,U){this.selected=null;this.setSelectedIndex(-1);this.query=this.source.value;var S=this.getNormalizedQuery();this.aborted=false;if(this.options.cacheResults&&this.resultsCache&&this.resultsCache[S]){this.processResults(this.resultsCache[S],true);if(false!==Q){N.call(this)}U&&U()}else{var T;if(this.query.length<=this.options.queryLengthLimit){if(this.options.search){T=this.options.search(this.query,this)}else{T=E.call(this,this.query)}}else{var P=ta.util.Deferred();var R={results:[],query:{query:this.query}};P.resolve(R);T=P.promise()}if(this.options.postResultsFn){T=T.success(this.options.postResultsFn)}if(this.options.integrateHistory){T=T.success(this.integrateHistoryIntoResults.bind(this))}T=T.success(this.processResults).failure(this.renderError);if(false!==Q){T.always(e.bind(N,this))}U&&T.always(U)}};h.prototype.processResults=function(V,R){var U=this.options.itemTemplate,Q=this;R=this.options.forceProcessResults||R;var P=!!V.results;if(!P){V={results:V,query:{query:this.query}}}var S=V.results;if(this.options.cacheResults&&P){var T=D(V.query&&V.query.query?V.query.query:this.getNormalizedQuery());if(!this.resultsCache){this.resultsCache={}}this.resultsCache[T]=V}if(R||this.getNormalizedQuery()!==D(this.lastSuccessfulQuery)){this.results=S;this.error=null;this.setSelectedIndex(-1);if(this.options.autoHighlightFirst){this.setSelectedIndex(0)}S.forEach(function(X,W){X.index=W;X.rendered=U(X);if(Q.highlightResult&&Q.highlightResult===Q.options.resolveSelection(X)){Q.setSelectedIndex(W)}if(Q.options.onProcessResult){Q.options.onProcessResult(X,W,Q)}})}this.renderResults(V,null,R)};h.prototype.renderResults=function(V,S,R){if(R||this.getNormalizedQuery()!==D(this.lastSuccessfulQuery)){var Q=this;var U=V.results?V.results:V;this.lastSuccessfulQuery=V.query&&V.query.query?V.query.query:null;e.removeClass(this.container,this.options.errorClass);e.removeClass(this.source,this.options.errorClass);var P=this.options.listTemplate(V);if(S){var W=new Element("div");var T=[Elements.from(this.options.errorTemplate(S))];if(typeOf(P)=="string"){P=Elements.from(P)}T.push(P);T.flatten();W.adopt(T);P=W}this.render(P);this.items=e.select(this.options.itemSelector,this.container);this.items.forEach(function(X){e.addEvent(X,"mouseover",e.bind(a,Q))});if(this.selectedIndex>=0){L.call(this)}else{this.options.autoSelectFirst&&this.highlightNextChoice()}this.options.onRender&&this.options.onRender(this,U)}};h.prototype.setSelectedIndex=function(P){this.selectedIndex=P;if(this.options&&this.options.onSetSelectedIndex){this.options.onSetSelectedIndex(P,this)}};h.prototype.renderError=function(P,Q){if(Q&&this.results){this.renderResults(this.results,P)}else{this.results=null}this.error=P;e.addClass(this.container,this.options.errorClass);e.addClass(this.source,this.options.errorClass);!Q&&this.render(this.options.errorTemplate(P));this.options.onError&&this.options.onError(this,P)};h.prototype.render=function(P){if(!this.container){return}if(typeOf(P)=="string"){this.container.innerHTML=P}else{if(typeOf(P)=="element"){this.container.empty();this.container.appendChild(P)}}};h.prototype.show=function(){if(!this.container||this.visible||!this.container.childNodes.length){return this}var Q=e.getPosition(this.source),P=e.getSize(this.source);if(this.options.positionRelative){if(e.find("body").hasClass("rtl")){this.container.style.right="auto"}else{this.container.style.left=(this.options.offsetX||0)+"px"}this.container.style.top=(P.y+(this.options.offsetY||0))+"px"}else{this.container.style.right="auto";this.container.style.left=Q.x+(this.options.offsetX||0)+"px";this.container.style.top=(Q.y+P.y+(this.options.offsetY||0))+"px"}this.visible=true;this.options.onShow&&this.options.onShow(this);return this};h.prototype.hide=function(){if(!this.visible||!this.container){return false}if(e.find("body").hasClass("rtl")){this.container.style.right="-999em"}else{this.container.style.left="-999em"}this.container.style.top="-999em";this.visible=false;this.options.onHide&&this.options.onHide(this);return this};h.prototype.highlightNextChoice=function(){G.call(this,1)};h.prototype.hightlightPreviousChoice=function(){G.call(this,-1)};h.prototype.select=function(S,Q){this.hide();if(this.selectedIndex<0||!this.results){return}this.source.value=this.options.resolveSelection(this.results[this.selectedIndex]);if(this.error){e.removeClass(this.container,this.options.errorClass);e.removeClass(this.source,this.options.errorClass);this.error=null;this.renderResults(this.results)}var T;if(this.options.onSelect){var T=this.options.onSelect.bind(this.options,this.results[this.selectedIndex],this.source.value,this,S,Q)}if(S){var P=this.results[this.selectedIndex];var U=0;if(this.results){U=this.results.length}var W=this.lastSuccessfulQuery?this.lastSuccessfulQuery:this.query;var R=P.scope=="history";var V=this.options.loggingOverride;if(V){V=V.bind(this)}if(P.type==="SEARCH"){s("search_bttn",P.type,P.data_type,undefined,undefined,undefined,T,Q,null,this.options.geoId,this.options.name,this.options.startTime,W,R,this.historyShown,V,P)}else{s("select",P.type,P.data_type,P.value,this.selectedIndex+1,U,T,Q,null,this.options.geoId,this.options.name,this.options.startTime,W,R,this.historyShown,V,P)}}else{if(T){T()}}p.call(this);return this};h.prototype.restore=function(){this.query&&this.query.length&&(this.source.value=this.query);this.setSelectedIndex(-1);if(this.selected){e.removeClass(this.selected,"selected");this.selected=null}this.options.onRestore&&this.options.onRestore(this.query);p.call(this);return this};h.prototype.sync=function(R){var P=this;if(this.query&&this.query!==R.query){this.results=null;this.error=null}this.query=R.query;R.value&&(this.source.value=R.value);this.setSelectedIndex(-1);this.selected&&e.removeClass(this.selected,"selected");var Q=function(){if(P.results&&P.results.length){var S=P.results.some(function(U,T){if(P.options.equal(U,R.result)){P.setSelectedIndex(T);return true}return false});if(!S&&P.options.assumeOnBlur){P.setSelectedIndex(0)}if(P.selectedIndex>=0){P.selected&&e.removeClass(P.selected,"selected");P.selected=P.items[P.selectedIndex];e.addClass(P.selected,"selected");P.source.value=P.options.resolveSelection(P.results[P.selectedIndex]);P.options.onSelect&&P.options.onSelect(P.results[P.selectedIndex],P.source.value,P,false)}}P.options.onSync&&P.options.onSync(P.query,P.source.value,P.selectedIndex>=0&&P.results[P.selectedIndex])};if(!this.results){this.query&&(this.source.value=this.query);this.search(false,Q)}else{Q()}};h.prototype.cleanUp=function(){this.container=null;this.item=null;this.selected=null;this.source=null;this.setSelectedIndex(-1);this.query=null;this.historyShown=false;this.results=null;this.error=null;this.clearCache()};h.prototype.clearCache=function(){this.resultsCache=null};h.prototype.abortSearch=function(){this.aborted=true};h.prototype.hasDefaultText=function(){return this.source&&this.source.value===this.options.defaultValue};h.prototype.integrateHistoryIntoResults=function(T){var U=T.results||T;var W=(T.query&&T.query.query)||this.query;var Y=false;if(T.normalized&&T.normalized.query){W=T.normalized.query;Y=true}var ad=U.getLast();if(ad&&ad.type=="SEARCH"){U.length-=1}else{ad=null}var Q=this.getHistoryMatchingQuery(W,Y);var aa=Q.length;var R={};var Z=[];for(var S=0;S<Q.length;S++){var ab=Q[S];R[ab.value]=S}for(var S=0;S<U.length;S++){var X=U[S];if(X.data_type!="LOCATION"||!(X.value in R)){Z.push(X)}else{var P=R[X.value];X.scope="history";Q[P]=X;aa--}}var V=Q.concat(Z);if(V.length>U.length&&V.length>this.options.maxResults){V.length=U.length}if(ad){V.push(ad)}if(T.results){T.results=V}else{T=V}var ac=ta.util.Deferred();ac.resolve(T);if(Q.length>0){this.historyShown=true}return ac.promise()};h.prototype.getHistoryMatchingQuery=function(V,W){if(V&&V.length<this.options.minHistoryChars){return[]}var S=new RegExp("^"+V,"i");var U=this.options.recentHistory;var Q=[];var R=function(Y){return"<b>"+Y+"</b>"};for(var T=0;T<U.length&&Q.length<this.options.maxHistoryItems;T++){var X=U[T];if(!X||X.value==this.options.geoId){continue}var P=X.name;if(W){P=X.normalized_name}if(P&&P.match(S)){if(this.options.highlightHistory){X=e.extend({},X);X.name=X.name.replace(S,R)}Q.push(X)}}return Q};h.prototype.applyOptionsToHistoryList=function(V){var S=[];var P;var R;var U;for(var T=0;T<this.options.recentHistory.length;T++){P=this.options.recentHistory[T];P=e.extend({},P);if(!this.options.historyTypes.contains(P.type.toLowerCase())){continue}P.scope="history";R=P.url;if(P.urls){for(var Q=0;Q<P.urls.length;Q++){U=P.urls[Q];if(U.url_type==this.options.historyLinkType){R=U.url;break}}}P.url=R;if(this.options.historyPredicate&&!this.options.historyPredicate(P)){continue}S.push(P)}this.options.recentHistory=S};h.prototype.shouldShowHistory=function(){var P=this.options.showOnFocus&&this.options.showHistory;var R=!!this.query&&this.query.length>0;var Q=this.options.recentHistory.length>0;return P&&!R&&Q};h.prototype.getSearchParams=function(){if(this.options.searchParams){if(typeof this.options.searchParams==="function"){return this.options.searchParams(this)}else{return this.options.searchParams}}else{return{}}};h.prototype.showHistoryIfEnabled=function(){if(!this.shouldShowHistory()){return}var P=this.options.recentHistory.slice(0,this.options.maxHistoryItems);var Q={results:P};this.processResults(Q,true);this.restore();this.show()};h.prototype.injectHistory=function(R,P){R.scope="history";var Q=this.options.recentHistory.length;if((!P&&P!=0)||P<0||P>Q){P=Q}this.options.recentHistory.splice(P,0,R);return R};h.prototype.removeHistory=function(P){this.options.recentHistory.splice(P,1)};h.prototype.clearHistory=function(){this.options.recentHistory=[];this.clearCache()};return h}(api));(function(d){var b={GEO:"sprite-typeahead-destination",HOTELOVERVIEW:"sprite-typeahead-destination",HOTEL:"sprite-typeahead-hotel",ATTRACTION:"sprite-typeahead-attraction",EATERY:"sprite-typeahead-restaurant",VACATION_RENTAL:"sprite-typeahead-hotel",FLIGHTS_TO:"sprite-typeahead-flight"};function e(f){return f.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00A0/g,"&nbsp;").replace(/"/g,"&quot;")}d.views||(d.views={});var a=function(h,g){var f={};var j=[];Array.each(h,function(k){var l=k.type;f[l]=f[l]||[];f[l].push(k)});Array.each(g,function(l){var m=f[l];if(m){for(var k=0;k<m.length;k++){j.push(m[k])}}});return j};d.views.configTypeAheadOptionsForSortingByPOIType=function(g,f){g.postResultsFn=function(j){var h=ta.util.Deferred();j.results=a(j.results,f);h.resolve(j);return h.promise()};g.listTemplate=function(k){var j=k.results;var h=[];if(j.length>0){h.push("<ul>");Array.each(j,(function(){var m="";return function(o){if(m!=o.type){m=o.type;var n=[o.rendered];n.push('<span class="label">');n.push(o.title);n.push('<img src="/img2/x.gif" class="icon hidden" alt="">');n.push("</span>");o.rendered=n.join("")}}})());var l=(function(){var m="";var n=document.createElement("div");var o=l;return function(q){var p='<li class="typeahead-choice '+e(q.title.toLowerCase())+'">'+q.rendered+"</li>";if(m!=q.type){m=q.type;n.innerHTML=p;n.firstChild.addClass("first");p=n.innerHTML}return p}})();h.push(j.map(l).join(""));h.push("</ul>")}return h.join("")}};d.views.itemTemplate=function(){return function(g){var k=[];var l=b[g.type];if(g.data_type&&g.data_type.toUpperCase()==="FLIGHTS_TO"){l=b(g.data_type)}if(l){var f="sprite-image "+l;if(g.data_type&&(g.data_type.toUpperCase()==="LIST_PAGE"||g.data_type.toUpperCase()==="BLENDER_PAGE")){f+="-list"}k.push('<div class="'+f+'"></div>')}var j=g.details||g;var h=e(j.name||"");var m=e(j.geo_name||"");var n="poi-name";if(!m){n+=" no-geo"}k.push('<span class="'+n+'">'+h+"</span>");k.push('<span class="geo-name">'+m+"</span>");k.push();return k.join("")}};var c=function(h){var j=[];var k=[];var g=[];var f;Array.each(h,function(l){if(l.type&&l.type.toUpperCase()==="SEARCH"&&l.name){f=l}else{if(l.scope=="history"){g.push(l)}else{if(l.scope=="local"){k.push(l)}else{j.push(l)}}}});return{globalResults:j,localResults:k,historyResults:g,searchResult:f}};d.views.configureTypeAheadForSegmentedResults=function(h,g){var f=g||{};h.postResultsFn=function(l){var q=ta.util.Deferred();var m=l.results;var k=c(m);var r=k.searchResult;var p=k.globalResults;var o=k.localResults;var j=k.historyResults;var n=j.concat(o).concat(p);if(r){n.push(r)}l.results=n;q.resolve(l);return q.promise()};h.listTemplate=function(l){var n=[];var m=l.results;var k=c(m);var r=false;var s=false;var o="";var p=!l.query&&k.localResults.length===0&&k.globalResults.length===0;if(k.historyResults.length>0&&(!p||f.historyOnEmpty)){r=true;if(f.historyLabel){n.push('<div class="title history">'+f.historyLabel+"</div>")}n.push('<ul class="resultContainer">');Array.each(k.historyResults,function(t){n.push("<li>");n.push(t.rendered);n.push("</li>")});n.push("</ul>")}if(!p&&f.localLabel&&(k.localResults.length>0||f.noResultsMessage)){s=true;n.push('<div class="title local">'+f.localLabel+"</div>")}if(k.localResults.length>0){s=true;n.push('<ul class="resultContainer">');Array.each(k.localResults,function(t){n.push("<li>");n.push(t.rendered);n.push("</li>")});n.push("</ul>")}else{if(s){n.push('<div class="no-results">'+f.noResultsMessage+"</div>")}}if(k.globalResults.length>0){if(f.globalLabel&&(s||r)){n.push('<div class="title global">'+f.globalLabel+"</div>")}n.push('<ul class="resultContainer">');Array.each(k.globalResults,function(t){n.push("<li>");n.push(t.rendered);n.push("</li>")});n.push("</ul>")}if(k.searchResult){var q=l.query&&l.query.query;var j="search resultContainer";if(k.searchResult.noResults){j+=" noResults"}n.push('<ul class="'+j+'"><li class="searchRow">'+e(k.searchResult.name.replace("%",q))+" &raquo;</div></li></ul>")}return n.join("")};return f}}(TypeAhead));ta.common.header=(function(){var e=(function(h){var k=function(l){l.focus();setTimeout(function(){if(document.activeElement!=l){l.focus()}},200)};var g=function(o){var l=new Element("div",{"class":"displayContainer"});for(var n=0;n<o.length;n++){var m=o[n];l.appendChild(f(m))}return l};var f=function(o){if(o.title){var q=new Element("div",{"class":o.classes});q.appendText(o.title);return q}var r=function(u,v){if(typeOf(v)=="element"){u.appendChild(v)}else{u.appendText(v)}};var m="displayItem ";if(o.classes){m+=o.classes}var s=new Element("div",{"class":m});if(o.leftIconClass){var n=new Element("div",{"class":o.leftIconClass+" leftIcon"});s.appendChild(n)}if(o.primaryText){var p=new Element("span",{"class":"primaryText"});r(p,o.primaryText);s.appendChild(p)}var t;if(o.secondaryText){t=new Element("span",{"class":"secondaryText"});r(t,o.secondaryText);s.appendChild(t)}else{p.addClass("noSecondaryText")}if(o.rightIconClass){var l=new Element("div",{"class":o.rightIconClass+" rightIcon"});s.appendChild(l)}if(o.onClick){h.addEvent(s,"click",o.onClick)}return s};var j=function(l){this.geoScopeInput=new Element(l.geoScopeInput);this.geoScopeLabel=new Element(l.geoScopeLabel);ta.removeClass(this.geoScopeInput,"focusClear");this.geoScopeFormElement=new Element(l.geoScopeFormElement);this.staticSearchInput=new Element(l.staticSearchInput);this.geoScopeTypeahead=l.geoScopeTypeAhead;this.staticSearchTypeAhead=l.staticSearchTypeAhead;this.options=l;this.geoInfo=null;this.savedGeoCount=0;this.clearGeoInfo();this.firstFocusTrigger=false};j.prototype.renderItem=function(l){return f(l)};j.prototype.renderList=function(l){return g(l)};j.prototype.clearGeoInfo=function(){this.setGeoInfo(1,"","")};j.prototype.saveGeoInfo=function(){var p=this.geoInfo;if(!p||p.geoID==1){return}var s=this.geoScopeTypeahead.options.recentHistory;var o=s.length;for(var n=0;n<o;n++){if(s[n].value==p.geoID){this.geoScopeTypeahead.removeHistory(n);break}}var q=this.geoScopeTypeahead.injectHistory({name:p.geoName,type:"geo"},1);q.value=p.geoID;q.details={name:q.name,geo_name:p.parentName};var r=[];for(var l in p.categories){var m=p.categories[l];r.push({type:l,url:m})}q.urls=r;this.savedGeoCount+=1};j.prototype.setGeoInfo=function(o,s,r,n){var q=this.geoInfo&&this.geoInfo.getId;var p={geoID:o,geoName:s,parentName:r,categories:{}};for(var m in n){var l=n[m];if(l.url){p.categories[m]=l}}this.geoInfo=p;this.refreshGeoInfo(q!=o)};j.prototype.refreshGeoInfo=function(p){var n=this.geoInfo;if(!n){return}this.staticSearchTypeAhead.options.viewOptions.historyLabel=null;this.staticSearchTypeAhead.options.viewOptions.globalLabel=null;this.staticSearchTypeAhead.options.viewOptions.localLabel=null;this.geoScopeTypeahead.clearResults();var o=this.staticSearchTypeAhead;var l=function(r,v){var s=n.categories[r];if(!s){return}var q=v.replace("%",n.geoName);var t=o.injectHistory({name:q,type:r,details:{name:q}});t.url=s.url;t.data_type="LOCATION";var u=d(n.geoName);u=v.replace("%",u);u="<span>"+u+"</span>";u=Elements.from(u);t.scoped_render=u[0]};var m=function(r,x){var t=0;var u=r.options.recentHistory;var s=u.length;var v=r.options.maxHistoryInjections;for(var w=0;w<s&&t<v;w++){var z=u[w];var q=z.details&&z.details.parent_ids&&z.details.parent_ids.contains(n.geoID);if(!x||q){var y=r.staticSearchTypeAhead.injectHistory(z);y.realHistory=true;t+=1}}};if(n.geoID!=1){this.staticSearchTypeAhead.options.scopeFilter="global";this.staticSearchTypeAhead.container.removeClass("global");this.staticSearchTypeAhead.container.addClass("scoped");this.setGeoScopeInputText(this.geoInfo.geoName+", "+this.geoInfo.parentName);this.geoScopeFormElement.set("value",this.geoInfo.geoID);if(p){this.staticSearchTypeAhead.setGeoId(this.geoInfo.geoID);this.staticSearchTypeAhead.clearHistory();l("GEO",this.options.translations.poi_overview_geo);l("HOTEL",this.options.translations.poi_hotels_geo);l("VACATION_RENTAL",this.options.translations.poi_vr_geo);l("ATTRACTION",this.options.translations.poi_attractions_geo);l("EATERY",this.options.translations.poi_eat_geo);l("FLIGHTS_TO",this.options.translations.poi_flights_geo);m(this,true)}}else{this.staticSearchTypeAhead.container.addClass("global");this.staticSearchTypeAhead.container.removeClass("scoped");this.staticSearchTypeAhead.options.scopeFilter=null;this.setGeoScopeInputText(this.options.translations.all_of_trip);this.geoScopeFormElement.set("value",null);this.staticSearchTypeAhead.options.viewOptions.localLabel=null;if(p){this.staticSearchTypeAhead.setGeoId(null);this.staticSearchTypeAhead.clearHistory();m(this,false)}}if(p){this.staticSearchTypeAhead.clearCache()}};j.prototype.startGeoSearch=function(l){if(l){k(this.geoScopeInput)}this.setGeoScopeInputText("");this.options.pageDimmerOverlay.show();if(!this.firstFocusTrigger){this.firstFocusTrigger=true;this.geoScopeTypeahead.showHistoryIfEnabled()}};j.prototype.stopGeoSearch=function(){if(this.geoScopeTypeahead.selected){return}if(this.geoInfo){this.geoScopeLabel.show();this.refreshGeoInfo()}};j.prototype.startStaticSearch=function(l){if(l){k(this.staticSearchInput)}this.options.pageDimmerOverlay.show();if(!this.firstFocusTrigger){this.firstFocusTrigger=true;this.staticSearchTypeAhead.showHistoryIfEnabled()}};j.prototype.stopStaticSearch=function(){};j.prototype.setGeoScopeInputText=function(l){this.geoScopeInput.set("value",l)};j.prototype.setStaticSearchInputText=function(l){this.staticSearchInput.set("value",l)};return j}(api));var a=function(g,h,m){if(!ta){return true}var l="";var f="";var j=ta.retrieve("ta_scoped_typeahead_search");if(j&&j.geoInfo.geoID>1){l=j.geoScopeTypeahead.source.value;f=j.staticSearchTypeAhead.getNormalizedQuery()}else{if(m){l=m;f=""}}var k=ta.id("mainSearch");var n=ta.id("TYPEAHEAD_REDIRECT");if(l&&!f&&k&&n){k.value=l;n.value="true";k.removeClass("focusClear")}return ta.call("ta.common.search.recordAndValidate",g,h)};var b=function(l,j,m){var k=document.getElement(".navSrchLang")?293:308;var h={duration:200,property:"width"};if(m){h.onComplete=m}new Fx.Tween(j,h).start(k);if(document.body.hasClass("tablet_typ_v2")){var f=6;var g=200;window.scroll.pass([window.scrollX,ta.id(j).getPosition().y-f]).delay(g)}};var d=function(f){return f.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00A0/g,"&nbsp;").replace(/"/g,"&quot;")};var c=function(g,f){setTimeout(function(){new Fx.Tween(f,{duration:150,property:"width"}).start(175)},200)};return{createNavMenu:function(g,f){f=f||{};g.hoverIntent({over:function(j){if(f.initFn){var h=false;if(!h){f.initFn();h=true}}this.getElement(".subNav").show();if(f.showFn){f.showFn.call(null,j)}},out:function(h){this.getElement(".subNav").hide();if(f.hideFn){f.hideFn.call(null,h)}},timeout:f.timeout||500})},clear:function(g,f){f=ta.id(f);f.value="";f.removeClass("hasDefault");f.removeEvent("focus","ta.common.header.clear")},clearIfEquals:function(h,f,g){if(f.value==g){ta.run("ta.common.header.clear",{},h,f)}},addClearParam:function(f){if(typeof document.cookie!=="undefined"&&document.cookie&&document.cookie.indexOf("TASession")>=0){if(ta.hac&&ta.hac.filters&&ta.hac.filters.cancelAllExistingHAC){ta.hac.filters.cancelAllExistingHAC()}var g="?";if(typeof f!=="undefined"&&f&&typeof f.href!=="undefined"&&f.href&&f.href.indexOf("clearFilters=true")<=-1){if(f.href.indexOf("?")>-1){g="&"}f.href+=g+"clearFilters=true"}}},setSearchText:function(j,g,h){g=ta.id(g);var f=g.getParent().getNext("input");f.value=h;f.addClass("hasDefault");f.addEvent("focus",function(k){ta.call("ta.common.header.clear",k,f)})},changeSearchType:function(n,g,l){g=ta.id(g);var j=g.getParent("form"),f=g.getParent().getNext("input"),k=f.getParent().getNext(),m=f.retrieve("nameTA"),h=f.retrieve("geoTA");ta.run("ta.common.header.setSearchText",{},n,g,l);if(g.id=="dropGeoRadio"){if(m){m.pause()}if(h){h.resume()}else{if(!ta.retrieve("hotelGeoTA")){ta.store("hotelGeoTA",true);ta.run("ta.widgets.typeahead.factory.location_mutable",{onComplete:function(o){f.store("geoTA",o)}},n,f,"GEO",function(){},{minLength:3})}}j.action="/HACSearch";k.show()}else{if(h){h.pause()}if(m){m.resume()}else{if(!ta.retrieve("hotelNameTA")){ta.store("hotelNameTA",true);ta.run("ta.widgets.typeahead.factory.standard_mutable",{onComplete:function(o){f.store("nameTA",o)}},n,f,"LOCATION","ta.widgets.typeahead.events.onSelectHotelDrop",{minLength:3,xargs:"&types=hotel"})}}j.action="/Search";k.hide()}},createDrop:function(h,f){f=ta.id(f);var g=f.getNext().getElement(".subNav");ta.run("ta.overlays.Factory.createDropDown",{},h,f,g)},firstClickHotelText:function(l,g,k){g=ta.id(g);var j=g.getParent("form"),f=ta.id("dropGeoRadio"),h=ta.retrieve("hotelNameTA");hasGeoTA=g.retrieve("hotelGeoTA");if(f.checked){if(!hasGeoTA){ta.store("hotelGeoTA",true);ta.run("ta.widgets.typeahead.factory.location_mutable",{onComplete:function(m){g.store("geoTA",m)}},l,g,"GEO",function(){},{minLength:3})}}else{if(!h){ta.store("hotelNameTA",true);ta.run("ta.widgets.typeahead.factory.standard_mutable",{onComplete:function(m){g.store("nameTA")}},l,g,"LOCATION","ta.widgets.typeahead.events.onSelectHotelDrop",{minLength:3,xargs:"&types=hotel"})}}ta.run("ta.common.header.clear",{},l,g);g.removePropertyEvent("focus","ta.common.header.firstClickHotelText")},submitAndSetPid:function(h,g,f){setPID(f);form=g.getParent("form");if(f&&f==18898&&ta.id("dropVracGeo").value==""){window.location="/Rentals"}else{form.submit()}},submitHotelsForm:function(j,g,f){setPID(f);form=g.getParent("form");if(ta.has("useHotelsFilterState")){var h=form.toQueryString();new Request({url:"/FilterState",data:h,method:"post",onSuccess:function(k){ta.widgets.calendar.redirectToHotelOverview(k)},onFailure:function(k){ta.widgets.calendar.redirectToHotelOverview(null)}}).send()}else{form.submit()}},showFriendsOverlay:function(){var g=ta.id("FRIENDSTAB");var h=new ta.overlays.RelativeOverlayBelow({showCloseButton:true,showArrow:true,arrowClass:"ttarrow",activate:ta.overlays.ACTIVATE_BOTH,style:"fbtt"},g);ta.store("friendsToolTip",h);if(ta.retrieve("friends_1st_resize")){var f=false;window.addEvent("resize",function(){if(!f){f=true}else{ta.common.header.hideFriendsToolTip(true)}})}else{window.addEvent("resize",function(){ta.common.header.hideFriendsToolTip(true)})}},checkFriendsToolTip:function(){if(!ta.util.localstorage||!ta.util.localstorage.canUseLocalStore()){return}var g=false;try{var f="taFriendsToolTipShown";if(!localStorage.getItem(f)){localStorage.setItem(f,true);g=true}}catch(j){ta.util.error.record(j,"checkFriendsToolTip - localStorage",null,{},"WARN")}if(g){var h=ta.id("COOKIE_BANNER");if(!ta.overlays||!ta.overlays.RelativeOverlayBelow){if(typeof(taExtraOverlayJs)!="undefined"){new Asset.javascript(taExtraOverlayJs,{onload:ta.common.header.showFriendsOverlay})}}else{if(typeof(h)!="undefined"&&h){ta.common.header.showFriendsOverlay.delay(2000)}else{ta.common.header.showFriendsOverlay()}}}},hideFriendsToolTip:function(g){var f=ta.retrieve("friendsToolTip");if(f){f.hide();window.removeEvent("resize",ta.common.header.hideFriendsToolTip)}var h=ta.id("FRIENDSTAB");if(h&&(typeof(g)=="undefined"||(g!=true))){h.addClass("hidenew")}},seeMoreOnToDoList:function(m,h,k){m.stopPropagation();var l=h.getParent("#WAR_MORE_TO_DO_ITEMS");if(l){var f=l.getChildren();if(f&&f.length>0){var g;var j=false;Array.each(f,function(q){if(q.getProperty("id")=="WAR_ADD_A_LISTING"){return}var o=q.getChildren();if(q.getProperty("id")!=k){if(j){if(o&&o.length>0){Array.each(o,function(r){if(!r.hasClass("warHeader")){r.addClass("hidden")}})}var p=q.getElement(".warHeader img.downarrow");var n=q.getElement(".warHeader img.rightarrow");if(p&&n){p.addClass("hidden");n.removeClass("hidden")}}}else{if(o&&o.length>0){Array.each(o,function(r){if(r.getProperty("id")=="warMore"){r.addClass("hidden")}else{r.removeClass("hidden")}})}j=true}})}}},seeLessOnToDoList:function(m,k,j){m.stopPropagation();var g=k.getParent("#WAR_MORE_TO_DO_ITEMS");if(g){var f=g.getChildren();if(f&&f.length>0){var h;var l=false;Array.each(f,function(p){var o=p.getChildren();if(p.getProperty("id")!=j){if(l){ta.common.header.openWARToDoListSection(p)}}else{var n=0;if(o&&o.length>0){Array.each(o,function(q){if(q.getProperty("id")=="warMore"){q.removeClass("hidden")}if(q.getProperty("id")=="warLess"){q.addClass("hidden")}if(q.hasClass("warLoc")){n++;if(n>3){q.addClass("hidden")}}})}l=true}})}}},expandWARToDoList:function(k,g,f){k.stopPropagation();var j=g.getParent("#"+f);var h=g.getChildren(".downarrow");if(h&&h.length>0){if(h[0].hasClass("hidden")){ta.common.header.openWARToDoListSection(j)}}},openWARToDoListSection:function(k){var h=k.getChildren("#warLess");if(h&&h.length>0&&!h[0].hasClass("hidden")){return}var j=k.getChildren();if(j&&j.length>0){var g=0;Array.each(j,function(m){if(m.getProperty("id")=="warMore"){m.removeClass("hidden")}if(m.hasClass("warLoc")&&g<3){m.removeClass("hidden");g++}})}var l=k.getElement(".warHeader img.downarrow");var f=k.getElement(".warHeader img.rightarrow");if(l&&f){l.removeClass("hidden");f.addClass("hidden")}},getWARNotificationFlag:function(){var h=ta.id("NO_WAR_NOTIFICATION_FLAG");if(h){return}var f=ta.id("WAR_NOTIFICATION_FLAG");if(f&&f.hasClass("hidden")){try{new Request({url:"/UserReviewToDoListAjax",data:{getCount:true},method:"get",onSuccess:function(m){var l=new Element("div",{html:m});var j=l.getElement("#WAR_NOTIFICATION_FLAG_NEW");if(j){j.replaces(f);j.setProperty("id","WAR_NOTIFICATION_FLAG")}else{var k=l.getElement("#NO_WAR_NOTIFICATION_FLAG");if(k){f.dispose()}}}}).send()}catch(g){ta.util.error.record(g,"ta.common.Header.getWARNotificationFlag");return}}},adjustFriendsLink:function(g){var f=$("TAIPPREFS");if(f){if(f.hasClass("auth_ip")){ta.util.cookie.setPIDCookie(18783)}else{if(f.hasClass("auth_fbc")){ta.util.cookie.setPIDCookie(15210)}else{return true}}window.location="/Friends";return false}return true},expandTypeAheadUI:b,contractTypeAheadUI:c,createTypeAhead:function(r,p,q,j){try{p=new Element(p);j=j||{};r&&r.stop();var w=12;var f=j.doExpansion?200:0;var m=20;if(typeof globalTypeAheadCss!=="undefined"&&!ta.has("ta.globalTypeAheadCss")){ta.store("ta.globalTypeAheadCss",Asset.css(globalTypeAheadCss))}var y={GEO:"sprite-typeahead-destination",HOTELOVERVIEW:"sprite-typeahead-destination",HOTEL:"sprite-typeahead-hotel",ATTRACTION:"sprite-typeahead-attraction",EATERY:"sprite-typeahead-restaurant",VACATION_RENTAL:"sprite-typeahead-hotel",FLIGHTS_TO:"sprite-typeahead-flight",VACATION_PACKAGE:"sprite-typeahead-hotel",SMART_DEAL:"sprite-typeahead-hotel"};var u={GEO:ta.retrieve("typeahead.location"),HOTEL:ta.retrieve("typeahead.hotel"),ATTRACTION:ta.retrieve("typeahead.attraction"),EATERY:ta.retrieve("typeahead.restaurant"),HOTEL_LIST:ta.retrieve("typeahead.hotel_list"),ATTRACTION_LIST:ta.retrieve("typeahead.attraction_list"),EATERY_LIST:ta.retrieve("typeahead.restaurant_list")};var x=false;var t=function(F,P){if(!P){P={}}var N=y[F.type];if(F.data_type&&(F.data_type==="FLIGHTS_TO"||F.data_type==="VACATION_PACKAGE")){N=y[F.data_type]}var R=P.firstInSection;var O=["LIST_PAGE","BLENDER_PAGE","NEAR_POI","VACATION_PACKAGE","SMART_DEAL"];var I=F.data_type&&O.indexOf(F.data_type.toUpperCase())!=-1;var Q=u[F.type+(I?"_LIST":"")];var E=false;var J=false;var L="";var H=[];if(N){var M="sprite-image "+N;if(I){M+="-list"}if(E){M+="-large"}H.push('<div class="'+M+'"></div>')}var C=F.details||F;var D=d(C.name||"");var G=d(C.geo_name||"");if(J){if(G){G=Q+" &ndash; "+G}else{G=Q}}var K=C.distance_string;H.push('<span class="poi-name">'+D+"</span>");if(F.closed===true&&ta.retrieve("typeahead_closed_label")){H.push('<span class="search-closed-poi" >'+ta.retrieve("typeahead_closed_label")+"</span>")}H.push('<span class="geo-name">'+G+"</span>");return H.join("")};var k;if(j.onRender){k=j.onRender;delete j.onRender}q=q>1?q:undefined;var n={recentHistory:ta.retrieve("typeahead.recentHistoryList")||[],minChars:3,containerParent:document.getElement(".secondaryNavBar .navSrch"),containerClass:"globalTypeAhead",itemSelector:"li",width:348,positionRelative:true,offsetX:20,offsetY:7,cacheResults:true,autopopulateHighlighted:false,cycleInput:false,assumeOnBlur:false,selectInputText:false,name:"MASTHEAD",startEventOn:"creation",geoId:q,validator:ta.common.search.recordAndValidate.bind(ta.common.search,null,p.getParent("form")),jpFirefoxIME:ta.retrieve("jp_typeahead_ime_firefox.enabled"),maxResults:w,errorOnSearchFailure:JS_location_not_found,onRender:function(D,G){var C=$$(".search-closed-poi");var F,I,H,E,J;if(C){for(F=0;F<C.length;F++){H=C[F];I=H.getSize().x;E=H.getSiblings(".poi-name")[0];J=E.getStyle("max-width");J=J.replace("px","");E.setStyle("max-width",(J-I-20)+"px")}}if(k){k(D,G)}},errorTemplate:function(){return""},searchParams:function(D){var F={};F.interleaved=true;F.geoPages=true;F.blenderPages=true;F.flightsToPages=true;F.nearPages=false;F.details=true;F.types="geo,hotel,eat,attr,vr";F.link_type="geo";F.neighborhood_geos=true;F.vpPages=true;F.smartDealPages=true;F.allowPageInsertionOnGeoMatch=false;F.defaultListInsertionType="hotel";F.scopeFilter=D.options.scopeFilter;F.max=12;if(ta.has("typeahead.relevancy_threshold")){F.scoreThreshold=0.5;F._ignoreMinCount=true}var E;var C=D.options.geoId;if((C==""||C<=1)&&ta.has("typeahead.biased_nearby_location")&&ta.has("typeahead.ipgeoid")){x=true;E=ta.retrieve("typeahead.ipgeoid");if(E&&E!==""){F.locBiased=true;F.sort="NEAR"}}if(C!==""||(E&&E!=="")){F.nearby=true;F.local=true;F.parentids=C;if(E&&(C==""||C<=1)){F.parentids=E}}else{F.global=true}return F},itemTemplate:t,resolveSelection:function(C){if(C){if(C.type.toUpperCase()==="SEARCH"){return p.value}else{return C.name&&C.name.stripTags()}}},onSelect:function(E,H,G,F,D){if(E){if(typeof E.type==="string"&&E.type.toUpperCase()==="SEARCH"){ta.setEvtCookie("TopNav_Search","Action","Selected_findmoreresults_inTaA_toSRP",0,"/Search");var C=p.getParent("form");C&&C.submit()}else{if(E.url){var I=E.scope=="history"?1:0;ta.setEvtCookie("TopNav_Search","Action","Selected_TaA_Result",I,E.url);window.location=E.url}}}},onShow:function(C){setTimeout(function(){C.container.addClass("visible")},f)},onHide:function(C){setTimeout(function(){C.container.removeClass("visible")},f)}};if(ta.has("typeahead.typeahead2_geo_segmented_ui")&&q&&q>1){var h=x?ta.retrieve("typeahead.nearGeo"):ta.retrieve("typeahead.geoArea")}var s=ta.retrieve("typeahead.noResultsFound");var z=ta.retrieve("typeahead.worldwide");var A=ta.retrieve("typeahead.history");n.viewOptions=TypeAhead.views.configureTypeAheadForSegmentedResults(n,{localLabel:h,noResultsMessage:s,globalLabel:z,historyLabel:A,historyOnEmpty:true});var B=n.postResultsFn;n.postResultsFn=function(F){var C=ta.util.Deferred();var D=F.results||F;if(D&&typeOf(D)==="array"){var E=D.length==0;D.push({name:ta.retrieve("typeahead.searchMore"),title:"Search",type:"SEARCH",url:"#",noResults:E});return B(F)}else{C.reject(JS_location_not_found);return C.promise()}};n=api.extend({},n,j);var o=new TypeAhead(p,n);p.store("typeahead",o);p.removePropertyEvent("focus","ta.common.header.createTypeAhead");ta.store("ta_typeahead_widget",o);var l=f;f=m;var g=function(){if(j.focusAction=="search"){o.search()}else{if(j.focusAction=="history"){o.showHistoryIfEnabled()}}f=l};if(j.doExpansion){b(r,p,g);p.addEvent("focus",function(){b(r,p)});p.addEvent("blur",function(){ta.common.header.contractTypeAheadUI(r,p)})}else{g()}return o}catch(v){ta.util.error.record(v,"ta.common.header.createTypeAhead")}},createScopedSearch:function(q,l,g){if(typeof globalTypeAheadCss!=="undefined"&&!ta.has("ta.globalTypeAheadCss")){ta.store("ta.globalTypeAheadCss",Asset.css(globalTypeAheadCss))}if(g.enableProximaNova&&typeof globalTypeAheadFontCss!=="undefined"&&!ta.has("ta.globalTypeAheadFontCss")){ta.store("ta.globalTypeAheadCss",Asset.css(globalTypeAheadFontCss))}var x=ta.id("GEO_SCOPE_CONTAINER");var p=ta.id("mainSearch");var u=ta.id("SEARCH_BUTTON");var m=ta.id("SECONDARY_NAV_BAR");var o=new Element("div",{"class":"pageDim"});var s=new ta.overlays.RelativeOverlayBelow({content:o,autoShow:false,permanent:true,style:"pageDimOverlay scopeSearchOverlay",zIndex:null},m);var w=function(){var y=api.getSize(ta.id("PAGE"));s.container.setStyles({width:y.x,height:y.y})};w();ta.id(window).addEvent("resize",w);ta.id(window).addEvent("blur",s.hide);u.addEvent("focus",s.hide);$(document.body).addEvent("click",function(z){var y=z.target.getParent(".navSrch");if(!y){s.hide()}});var v=ta.retrieve("typeahead.recentHistoryList")||[];var h=ta.retrieve("typeahead.popularDestinations");var j={pageDimmerOverlay:s,geoScopeInput:ta.id("GEO_SCOPED_SEARCH_INPUT"),geoScopeLabel:ta.id("GEO_SCOPED_SEARCH_LABEL"),geoScopeFormElement:ta.id("TYPEAHEAD_GEO_ID"),staticSearchInput:p,recentHistory:v,popularDestinations:h,translations:{hotels_text:ta.retrieve("typeahead.scoped.hotel_text"),restaurants_text:ta.retrieve("typeahead.scoped.restaurants_text"),things_to_do_text:ta.retrieve("typeahead.scoped.things_to_do_text"),vacation_rentals_text:ta.retrieve("typeahead.scoped.vacation_rentals"),all_of_trip:ta.retrieve("typeahead.scoped.all_of_trip"),static_local_label:ta.retrieve("typeahead.scoped.static_local_label"),no_results_found:ta.retrieve("typeahead.noResultsFound"),title_text:ta.retrieve("typeahead.scoped.result_title_text"),recently_viewed:ta.retrieve("typeahead.history.all_caps"),popular_destinations:ta.retrieve("typeahead.popular_destinations"),restaurants:ta.retrieve("typeahead.restaurant_list"),hotels:ta.retrieve("typeahead.hotel_list"),vacation_rentals:ta.retrieve("typeahead.vacation_rental_list"),poi_overview_geo:ta.retrieve("typeahead.scoped.poi_overview_geo"),poi_hotels_geo:ta.retrieve("typeahead.scoped.poi_hotels_geo"),poi_vr_geo:ta.retrieve("typeahead.scoped.poi_vr_geo"),poi_attractions_geo:ta.retrieve("typeahead.scoped.poi_attractions_geo"),poi_eat_geo:ta.retrieve("typeahead.scoped.poi_eat_geo"),poi_flights_geo:ta.retrieve("typeahead.scoped.poi_flights_geo")},icons:{GEO_LOCATION:"sprite-typeahead-destination",HOTEL_LOCATION:"sprite-typeahead-hotel",VACATION_RENTAL_LOCATION:"sprite-typeahead-vr",ATTRACTION_LOCATION:"sprite-typeahead-attraction",EATERY_LOCATION:"sprite-typeahead-restaurant",FLIGHTS_TO_LOCATION:"sprite-typeahead-flight",HOTEL_LIST:"sprite-typeahead-hotel-list",VACATION_RENTAL_LIST:"sprite-typeahead-vr-list",ATTRACTION_LIST:"sprite-typeahead-attraction-list",EATERY_LIST:"sprite-typeahead-restaurant-list",GEO_FLIGHTS_TO:"sprite-typeahead-flight",GEO_VACATION_PACKAGE:"sprite-typeahead-hotel-list",ACCOMMODATION_SMART_DEAL:"sprite-typeahead-hotel-list",ALL:"sprite-typeahead-all"},maxHistoryInjections:5};var f=ta.id("MAIN_SEARCH_CONTAINER");var r=ta.common.header.createTypeAhead(q,p,g.geoID,{minChars:3,defaultValue:ta.retrieve("typeahead.scoped.poi_default_text"),nextField:false,autoSelectFirst:false,selectOnBlur:false,width:null,offsetX:0,offsetY:20,containerParent:f,containerClass:"scopedSearchDisplay staticPOIDisplay",validator:function(y){a(y,f.getParent("form"))},recentHistory:[],historyTypes:["overview"],showHistory:true,integrateHistory:false,maxHistoryItems:j.maxHistoryInjections+6,focusAction:"history",onSubmit:function(B){if(!g.bypassSearch){return}var A=B.getNormalizedQuery();if(A){A=A.toLowerCase()}var z=null;switch(A){case k.options.translations.hotels_text:z="hotel";break;case k.options.translations.restaurants_text:z="eat";break;case k.options.translations.things_to_do_text:z="attr";break;case k.options.translations.vacation_rentals_text:z="vr";break}var C=ta.id("TYPEAHEAD_REDIRECT");var y=ta.id("TYPEAHEAD_REDIRECT_TYPE");if(z&&C&&y){C.value="true";y.value=z}},onRender:function(C,A){var z=api.select(".displayItem.history",C.container);if(z&&z.length>0){var B=k.renderItem({title:k.options.translations.recently_viewed,classes:"title"});z[0].getParent("ul").insertBefore(B,z[0].getParent())}var y=C.container.getElements("li, div");if(y.length>0&&y[0].hasClass("title")){C.container.removeClass("whiteCaret");C.container.addClass("greyCaret")}else{C.container.removeClass("greyCaret");C.container.addClass("whiteCaret")}},itemTemplate:function(G){if(!G.details){return""}var z;var y;if(G.realHistory){z="history"}else{if(G.scope=="history"){z="overview"}else{z="result"}}var E;var B=G.data_type&&(G.data_type.toUpperCase()==="LIST_PAGE"||G.data_type.toUpperCase()==="BLENDER_PAGE");if(B){E=G.type+"_LIST"}else{E=G.type+"_"+G.data_type}var D=j.icons[E];var F=G.details.geo_name;var C=k.renderItem({leftIconClass:D,primaryText:G.scoped_render||G.details.name,secondaryText:F,rightIconClass:y,classes:z});var A=new Element("div");A.appendChild(C);return A.get("html")}});if(!r.hasDefaultText()){r.query=r.source.value}g=api.extend({},j,g);var t=new TypeAhead(j.geoScopeInput,{defaultValue:j.geoScopeInput.value,recentHistory:h?h:v,historyTypes:["geo","all"],showHistory:true,integrateHistory:false,maxHistoryItems:j.maxHistoryInjections+1,containerParent:x,containerClass:"scopedSearchDisplay geoScopeDisplay whiteCaret",itemSelector:".displayItem.result",nextField:false,autoSelectFirst:true,positionRelative:true,offsetX:0,offsetY:20,width:null,cacheResults:true,autopopulateHighlighted:false,cycleInput:false,assumeOnBlur:false,selectInputText:false,name:"GEOSCOPE",startEventOn:"creation",shouldSubmit:function(){return false},minChars:3,maxResults:12,search:function(z,A){var y=ta.util.Deferred();var B={query:z,action:"API",startTime:this.startTime,uiOrigin:this.name,source:this.name,types:"geo",link_type:"geo,hotel,vr,attr,eat,flights_to",details:true,max:A.options.maxResults};new ta.util.ajax({method:"GET",url:"/TypeAheadJson",data:B}).always(function(C){if(C){y.resolve(C)}else{y.reject(JS_location_not_found)}});return y.promise()},errorTemplate:function(){return""},itemTemplate:function(y){return null},listTemplate:function(B){var y=[];var C=B.results;var F=true;for(var D=0;D<C.length;D++){var L=C[D];if(L.scope!="history"){F=false}var K;var z;if(L.type=="ALL"){z="all_trip result";K=k.options.icons.ALL}else{K=k.options.icons.GEO_LOCATION;z="result"}var J="";if(L.details){J=L.details.geo_name;y.push({leftIconClass:K,primaryText:L.details.name,secondaryText:J,classes:z})}}if(y.length==0){y.push({title:k.options.translations.no_results_found,classes:"no-results"})}else{if(F&&C.length-k.savedGeoCount>1){var H=k.options.translations.recently_viewed;var E=k.options.popularDestinations;if(E&&E.length>0){H=k.options.translations.popular_destinations}var A=k.savedGeoCount;y.splice(1+A,0,{title:H,classes:"title"})}}var I=k.renderList(y);var G=new Element("div",{"class":"resultContainer"});G.appendChild(I);return G},resolveSelection:function(y){return null},onSelect:function(C,H,F,A,z){if(!C){return}var E={};var G=C.urls;for(var D=0;G&&D<G.length;D++){var y=G[D];E[y.type]={url:y.url}}if(!C.value){k.clearGeoInfo()}else{k.setGeoInfo(C.value,C.details.name,C.details.geo_name,E)}if(k.staticSearchTypeAhead.getNormalizedQuery()){k.staticSearchTypeAhead.search(null,function(){k.startStaticSearch(true)})}else{k.startStaticSearch(true)}var B=C.scope=="history"?1:0;ta.trackEventOnPage("TopNav_geo_search","Action","Selected_TaA_Result",B)},onKeyDown:function(y,z){if(z.tabPressed&&z.selectedIndex>=0){y.preventDefault();y.stopPropagation();z.select(true,"tab")}}});var n=t.injectHistory({name:j.translations.all_of_trip,type:"ALL"},0);n.details={name:n.name};g.staticSearchTypeAhead=r;g.geoScopeTypeAhead=t;var k=new e(g);ta.store("ta_scoped_typeahead_search",k);return k},scopedSearchSubmitValidate:a}})();ta.common.search={langSelect:function(b,a){if(a.form.elements.q.value.length>0){a.form.submit()}},useCurrentLocation:function(a){ta.select(".locNotFound.hidden").removeClass("hidden")},clearOnFocus:function(b,a){if(a.value==a.defaultValue){a.value="";a.removeClass("focusClear")}},defaultOnBlur:function(b,a){if(a.value==""){a.addClass("focusClear");a.value=a.defaultValue}},validate:function(b,a){if(a.q.value.trim()==""||$(a.q).hasClass("focusClear")){return false}setOneTimeCookie("SRCHACT","NEW");return true},recordAndValidate:function(f,d){if(ta.common.search.validate(f,d)){var b=ta.retrieve("ta_typeahead_widget");var e=b&&b.options?b.options.startTime:undefined;var g=b?b.lastSuccessfulQuery:undefined;var c=typeof modelGeoId!="undefined"&&modelGeoId;var a=b&&b.options?b.options.name:undefined;var h=b&&b.historyShown;new Request({method:"GET",data:{hadHistory:h,action:"RECORD",eventType:"search_bttn",startTime:e,source:a,query:g,uiOrigin:a,global:(!c||pageServlet=="Search"),scope:(!c||pageServlet=="Search")?"G":c},onSuccess:function(j){if(b&&b.options&&b.options.onSubmit){b.options.onSubmit(b)}d.submit()},onFailure:function(j){if(b&&b.options&&b.options.onSubmit){b.options.onSubmit(b)}d.submit()},url:"/TypeAheadJson"}).send()}return false},selectLang:function(b,d){try{var o=function(p){var e=p.match(/([\d.]+)px/);if(e){return parseFloat(e)}return 0};var g=ta.id("SEARCH_LANG_SELECT_POPUP");if(!g){return false}if(!g.hasClass("hidden")){var f=ta.id("SEARCH_LANG_SELECT_INPUT");var j=ta.id("SEARCH_LANG_SELECTED");if(f){var h=d.id.match(/lang_(.+)/);if(h){var c=h[1];if("all"==c){f.value=""}else{f.value=c}}if(j){if(ta.isFall2013MastheadRefresh()){if(h){g.getElements(".langSelectOption").removeClass("selected");d.addClass("selected")}}else{j.set("html",ta.id(d).get("html"))}}}g.addClass("hidden");if(!ta.isFall2013MastheadRefresh()&&j&&!ta.common.search.widthfixed){var k=ta.common.search.width;var n=o(j.getStyle("width"));var a=Math.max(k,n);console.log("check width old "+k+" new "+n);if(k!=n){j.setStyle("width",a+"px");ta.common.search.widthfixed=true}}}else{g.removeClass("hidden");if(!ta.isFall2013MastheadRefresh()){var j=ta.id("SEARCH_LANG_SELECTED");if(j&&!ta.common.search.widthfixed){ta.common.search.width=o(j.getStyle("width"))}}}}catch(l){ta.util.error.record(l,"select search lang")}},reviews:function(c,b){new Request({url:"/ActionRecord?action=SearchReviews"}).send();if(b&&b.getElement){var a=b.getElement(".searchTestText");if(a){alert(a.innerHTML)}}else{alert("Coming Soon!")}return false},selectOption:function(b,d){var q=function(e){do{e=e.getParent()}while(e&&e.nodeName!=="FORM");return e};var c=ta.id(d);var j=ta.id(q(c));try{var p=function(r){var e=r.match(/([\d.]+)px/);if(e){return parseFloat(e)}return 0};var h=j.getElement(".SEARCH_SELECT_POPUP");if(!h){return false}if(!h.hasClass("hidden")){h.addClass("hidden");var f=j.getElement(".SEARCH_SELECT_INPUT");var k=j.getElement(".SEARCH_SELECTED");if(f){var g=c.hasClass("lang_all");if(g){f.value=1}else{f.value=2}if(k){k.set("html",c.get("html"))}}if(k){var l=ta.common.search.width;var o=p(k.getStyle("width"));var a=Math.max(l,o);k.setStyle("width",a+"px")}}else{h.removeClass("hidden");var k=j.getElement(".SEARCH_SELECTED");if(k){ta.common.search.width=p(k.getStyle("width"))}}}catch(n){ta.util.error.record(n,"select search lang")}}};ta.common.flyout={intlPopup:function(d,b){d.stop();b.onclick=null;flagsUrl=document.location.pathname;var c="/StaticVelocityPage?t=intSitesFly.vm&lt=evt&footerFlagFormat="+footerFlagFormat+"&flagsURL="+encodeURIComponent(flagsUrl);if(document.location.search!=""){c+=encodeURIComponent(document.location.search)}if(document.location.hash!=""){c+=encodeURIComponent(document.location.hash)}if(window.modelGeoId){c+="&geo="+modelGeoId}if(window.flagsSettings){for(var a=0;a<flagsSettings.length;a++){c+="&"+flagsSettings[a]+"=true"}}if(window.pageFeature){c+="&pageFeature="+pageFeature}new Asset.css(flagsFlyoutCSS);new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:c},b);return false},showRecentLocationSaveOverlay:function(){setPID(3832);new Request({url:"/RecentlyViewedAjax",onSuccess:function(a){if(!a.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(a,{style:"dg s4 RecentlyViewedOverlay"})}},data:{a:"save_overlay"},evalScripts:true,method:"get"}).send()},submitRecentLocationEmail:function(){var a=ta.retrieve("overlays.current");if($("rvEmailSend")){$("rvEmailSend").hide()}if($("rvEmailProgress")){$("rvEmailProgress").show()}setPID(4470);new Request({url:"/RecentlyViewedAjax",onSuccess:function(b){a.hide();if(!b.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(b,{style:"dg s4 RecentlyViewedOverlay"})}},data:$("rvEmailForm"),evalScripts:true}).send()},submitRecentLocationSave:function(){var a=ta.retrieve("overlays.current");if($("rvEmailSend")){$("rvEmailSend").hide()}if($("rvEmailProgress")){$("rvEmailProgress").show()}setPID(4469);new Request({url:"/RecentlyViewedAjax",onSuccess:function(b){a.hide();if(!b.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(b,{style:"dg s4 RecentlyViewedOverlay"})}},data:$("rvEmailForm"),evalScripts:true}).send()},showEmailHotelOverlay:function(c,d,a,b){new Asset.css(emailHotelCSS);new Request({url:"/EmailHotel",onSuccess:function(f){ta.run("ta.overlays.showInLightbox",{},f,{style:"dg s4"});if(ta.has("emailOwnerShowCaptcha")){ta.t4b.emailhotel.showRecaptcha()}},data:{detail:c,isOfferEmail:d,overrideOfferEmail:a,contactColumn:b},evalScripts:true,method:"get"}).send()},rvInquiryPrivacy:function(b,a){b.stop();a.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,content:$("rvPrivacyBox").innerHTML},a)},rvClearDefault:function(c,a){var b=$(c);if(b&&b.value==a){b.value="";b.removeClass("rvDefault")}},BLSpecialOffersUrl:function(b,a){b.stop();a.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,content:$("blLinkMsg").innerHTML},a)},destinationsPopup:function(b,a){b.stop();a.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:"/vpages/destinationsFly.html?lt=evt"},a)},funStuffPopup:function(b,a){b.stop();a.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:"/vpages/funStuffFly.html?lt=evt"},a)},bestValue:function(b,a){b.stop();a.onmouseover=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,remoteContent:"/vpages/bestValueFly.html?log=false"},a);return false},starAttribution:function(b,a){b.stop();a.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},a);return false},amenities:function(d,b,a,c){if(d){d.stop()}b.onclick=null;if(typeof(amenityOverlayCss)!="undefined"&&!ta.retrieve("ta.amenityOverlayCss")){ta.store("ta.amenityOverlayCss",Asset.css(amenityOverlayCss))}if(a&&a>0){setPID(a);new Request({url:"/ActionRecord?excludeFromVS=false&action=HRAmenitiesFlyout"}).send()}if(c){ta.store("amenities.suppressLinks",true)}ta.run("ta.overlays.Factory.createAmenitiesLightbox",{},b);return false}};ta.common.sendmessage={getMessageCode:function(){var e=new Date().getTime();var b="ABCDEFGHIJKLMNOPQRSTUVWXYZ123456";var f=[];for(var a=0;a<32;a++){f[a]=((e&(1<<a))!=0)?1:0}var c=[[],[],[],[],[],[]];for(var a=0;a<30;a++){c[a%(c.length)].push(f[f.length-1-a])}var d="";for(var a=0;a<c.length;a++){d+=b.substr(parseInt(c[a].reverse().join(""),2),1)}return d},communityLightbox:function(e,d){if(!communityEnabled){window.callback_communityLightboxEnable=function(){communityEnabled=true;var g=ta.retrieve("overlays.sendmessage");if(g){g.hide()}ta.common.sendmessage.communityLightbox(e,d)};var a=new StringBuffer();a.append('<p id="inviteStatusField" style="display: none; color: red;"></p>');a.append("<p>"+JS_mem_travelnet_friends_disabledM2M+".</p>");a.append('<p><a href="javascript:void(0)" onclick="ta.common.sendmessage.enableCommunity(window[\'callback_communityLightboxEnable\'], true); return false;">'+JS_common_Clickhere+"</a> "+JS_mem_travelnet_friends_turnOn+".</p>");var f=ta.overlays.showInLightbox(a.toString(),{backdrop:ta.overlays.BACKDROP_NEVER,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});f.container.setStyle("z-index","9997");if($("vrWideOverview")&&ta.has("vrShowCaptcha")){f.closeBtn.addEvent("click",function(){ta.vr.showRecaptcha()})}ta.store("overlays.sendmessage",f);return}if(d){var b=function(g){var h=ta.overlays.showInLightbox(g,{backdrop:ta.overlays.BACKDROP_NEVER,permanent:true,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});h.container.setStyle("z-index","9997");if($("vrWideOverview")&&ta.has("vrShowCaptcha")){h.closeBtn.addEvent("click",function(){ta.vr.showRecaptcha()})}ta.store("overlays.sendmessage",h);var j=window[d];if(j&&typeOf(j)=="function"){j()}}}else{var b=function(g){var h=ta.overlays.showInLightbox(g,{backdrop:ta.overlays.BACKDROP_NEVER,permanent:true,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});h.container.setStyle("z-index","9998");if($("vrWideOverview")&&ta.has("vrShowCaptcha")){h.closeBtn.addEvent("click",function(){ta.vr.showRecaptcha()})}ta.store("overlays.sendmessage",h)}}var c={url:e,onSuccess:b,evalScripts:true,onFailure:ta.util.error.ajaxFailure.partial("SendMessage:communityLightbox")};new Request(c).send()},enableCommunity:function(c,a){var b=c;if(!a){b=function(d){ta.common.sendmessage.enableCommunityResponse(d,c)}}if(typeof(JS_SECURITY_TOKEN)=="undefined"){JS_SECURITY_TOKEN=""}new Request({url:"/MemberSubscriptionsController",data:{Action:"ChangeM2M",set:"on",token:JS_SECURITY_TOKEN},onSuccess:b,onFailure:ta.util.error.ajaxFailure.partial("SendMessage:enableCommunity")}).send()},enableCommunityResponse:function(res,callback){if(txt.match(/^{/)){var data=eval("("+txt+")");if(data.ERROR){document.getElementById("inviteStatusField").innerHTML=data.ERROR;document.getElementById("inviteStatusField").style.display="block"}}else{document.getElementById("inviteStatusField").innerHTML=JS_community_on;document.getElementById("inviteStatusField").style.display="block"}},submitSendMessage:function(h,b){h.stop();b.onclick=null;var a=b.className.match(/LSO_(\w+)/)[1];$("LsoId").value=footprintGetWithSet(a);$("screenWidth").value=screen.width;$("screenHeight").value=screen.height;if(!b.className.match(/\bform_(\w+)\b/)){return}var e=$(RegExp.$1);var d={url:b.href,data:e,evalScripts:true,onFailure:ta.util.error.ajaxFailure.partial("SendMessage:submitSendMessage")};var g=window["callback_"+e.name];if(b.className.match(/method_(\w+)\b/)){d.method=RegExp["$1"]}if(b.className.match(/\btgt_(\w+)\b/)){d.update=RegExp["$1"]}else{d.onComplete=function(l,j){if(ta.retrieve("messaging.isiframe")&&ta.id("PAGE")){ta.id("PAGE").set("html",l);if(ta.id("SUCCESS")){window.top.location.href="/Messages?f=512&o=0&cnt=25&j=-3&oo=0&oj=-3"}}else{var k=ta.overlays.showInLightbox(l,{backdrop:ta.overlays.BACKDROP_NEVER,permanent:true,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});ta.store("overlays.sendmessage",k)}if(g&&typeOf(g)=="function"){g()}}}var c=window["validate"+e.id];if(c&&typeOf(c)=="function"&&c.apply(e)==false){return}if(b.className.match(/\bevalScripts\b/)){d.evalScripts=true}var f=ta.retrieve("overlays.sendmessage");if(f&&f.options&&f.options.permanent){f.options.permanent=false}new Request(d).send()},cancel:function(a){if(a){return}var b=ta.retrieve("overlays.sendmessage");if(b){ta.remove("overlays.sendmessage")}if(ta.has("community.needsReload")){window.location.reload()}},closeSendMessage:function(c,a){if(c&&c.stop){c.stop()}if(a){a.onclick=null}var b=ta.retrieve("overlays.sendmessage");if(b){b.hide(c)}if($("vrWideOverview")&&ta.has("vrShowCaptcha")){ta.vr.showRecaptcha()}}};ta.servlet.Inspiration={sortPopularity:function(b,a){sort("popularity")},sortAlphabetical:function(b,a){sort("alphabetical")}};ta.keep("facebook.onAvail",function(){FB.Event.subscribe("edge.create",function(d,f){try{var g=false;if(f){g=ta.id(f)}var a="";var c=d||"";if(g){if(g.className){var b=false;if(b=g.className.match(/track_(\w+)/)){a=b[1]}if(g.hasClass("expanded")){a+="_expanded"}}}new Request({url:"/ActionRecordPlus?action=LIKE&from="+a+"&url="+c}).send()}catch(e){ta.util.error.record(e,"FB like review tracking error")}})});ta.servlet.Reviews={expandCount:0,PAGING_HEIGHT:1000,expandReview:function(o,d,c){var a=0;if(ta.retrieve("expand_"+c)){return}ta.store("expand_"+c,true);a++;var b=ta.id(c);var n=new Event(o);try{a++;if(!b){ta.util.error.record(null,"expandReview - no container",n,{revId:c});return}var j,l,g=false;if(b.getElement){j=b.getElement(".dyn_full_review");l=b.getElement(".basic_review");g=b.getElement(".revBotContent")}if(!l||!l.hasClass){ta.util.error.record(null,"expandReview - no basic_rev",n,{revId:c});return}a++;var h=l.hasClass("first");if(g&&g.getElement){var f=g.getElement(".fb_like_button")}var k=l.getElement(".helpful");a++;if(j){j.setStyle("display","block");if(f){ta.servlet.Reviews.injectFBLikeIntoFull(f,j)}if(ta.servlet.Reviews.translationRatings.contains(expandedReviewId)){ta.servlet.Reviews.injectTranslationRating(l,j)}l.setStyle("display","none");ta.remove("expand_"+c)}else{a++;ta.servlet.Reviews.expandCount++;var m=l.getElement(".partnerRvw span.linkItem");a++;if(m){m.getElement("img.textArrow_more").setStyle("display","none");new Asset.image(CDNHOST+"/img2/spinner.gif",{"class":"anim_loop"}).inject(m)}a++;new Request({url:"/SingleUserReview-g"+modelGeoId+"-d"+modelLocId+"?review="+c+"&servlet="+pageServlet+"&expand="+ta.servlet.Reviews.expandCount,onSuccess:function(s,t){try{var r=0;j=new Element("div");j.addClass("dyn_full_review");j.set("html",s);j.inject(l,"after");r++;var u=j.getElement(".collapse");if(u){u.addEvent("click",function(){ta.servlet.Reviews.collapseReview(b)})}r++;if(h){j.getElement(".basic_review").addClass("first")}r++;setupTranslationRatingSlider(j);r++;if(typeof processLinks!=="undefined"){processLinks(j)}r++;ta.servlet.Reviews.fixMTHelpfulUrl(j,c);if(l){var x=l.getElement("img.anim_loop");x.dispose()}r++;if(m){var q=m.getElement("img.textArrow_more");if(typeof(q)!="undefined"&&q!=null){q.setStyle("display","inline")}}r++;var v=ta.retrieve("facebook.data.handlers.FRIEND_NAMES");var p=ta.retrieve("facebook.data.handlers.HIGHLIGHT_FRIENDS");if(v&&typeof(v)=="function"){v()}if(p&&typeof(v)=="function"){p({expanded:true})}if(f){ta.servlet.Reviews.injectFBLikeIntoFull(f,j)}if(k){helpfulVotingKey=k.id.match(/(helpful\w+)_\w+/);if(helpfulVotingKey){helpfulVotingKey=helpfulVotingKey[1];if(ta.retrieve(helpfulVotingKey)){var z=j.getElement(".helpful");if(z){z.innerHTML=k.innerHTML}}}}r++}catch(w){ta.util.error.record(w,"expandReview - post AJAX",null,{postProg:r})}if(l&&l.setStyle){l.setStyle("display","none")}if(g&&g.setStyle){g.setStyle("display","none")}ta.remove("expand_"+c);var y=ta.retrieve("ta.servlet.Reviews.callback");if(y!=null){y()}},evalScripts:true}).send()}}catch(e){ta.util.error.record(e,"expandReview",n,{revId:c,prog:a});ta.remove("expand_"+c)}},expandReviews:function(g,k,h,r,p){if(ta.retrieve("expand_"+h)){return}ta.store("expand_"+h,true);var m=ta.id(h);var o=new Event(g);try{if(!m){ta.util.error.record(null,"expandReviews - no container",o,{revId:h});return}var j,s,x=false;if(m.getElement){j=m.getElement(".dyn_full_review");s=m.getElement(".basic_review");x=m.getElement(".revBotContent")}if(!s||!s.hasClass){ta.util.error.record(null,"expandReviews - no basic_rev",o,{revId:h});return}if(j){ta.servlet.Reviews.showExpandedReview(h,true);ta.remove("expand_"+h)}else{ta.servlet.Reviews.expandCount++;var t=s.getElement(".partnerRvw span.moreLink");if(t){var c=t.getParent().getElement("img.textArrow_more");if(c){c.setStyle("display","none");new Asset.image(CDNHOST+"/img2/spinner.gif",{"class":"anim_loop"}).inject(t,"after")}}var w=$$("#REVIEWS .reviewSelector");var a;for(var u=0;u<w.length;u++){if(w[u].id==h){a=w.slice(u)}}var l=[];if(a&&a.length>0){for(var u=0;u<a.length;u++){var q=a[u].id;if(q&&q.indexOf("review_")===0){var v=a[u].getElement(".dyn_full_review");if(!v){var f=a[u].getElement(".basic_review");if(f){l[l.length]=q.split("_")[1]}else{ta.util.error.record(null,"expandReviews - basic_review content missing",null,{revId:q},"WARN")}}}}}if(l.length>0){var n=l[0];var b=0;if(r){b=r}var e=l.join(",");new Request({url:"/ExpandedUserReviews-g"+modelGeoId+"-d"+modelLocId+"?target="+n+"&context="+b+"&reviews="+e+"&servlet="+pageServlet+"&expand="+ta.servlet.Reviews.expandCount,trackEvent:{module:"Reviews",action:"expand"},onSuccess:function(F,B){try{var G=[];var y=new Element("div");y.set("html",F);var N=y.getChildren();var E=[];for(var M=0;M<N.length;M++){var C=N[M];var I=C.id.split("_")[2];var P=ta.id("review_"+I);if(P&&P.getElement){E.push(P.getProperty("id"));var L=P.getElement(".basic_review");if(L){G.push(I);C.erase("id").addClass(L.className.replace("basic_review","dyn_full_review")).inject(L,"after").hide();var Q=C.getChildren()[0];if(Q){Q.removeClass("review")}var H=C.getElement(".collapse");if(H){H.addEvent("click",ta.servlet.Reviews.getCollapseCallback(P))}setupTranslationRatingSlider(C);if(typeof processLinks!=="undefined"){processLinks(C)}if(ta.servlet.Reviews.translationRatings.contains(I)){ta.servlet.Reviews.injectTranslationRating(L,C)}ta.servlet.Reviews.fixMTHelpfulUrl(C,"review_"+I);if(I===n){var z=L.getElement("img.anim_loop");if(z){z.dispose()}ta.servlet.Reviews.refreshSidebarAds();ta.servlet.Reviews.injectInlineBanner(P);var K=L.getElement(".partnerRvw span.moreLink");if(K){var A=K.getParent().getElement("img.textArrow_more");if(typeof(A)!="undefined"&&A!=null){A.setStyle("display","inline")}}}}}}var D=true;for(var M=0;M<G.length;M++){if(M==1){D=false}var J="review_"+G[M];ta.servlet.Reviews.showExpandedReview(J,D)}if(lazyImgs!=null){window.setupLazyLoad()}}catch(R){ta.util.error.record(R,"expandReviews - post AJAX",null,{});var z=s.getElement("img.anim_loop");if(z){z.dispose()}var K=s.getElement(".partnerRvw span.moreLink");if(K){var A=K.getParent().getElement("img.textArrow_more");if(typeof(A)!="undefined"&&A!=null){A.setStyle("display","inline")}}}if(Browser.ie&&Browser.version<8){var O=function(){for(var S=0;S<E.length;++S){var T=ta.id(E[S]);if(T!==null){T.addClass("dummy")}}};setTimeout(O,0)}ta.remove("expand_"+h)},onFailure:function(y,z){ta.util.error.record(null,"ExpandedUserReviews ajax call failed",null,{reviewIds:e},"WARN");var B=s.getElement("img.anim_loop");if(B){B.dispose()}var C=s.getElement(".partnerRvw span.moreLink");if(C){var A=C.getParent().getElement("img.textArrow_more");if(typeof(A)!="undefined"&&A!=null){A.setStyle("display","inline")}}},evalScripts:true}).send()}}}catch(d){ta.util.error.record(d,"expandReviews",o,{revId:h});ta.remove("expand_"+h)}},injectInlineBanner:function(a){try{if(a){if(ta.has("ads.gptEnabled")){if(!ta.has("ads.inlineReviewAd.injected")){ta.store("ads.inlineReviewAd.injected",true);ta.common.ads.queueForInjection(["gpt-ad-468x60"])}else{var b=a.getElement(".iab_inlineBanner");if(b){b.destroy()}}}else{injectAdsTargeted(a)}}else{throw new Error("Review parent element is null")}}catch(c){ta.util.error.record(c,"unable to inject inline banner on review expansion")}},refreshSidebarAds:function(){try{if(ta.has("ads.gptEnabled")){ta.common.ads.refreshSidebarAds()}else{ta.common.ads.refreshSideBarAdsWithRefreshOrdKey()}}catch(a){ta.util.error.record(a,"unable to refresh sidebar ads on review expansion")}},getCollapseCallback:function(a){return function(){ta.servlet.Reviews.collapseReview(a)}},showExpandedReview:function(a,b){try{if(typeof(a)==="undefined"){ta.util.error.record(null,"showExpandedReview - reviewId is undefined");return}var e=ta.id(a);if(e){var h,k,f=false;if(e.getElement){h=e.getElement(".dyn_full_review");k=e.getElement(".basic_review");f=e.getElement(".revBotContent")}else{ta.util.error.record(null,"showExpandedReview - recContainer missing getElement attribute",null,{revId:a});return}if(!k){ta.util.error.record(null,"showExpandedReview - basic_rev is null",null,{revId:a});return}if(!k.hasClass){ta.util.error.record(null,"showExpandedReview - basic_rev missing hasClass attribute",null,{revId:a});return}if(f&&f.getElement){var d=f.getElement(".fb_like_button")}var j=k.getElement(".helpful");if(!h){ta.util.error.record(null,"showExpandedReview - no full");return}if(j){var g=j.id.match(/(helpful\w+)_\w+/);if(g){g=g[1];if(ta.retrieve(g)){var l=h.getElement(".helpful");if(l){l.innerHTML=j.innerHTML}}}}if(d){ta.servlet.Reviews.injectFBLikeIntoFull(d,h)}h.show();k.hide()}else{ta.util.error.record(null,"showExpandedReview - revContainer is null",null,{revId:a});return}}catch(c){ta.util.error.record(c,"showExpandedReview")}},fixMTHelpfulUrl:function(c,a){var d=c.getElement("input[name=returnTo]");if(d){var b=document.location.href;if(b.indexOf("#")>=0){b=b.substring(0,b.indexOf("#"))}d.value=b+"#mtreview_"+a}},injectFBLikeIntoFull:function(c,a){try{if(c){var e=c.getFirst();if(e){e.addClass("expanded")}var b=a.getElement(".helpful");if(b){c.inject(b,"after")}}}catch(d){ta.util.error.record(d,"expandReview - like button")}},injectTranslationRating:function(c,b){if(c&&b){var a=c.getElement(".translation"),d=b.getElement(".translation");if(a&&d){d.set("html",a.get("html"))}}},translationRatings:[],collapseReview:function(a){try{a=ta.id(a);var f=a.getElement(".dyn_full_review");var c=a.getElement(".basic_review");var d=a.getElement(".revBotContent");var b=f.getElement(".fb_like_button");if(c&&c.setStyle){c.setStyle("display","block")}if(d&&d.setStyle){d.setStyle("display","block")}if(b){var j=b.getFirst();if(j){j.addClass("expanded")}if(d){b.inject(d,"inside")}}var h=a.id.replace("review_","");if(ta.servlet.Reviews.translationRatings.contains(h)){ta.servlet.Reviews.injectTranslationRating(f,c)}f.setStyle("display","none")}catch(g){ta.util.error.record(g,"collapseReview")}},findLink:function(b,a){if(/\bt(r[\d]+)\b/.test(a.className)){window.location=$(RegExp.$1).href}},mtSubmitOnClick:function(b,a){if(a.value==="true"){ta.util.cookie.setPIDCookie(25173)}else{if(a.value==="false"){ta.util.cookie.setPIDCookie(25172)}}a.form.submit()},validateMTEdit:function(d,c){var b=ta.id("mtedit_mt");var a=b.getElements(".mtedit_orig_title")[0].value;var g=b.getElements(".mtedit_title")[0].value;var f=b.getElements(".mtedit_orig_text")[0].value;var e=b.getElements(".mtedit_text")[0].value;return g&&e&&(g!=a||e!=f)},enableMTEditSubmit:function(c,b){var a=ta.id("mtedit_submit");if(a.disabled&&ta.servlet.Reviews.validateMTEdit(c,b)){a.disabled=false}},submitMTEdit:function(f,d,a,e){var b=ta.id("mtedit_submit");b.disabled=true;ta.select(".mtedit_error").each(function(j){j.hide()});if(ta.servlet.Reviews.validateMTEdit(f,d)){var c=ta.id("mtedit_mt");var h=c.getElements(".mtedit_title")[0].value;var g=c.getElements(".mtedit_text")[0].value;new Request({url:"/MachineTranslationEditSubmit?r="+a,data:{title:h,body:g,token:e},onSuccess:function(){try{ta.id("mtedit").hide();ta.id("mtedit_received").show();ta.retrieve("translationEditOverlay").position();var j=ta.id("mtForm"+a);j.getElement(".mtRateLabel").hide();j.getElement(".mtImproveButton").hide();j.getElement(".mtEditThanksLabel").show()}catch(k){ta.util.error.record(k,"submitMTEdit:onSuccess")}},onFailure:function(j){try{if(j.status>=400&&j.status<=499){ta.id("mtedit_404").show()}else{b.disabled=false;ta.id("mtedit_500").show()}}catch(k){ta.util.error.record(k,"submitMTEdit:onFailure")}}}).send()}else{ta.id("mtedit_nochange").show()}},rateMTReview:function(a,d){var c=ta.id(d.form);var h=c.getElement("input[name=translateRating]:checked");if(h){var e=h.value;var f=c.elements.userId.value;var b=c.elements.reviewId.value;ta.servlet.Reviews.translationRatings.push(b);var g=c.action+"?at=true&rateValue="+b+","+f+","+e;new Request({url:g}).send();var j=c.getElement(".thanks").innerHTML;c.getElement(".translationRatingForm").innerHTML=j}},rateMTReviewNew:function(a,d,b,e){var c=ta.id("mtForm"+b);if(c){var h=c.elements.userId;if(h){ta.servlet.Reviews.translationRatings.push(b);var j=c.action+"?at=true&rateValue="+b+","+h.value+","+e;new Request({url:j}).send();var f=document.getElement(".mtRatingOverlay");if(f){f.hide()}var g=c.getElement(".mtRatingButton");if(g){g.hide()}var k=c.getElement(".thanks");if(k){k.show()}}}},popSocialShare:function(b,a){if(b&&b.href){var c="toolbar=1,location=1,directories=1,status=1,menubar=1,resizable=1,copyhistory=1,scrollbars=1,width=800,height=400,left=40,top=40,screenx=40,screeny=40";window.open(b.href,"SocialShare",c)}new Request({url:"/ActionRecord?action=shareOn"+a}).send();return false},helpfulVoteHandlerOb:function(b,a,c){new Event(b).preventDefault();var d=a.className.match(/\btgt_(\w+)\b/);if(!d){return}d=d[1];c=ta.util.ASDF.asdfDcd(c);new Request({url:c,onSuccess:function(e,g){var h=ta.id(d+"_expanded");var f=ta.id(d+"_collapsed");if(h){h.innerHTML=e}if(f){f.innerHTML=e;ta.store(d,true)}}}).send()},recordUnattached:function(b,a){new Request({url:"/ActionRecord?action=START_UNATTACHED_RVW_SEARCH"}).send();a.removePropertyEvent("keyup","ta.servlet.Reviews.recordUnattached")},changeSearchType:function(l,b){if(window.searchType){$$("span."+window.searchType.id).hide()}window.searchType=b;$$("span."+b.id).setStyle("display","inline");var d=b.getAttribute("data-type")||b.value;ta.find('input[name="type"]').value=d;var n=ta.id("query");var f=n.retrieve("typeahead");if(n&&f){var m=ta.servlet.Reviews.poiTypeIdMap[d];f.options.search=TypeAhead.utils.query(false,m,null,null,true,10);f.search()}var g="GEO";if(b.id!="type_rental"){switch(b.id){case"type_hotel":ta.store("tpAhdType","hotel");break;case"type_attraction":ta.store("tpAhdType","attr");g="ATTRGEO";break;case"type_restaurant":ta.store("tpAhdType","eat");g="RESTGEO";break;case"type_location":ta.store("tpAhdType","geo");break}if($("SRCH_BOX_VR")){$("SRCH_BOX_VR").hide()}if($("SRCH_RSLT_VR")){$("SRCH_RSLT_VR").hide()}if($("MAIN_COL")){$("MAIN_COL").hide()}if($("POST_PHOTOS_FORM")){$("POST_PHOTOS_FORM").hide()}$("SRCH_BOX").show();$("UR_SELECT").show();var a=ta.id("query");var c=a.retrieve("typeAhead");var j=ta.id("SEARCH_GEO");if(c){c.changeUrl("/TypeAheadJson?action=SINGLELOCTYPE&types="+ta.retrieve("tpAhdType")+"&global=true&parentids="+j.value);c.query();c.updateChoices()}if(a.value.length>0){searchByType()}a.focus();a.select();var k=ta.id("queryGeo");if(k){var e=k.retrieve("typeAhead");if(e){e.changeUrl("/TypeAheadJson?action="+g);e.query();e.updateChoices()}}}else{$("SRCH_BOX_VR").show();$("SRCH_BOX").hide();$("UR_SELECT").hide();var h=$("reviewGeo");h.focus();h.select()}ta.store("searchResultFlag",true);ta.id("SRCH_RSLT").hide()},unattachedSearchOnFocus:function(e,c,b){var d=ta.retrieve("tpAhdType");var a={xargs:"&types="+d};if(b){a.geo=b}ta.run("ta.widgets.typeahead.factory.global_mutable",{},e,c,"SINGLELOCTYPE","ta.widgets.typeahead.events.onSelectUnattached",a);c.removePropertyEvent("focus","ta.servlet.Reviews.unattachedSearchOnFocus")},unattachedSearchGeoOnFocusAttach:function(d,a){var b=ta.retrieve("tpAhdType"),c=a.retrieve("typeAhead");ta.run("ta.widgets.typeahead.factory.global_mutable",{},d,a,"GEOGRAPHICONLY","ta.widgets.typeahead.events.onSelectGeoUnattached",{xargs:"&types="+b,minLength:1,noSearchPrompt:true});a.removePropertyEvent("focus","ta.servlet.Reviews.unattachedSearchGeoOnFocus")},unattachedSearchGeoOnFocus:function(c,a){var b=ta.id("SEARCH_GEO");b.value=1;a.value=""},unattachedSearchGeoOnBlur:function(g,b){var f=ta.id("SEARCH_GEO"),c=ta.id("query"),d=b.retrieve("typeAhead"),a=c.retrieve("typeAhead");if(!d.selected){var e=d.choices.getFirst();if(b.value==""||!e||!e.responseObj||e.responseObj.notFound){f.value=1;b.value=""}else{f.value=e.responseObj.value;b.value=e.responseObj.name}a.changeUrl("/TypeAheadJson?action=SINGLELOCTYPE&types="+ta.retrieve("tpAhdType")+"&global=true&parentids="+f.value)}},ratingFlyoutScroll:function(b){try{var c=b.getScroll().y,a=b.getScrollSize().y;if(b.retrieve("canFetchMore",true)&&c>a-ta.servlet.Reviews.PAGING_HEIGHT){b.store("canFetchMore",false);ta.servlet.Reviews.fetchRatingPage(b)}}catch(d){ta.util.error.record(d,"ratingFlyoutScroll")}},fetchRatingPage:function(b){var a=b.getElement(".ratingVal").innerHTML,c=b.getElement(".locId").innerHTML,e=b.getElement(".revId"),d=e.innerHTML;if(d!=0){new Request({url:"/RatingPagingAjax",data:{locId:c,ratingVal:a,revId:d},method:"get",onSuccess:function(f,g){e.destroy();b.innerHTML+=f;b.store("canFetchMore",true)}}).send()}},toggleOnRecentReview:function(h,f,a){if(!h||!f||!a){return}var e=ta.id(h.target||h.srcElement);var d=ta.id("RECENT_REVIEW_QUOTE_"+a);if(d&&e&&e.id==f.id){var g=d.getElement(".speechBubble");if(g){g.addClass("highlight")}var c=d.getElement(".recentReview_meta_content");if(c){c.addClass("highlight")}}if(!d||!d.hasClass("hidden")){return}var b=ta.id("RECENT_REVIEW_ATTRIBUTION_"+a);if(!b){return}ta.select("#HR_HACKATHON_CONTENT .recentReviewQuote").each(function(j){if(j.get("id")!="RECENT_REVIEW_QUOTE_"+a){if(!j.hasClass("hidden")){j.addClass("hidden")}}else{j.removeClass("hidden")}});ta.select("#HR_HACKATHON_CONTENT .recentReviewAttribution").each(function(j){if(j.get("id")!="RECENT_REVIEW_ATTRIBUTION_"+a){if(!j.hasClass("hidden")){j.addClass("hidden")}}else{j.removeClass("hidden")}})},toggleOffRecentReview:function(g,e,a){if(!g||!e||!a){return}var c=ta.id("RECENT_REVIEW_QUOTE_"+a);if(!c){return}var d=ta.id(g.target||g.srcElement);if(d&&d.id==e.id){var f=c.getElement(".speechBubble");if(f){f.removeClass("highlight")}var b=c.getElement(".recentReview_meta_content");if(b){b.removeClass("highlight")}}},onClickRecentReview:function(d,c,a){if(!d||!c||!a){return}var b=ta.id("RECENT_REVIEW_QUOTE_"+a);if(!b){return}var e=b.getElement(".quoteLnk");if(e){e.click()}},toggleReview:function(a,c,b,e){if(!a||!c||!b){return}var g=ta.id("review_"+b);var f=ta.id("UR"+b);var j;if(f){j=f}else{if(g){j=g}else{return}}var h=j.getElement(".col2of2");var d=j.getElement(".innerBubble");if(h&&d){if(e){h.addClass("highlight");d.addClass("highlight")}else{h.removeClass("highlight");d.removeClass("highlight")}}},scrollToReview:function(b,d,c){var j=document.getElements(".persistent_tabs_header");var e=0;if(j){e=j.getHeight()}var g=ta.id("review_"+c);if(g){window.scrollTo(0,g.getPosition().y-e)}else{var f=ta.retrieve("location.helpful_review_highlight.full."+c);if(f){var h=ta.select("#REVIEWS .reviewSelector");var a=Elements.from(f);h.some(function(k){if(!k.getParent("#FRIENDS_LOCATION_CONTENT_SUMMARY")){a.inject(k,"before");g=ta.id("review_"+c);window.scrollTo(0,g.getPosition().y-e);return true}return false})}}},poiTypeIdMap:{2:"hotel",7:"eat",5:"attr"},selectPoiIcon:function(c,a){ta.select(".poiTypes li").addClass("collapsed");a.removeClass("disabled");a.getSiblings().addClass("disabled");var b=ta.find(".unattachedTypeahead");b&&b.toggleClass("hidden",a.id=="type_rental");ta.servlet.Reviews.changeSearchType(c,a)},createUnattachedTypeahead:function(e,c){c.onfocus=null;var b=ta.find('input[name="type"]').value;var d=ta.servlet.Reviews.poiTypeIdMap[b];var f=TypeAhead.utils.query(false,d,null,null,true,10);var a={name:"UnattachedWarLander",minChars:3,maxResults:10,containerParent:ta.id("PAGE"),containerClass:"typeaheadResults",search:f,itemTemplate:TypeAhead.views.itemTemplate(),itemSelector:"li",width:348,positionRelative:false,selectInputText:false,selectOnBlur:false,assumeOnBlur:false,cacheResults:false,autopopulateHighlighted:false,forceProcessResults:true,onSelect:function(h){var j=ta.id("UR_SELECT");if(j&&h){j.appendChild(new Element("input",{type:"hidden",name:"detail",value:h.value}));j.submit()}},resolveSelection:function(h){return h.name.stripTags()},onShow:function(h){h.container.addClass("visible")},onHide:function(h){h.container.removeClass("visible")}};TypeAhead.views.configureTypeAheadForSegmentedResults(a);var g=new TypeAhead(c,a);c.store("typeahead",g)}};ta.servlet.Location={distanceUnitsCookieName:"TAdistanceCookie",showMi:function(){$$("#NEARBY .milesOption").each(function(b,a){b.checked=true});$$("#NEARBY .milesLabel").each(function(b,a){$(b).addClass("selected")});$$("#NEARBY .kmLabel").each(function(b,a){$(b).removeClass("selected")});$$("#NEARBY .distanceMiles").show();$$("#NEARBY .distanceKm").hide();Cookie.write(this.distanceUnitsCookieName,0)},showKm:function(){$$("#NEARBY .kmOption").each(function(b,a){b.checked=true});$$("#NEARBY .milesLabel").each(function(b,a){$(b).removeClass("selected")});$$("#NEARBY .kmLabel").each(function(b,a){$(b).addClass("selected")});$$("#NEARBY .distanceMiles").hide();$$("#NEARBY .distanceKm").show();Cookie.write(this.distanceUnitsCookieName,1)},reportClosedVote:function(b,a,c){if(c&&c>0){c=encodeURIComponent(c);new Request({method:"get",url:"/ReportIAP?action=geocodeclosed&id="+c,onSuccess:function(d){ta.overlays.showInLightbox(d,{style:"mg s4",delayedPosition:true})}}).send()}},reportGeoCode:function(d,c,e,b,a){if(e&&e>0){e=encodeURIComponent(e);new Request({method:"get",url:"/ReportIAP?action=geocodebad&id="+e,onSuccess:function(f){ta.overlays.showInLightbox(f,{style:"mg s4",delayedPosition:true})}}).send()}if(ta.trackEventOnPage&&b&&a){ta.trackEventOnPage(b,a,e)}},reportCorrectAddr:function(c,f,l,o,d,j,m,p){if(l&&l>0){l=encodeURIComponent(l);var h=document.getElementById("street").value;var k=document.getElementById("city").value;var b=document.getElementById("state").value;var e=document.getElementById("zip").value;var g=document.getElementById("country").value;var n=document.getElementById("phone").value;var a=document.getElementById("website").value;if(o==h&&d==k&&j==e&&m==n&&p==a){new Request({method:"post",url:"/ReportIAP?action=geocodecorrect&updated=false&id="+l,onSuccess:function(q){ta.overlays.showInLightbox(q,{style:"mg s4",delayedPosition:true})}}).send()}else{h=encodeURIComponent(h);k=encodeURIComponent(k);b=encodeURIComponent(b);e=encodeURIComponent(e);g=encodeURIComponent(g);n=encodeURIComponent(n);a=encodeURIComponent(a);new Request({method:"post",url:"/ReportIAP?action=geocodecorrect&updated=true&id="+l+"&street="+h+"&city="+k+"&state="+b+"&zip="+e+"&country="+g+"&phoneNumber="+n+"&webSite="+a,onSuccess:function(q){ta.overlays.showInLightbox(q,{style:"mg s4",delayedPosition:true})}}).send()}}},reportGeoCodeDialog:function(d,c,e,b,a){if(typeof(incorrectLocation)!="undefined"&&!this.incorrectLocationLink){this.incorrectLocationLink=Asset.css(incorrectLocation)}if(e&&e>0){e=encodeURIComponent(e);new Request({method:"get",url:"/ReportIAP?id="+e+"&action=geocodedialog",onSuccess:function(f){ta.overlays.showInLightbox(f,{style:"mg s4",delayedPosition:true})},evalScripts:true}).send()}if(ta.trackEventOnPage&&b&&a){ta.trackEventOnPage(b,a,e)}},updateListingInformation:function(a,c,e,j,f,b,h,g){if(e&&e>0){if(g){window.location.href=g}else{var d={style:"glnew_lightbox",closeButtonClass:"innerClose",delayedPosition:true,attachCloseEvent:false,permanent:true,showCloseButton:true};new Request({url:"/GetListedUpdate"+b+"?id="+e,onSuccess:function(l){var k=ta.overlays.showInLightbox(l,Object.merge(d,{title:h}));k.closeBtn.addEvent("click",function(){ta.GetListedNew.closeOverlay()})},evalScripts:true}).send()}}if(ta.trackEventOnPage&&j&&f){ta.trackEventOnPage(j,f,e)}},reportClosedVoteNew:function(d,c,f,b,a,e){if(f&&f>0){new Request({method:"post",url:"/"+e+"?action=closedareyousure&id="+f,onSuccess:function(g){ta.overlays.showInLightbox(g,{style:"glnew_update_areyousure mg s4",delayedPosition:true,isChild:true,showCloseButton:false})},evalScripts:true}).send()}},recordOpenVote:function(d,c,f,b,a,e){if(f&&f>0){new Request({method:"post",url:"/"+e+"?action=voteopen&id="+f,onSuccess:function(g){ta.overlays.showInLightbox(g,{style:"mg s4",delayedPosition:true,showCloseButton:false})},evalScripts:true}).send()}},requestListingWithLightbox:function(b,c,a,h,k,e){var f={};var j=document.getElementById("query");if(j&&j.value){f.query=j.value}var d={style:"glnew_lightbox",closeButtonClass:"innerClose",delayedPosition:true,attachCloseEvent:false,permanent:true,showCloseButton:true};var g="/GetListedLightbox?placetype="+a;if(k){g=g+"&showthanks=true"}if(e){g=g+"&fromWARToDo=true"}new Request({method:"post",url:g,data:f,onSuccess:function(m){var l=ta.overlays.showInLightbox(m,Object.merge(d,{title:h}));l.closeBtn.addEvent("click",function(){ta.GetListedNew.closeOverlay()});ta.select(".overlayBG").setStyle("height",Math.max(window.innerHeight?window.innerHeight:(document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.offsetHeight),document.body.scrollHeight))},evalScripts:true}).send()},showReportForm:function(b,a,c){if(c&&c>0){c=encodeURIComponent(c);new Request({method:"get",url:"/ReportIAP?id="+c+"&action=geocodeform",onSuccess:function(d){ta.overlays.showInLightbox(d,{style:"mg s4",delayedPosition:true})},evalScripts:true}).send()}},setTrackPID:function(c,b,a){if(a==10022){ta.util.cookie.setPIDCookie(17138)}else{if(a==10021){ta.util.cookie.setPIDCookie(17137)}}},closeLightbox:function(){var a=ta.retrieve("overlays.current");if(a){a.hide()}},activateReportButton:function(){var a=ta.id("REPORT_LOCATION").getElements(".button")[0];a.removeClass("inactive");a.removeProperty("disabled")}};ta.servlet.Member={memberBenefitsSubscribe:function(a){ta.servlet.Member.processMOSubscribeRequest(a);return false},memberGuideRequest:function(a){processGuideRequest(a)},memberTOGForm:function(a){processTOGForm(a)},processMOSubscribeRequest:function(a){if(!loggedIn){new Event(a).preventDefault();return false}var d=$("MEMONLY_SUBS_FORM");d.elements.action.value="subscribe";var c={url:"/TravelGuides",data:d,onFailure:function(f){alert(f.status+"\n"+f.responseText)}};c.onSuccess=ta.servlet.Member.subscribeRequestResFunc;var b=window["validate"+d.id];new Event(a).preventDefault();new Request(c).send()},subscribeRequestResFunc:function(a){if(a!=""){for(subtype in subtypes){if(subtyperes[subtype].test(a)){if(subtype=="tw"&&ta.retrieve("tcd.refresh")){window.location.reload()}var g=document.getElementById(subtype+"Optin");g.setAttribute("checked","true");g.setAttribute("disabled","true");var c=document.getElementById(subtype+"OptinLbl");c.innerHTML="<b>"+headings[subtype]+"</b> "+tamg_thanks;var f=document.getElementById("OPTINTEXT");f.style.display="none"}}var k={};for(subtype in subtypes){var d=document.getElementById(formids[subtype]);k[subtype]=d.checked}var h=true;var j=true;for(subtype in k){if(subtyperes[subtype].test(a)){h=false}if(!k[subtype]){j=false}}if(j){var e=document.getElementById("NLSUBMITDIV");e.style.display="none"}if(h){var b=document.getElementById("OPTINTEXT");b.innerHTML='<div class="alert">'+no_selection_error+"</div>";b.style.display="block"}}},addTripWatchLocation:function(event,elmt,updateTxt){var mElmt=new Element(elmt);new Event(event).stop();new Request({url:elmt.href,onFailure:ta.util.error.ajaxFailure.partial("Member:addTripWatchLocation"),onSuccess:function(txt,xml){if(txt.match(/^{/)){var data=eval("("+txt+")");if(data.ERROR){ta.overlays.showInLightbox(data.ERROR);return}else{if(data.ALERT){ta.overlays.showInLightbox(data.ALERT);return}}}var spanElt=new Element("span");spanElt.set("html",updateTxt);mElmt.hide();spanElt.inject(mElmt,"after")}}).send()},addTripWatchLocationReload:function(a){new Request({url:a.href,onFailure:ta.util.error.ajaxFailure.partial("Member:addTripWatchLocationReload"),onSuccess:function(b,c){window.location.reload()}}).send()}};ta.servlet.Popup={index:0,open:function(a,b,c,q,m,l,g,p){try{if(isNaN(parseInt(c))){c=600}else{c=parseInt(c)}if(isNaN(parseInt(q))){q=400}else{q=parseInt(q)}if(isNaN(parseInt(m))){m=0}else{m=parseInt(m)}if(isNaN(parseInt(l))){l=0}else{l=parseInt(l)}if(a.indexOf("p=HotelsCom")>-1){c=Math.max(c,960);q=Math.max(q,window.getHeight(),600)}if(Browser.chrome){g=true}var f=1;if(g){f=0}var k=1;if(ta.browser.isIE9orHigher()){var k=0}var j=false;if(b&&typeof b=="string"){j=b}if(!j){var r=ta.servlet.Popup.index++;j="TripPop"+r}var d="";if(p){d="toolbar=1,resizable=1,location=1,status=1"}else{k=0;d="toolbar=0,resizable=1,location=0,status=0"}d+=",menubar="+k;d+=",scrollbars="+f;d+=",width="+c;d+=",height="+q;d+=",screenX="+m+",left="+m;d+=",screenY="+l+",top="+l;var n=window.open(a,j,d);if(n!=null){try{n.focus();n.opener=self}catch(o){}return n}}catch(h){ta.util.error.record(h,"Popup.open",null,{name:b,width:c,height:q,x:m,y:l,noScroll:g,allOptions:p})}},openExternalWithDefaultOptions:function(a){try{var b=475;var o=390;var l=210;var k=5;if(screen.width>=1024&&screen.height>=768){b=900;o=768;l=240}else{if(screen.width>1024){b=800;o=600;l=240}else{if(screen.width>800){b=620;o=500;l=240}}}if(a.indexOf("p=HotelsCom")>-1){b=Math.max(b,960);o=Math.max(o,window.getHeight(),600)}var f=false;if(Browser.chrome){f=true}var d=1;if(f){d=0}var j=1;if(ta.browser.isIE9orHigher()){var j=0}var p=ta.servlet.Popup.index++;var h="TripPop"+p;var c="toolbar=1,resizable=1,location=1,status=1";c+=",menubar="+j;c+=",scrollbars="+d;c+=",width="+b;c+=",height="+o;c+=",screenX="+l+",left="+l;c+=",screenY="+k+",top="+k;var m=window.open(a,h,c);if(m!=null){try{m.focus();m.opener=self}catch(n){}return m}}catch(g){ta.util.error.record(g,"Popup.open - openExternalWithDefaultOptions",null,{name:name,width:b,height:o,x:l,y:k,noScroll:f})}},openSizedPopup:function(e,b,d){new Event(e).preventDefault();var c=600;var a=400;if(sz=b.className.match(/sz(\d+)x(\d+)/)){c=sz[1];a=sz[2]}ta.servlet.Popup.open(b.href,"photoTPW",c,a,false,false,((typeof d!="undefined")?d:true),true)},checkrates:function(b,a){b.preventDefault();if(a.get("tag")!="a"){a=a.getParent("a")}ta.servlet.Popup.open(a.href,"cr",245,610,5,5);if(ta.trackEventOnPage){ta.trackEventOnPage("map_pin_overlay","check_rates_click")}},sponsorCheckRates:function(d,b){d.preventDefault();if(b.get("tag")!="span"){b=b.getParent("span")}var a=b.className.match(/id_(\d+)/)[1];var c="/HotelDateSearch?d="+a+"&fromPop=false&sponsid="+ta.retrieve("sponsor.id")+"&area=QC_Button_Map&from=HACSearchButton&returnTo=__2F__GMapsLocationController&sponsdet=mapsHacBottom";ta.servlet.Popup.open(c,"cr",245,610,5,5)},termsPopup:function(b,a){popup.apply(a,[b,"terms",300,300,30,25]);return false},openInParent:function(e,d,c){var a=false;if(window.top&&window.top.opener){a=window.top}else{if(window.opener){a=window}}if(!a){return true}var b="";if(d.get("tag")=="form"){b=d.action+"?"+d.toQueryString()}else{if(d.get("tag")=="a"){b=d.href}else{d=d.getParent("a");b=d.href}}if(b!=""){if(e){e.preventDefault()}a.opener.location=b;if(!(typeof c!="undefined"&&c)){a.close()}else{window.blur()}}},openInParentOrSelf:function(d,c){var a=false;if(window.top&&window.top.opener){a=window.top}else{if(window.opener){a=window}}var b="";if(c.get("tag")=="form"){b=c.action+"?"+c.toQueryString()}else{if(c.get("tag")=="a"){b=c.href}else{c=c.getParent("a");b=c.href}}if(b!=""){if(d){d.preventDefault()}if(!a||(typeof a.opener=="undefined")||!a.opener||(typeof a.opener.closed=="undefined")||a.opener.closed){window.location=b}else{a.opener.location=b;a.close()}}},photoGallery:function(a,d){try{if(!d){return false}if(!d.get||!d.getParentBySelector){d=$(d)}if(!d.get||!d.getParentBySelector){ta.util.error.record(j,"photoGallery - elmt not wrapped");return false}if(d.get("tag")!="a"){d=d.getParentBySelector("a")}}catch(j){ta.util.error.record(j,"photoGallery - get anchor elmt");return false}var b="";var c="1";if(d.className){b=d.className.match(/u_([^ ]*)/)[1];c=d.className.match(/#([0-9]+)/)[1]}try{if(typeof cookieDomain=="undefined"){var g=window.location.hostname.split("."),f=0,l;while(g[f]&&g[f]!="tripadvisor"){f++}l=g.slice(f).join(".");if(l){cookieDomain="."+l}}Cookie.write("PhotoPop",c,{domain:cookieDomain})}catch(j){ta.util.error.record(j,"photoGallery - cookie set")}try{var k="";if(b){k=ta.servlet.Popup.open(b,"media",780,800)}else{}try{if(k&&k.showImage){k.showImage(c)}}catch(j){}}catch(j){ta.util.error.record(j,"photoGallery - pop window")}return false},openAIMLink:function(d,c){new Event(d).preventDefault();var b;if(c.get("tag")=="span"&&c.hasClass("fkASDF")){b=c.className.match(/u_([^ ]*)/)[1]}else{if(c.getParent("div.fkASDF")){b=c.getParent("div.fkASDF").className.match(/u_([^ ]*)/)[1]}else{if(c.get("tag")=="a"){b=c.href}else{if(c.getParent().get("tag")=="a"){b=c.getParent().href}else{return}}}}b=b.replace("%7Cnavarea%7C",ta.meta.link.getPhotoNavArea(c));var a=c.className.match(/win(.+)/);if(a&&a.length>1){a=a[1]}else{a=null}ta.store("commerce.AIMWindow",ta.servlet.Popup.open(b,a,980,800,240,5,false,true));try{if(ta.has("checkrates.lpl_check_rates")&&c.href&&c.href.match(/LocationPhotosLightbox/)){ta.id("MEDIA_GALLERY").hide()}}catch(f){ta.util.error.record(f,"LPL photoGallery - could not hide photo gallery")}},openProviderWindow:function(b,a){new Event(b).preventDefault();ta.servlet.Popup.open(a.href,"photoTPW",1260,922,false,false,true,true)}};ta.servlet.Hotel={detailsTabClicked:function(b,a){showTab(locationId,"tabDetails")},photosTabClicked:function(b,a){showTab(locationId,"tabPhotos")},mapTabClicked:function(b,a){showTab(locationId,"tabMap")},ratingsTabClicked:function(b,a){showTab(locationId,"tabRatings")},anchorAtHotelsSortingHeader:function(){var a=ta.id("hotels_list_sorting_header");if(a){new Fx.Scroll(document.body,{offset:{x:0,y:a.getPosition().y}}).toTop()}},setPid:function(a){ta.util.cookie.setPIDCookie(a)},setConceptCookie:function(){if(ta.has("topconcepts.lastconcept")){var a=ta.retrieve("topconcepts.lastconcept");Cookie.write("CONCEPT",a,{domain:cookieDomain,time:5})}return true},voteRecorded:false,recordVote:function(b,g,e,c,a){if(a.checked&&!ta.servlet.Hotel.voteRecorded){ta.servlet.Hotel.voteRecorded=true;new Request({url:"/ActionRecord-g"+b+"-d"+g+"?action=TopConceptsHelpful_"+e}).send();var d=$("preVote");var f=$("postVote");if(d&&f){d.style.display="none";f.style.display="inline"}else{ta.util.error.record(null,"recordVote - cannot find voting spans")}}return true},isHotelsServlet:function(a){if(ta.has("is_hotels_serv")){return ta.retrieve("is_hotels_serv")}var b=ta.id("PAGE");if(b&&typeof b!="undefined"){if(b.hasClass("hotels_like")){ta.store("is_hotels_serv",true);return true}else{if(b.hasClass("non_hotels_like")){ta.store("is_hotels_serv",false);return false}}}if(typeof a!="undefined"){return a}return false},selectLanguage:function(d,b,e){var c=ta.id("LANG_FORM");var a=ta.id("filterLang");if(c&&a){ta.setEvtCookie("Reviews_Controls","language_sort","",0,window.location.href);a.value=e;c.submit()}},selectSeason:function(a,f,j,b,d,e){var g=ta.find("#MONTH_FORM .seasonLabel");if(ta.util.localstorage&&ta.util.localstorage.canUseLocalStore()){var h=new Date();h.setHours(h.getHours()+12);if(d!=0){localStorage.setItem("season_memory_expiry_time",h);localStorage.setItem("season_memory_loc_id",j);localStorage.setItem("season_memory_geo_id",b)}else{localStorage.removeItem("season_memory_expiry_time");localStorage.removeItem("season_memory_popup_shown");localStorage.removeItem("season_memory_loc_id");localStorage.removeItem("season_memory_new_popup_shown");localStorage.removeItem("season_memory_geo_id")}}if(g&&e){g.set("text",e)}var c=ta.id("MONTH_FORM");var l=ta.id("filterSeasons");if(c&&l){l.value=d;ta.trackEventOnPage("Reviews_Controls","season","",d);function k(){var m=ta.select(".seasonList .spinner img");m.forEach(function(o){o.remove()});var n=ta.find(".spinner",f);if(n){new Asset.image(CDNHOST+"/img2/spinner.gif").inject(n)}}k();c.submit()}}};ta.widgets.calendar={multiDateFormatter:function(f,g,e,c,d){var b={cname:"",contents:f.getDate()};var a="";if(!e){a="invalid"}else{if(f.getTime()==this.today.getTime()){if(this.newInDate&&f.getTime()==this.newInDate.getTime()){a="today inDate"}else{if(!g){a="today disabled"}else{a="today"}}}else{if(this.newInDate&&f.getTime()==this.newInDate.getTime()){a=d.inDateClass}}}b.cname=a;return b},calendarMultiSelect:function(h,g,a,f,b){try{ta.id(b).getParent(".overlay").overlay.calendar.multiSelect(h,ta.util.date.create(g,a,f),b)}catch(c){ta.util.error.record(c,"calendarMultiSelect issue")}},calendarMouseOver:function(f,e,a,c,b){ta.id(b).getParent(".overlay").overlay.calendar.dayOver(f,ta.util.date.create(e,a,c),b)},calendarPrev:function(c,b){var a=ta.id(b);if(a&&a.hasClass("sprite-date_picker-btnLeftInactive")){return}if(ta.util.i18n.isRtl()&&a&&a.hasClass("sprite-date_picker-btnRightInactive")){return}a.getParent(".overlay").overlay.calendar.prev()},calendarNext:function(c,b){var a=ta.id(b);if(a&&a.hasClass("sprite-date_picker-btnRightInactive")){return}if(ta.util.i18n.isRtl()&&a&&a.hasClass("sprite-date_picker-btnLeftInactive")){return}a.getParent(".overlay").overlay.calendar.next()},adultsOver:function(c,b){var a=document.getElements(".date_picker_adults_option");if(a){Array.each(a,function(d){ta.id(d).removeClass("adults_selected")})}ta.id(b).addClass("adults_selected")},removeMetaCalendarFromSync:function(c){if(!ta.has("metaDatePickerEnabled")){return}var b="avail.data."+c+"._met";var a=ta.retrieve("avail.data.objects");if(a){a.erase(b)}ta.store("avail.data.objects",a);ta.remove(b)},getCalendarObjectKey:function(d,b,a){var c="avail.data";if(a){c=c+"."+a}c=c+"."+d;if(b){c=c+"."+b}return c},trackCalendarObject:function(c){var a=ta.widgets.calendar.getCalendarObjectKey(c.locId,c.ext,c.calendar.options.pickerOption);ta.store(a,c);var b=ta.retrieve("avail.data.objects");if(!b){b=[]}b.include(a);ta.store("avail.data.objects",b)},trackCalendarFlyout:function(d,c,e){var f="date.picker.calendarflyout";var b=ta.retrieve(f);if(!b){b=[]}var a={};a.elmt=d;a.overlay=c;a.overlaySrc=e;b.push(a);ta.store(f,b);ta.remove("date.picker.calendarflyout.allCleared")},clearCalendarFlyouts:function(){var b="date.picker.calendarflyout";var a=ta.retrieve(b);if(a){a.each(function(c){var e=c.elmt;var d=c.overlay;var f=c.overlaySrc;if(e&&d&&f){e.removeEvent("mouseenter",d.showWithDelay);e.removeEvent("mouseleave",d.hideWithDelay);e.removeEvent("mouseenter",d.show);e.removeEvent("mouseleave",d.hide);e.removeEvent("click",d._pin);e.adopt(f)}});ta.store("date.picker.calendarflyout.allCleared",true)}},getDateBefore:function(b){var a=new Date(b.getTime());a.setDate(a.getDate()-1);return a},getDateAfter:function(b){var a=new Date(b.getTime());a.setDate(a.getDate()+1);return a},setPageInDate:function(a){if(a&&a.getDate){ta.store("date.picker.pageInDate",a)}if(ta.has("date.picker.pageOutDate")){ta.store("meta.page_dates",true)}},setPageOutDate:function(a){if(a&&a.getDate){ta.store("date.picker.pageOutDate",a)}if(ta.has("date.picker.pageInDate")){ta.store("meta.page_dates",true)}ta.widgets.calendar.updateCalendarPropertiesOnDateSet()},setTimeoutPageDates:function(){var b=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.inDateTimeout"));if(b){ta.widgets.calendar.setPageInDate(b)}var a=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.outDateTimeout"));if(a){ta.widgets.calendar.setPageOutDate(a)}},clearPageDates:function(){ta.store("data.picker.cachedDateCleared",true);ta.remove("date.picker.pageInDate");ta.remove("date.picker.pageOutDate");ta.remove("multiDP.inDate");ta.remove("multiDP.outDate");ta.remove("meta.page_dates");ta.remove("meta.session_dates");ta.remove("multiDP.priorDates");if(ta.isMetaHotelsRequest()||ta.has("meta.mini_meta_on_accommodations")){ta.store("dates.datesCleared",true)}},clearPageInDate:function(){ta.remove("date.picker.pageInDate");ta.remove("multiDP.inDate");ta.remove("meta.page_dates")},clearPageOutDate:function(){ta.remove("date.picker.pageOutDate");ta.remove("multiDP.outDate");ta.remove("meta.page_dates")},updateCalendarPropertiesOnDateSet:function(){var a=ta.retrieve("avail.data.objects");if(a){Array.each(a,function(c){var b=ta.retrieve(c);if(b&&b.calendar){b.calendar.setPermanent(false)}})}},setPageAdultsCount:function(a){if(a){ta.store("date.picker.adultsCount",a)}},getPageInDate:function(){var a=false;if(ta.has("date.picker.pageInDate")){a=ta.retrieve("date.picker.pageInDate")}if(!a&&ta.has("multiDP.inDate")){a=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.inDate"));if(a){ta.widgets.calendar.setPageInDate(a)}}if(a){return new Date(a.getTime())}return false},getPageOutDate:function(){var a=false;if(ta.has("date.picker.pageOutDate")){a=ta.retrieve("date.picker.pageOutDate");if(!ta.widgets.calendar.isValidStayLength(a)){ta.widgets.calendar.clearPageOutDate();return false}if(a){return new Date(a.getTime())}}if(!a&&ta.has("multiDP.outDate")){a=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.outDate"));if(a){ta.widgets.calendar.setPageOutDate(a)}if(!ta.widgets.calendar.isValidStayLength(a)){ta.widgets.calendar.clearPageDates();return false}if(a){return new Date(a.getTime())}}return false},haveDatesChanged:function(){var a=ta.widgets.calendar.getPageInDate(),b=ta.widgets.calendar.getPageOutDate(),d=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.inDate")),c=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.outDate"));return(!d||a.getTime()!=d.getTime())||(!c||b.getTime()!=c.getTime())},isValidStayLength:function(a){var b=ta.widgets.calendar.getPageInDate();if(!b||!a){return true}var c=a-b;c=Math.round(c/1000/60/60/24);if(c>ta.util.date.MAX_STAY_DURATION_DAYS){return false}return true},getPageAdultsCount:function(){if(ta.has("date.picker.adultsCount")){return ta.retrieve("date.picker.adultsCount")}if(ta.has("multiDP.adultsCount")){ta.store("date.picker.adultsCount",ta.retrieve("multiDP.adultsCount"));return ta.retrieve("multiDP.adultsCount")}return"2"},getGuestsRoomsPickerData:function(){var g=ta.retrieve("guests.rooms.object"),c,b;if(!g){try{var f=Cookie.read("TATravelInfo");var a=ta.widgets.calendar.getGuestsRoomsValue(f,"A");if(a&&a!==""){c=parseInt(a,10)}var d=ta.widgets.calendar.getGuestsRoomsValue(f,"RS");if(d&&d!==""){b=parseInt(d,10)}if(c&&c>0&&b&&b>0){g={rooms:b,guests:c};ta.store("guests.rooms.object",g)}}catch(h){ta.util.error.record(h,"ta.widgets.calendar.getGuestsRoomsPickerData")}}if(!g){g={rooms:1,guests:2};ta.store("guests.rooms.object",g)}return g},getCheckRatesData:function(){var e=ta.widgets.calendar.getPageInDate();var b=ta.widgets.calendar.getPageOutDate();var c=ta.widgets.calendar.getPageAdultsCount();if(!e||!b||!e.getMonth||!b.getMonth){return false}var a={inMonth:(e.getMonth()+1)+" "+e.getFullYear(),inDay:e.getDate(),outMonth:(b.getMonth()+1)+" "+b.getFullYear(),outDay:b.getDate(),adults:c};if(ta.has("guests_rooms_picker.enabled")){var d=ta.widgets.calendar.getGuestsRoomsPickerData();a.adults=d.guests;a.rooms=d.rooms}return a},_parseDatePickerDate:function(c){try{if(c&&c.split&&c.split(" ").length>1){var a=c.split(" ");var b=new Date();ta.util.date.normalize(b);b.setFullYear(a[0]);b.setDate(1);b.setMonth(parseInt(a[1],10)-1);b.setDate(a[2]);return b}}catch(d){return false}},hasPageDates:function(){if(!ta.has("metaDatePickerEnabled")){return false}if(ta.has("meta.page_dates")){return true}ta.widgets.calendar.getPageInDate();ta.widgets.calendar.getPageOutDate();return ta.has("meta.page_dates")},oneDayMill:(24*60*60*1000),updateDateWidgetDisplay:function(a){if(!a){return}ta.id(a).removeClass("date_picker_error");var c=ta.widgets.calendar.getPageInDate();var b=ta.widgets.calendar.getPageOutDate();ta.widgets.calendar.updateDateDisplay(a,c,b);var d=document.getElements(".adults");if(d){d.each(function(e){ta.widgets.calendar.updateAdultsDisplay(e)})}},getPageInCalendarField:function(b,a){return ta.id("date_picker_in_"+b+a)},getPageOutCalendarField:function(b,a){return ta.id("date_picker_out_"+b+a)},getErrorDates:function(){var c="no dates";try{var a=ta.widgets.calendar.getDatePickerFormat("classic");if(ta.widgets.calendar.hasPageDates()){c=ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageInDate(),a);c=c+" - "+ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageOutDate(),a)}}catch(b){}return c},updateDateDisplay:function(b,c,g){var d,a,f,j,e,h,k;if(c&&g&&c.getTime()>g.getTime()){d=c;c=g;g=d}a=ta.widgets.calendar.getDatePickerFormat("classic");if(ta.id(b).getParent(".dual_date")){b.innerHTML=c?ta.widgets.calendar.dateToString(c,a):ta.retrieve("multiDP.checkIn");f=b.id.replace("date_picker_in","date_picker_out");if(f&&ta.id(f)){ta.id(f).innerHTML=g?ta.widgets.calendar.dateToString(g,a):ta.retrieve("multiDP.checkOut")}}else{j=b.innerHTML=ta.retrieve("multiDP.enterDatesText");e=ta.widgets.calendar.getSingleDateFieldDatesText(c,g,a);if(e){j=e}b.innerHTML=j;h=ta.id(b).getParent();if(h){k=h.getElement(".date_picker_calendar_nights");ta.widgets.calendar.updateNightsDisplay(k,c,g)}}},getSingleDateFieldDatesText:function(d,b,a){var c="";var e=ta.retrieve("multiDP.dateSeparator")||" - ";if(d){c=ta.widgets.calendar.dateToString(d,a)+e;if(b){c=c+ta.widgets.calendar.dateToString(b,a)}}return c},updateNightsDisplay:function(d,c,a){if(!d){return}if(!a){d.innerHTML="";return}var b=ta.widgets.calendar.getNumberOfNightsFromDates(c,a);if(b==1){d.innerHTML=ta.retrieve("multiDP.singleNightText")}else{d.innerHTML=ta.retrieve("multiDP.multiNightsText").replace(/\d+/,b)}},getNumberOfNights:function(){var b=ta.widgets.calendar.getPageInDate(),a=ta.widgets.calendar.getPageOutDate();return ta.widgets.calendar.getNumberOfNightsFromDates(b,a)},getNumberOfNightsFromDates:function(b,a){if(b&&a){return Math.round(Math.abs((b.getTime()-a.getTime())/ta.widgets.calendar.oneDayMill))}else{return 0}},updateAdultsDisplay:function(b){if(!b){return}var a=ta.widgets.calendar.getPageAdultsCount();if(a=="1"){b.innerHTML=ta.retrieve("multiDP.singleAdultsText")}else{b.innerHTML=ta.retrieve("multiDP.multiAdultsText").replace(/\d+/,a)}},syncAllDatePickers:function(){var c=document.getElements(".date_picker.date");if(c){Array.each(c,function(g){if(g&&!ta.id(g).hasClass("out_date")){ta.widgets.calendar.updateDateWidgetDisplay(g)}})}var a=$$(".tablet_date_label");if(a&&ta.widgets.calendar.hasPageDates()){a.addClass("showLabels")}a=document.getElements(".dateLabel");if(a){var f=ta.widgets.calendar.getDatePickerFormat("short");var b=ta.widgets.calendar.getDatePickerFormat("classic");var e=ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageInDate(),b);if(ta.has("guests_rooms_picker_3.enabled")){e=ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageInDate(),f)}var d=ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageOutDate(),b);Array.each(a,function(g){var h=ta.id(g);if(h){if(h.hasClass("inDate")){h.innerHTML=e?e:ta.retrieve("multiDP.checkIn")}else{if(h.hasClass("outDate")){h.innerHTML=d?d:ta.retrieve("multiDP.checkOut")}}}})}},getDatePickerFormat:function(a){if(a==="classic"&&typeof DATE_PICKER_CLASSIC_FORMAT!="undefined"){return DATE_PICKER_CLASSIC_FORMAT}else{if(a==="short"&&typeof DATE_PICKER_SHORT_FORMAT!="undefined"){return DATE_PICKER_SHORT_FORMAT}else{if(typeof DATE_PICKER_META_FORMAT!="undefined"){return DATE_PICKER_META_FORMAT}}}if(typeof a!="string"){a="not_a_string"}return""},dateToString:function(d,e){var b,k,a,h,c,l,j,f,g;if(!d.getDate||!e){return""}if(e==ta.widgets.calendar.getDatePickerFormat("classic")){b=new Date(d);if(ta.retrieve("thai_buddhist_era_year")){b.setFullYear(b.getFullYear()+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET)}k="MM";a="yyyy";h="dd";f=b.getDate()+"";if(f&&f.length===1){f="0"+f}g=(b.getMonth()+1)+"";if(g&&g.length===1){g="0"+g}e=e.replace(k,g).replace(h,f).replace(a,b.getFullYear()).replace(/'/g,"");return e}else{if(e==ta.widgets.calendar.getDatePickerFormat("short")){b=new Date(d);k="MM";h="dd";f=b.getDate()+"";if(f&&f.length==1){f="0"+f}g=(b.getMonth()+1)+"";if(g&&g.length==1){g="0"+g}e=e.replace(k,g).replace(h,f).replace(/'/g,"");return e}}c=ta.retrieve("multiDP.abbrevMonthList");l=d.getDay();if(ta.retrieve("multiDP.isMondayFirstDayOfWeek")){l=l-1}if(l==-1){l=6}j="EEE";k="MMM";if(e=="EEEE d MMMM"){j="EEEE";k="MMMM"}e=e.replace(j,jsGlobalDaysAbbrev[l]).replace(k,c[d.getMonth()]).replace(/\bd\b/,d.getDate()).replace(/'/g,"");return e},showCalendarByLocId:function(b,a){if(!/^\d+$/.test(b)){ta.util.error.record(null,"Cannot show calendar due to missing/invalid location ID: "+b);return}a=a||"";var c={id:"",className:"id_"+b+a,"data-date_suffix":a,toString:function(){return"[showCalendarSrc: "+b+a+"]"}};ta.widgets.calendar.setErrorStyling(c)},clickCalendarEvent:function(b){if(document.createEvent){var a=document.createEvent("HTMLEvents");a.initEvent("click",true,true);b.dispatchEvent(a)}else{b.click()}},setErrorStyling:function(d){var c=false,g=d["data-date_suffix"]||null;var b=d.id.match(/CHECK_RATE_([a-zA-Z]+)/);if(b&&b.length>1&&(b[1]=="mnf"||b[1]=="mnl"||b[1]=="photoviewer")){g="_"+b[1]}try{c=d.className.match(/\bid_(\d+)/)[1]}catch(f){}if(c){var a=false;var h="date_picker_in_";if(!a&&g){a=ta.id(h+c+g)}if(!a){a=ta.id(h+c+"_met")}if(!a){a=ta.id(h+c+"_cro")}if(!a){a=ta.id(h+c+"_per")}if(!a){a=ta.id(h+c+"_pop")}if(!a){a=ta.id(h+c+"_mnl")}if(!a){a=ta.id(h+c+"_mnm")}if(!a){a=ta.id(h+c+"_smt")}if(!a){a=ta.id(h+c+"_pto")}if(!a){a=ta.id(h+c+"_pal")}if(!a){a=ta.id(h+c+"_amo")}if(!a&&d.id.slice(-4)=="_inm"){a=ta.id(h+c+"_inm")}if(!a){a=ta.id(h+c)}if(a){setTimeout(function(){ta.widgets.calendar.clickCalendarEvent(a)},100)}}},launchInlineMeta:function(a){ta.widgets.calendar._crBtnOnclick("#CHECK_RATE",a)},launchMetaLightboxUpdate:function(){},launchCRLBUpdate:function(){ta.commerce.meta.clearStoredMiniData();ta.overlays.Factory.updateMiniMetaPlacements()},_crBtnOnclick:function(b,c){ta.store("meta.calendarCR",true);var a=document.getElement(b);if(a){document.getElement(b).onclick(c)}ta.remove("meta.calendarCR")},onShowPricesClick:function(a,b){if(!ta.widgets.calendar.hasPageDates()){return}ta.trackEventOnPage("GuestRoomSelector","ShowPrices_Calendar_click");if(b==="Hotels"){ta.servlet.HACSearch.doMetaDateSearch();ta.commerce.meta.updateHeaderDates()}else{if(b==="HotelHighlight"){ta.widgets.calendar.onCalendarRangeSelect(a)}else{window.fireEvent("newInlinePageDates",[a])}}ta.widgets.calendar.closeCalendarWidgets();if(ta.has("guests_rooms_picker_3.enabled")){this.displayStayInfoPicker()}},displayStayInfoPicker:function(){$$(".stayInfoHeader").removeClass("hidden");$$(".changeStayInfoButton").removeClass("hidden");$$(".date_control_wrapper").addClass("hidden")},closeCalendarWidgets:function(){var b=document.getElements(".date_picker_calendar");if(b){Array.each(b,function(e){if(e&&e.overlay){var d=true;var c=e.overlay.source;if(c&&(c.hasClass("isPreDatesPermanent")||c.getParent(".isPreDatesPermanent"))){d=false}if(d){e.overlay.hide()}}})}var a=document.getElement(".dp.overlay");if(a&&a.overlay){a.overlay.hide()}},getInOutTrackingKey:function(b){var a="avail.data.dateClicked";if(b){return a+".in"}else{return a+".out"}},removeInOutCalendarSelected:function(a){ta.remove(ta.widgets.calendar.getInOutTrackingKey(a))},trackInOutCalendarSelected:function(a){ta.store(ta.widgets.calendar.getInOutTrackingKey(a),true)},inOutCalendarSelected:function(a){return ta.retrieve(ta.widgets.calendar.getInOutTrackingKey(a))},trackCalendarEvent:function(c,d,b,g){try{var a=ta.has("multiDP.priorDates")?ta.retrieve("multiDP.priorDates"):ta.widgets.calendar.hasPageDates();b+=a?"|CHANGE":"|PRE";ta.trackEventOnPage(c,d,b,g,true)}catch(f){}},cancelAllExistingHAC:function(){if(ta.hac.filters&&ta.hac.filters.removeProcessingForExistingHACQuery){ta.hac.filters.removeProcessingForExistingHACQuery()}if(ta.meta.update&&ta.meta.update.cancelAllMetaCurrentQuery){ta.meta.update.cancelAllMetaCurrentQuery()}if(ta.commerce.metajson&&ta.commerce.metajson.cancelCurrentBulkFetch){ta.commerce.metajson.cancelCurrentBulkFetch()}},submitHacSearch:function(d,c){if(ta.has("useHotelsFilterState")){return ta.widgets.calendar.submitHotelsForm(d,c)}var b="";c=ta.id(c);if(c.get("tag")=="form"){var e=c.getElement("input[name=q]");if(e){e.name=""}b=c.action+"?"+c.toQueryString()}else{if(c.get("tag")=="a"){b=c.href}else{c=c.getParent("a");b=c.href}}if(b!==""){if(ta.widgets.calendar.hasPageDates()){if(!b.match(/\?/)){b=b+"?"}var a=ta.widgets.calendar.getCheckRatesData();if(a){b=b+"&"+Object.toQueryString(a)}}if(d){new Event(d).preventDefault()}window.location=b}},clearSessionDates:function(b,a){new Request({url:"/UpdateSessionDatesAjax?clear=true",onSuccess:function(){ta.widgets.calendar.clearDates();if(b){document.location.href="./"+b}if(a&&typeof a==="function"){a()}}}).send()},clearAllDatePickers:function(){var c=ta.retrieve("avail.data.objects");if(c){Array.each(c,function(d){var e=ta.retrieve(d);if(e){e.clear()}})}var b=document.getElements(".date_picker.date");if(b){Array.each(b,function(d){ta.widgets.calendar.updateDateWidgetDisplay(d);ta.widgets.calendar.showEnterDates(d)})}var a=$$(".tablet_date_label");if(a){a.removeClass("showLabels")}},showEnterDates:function(a){if(!a){return}if(ta.id(a).getParent(".dual_date")){if(ta.id(a).hasClass("out_date")){a.innerHTML=ta.retrieve("multiDP.checkOut")}else{a.innerHTML=ta.retrieve("multiDP.checkIn")}}else{a.innerHTML=ta.retrieve("multiDP.enterDatesText")}},clearDates:function(){ta.widgets.calendar.clearPageDates();ta.widgets.calendar.clearAllDatePickers();var a=document.getElement(".clearDates");var k=document.getElement(".clearDatesWrapper");var c=document.getElement(".showPriceButton");var b=document.getElement(".change_dates_button");var h=document.getElement(".date_picker_post_dates");var e=document.getElement(".date_picker_pre_dates");var f=document.getElement(".show_prices_button");var j=ta.id("ANIMATED_DATE_CTA");var d=ta.id("BC_PHOTOS");var g=document.getElement("#BC_PHOTOS .photo_slideshow");var l=document.getElement("#BC_PHOTOS .ug_thumbs");if(ta.retrieve("animate_date_reformat")){j=ta.id("ANIMATED_DATE_CTA_REFORMAT")}if(e){e.show()}if(h){h.hide()}if(a){a.hide()}if(k){k.hide()}if(b){b.hide()}if(f){f.show()}if(j){ta.servlet.HACSearch.loadAnimatedDateCTA()}if(c){c.hide()}if(d){d.style.opacity=1}if(g){g.style.opacity=1}if(l){l.style.opacity=1}if(ta.servlet.HACSearch&&ta.has("hac_timezone_awareness")){ta.servlet.HACSearch.clearDateFieldHighlighting()}},clearDatesAndRedirect:function(){var a=window.location.hash;var b=false;var c=window.location.href.match(/geo=\d+/g);if(c&&c[0]){b=c[0]}if(!b){c=window.location.href.match(/-g\d+/g);if(c&&c[0]){b="geo="+c[0].substring(2)}}if(b){var d="HACSearch?"+b+a;ta.widgets.calendar.clearSessionDates(d)}},storePriorDates:function(){ta.store("multiDP.priorDates",ta.retrieve("multiDP.priorDates")||ta.widgets.calendar.hasPageDates())},datesExist:function(){var b=ta.widgets.calendar.getPageInDate();var a=ta.widgets.calendar.getPageOutDate();return b&&a},datesInRange:function(){var c=ta.widgets.calendar.getPageInDate();var a=ta.widgets.calendar.getPageOutDate();if(!ta.widgets.calendar.datesExist()){return false}var b=Math.round(Math.abs((c.getTime()-a.getTime())/ta.widgets.calendar.oneDayMill));return b>=1&&b<=ta.util.date.MAX_STAY_DURATION_DAYS},openFirstDatePicker:function(b){new Event(b).stopPropagation();var a=$$(".date_picker_calendar_wrap");if(a&&a.length>0){a[0].click()}ta.trackEventOnPage("price_filter_dates_link","click","")},justUpdateSessionDates:function(b,c,a){if(c&&!ta.widgets.calendar.haveDatesChanged()){b();return}new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString(ta.widgets.calendar.getCheckRatesData()),method:"post",async:(a!==true),onSuccess:function(){if(b&&typeof(b)==="function"){b()}if(!ta.retrieve("dates.moniker.fired")){ta.store("dates.moniker.fired",true);ta.widgets.calendar.loadDateEnteredMonikers()}}}).send();return true},justUpdateSessionAdults:function(a){var b=ta.widgets.calendar.getPageAdultsCount();if(b<=0){return}new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString({adults:b,onlyAdults:true}),method:"post",onSuccess:function(){if(a&&typeof(a)==="function"){a()}}}).send()},getGuestsRoomsValue:function(d,c){if(!d){return}var a=d.split("*");for(var b=0;b<a.length;b++){var e=a[b].split(".");if(e.length!=2){continue}if(e[0]===c){return e[1]}}},updateGuestsRoomsPickerDataFromCookie:function(){var e=Cookie.read("TATravelInfo"),f,b,c,a,d;a=ta.widgets.calendar.getGuestsRoomsValue(e,"A");if(a&&a!==""){c=parseInt(a,10)}d=ta.widgets.calendar.getGuestsRoomsValue(e,"RS");if(d&&d!==""){b=parseInt(d,10)}if(c>=1&&b>=1&&c.toFixed&&b.toFixed){f={rooms:b,guests:c};ta.store("guests.rooms.object",f)}},updateGuestsRoomsPickerUI:function(){var b=ta.widgets.calendar.getGuestsRoomsPickerData();var a=document.getElements(".grp-rooms-value");a.each(function(c){if(c){c.innerHTML=b.rooms}});a=document.getElements(".grp-guests-value");a.each(function(c){if(c){c.innerHTML=b.guests}})},updateGuestsRoomsButtonLabelsPluralization:function(b,c){var a=$$(b);a.each(function(d){if(c>1){d.addClass("multiple")}else{d.removeClass("multiple")}})},checkDatesMakeHacCallHR:function(a){if(ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.handleNewDates(a)}},checkDatesMakeHacCallHotels:function(a){if(ta.widgets.calendar.hasPageDates()){ta.servlet.HACSearch.doMetaDateSearch(a)}},updateSDCalendar:function(){new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString(ta.widgets.calendar.getCheckRatesData()),method:"post",onSuccess:function(){var f,d,c,b,e,a=document.getElement("#STATIC_DATE_PICKER_BAR .filterControls");window.fireEvent("sd_hh_datesChanged");if(ta.id("SDDatesHeaderCenter")){f=ta.id("SDDatesHeaderCenter");f.addClass("hide")}if((ta.id("SD_DATEBAR_TOOLTIP"))){f=ta.id("SDDatePickerBarStaticButton");f.addClass("hide");d=ta.id("SDDatePickerBarStaticChangeDates");d.removeClass("hide")}if(ta.id("SD_TV_CAMPAIGN")){c=ta.id("SD_TV_CAMPAIGN");c.addClass("hide")}if(ta.id("SD_MAP")){b=ta.id("SD_MAP");b.addClass("hide")}if(ta.id("SD_TRENDING")){e=ta.id("SD_TRENDING");e.addClass("hide")}if(a){if(ta.widgets.calendar.datesExist()){a.removeClass("noDatesSelected");a.addClass("datesSelected")}else{a.removeClass("datesSelected");a.addClass("noDatesSelected")}}if(!ta.retrieve("dates.moniker.fired")){ta.store("dates.moniker.fired",true);ta.widgets.calendar.loadDateEnteredMonikers()}}}).send()},updateHLCalendar:function(){new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString(ta.widgets.calendar.getCheckRatesData()),method:"post",onSuccess:function(){var c,f;window.fireEvent("sd_hh_datesChanged");f=ta.id("BODYCON");if(f){c=f.getElement("#HLDatePickerBar .metaDatePicker.moreProminent");var g=f.getElement(".show_prices_button");var j=f.getElement(".change_dates_button");if(g&&!g.hasClass("hide")){g.addClass("hide")}if(j&&j.hasClass("hide")){j.removeClass("hide")}}if(c){var b=document.getElement(".overlayBG");var h=document.getElement(".rgba_flyout.gray.overlay.relative");var d=document.getElement(".baseHotelInfoLeft");var a=document.getElement(".baseHotelInfoRight");var e=document.getElement(".HLBaseDisclaimer");if(b){b.destroy()}if(h){h.destroy()}if(d&&a){a.inject(d,"before")}if(e&&e.hasClass("hide")){e.removeClass("hide")}}if(!ta.retrieve("dates.moniker.fired")){ta.store("dates.moniker.fired",true);ta.widgets.calendar.loadDateEnteredMonikers()}}}).send()},updateSessionDates:function(a,b){new Request({url:"/UpdateSessionDatesAjax",data:b,method:"post",onSuccess:function(){if(a){window.location=a}},onFailure:function(){if(a){window.location=a}}}).send()},redirectToHotelOverview:function(a){if(a){a=JSON.decode(a);window.location=a.url}else{window.location="/Hotels"}},submitHotelsForm:function(d,b){b=ta.id(b);var c=b.toQueryString();if(ta.widgets.calendar.hasPageDates()){var a=ta.widgets.calendar.getCheckRatesData();if(a){c=c+"&"+Object.toQueryString(a)}}new Request({url:"/FilterState",data:c,method:"post",onSuccess:function(e){ta.widgets.calendar.redirectToHotelOverview(e)},onFailure:function(){ta.widgets.calendar.redirectToHotelOverview(null)}}).send();if(d){new Event(d).preventDefault()}return false},getPlacement:function(h){if(!h||!h.id){return null}var e=/date_picker_[0-9]*_([a-z]*)/;var j=/date_picker_in_[0-9]*_([a-z]*)/;var g=/date_picker_out_[0-9]*_([a-z]*)/;var f=/date_picker_adults_[0-9]*_([a-z]*)/;var a=h.id;var d=e.exec(a);if(!d){d=j.exec(a)}if(!d){d=g.exec(a)}if(!d){d=f.exec(a)}if(d){d=d[1]}if(!d){var b=h.getParent(".HotelDateSearch");if(b&&b.id){var c=(b.id).split("_");if(c.length>1){d=c[(c.length-1)]}}}return d},handleNewDates:function(m,p){if(ta.retrieve("hotel_review_low_price_message")){var f=document.getElement("#PRICE_ALERT_RIBBON");if(f){f.hide()}var b=ta.id("CHECK_RATES_CONT");if(b){b.removeClass("hasPriceSaverRibbon")}ta.remove("hidePriceAlertRibbon")}if(!ta.retrieve("dates.moniker.fired")){ta.store("dates.moniker.fired",true);ta.widgets.calendar.loadDateEnteredMonikers()}if(ta.retrieve("tablet_maps_v1")&&p){var c=p.getParent(".flexCard");if(c){c.addClass("withMeta")}}if(ta.isHRTabs2014()){ta.servlet.HotelReview.clearPriceTab();ta.servlet.HotelReview.updatePriceTab()}ta.store("meta.requestFromArea","");if(ta.retrieve("origHTMLForUserReviews")){var j=ta.id("noAvailRHS");if(j){j.innerHTML=ta.retrieve("origHTMLForUserReviews")}}var l=document.getElement(".seeMoreHotels");if(l){l.hide()}var e=ta.id("BC_PHOTOS");if(e){e.style.opacity=1}var h=document.getElement("#BC_PHOTOS .photo_slideshow");if(h){h.style.opacity=1}var o=document.getElement("#BC_PHOTOS .ug_thumbs");if(o){o.style.opacity=1}var d=ta.widgets.calendar.getPlacement(p);if(d=="geo"){ta.widgets.calendar.justUpdateSessionDates();return}if(ta.retrieve("ta.commerce.suppress_commerce_impressions.enabled")){if(pageServlet=="Hotel_Review"||pageServlet=="ShowUserReviews"){ta.store("meta.isFromDatesChange",true)}}ta.store("hotels.datesChanged",true);if(ta.commerce.datepickerpersist){ta.commerce.datepickerpersist.update()}var g="property_"+m;var k=ta.id(g);var a=ta.retrieve("overlay.lastElmt.className");var n=(d=="pop")&&(pageServlet=="Hotels")&&k&&a&&a.match(/custom_area_QC_Hotels_Meta/);if(ta.meta&&ta.meta.update&&!n){if(pageServlet==="Hotels"){ta.servlet.HACSearch.displayPostDatesLinks()}ta.overlays.Factory&&ta.overlays.Factory.tryToHideCROverlayPostDatesClose();window.fireEvent("newInlinePageDates",[m,d]);return}else{if(!n&&ta.util&&ta.util.error){ta.util.error.record(null,"handleNewDates - no meta js");return}}ta.store("hotels.datesChanged",true);ta.servlet.HACSearch.displayPostDatesLinks();ta.store("meta.redirectingToHR",true);ta.remove("overlay.lastElmt.className");ta.widgets.calendar.justUpdateSessionDates(false,false,true);ta.hac.filters.updateResultsFromDateSearch();window.open(k.href);document.getElements(".overlay").each(function(q){if(q.overlay&&q.overlay.hide){q.overlay.hide()}})},trackCRButtonClick:function(a){var c=ta.widgets.calendar.getPageInDate();var b=ta.widgets.calendar.getPageOutDate();var d=[a];if(c){d.push("CHECKIN")}if(b){d.push("CHECKOUT")}ta.trackEventOnPage("CRBUTTON","CLICK",d.join("|"))},setupNewDatesEvent:function(){try{ta.util.customEvent.addListener("newInlinePageDates",window,ta.widgets.calendar.inlineCalendarOnDateSelection)}catch(a){ta.util.error.record(a,"trouble building event - newInlinePageDates")}},inlineCalendarOnDateSelection:function(){ta.widgets.calendar.onCalendarChangeDates();var a=window.modelLocId;if(a){ta.widgets.calendar.onCalendarRangeSelect(a)}},onCalendarChangeDates:function(){ta.commerce.meta.tracking.resetAllTimingLocks();ta.commerce.meta.tracking.clearSuppressedAreas();ta.commerce.meta.polling.clearAllPollingInfo();if(ta.isHacMap()){ta.servlet.hotelsMap.map.cleanupOverlays()}},onCalendarRangeSelect:function(c,b){if(ta.commerce.metajson){ta.commerce.metajson.refetchAll()}if(typeof oxapp!="undefined"&&oxapp&&oxapp.context){var a=oxapp.context.get("TravelDates");if(a){a.save()}}if(c&&ta.has("checkrates.meta_af")&&!(ta.retrieve("tablet_maps_v1")&&ta.retrieve("maps_v2_open"))){ta.commerce.meta.loadMetaAF(c,"AV_ABOVE_FOLD_META",false)}ta.store("ta.calRangeSelectCtx",{locId:c,ext:b});ta.fireEvent("onCalendarRangeSelect");ta.store("ta.calRangeSelectCtx",null)},trackCalendarSelect:function(c){var j=document.getElement(".inline_calendar");if(j){j=j.getParent()}if(!j){return}var f=j.getElement(".meta_date_field.first .date_picker");if(c){f=j.getElement('.meta_date_field:not([class="first"]) .date_picker')}if(!f){return}var d=ta.id(f).get("id");d=d.substring(d.length-3,d.length);var b="START";var g="DATES";var a=ta.widgets.calendar.getPageInDate();var e=ta.widgets.calendar.getPageOutDate();if(d=="upt"){g="Interrupter"}if(c){b="SELECT";if(ta.retrieve("ta.calendar.isPriceOverlayCalendar")){g="PRICE_CALENDAR"}else{if(a&&e){var h=ta.util.date.getDaysInRange(a,e)-1;if(h>ta.util.date.MAX_STAY_DURATION_DAYS){g="DATES_OVER_30_DAYS"}}}}if(ta.retrieve("meta.prof_photo_lb.post_date_close.overlay")){g="CalendarLightbox"}ta.widgets.calendar.trackCalendarEvent(ta.widgets.calendar.getTrackingString(),b,g)},setFirstDisplayMonth:function(c){var a=document.getElement(".month");if(!a){return false}var b=ta.widgets.calendar.getDateFromElem(a);if(!b){b=new Date(ta.util.date.normalize(new Date()))}if(c){b.setDate(1);b.setDate(32);b.setDate(1)}else{b.setDate(1);b.setDate(-1);b.setDate(1)}return b},updateCalendarMonths:function(a,g){try{if(!ta.has("ta.calendar.date.clickFunction")){ta.widgets.calendar.setClickMouseOverFunctions()}if(!a){return}a=ta.id(a);if(!g){if(ta.util.i18n.isRtl()&&!a.hasClass("sprite-date_picker-arrowButtonRight")){return}else{if(!ta.util.i18n.isRtl()&&!a.hasClass("sprite-date_picker-arrowButtonLeft")){return}}}else{if(ta.util.i18n.isRtl()&&!a.hasClass("sprite-date_picker-arrowButtonLeft")){return}else{if(!ta.util.i18n.isRtl()&&!a.hasClass("sprite-date_picker-arrowButtonRight")){return}}}var c=ta.widgets.calendar.setFirstDisplayMonth(g);var b=document.getElement(".inline_calendar");var d=b.getElements(".month");if(d){Array.each(d,function(e){e.dispose()})}var f=ta.widgets.calendar.createMonth(c);ta.widgets.calendar.injectMonth(f.elmt,b,true);ta.widgets.calendar.updatePrevNext(b,f)}catch(h){ta.util.error.record(h,"update calendar months")}},updatePrevNext:function(b,g){var c=g.date;var e=g.date;if(!ta.has("ta.calendar.firstDate")){ta.widgets.calendar.setFirstLastDates()}var j=ta.util.date.inSameMonth(c,ta.retrieve("ta.calendar.firstDate"));var a=ta.util.date.inSameMonth(e,ta.retrieve("ta.calendar.lastDate"));var f=ta.util.i18n.isRtl()?"sprite-date_picker-arrowButtonRight":"sprite-date_picker-arrowButtonLeft";var h=ta.util.i18n.isRtl()?"sprite-date_picker-arrowButtonLeft":"sprite-date_picker-arrowButtonRight";b.getElement(".prev").addClass(j?"":f).removeClass(j?f:"");b.getElement(".next").addClass(a?"":h).removeClass(a?h:"");var d=b.getElement(".prevText");if(d){if(j||!g.date){d.innerHTML=""}else{d.innerHTML=jsGlobalMonthsAbbrev[(g.date.getMonth()-1)%12]}}d=b.getElement(".nextText");if(d){if(a||!g.date){d.innerHTML=""}else{d.innerHTML=jsGlobalMonthsAbbrev[(g.date.getMonth()+1)%12]}}},dayClick:function(n,k,c,h,b){try{b=ta.id(b);if(!b||b.getParent(".disabled")){return}var l=ta.util.date.create(k,c,h);var a=ta.widgets.calendar.getPageOutDate();if(l){if(!ta.has("ta.first.date.selected")){if(a&&ta.widgets.calendar.isValidStayLength(a)){ta.widgets.calendar.clearPageDates()}ta.widgets.calendar.setPageInDate(l);ta.widgets.calendar.setFirstDateSelected(true);ta.widgets.calendar.trackCalendarSelect(false,b)}else{var j=ta.widgets.calendar.getPageInDate();if(!j){if(a&&ta.widgets.calendar.isValidStayLength(a)){ta.widgets.calendar.clearPageDates()}ta.widgets.calendar.setPageInDate(l);ta.widgets.calendar.setFirstDateSelected(true);return}else{if(j.getTime()==l.getTime()){return}else{if(j.getTime()>l.getTime()){ta.widgets.calendar.setPageInDate(l);ta.widgets.calendar.setPageOutDate(j)}else{ta.widgets.calendar.setPageOutDate(l)}}}ta.widgets.calendar.setFirstDateSelected(false);var f=1;if(typeof modelLocId!="undefined"){f=modelLocId}ta.widgets.calendar.handleNewDates(f);ta.widgets.calendar.showInlineCalendar(false);ta.widgets.calendar.trackCalendarSelect(true,b)}ta.widgets.calendar.updateSelectedDays(n,l,b);ta.widgets.calendar.syncAllDatePickers()}}catch(g){ta.util.error.record(g,"dayClick")}},setFirstDateSelected:function(a){if(a){ta.store("ta.first.date.selected",true);ta.widgets.calendar.addFirstDateFlag()}else{ta.remove("ta.first.date.selected");ta.widgets.calendar.removeFirstDateFlag();ta.widgets.calendar.removeHoverDateFlag()}ta.widgets.calendar.setMaxLengthOfStayStyling();ta.widgets.calendar.setInDateInputSelectState(a)},clearCalendarSelections:function(){ta.widgets.calendar.clearSelectedDays();ta.widgets.calendar.clearDates();ta.widgets.calendar.setFirstDateSelected(false)},addFirstDateFlag:function(){var a=ta.widgets.calendar.getPageInDate();var d=ta.widgets.calendar.getDayElemFromDate(a);var b=ta.retrieve("calendar.checkInText");if(b){var c=new ta.widgets.ArrowLabel(d,b);ta.store("ta.calendar.firstDateFlag",c)}},removeFirstDateFlag:function(){if(ta.has("ta.calendar.firstDateFlag")){var a=ta.retrieve("ta.calendar.firstDateFlag");if(a){a.remove();ta.remove("ta.calendar.firstDateFlag")}}},addHoverDateFlag:function(c,f,b){var a=ta.widgets.calendar.getPageInDate();if(a.getTime()==c.getTime()){ta.widgets.calendar.removeHoverDateFlag();return}if(ta.has("ta.calendar.hoverDateFlag")){var e=ta.retrieve("ta.calendar.hoverDateFlag");if(e){e.setParentElem(f);e.setText(b)}return}var d=new ta.widgets.ArrowLabel(f,b,{labelArrowBaseClass:"calendarDateStyling hoverDateStyling"});ta.store("ta.calendar.hoverDateFlag",d)},removeHoverDateFlag:function(){if(ta.has("ta.calendar.hoverDateFlag")){var a=ta.retrieve("ta.calendar.hoverDateFlag");if(a){a.remove();ta.remove("ta.calendar.hoverDateFlag")}}},addChooseDatesFlag:function(){if(!ta.has("ta.calendar.chooseDateFlag")){var a=ta.retrieve("calendar.enterDatesText");var b=document.getElement(".metaContentSection .largeOpenCalCRButton");var c=new ta.widgets.ArrowLabel(b,a,{labelArrowBaseClass:"calendarDateStyling enterDatesArrowElem",arrowSpriteClass:"sprite-date_picker-orangeArrowUp"});ta.store("ta.calendar.chooseDateFlag",c)}},removeChooseDatesFlag:function(){if(ta.has("ta.calendar.chooseDateFlag")){var a=ta.retrieve("ta.calendar.chooseDateFlag");if(a){a.remove();ta.remove("ta.calendar.chooseDateFlag")}}},onDateInputClick:function(a,b){var c=document.getElement(".inline_calendar");if(c&&c.hasClass("hidden")){ta.widgets.calendar.showInlineCalendar(true,!b.getParent(".meta_date_field.first"))}else{if(c&&ta.has("ta.first.date.selected")&&b&&b.getParent(".meta_date_field.first")){ta.widgets.calendar.clearCalendarSelections()}}},onDateInputOver:function(){if(!ta.widgets.calendar.hasPageDates()&&!ta.has("ta.first.date.selected")){ta.widgets.calendar.addChooseDatesFlag()}},onDateInputOut:function(){ta.widgets.calendar.removeChooseDatesFlag()},getDayElemFromDate:function(a){if(!a||!a.getTime){return false}return document.getElement(".date_"+a.getDate()+".month_"+a.getMonth()+".year_"+a.getFullYear())},getDateFromElem:function(c){var a,b=1,f=false,d=false,e;if(!c){return false}c=ta.id(c);a=c.className;if(!a){return false}e=a.match(/date_(\d+)/);if(e&&e[1]){b=e[1]}e=a.match(/month_(\d+)/);if(e&&e[1]){f=e[1]}e=a.match(/year_(\d+)/);if(e&&e[1]){d=e[1]}if(f===false||d===false){return false}return ta.util.date.create(d,f,b)},setMaxLengthOfStayStyling:function(){var e=ta.has("ta.first.date.selected");var f=document.getElements(".month td");if(e){var a=ta.widgets.calendar.getPageInDate();var c=ta.widgets.calendar.getPageInDate();c.setDate(c.getDate()+ta.util.date.MAX_STAY_DURATION_DAYS);if(f&&a){Array.each(f,function(h){var g=ta.widgets.calendar.getDateFromElem(h);if(g&&(g.getTime()<a.getTime()||c.getTime()<g.getTime())){h.addClass("disabled")}})}}else{if(f){var b=new Date(ta.util.date.normalize(new Date()));if(!ta.has("ta.calendar.lastDate")){ta.widgets.calendar.setFirstLastDates()}var d=ta.retrieve("ta.calendar.lastDate");Array.each(f,function(h){var g=ta.widgets.calendar.getDateFromElem(h);if(g&&(b.getTime()<=g.getTime()&&g.getTime()<=d.getTime())){h.removeClass("disabled")}})}}},setInDateInputSelectState:function(b,d){var c=document.getElements(".metaContentSection .date_picker_calendar_wrap");var a=ta.widgets.calendar.getSelArrowElem();if(c){Array.each(c,function(e){if(!d){if(e.getParent()&&e.getParent().hasClass("first")){if(b){e.removeClass("selectionStyle")}else{e.addClass("selectionStyle");e.getParent().adopt(a)}}else{if(b){e.addClass("selectionStyle");if(e.getParent()){e.getParent().adopt(a)}}else{e.removeClass("selectionStyle")}}}else{e.removeClass("selectionStyle");a.dispose()}})}},getSelArrowElem:function(){var a=document.getElement(".selectionUpArrow");if(!a){if(document.getElement(".inline_calendar")){a=new Element("div",{"class":"sprite-date_picker-pointer-orange-ac selectionUpArrow"})}else{a=new Element("div",{"class":"sprite-date_picker-pointer selectionUpArrow"})}}return a},showInlineCalendar:function(f,d){var h=document.getElement(".inline_calendar");if(h){if(f){var c=h.hasClass("hidden");h.removeClass("hidden");var b=document.getElement("#HR_HACKATHON_CONTENT .postShowMetaCR");if(b){b.dispose()}if(d){if(!ta.has("date.picker.pageInDate")){d=false}}ta.widgets.calendar.setFirstDateSelected(!!d);if(c){ta.widgets.calendar.trackCalendarEvent(ta.widgets.calendar.getTrackingString(),"OPEN","DATES")}}else{h.addClass("hidden");ta.widgets.calendar.setInDateInputSelectState(false,true);var g=document.getElement(".largeOpenCalCRButton");if(g){g.dispose()}var a=document.getElement(".open_calendar_legend");if(a){a.addClass("miniMetaHideHdr").removeClass("miniMetaShowHdr")}var e=document.getElement(".open_calendar_highlight_bg");if(e){e.removeClass("open_calendar_highlight_bg")}}}},dayOver:function(f,e,a,c,b){if(typeof(isIPad)!="undefined"&&isIPad){ta.widgets.calendar.dayClick(f,e,a,c,b);return}ta.widgets.calendar.updateSelectedDays(f,ta.util.date.create(e,a,c),b)},updateSelectedDays:function(q,m,n){var o,f="prevSel",k="start",b="end",h=false,e,l,c,p,g,a,j;if(!ta.has("ta.first.date.selected")){return}if(!n){ta.widgets.calendar.removeHoverDateFlag();return}n=ta.id(n).getParent();o=m;ta.widgets.calendar.clearSelectedDays();e=ta.widgets.calendar.getPageInDate();l=ta.widgets.calendar.getPageOutDate();h=false;c=false;if(e){h=document.getElement(".month_"+e.getMonth()+".date_"+e.getDate());c=e}else{if(l){h=document.getElement(".month_"+l.getMonth()+".date_"+l.getDate());c=l}}a=h;j=n;if(!a){a=document.getElement(".month td");if(a){a.addClass(f)}}else{a.addClass(k).addClass(f)}if(o.getTime()<c.getTime()){ta.widgets.calendar.removeHoverDateFlag();return}if(!j){j=document.getElement(".month_"+o.getMonth()+".date_"+ta.util.date.getLastDayOfMonth(o));j.addClass(f)}else{j.addClass(b)}ta.widgets.calendar.updateSelectedDaysHelper(a,j,true,f);if(n.hasClass("disabled")){ta.widgets.calendar.removeHoverDateFlag()}else{p=ta.retrieve("calendar.singleNightText");g=ta.util.date.getDaysInRange(c,o)-1;if(1<g){p=ta.retrieve("calendar.multiNightsText");p=p.replace(/\d+/,g)}ta.widgets.calendar.addHoverDateFlag(o,n,p)}},updateSelectedDaysHelper:function(e,k,g,h){if(!e||e==k){return}var f="nextSibling";var l="firstChild";if(!g){f="previousSibling";l="lastChild"}var d=false;if(ta.widgets.calendar.isValidDateElem(e.getNext())){d=e.getNext()}else{var a=ta.id(e.parentNode);if(a&&a.getNext()){d=a.getNext()[l]}else{if(a&&ta.id(a).getParent(".month")){var c=ta.id(a).getParent(".month");if(ta.util.i18n.isRtl()){f=(f=="previousSibling")?"nextSibling":"previousSibling"}var j=c.getNext();if(!j){return}var b=ta.id(j).getElements("td");if(!g){b.reverse()}b.some(function(m){if(ta.widgets.calendar.isValidDateElem(m)){d=m;return true}return false},this)}}}if(d){ta.id(d).addClass(h);ta.widgets.calendar.updateSelectedDaysHelper(d,k,g,h)}},isValidDateElem:function(b){if(!b||b.tagName!="TD"){return false}var a=b.className;if(a.match(/other/)||a.match(/disabled/)){return false}return true},clearSelectedDays:function(){var a=["prevSel","selected","start","end","inDate","inDate_DP7"];Array.each(a,function(c){var b=document.getElements(".inline_calendar .month td."+c);if(b){Array.each(b,function(d){d.removeClass(c)})}})},injectMonth:function(d,b,f){var c=b,a="top",e=b.getElement(".navCal");if(f&&e){c=e;a="after"}else{if(!f){a="bottom"}}d.inject(c,a);ta.widgets.calendar.setMaxLengthOfStayStyling();ta.widgets.calendar.removeFirstDateFlag();if(ta.has("ta.first.date.selected")){ta.widgets.calendar.addFirstDateFlag()}},setFirstLastDates:function(){var c=11;var b=new Date();b=new Date(ta.util.date.normalize(b));ta.store("ta.calendar.firstDate",b);var f=new Date(b.getTime());f.setDate(1);var a=f.getMonth();var e=a+c;f.setFullYear(f.getFullYear()+e/12);f.setMonth(e%12);f=new Date(ta.util.date.normalize(f));ta.store("ta.calendar.lastDate",f)},setClickMouseOverFunctions:function(){ta.store("ta.calendar.date.clickFunction","ta.widgets.calendar.dayClick");ta.store("ta.calendar.date.mouseOverFunction","ta.widgets.calendar.dayOver")},buildDayClass:function(a){var f="";var e=ta.widgets.calendar.getPageInDate();var c=ta.widgets.calendar.getPageOutDate();var b=new Date(ta.util.date.normalize(new Date()));if(!ta.has("ta.calendar.lastDate")){ta.widgets.calendar.setFirstLastDates()}var d=ta.retrieve("ta.calendar.lastDate");if(e&&e.getTime()==a.getTime()){f="inDate_DP7 start prevSel"}else{if(e&&c&&e.getTime()<a.getTime()&&c&&a.getTime()<c.getTime()){f="prevSel"}else{if(c&&c.getTime()==a.getTime()){f="inDate_DP7 end prevSel"}else{if(a.getTime()<b.getTime()||d.getTime()<a.getTime()){f="disabled"}}}}if(a.getTime()==b.getTime()){f="today "+f}return f},createMonth:function(l){var k={date:l},g,c="",o,m,b,p,a,e=-1,j,n,f,q,r,h;if(!ta.has("ta.calendar.firstDate")){ta.widgets.calendar.setFirstLastDates()}g=new Date(l.getTime());g.setDate(1);ta.util.date.normalize(g);o=l.getFullYear();m=l.getMonth();b;p=new Date(ta.util.date.normalize(new Date()));a=ta.retrieve("ta.calendar.lastDate");j=ta.widgets.calendar.getPageInDate();if(j&&g.getMonth()==j.getMonth()){e=j.getDate()}if(j){b=new Date(j.getTime());b.setDate(b.getDate()+ta.util.date.MAX_STAY_DURATION_DAYS+1)}n=o;if(ta.retrieve("thai_buddhist_era_year")){n=n+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET}c+='<table cellspacing="0" cellpadding="0" border="0"><thead><tr><th class="caption" colspan="7">';if(typeof DATE_FORMAT_MMM_YYYY!="undefined"){c+=DATE_FORMAT_MMM_YYYY.replace(/MMM/,jsGlobalMonths[m]).replace(/YYYY/,n)}c+="</th></tr><tr>";for(f=0;f<jsGlobalDaysShort.length;f++){c+="<th>";c+=jsGlobalDaysShort[f];c+="</th>"}c+="</tr></thead><tbody><tr>";q=new Date(g.getTime());q.setDate(1);r=1-q.getDay();q.setDate(r);for(f=1;f<=42;f++){if(q.getDay()===0){c+="</tr><tr>"}h=ta.widgets.calendar.buildDayClass(q)+" "+ta.widgets.calendar.buildCalendarFrameClass(f);c+='<td class="month_'+q.getMonth()+" date_"+q.getDate()+" year_"+q.getFullYear()+" "+h+'">';if(q.getTime()<p.getTime()||a.getTime()<q.getTime()){c+=q.getDate()}else{c+=ta.widgets.calendar.buildDayAnchorTag(q)}c+="</td>";q.setDate(q.getDate()+1)}c+="</tr></tbody></table>";k.elmt=new Element("div",{"class":"month month_"+k.date.getMonth()+" year_"+k.date.getFullYear()}).set("html",c);return k},buildCalendarFrameClass:function(b){var a="";if(b%7===1){a="leftCalFrame"}else{if(b%7===0){a="rightCalFrame"}}if(b<8){a=a+" topCalFrame"}else{if(35<b){a=a+" bottomCalFrame"}}return a},buildDayAnchorTag:function(a){var b="";if(ta.has("checkrates.add_holding_windows")){b+='<a href="javascript:void(0);" class="no_cpu" '}else{b+='<a href="javascript:void(0);"'}if(ta.has("ta.calendar.date.clickFunction")){b+=' onmouseover="';b+=ta.retrieve("ta.calendar.date.mouseOverFunction");b+="(event,";b+=a.getFullYear();b+=",";b+=a.getMonth();b+=",";b+=a.getDate();b+=',this);"'}if(ta.has("ta.calendar.date.clickFunction")){b+=' onclick="';b+=ta.retrieve("ta.calendar.date.clickFunction");b+="(event,";b+=a.getFullYear();b+=",";b+=a.getMonth();b+=",";b+=a.getDate();b+=',this)";'}b+=">";b+=a.getDate();b+="</a>";return b},addCustomDayStyleString:function(g,f,d,h,c){var j="";var a=ta.widgets.calendar.getPageInDate();var e=ta.widgets.calendar.getPageOutDate();var b="";if(a&&e){b=" inDate_DP7 prevSel";if(c.getTime()>a.getTime()&&c.getTime()<e.getTime()){j=j+" prevSel"}}if(a&&d.date.getMonth()==a.getMonth()&&h==a.getDate()){j=j+" start"+b}if(e&&d.date.getMonth()==e.getMonth()&&h==e.getDate()){j=j+" end"+b}return j},getDateArgsObject:function(){try{var b=ta.widgets.calendar.getPageInDate();var e=ta.widgets.calendar.getPageOutDate();var h=ta.widgets.calendar.getPageAdultsCount();if(!b||!e||!h){return null}var j=b.getDate();var l=b.getMonth()+1;var g=b.getFullYear();var c=e.getDate();var f=e.getMonth()+1;var a=e.getFullYear();var k={inDay:j,inMonth:l+" "+g,outDay:c,outMonth:f+" "+a,adults:h};return k}catch(d){ta.util.error.record(d,"Unable to create calendar date args object");return null}},loadDateEnteredMonikers:function(){ta.common.ads.loadMonikers.delay(2000)},getTrackingString:function(){return ta.retrieve("multiDP.trackString")||"DATEPICKER"},clickDatepickerThroughBackdrop:function(f,c,a){if(!f){return}f=new Event(f);var g=f.page.x;var d=f.page.y;var b=false;Array.from([c,a]).each(function(j){if(!b){var k=j.getPosition();var h=j.getSize();if(g>=k.x&&g<=(k.x+h.x)&&d>=k.y&&d<=(k.y+h.y)){b=true;var e=new MouseEvent("click",{view:window,bubbles:true,cancelable:true});j.dispatchEvent(e);f.stopPropagation()}}})}};ta.widgets.ArrowLabel=new Class({Implements:Options,Binds:["shiftLeft","shiftRight"],options:{charWidth:7,sidePadding:0,labelArrowBaseClass:"calendarDateStyling",arrowElemClass:"defaultArrowElemStyling",textElemClass:"arrowTextElemStyling",arrowSpriteClass:"sprite-date_picker-grayDownArrow",arrowIconClass:"arrowIconStyling",arrowIconWidth:16},initialize:function(f,d,j){this.setOptions(j);if(!f||!d){return false}this.labelText=d;this.parentElem=f;var a=d.length+1;var h=(a*this.options.charWidth);var b=0;if(this.parentElem.getCoordinates&&this.parentElem.getCoordinates().width){b=this.parentElem.getCoordinates().width;if(b%2==1){b=b+1}}var c=0;if(h){if(h%2==1){h=h+1}c=(-1)*((h/2)-(b/2))}var g="left";if(ta.util.i18n.isRtl()){g="right"}this.inlineRelElem=new Element("div",{"class":this.options.labelArrowBaseClass+" inlineRelElemStyling"});this.arrowElem=new Element("div",{"class":this.options.arrowElemClass,styles:{width:h,padding:"0 "+this.options.sidePadding+"px"}});this.arrowElem.setStyle(g,c);this.arrowTextElem=new Element("div",{html:this.labelText,"class":this.options.textElemClass});this.arrowIconElem=new Element("div",{"class":this.options.arrowSpriteClass+" "+this.options.arrowIconClass});var e=0;if(this.options.arrowIconWidth){e=(-1)*((this.options.arrowIconWidth/2)-(b/2))}else{if(b){e=b/2}}this.arrowIconElem.setStyle(g,e);this.arrowTextElem.inject(this.arrowElem);this.arrowElem.inject(this.inlineRelElem);this.arrowIconElem.inject(this.inlineRelElem);this.inlineRelElem.inject(f)},setParentElem:function(a){if(a&&this.inlineRelElem){this.parentElem=a;this.parentElem.adopt(this.inlineRelElem)}},setText:function(a){this.labelText=a;this.arrowTextElem.innerHTML=this.labelText},remove:function(){if(this.inlineRelElem){this.inlineRelElem.destroy()}}});ta.widgets.Calendar=new Class({Binds:["addCustomDayStyleString","getCreatorElement"],Implements:[Options,Events],options:{selectedDate:null,firstDate:null,lastDate:null,dualCalendar:true,invalidDates:null,useLinks:true,dayNames:false,formatter:null,offsetOther:0,choiceLink:null,prevAction:null,nextAction:null,monthHeadingFormat:"",monthspan:11,indicateTurnoverDays:false,monthChangeDuration:500,postContent:null,prevStyle:false,nextStyle:false,showRange:false,isFirstCal:null,creatorElem:null,includeTodayInRange:false,holidaysOnCalendar:false,stableTableHeight:false},initialize:function(b){this.setOptions(b);if(!this.options.firstDate){if(ta.has("hac_timezone_awareness")&&ta.has("ta.hac.locationTimezoneOffset")){var d=ta.retrieve("ta.hac.locationTimezoneOffset");var a=new Date();var c=a.getTime();c+=(a.getTimezoneOffset()*60000);var e=c+d;this.options.firstDate=new Date(e)}else{this.options.firstDate=new Date()}}if(!this.options.lastDate){this.setLastDate(this.options.monthspan)}this.today=new Date();this.selectedDate=this.options.selectedDate;ta.util.date.normalize(this.today);if(this.options.firstDate){ta.util.date.normalize(this.options.firstDate)}if(this.options.lastDate){ta.util.date.normalize(this.options.lastDate)}if(this.selectedDate){ta.util.date.normalize(this.selectedDate)}this.container=new Element("div",{"class":"calendar"});this.addPrevNext();if(this.options.postContent){if(typeof(this.options.postContent)==="function"){this.options.postContent=this.options.postContent()}this.container.adopt(this.options.postContent)}if(this.options.wrapper){if(typeof(this.options.wrapper)==="function"){this.options.wrapper=this.options.wrapper()}this.options.wrapper.getElement(".wrapper_inner").adopt(this.container);this.container=this.options.wrapper}if(this.options.monthHeadingFormat==""&&DATE_FORMAT_MMM_YYYY){this.options.monthHeadingFormat=DATE_FORMAT_MMM_YYYY}},setLastDate:function(b){if(b==null||b<1){b=11}var e=new Date();e.setDate(1);var a=e.getMonth();var c=a+b;e.setFullYear(e.getFullYear()+c/12);e.setMonth(c%12);this.options.lastDate=e},getFirstDate:function(){return this.selectedDate||(this.theOtherCal&&this.theOtherCal.selectedDate)||this.today},update:function(){if(this.currentMonth){this.removeTable(null,this.currentMonth)}if(this.nextMonth){this.removeTable(null,this.nextMonth)}var c=this.getFirstDate();if(ta.widgets.calendar.getPageInDate()){c=new Date(ta.widgets.calendar.getPageInDate());if(ta.has("datepicker_autoadvance_fday")){c=ta.retrieve("datepicker_autoadvance_fday")}}else{if(ta.widgets.calendar.getPageOutDate()){c=new Date(ta.widgets.calendar.getPageOutDate());c.setDate(0)}}if(this.options.firstDate&&c<this.options.firstDate){c=this.options.firstDate}if(this.options.dualCalendar){var f=new Date(c);f.setDate(ta.util.date.DAYS_IN_MONTH[f.getMonth()]);ta.util.date.normalize(f);if(f>=this.options.lastDate){c=new Date(c);if(c.getMonth()==0){c.setFullYear(c.getFullYear()-1,11,1)}else{c.setMonth(c.getMonth()-1,1)}}}this.currentMonth=this.createMonth(c);this.injectMonth(this.currentMonth.elmt,true);if(this.options.dualCalendar){var e=new Date(this.currentMonth.date);var a=e.getDate();var b=e.getMonth()+1;if(a>ta.util.date.DAYS_IN_MONTH[b]){a=ta.util.date.DAYS_IN_MONTH[b]}e.setMonth(b,a);this.nextMonth=this.createMonth(e);this.injectMonth(this.nextMonth.elmt,false)}this.updatePrevNext();return this},injectMonth:function(c,d){if(ta.util.i18n.isRtl()){d=!d}var b=this.container,a="top";if(!d&&ta.id(this.container).getElement(".wrapper_inner .calendar")){b=ta.id(this.container).getElement(".wrapper_inner .calendar")}if(d&&this.nav){b=this.nav;a="after"}else{if(!d){if(this.options.postContent){b=this.options.postContent;a="before"}else{a="bottom"}}}c.inject(b,a)},reposition:function(){this.currentMonth.elmt.setStyle("left","0px");if(this.options.dualCalendar){if(!ta.util.i18n.isRtl()){this.nextMonth.elmt.setStyle("left",this.currentMonth.elmt.getCoordinates().width+this.options.offsetOther+"px")}else{this.nextMonth.elmt.setStyle("left","0px");this.currentMonth.elmt.setStyle("left",this.nextMonth.elmt.getCoordinates().width+this.options.offsetOther+"px")}}return this},updatePrevNext:function(){var b=this.currentMonth.date;var a=this.options.dualCalendar?this.nextMonth.date:this.currentMonth.date;var d=ta.util.date.inSameMonth(b,this.options.firstDate);var c=ta.util.date.inSameMonth(a,this.options.lastDate);getChildByClass(this.container,"prev").style.display=(d?"none":"block");getChildByClass(this.container,"next").style.display=(c?"none":"block")},createPagingElement:function(a,b,c){return'<span class="'+a+'"><a style="display: block;" onclick="'+b+'(event, this);">'+c+"</a></span>"},addPrevNext:function(){if(!(this.options.prevAction&&this.options.nextAction)){return}var a=[],b=this.nav=new Element("div",{"class":"navCal"}).inject(this.container);a.push(this.createPagingElement("prev"+(this.options.prevStyle?" "+this.options.prevStyle:""),this.options.prevAction,"Previous Month"));a.push(this.createPagingElement("next"+(this.options.nextStyle?" "+this.options.nextStyle:""),this.options.nextAction,"Next Month"));b.set("html",a.join(""))},getHolidays:function(f,c,d,b){var e;if(f){var a=c+"-"+(d+1)+"-"+b;e=f[a]}return e},createMonth:function(C){var E={date:C};var o=new Date(C);o.setDate(1);ta.util.date.normalize(o);var q=(o.getDay()-jsGlobalDayOffset+7)%7;var A=new Date(C);A.setDate(0);this.prevDayValid=(this.isInvalidDate(A)?0:1);if(A<this.options.firstDate||A>this.options.lastDate){this.prevDayValid=-1}var c=[];var s=C.getFullYear();var u=C.getMonth();var h=new Date();var v;var B=ta.util.date.inSameMonth(h,C)?h.getDate():-1;var p=-1;if(this.selectedDate&&this.selectedDate.getMonth()==u&&this.selectedDate.getFullYear()==s){p=this.selectedDate.getDate()}var D;if(this.options.showRange&&this.theOtherCal&&this.theOtherCal.selectedDate){D=this.theOtherCal.selectedDate;ta.util.date.normalize(D)}if(this.options.singleSelect){if(this.options.pickerOption=="out"&&ta.widgets.calendar.getPageInDate()){v=new Date(ta.widgets.calendar.getPageInDate());v.setDate(v.getDate()+ta.util.date.MAX_STAY_DURATION_DAYS)}}var t=s;if(ta.retrieve("thai_buddhist_era_year")){t=t+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET}c.push('<table cellspacing="0" cellpadding="0" border="0"><thead><tr><th class="caption" colspan="7">');c.push(this.options.monthHeadingFormat.replace(/MMM/,jsGlobalMonths[u]).replace(/YYYY/,t));c.push("</th></tr><tr>");for(var y=0;y<jsGlobalDaysShort.length;y++){c.push("<th>");c.push(this.options.dayNames?jsGlobalDaysAbbrev[y]:jsGlobalDaysShort[y]);c.push("</th>")}c.push("</tr></thead><tbody><tr>");var g=0;for(var y=0;y<q;y++){c.push('<td class="other">&nbsp;</td>');g++}q--;var x=0;var b=ta.util.date.DAYS_IN_MONTH[E.date.getMonth()];if(E.date.getMonth()==1&&E.date.getYear()%4==0){b+=1}var k=b;while(x<b){q=(q+1)%7;x++;o.setDate(x);var z=x;var e=null;var r=this.getHolidays(this.options.holidaysOnCalendar,s,u,x);if(this.options.includeTodayInRange){var a=!(o<=this.options.firstDate||o>this.options.lastDate||(v&&o>v))}else{var a=!(o<this.options.firstDate||o>this.options.lastDate||(v&&o>v))}var w=!this.isInvalidDate(o);var n=this.options.choiceLink;var m=!((this.selectedDate&&this.selectedDate.getTime()<o.getTime())||(D&&D.getTime()<o.getTime()));if(this.options.formatter){this.options.selectedDay=p;this.options.otherDate=D;var f=this.options.formatter.call(this,o,a,w,q,this.options);e=f.cname;z=f.contents;n=f.link||n}else{if(!w){e="invalid"}else{if(x==B){if(x==p||(D&&o.getTime()===D.getTime())){e="today selected "+(m?"start":"end");m=!m;if(this.selectedDate&&D){e+=" rngDt"}}else{if(!a){e="today disabled"}else{e="today"}}}else{if(x==p||(D&&o.getTime()===D.getTime())){e="selected "+(m?"start":"end");m=!m;if(this.selectedDate&&D){e+=" rngDt"}}else{if(this.selectedDate&&D&&((this.selectedDate.getTime()<o.getTime()&&o.getTime()<D.getTime())||(this.selectedDate.getTime()>o.getTime()&&o.getTime()>D.getTime()))){e="rngDt"}}}}}if(this.options.indicateTurnoverDays){if(w){if(this.prevDayValid==0){if(e){e+=" depart"}else{e="depart"}}this.prevDayValid=1}else{if(this.prevDayValid==1){if(e){e+=" arrive"}else{e="arrive"}}this.prevDayValid=0}if(!a){this.prevDayValid=-1}}if(q==0){c.push("</tr><tr>")}if(!a){c.push('<td class="');c.push(e||"disabled");c.push('">');if(r){c.push(r)}else{c.push(z||x)}c.push("</td>")}else{if(this.options.singleSelect){var j=this.date;if(j&&j.getDate()==x&&j.getMonth()==u){e=e+" selected"}}var l=this.addCustomDayStyleString(n,s,E,x,o,z);if(l){e+=l}if(e){c.push('<td class="');c.push(e);c.push('">')}else{c.push("<td>")}c.push(this.buildDayAnchorTag(n,s,u,x,z,o));c.push("</td>")}}while(++q<7){c.push("<td class='other'>&nbsp;</td>");g++}if(this.options.stableTableHeight){while((b+g)<42){c.push("</tr><tr>");var y=0;for(y=0;y<7;y++){c.push("<td class='other'>&nbsp;</td>");g++}}}c.push("</tr></tbody></table>");E.elmt=new Element("div",{"class":"month"}).set("html",c.join(""));return E},addCustomDayStyleString:function(d,b,f,a,e,c){},buildDayAnchorTag:function(f,c,e,b,d,g){var a=[];if(this.options.useLinks&&f){if(ta.has("checkrates.add_holding_windows")){a.push('<a href="javascript:void(0);" class="no_cpu" ondragstart="return false;" onclick="')}else{a.push('<a href="javascript:void(0);" ondragstart="return false;" onclick="')}a.push(f);a.push("(event,");a.push(c);a.push(",");a.push(e);a.push(",");a.push(b);a.push(',this)"');if(this.options.dayMouseOver){a.push(' onmouseover="');a.push(this.options.dayMouseOver);a.push("(event,");a.push(c);a.push(",");a.push(e);a.push(",");a.push(b);a.push(',this)"')}if(this.options.dayMouseOut){a.push(' onmouseout="');a.push(this.options.dayMouseOut);a.push("(event,");a.push('this)"')}a.push(">");a.push(d);a.push("</a>")}else{a.push(d)}return a.join("")},isInvalidDate:function(a){return ta.util.date.inDateSet(a,this.options.invalidDates)},isValid:function(){if(!this.selectedDate){return true}return this.selectedDate.getTime()>=this.options.firstDate.getTime()&&this.selectedDate.getTime()<=this.options.lastDate.getTime()},prev:function(){if(this.animating){return}var l=this.options.dualCalendar;this.animating=true;var h=new Date(this.currentMonth.date);var g=h.getMonth()-1;if(g<0){g=g+12;h.setFullYear(h.getFullYear()-1)}var j=h.getDate();if(j>ta.util.date.DAYS_IN_MONTH[g]){j=ta.util.date.DAYS_IN_MONTH[g]}h.setMonth(g,j);var k=this.currentMonth.elmt.getCoordinates().width;var f=k+(l?this.nextMonth.elmt.getCoordinates().width:0);var b=this.createMonth(h);if(!ta.util.i18n.isRtl()){b.elmt.style.left="-"+k+"px"}else{b.elmt.style.left=f+"px"}this.injectMonth(b.elmt,true);var e=this.container.getElements("div.month");var a;if(!ta.util.i18n.isRtl()){a={"0":{left:[-k,0]},"1":{left:[0,k+this.options.offsetOther]}};if(l){a["2"]={left:[k+this.options.offsetOther,k*2+this.options.offsetOther]}}}else{a={"0":{left:[0,-k]},"1":{left:[k+this.options.offsetOther,0]}};if(l){a["2"]={left:[k*2+this.options.offsetOther,k+this.options.offsetOther]}}}var c=new Fx.Elements(e,{onComplete:this.doneAnimating.bind(this).partial(Function._,this.nextMonth||this.currentMonth),duration:this.options.monthChangeDuration});if(l){this.nextMonth=this.currentMonth}this.currentMonth=b;this.updatePrevNext();c.start(a)},next:function(){if(this.animating){return}var l=this.options.dualCalendar;this.animating=true;var h=new Date(this.currentMonth.date);var g=h.getMonth()+(l?2:1);if(g>11){g=g-12;h.setFullYear(h.getFullYear()+1)}var j=h.getDate();if(j>ta.util.date.DAYS_IN_MONTH[g]){j=ta.util.date.DAYS_IN_MONTH[g]}h.setMonth(g,j);var k=this.currentMonth.elmt.getCoordinates().width;var f=k+(l?this.nextMonth.elmt.getCoordinates().width:0);var b=this.createMonth(h);if(!ta.util.i18n.isRtl()){b.elmt.style.left=f+"px"}else{b.elmt.style.left="-"+k+"px"}this.injectMonth(b.elmt,false);var e=this.container.getElements("div.month");var a;if(!ta.util.i18n.isRtl()){a={"0":{left:[0,-k]},"1":{left:[k+this.options.offsetOther,0]}};if(l){a["2"]={left:[k*2+this.options.offsetOther,k+this.options.offsetOther]}}}else{a={"0":{left:[-k,0]},"1":{left:[0,k+this.options.offsetOther]}};if(l){a["2"]={left:[k+this.options.offsetOther,k*2+this.options.offsetOther]}}}var c=new Fx.Elements(e,{onComplete:this.doneAnimating.bind(this).partial(Function._,this.currentMonth),duration:this.options.monthChangeDuration});if(l){this.currentMonth=this.nextMonth;this.nextMonth=b}else{this.currentMonth=b}this.updatePrevNext();c.start(a)},removeTable:function(b,a){a.elmt.dispose()},doneAnimating:function(b,a){this.removeTable(b,a);this.animating=false},select:function(a,b){this.selectedDate=b;this.fireEvent("onSelect",[this,a])},clear:function(a){this.selectedDate=null;this.fireEvent("onClear",[this,a])},nearbyMonth:function(b,a){var c=b+a;if(c>11){c-=12}else{if(c<0){c+=12}}return c},getCreatorElement:function(){return this.options.creatorElem}});(function(){var b=new Class({Implements:[Options,Events],URL_SAVE_CONTROLLER:"/SavesAjax",parentName:null,parentFolderId:0,locationId:0,guideId:0,tripGuideId:0,savedItems:{},sessionSavedItems:[],options:{savesTree:null},initialize:function(c){this.setOptions(c);if(this.options.savesTree){this.setSavesTree(this.options.savesTree)}this.addEvent("saveComplete",this.trackSuccessfullSave)},refresh:function(c){this.setOptions(c);if(this.options.savesTree){this.setSavesTree(this.options.savesTree)}},openSavesHoverRegflow:function(d){var e=1;if(d&&d.target&&d.target.getParent(".listing")){e=d.target.getParent(".listing").get("data-rankInList")}ta.trackEventOnPage("HoverSave","saveIntent",ta.widgets.Saves.locationId,e,false);ta.store("registration.ga_module","SavesHover");if(ta.retrieve("secure_registration.enabled")){var c=ta.registration.register({product:"SAVES_HOVER",popup:true,successAction:"ta.widgets.Saves.refreshLoggedInHoverSaves",data:function(){return{type:5,entity:+ta.widgets.Saves.locationId}}});if(c){ta.widgets.Saves.refreshLoggedInHoverSaves()}}else{ta.overlays.registration.connect({flow:"SAVES_HOVER"},"SIGNUP")}},openMastheadRegflow:function(c){ta.store("registration.ga_module","Masthead");ta.overlays.registration.connect({flow:"MASTHEAD"},"SIGNUP")},trackSuccessfullSave:function(e,c,d){if(!e){return}ta.trackEventOnPage("HoverSave","saveComplete",c,1,false);new Request({url:"/ActionRecord?action=Save_Completed"}).send()},setSavesTree:function(){},getSavesTree:function(c){if(this.options.savesTree&&!c){return this.options.savesTree}else{}},saveCall:function(f,d){var h=this;this.entityType=f;this.locationId=d;for(var c in this.sessionSavedItems){if(this.locationId==this.sessionSavedItems[c]){this.showSaved();return}}var g={action:"SAVE_ITEM",entity:this.locationId,type:f};var e=new Request({url:this.URL_SAVE_CONTROLLER,data:g,onRequest:function(){h.fireEvent("saveComplete",[true,d])},onSuccess:function(j){var m=false;j=JSON.decode(j);if(!j){return}if(j.error){if(j.error=="DUPITEM"){h.fireEvent("saveComplete",[m,d])}var k={name:"saves save item",message:(j&&j.error?j.error:"Error while calling SAVE_ITEM with locationId: "+d+" and entityType: "+f+".")};ta.util.error.record(k,"saveCall");return}else{m=true}if(m&&j.id){var l=j.id;if(l<-3){ta.run("ta.overlays.Factory.openMastheadRegflow")}}h.fireEvent("saveComplete",[m,d,l,j.folderid,h.btn]);h.locationId=0;h.btn=null}}).send();return e},unsaveCall:function(f,c){var g=this;var e={action:"DELETE_ITEM",id:f};var d=new Request({url:this.URL_SAVE_CONTROLLER,data:e,onRequest:function(){g.fireEvent("unsaveComplete",[true,f,c])},onSuccess:function(h){if(h!=""){h=JSON.decode(h);if(!h||h.error){var j={name:"saves unsave item",message:(h&&h.error?h.error:"Unknown error while deleting : "+f)};ta.util.error.record(j,"unsaveCall")}}g.fireEvent("unsaveComplete",[h,f,c])}}).send();return d},saveGuideCall:function(c){var e=this;var d={action:"SAVE_GUIDE",guideid:c};new Request({url:this.URL_SAVE_CONTROLLER,data:d,onSuccess:function(g){var k=true;var j=null;var f=null;g=JSON.decode(g);if(!g||g&&g.error){k=false;var h={name:"saves save guide",message:(g&&g.error?g.error:"Unknown error while saving guide : "+c)};ta.util.error.record(h,"saveGuideCall")}else{j=g.folder;f=g.items}this.guideId=0;e.fireEvent("saveGuideComplete",[k,j,f]);ta.trackEventOnPage("GuideSave","saveComplete",c,1,false);new Request({url:"/ActionRecord?action=Guide_Save_Completed"}).send()}}).send()},saveTripGuideCall:function(c){var e=this;var d={action:"SAVE_TRIP_GUIDE",guideid:c};new Request({url:this.URL_SAVE_CONTROLLER,data:d,onSuccess:function(g){var k=true;var j=null;var f=null;g=JSON.decode(g);if(!g||g&&g.error){k=false;var h={name:"saves save tripguide",message:(g&&g.error?g.error:"Unknown error while saving tripguide : "+c)};ta.util.error.record(h,"saveTripGuideCall")}else{j=g.folder;f=g.items}this.guideId=0;e.fireEvent("saveTripGuideComplete",[k,j,f]);ta.trackEventOnPage("TripGuideSave","saveComplete",c,1,false);new Request({url:"/ActionRecord?action=Trip_Guide_Save_Completed"}).send()}}).send()},getSavesCall:function(d){var e=this;var c={action:"FETCH_ITEMS"};if(!d&&this.options.savesTree){e.fireEvent("retrievedSaves",[this.options.savesTree])}new Request({url:this.URL_SAVE_CONTROLLER,data:c,onSuccess:function(f){f=JSON.decode(f);if(!f||f&&f.error){var g={name:"saves get saves",message:(f&&f.error?f.error:"Unknown error while fetching items.")};ta.util.error.record(g,"getSavesCall")}else{e.savedItems=f}e.fireEvent("retrievedSaves",[f])}}).send()},moveCall:function(g,c,e){var h=this;var f={action:"MOVE_ITEM",id:g,folder:c};var d=new Request({url:this.URL_SAVE_CONTROLLER,data:f,onSuccess:function(j){if(j!=""){j=JSON.decode(j);if(!j||j.error){var k={name:"saves move item",message:(j&&j.error?j.error:"Unknown error while moving : "+g)};ta.util.error.record(k,"moveCall")}}h.fireEvent("moveComplete",[j,g,c,e])}}).send();return d},addNoteCall:function(f,c,h){var g=this;var e={action:"ADD_NOTE",id:f,note:c};var d=new Request({url:this.URL_SAVE_CONTROLLER,data:e,onSuccess:function(j){if(j!=""){j=JSON.decode(j);if(!j||j.error){var k={name:"saves add note",message:(j&&j.error?j.error:"Unknown error while adding note to : "+f)};ta.util.error.record(k,"addNoteCall")}}g.fireEvent("addNoteComplete",[j,f,c]);if(typeof h=="function"){h(j,f,c)}}}).send();return d},addFolderNoteCall:function(c,d,h){var g=this;var f={action:"ADD_FOLDER_NOTE",id:c,note:d};var e=new Request({url:this.URL_SAVE_CONTROLLER,data:f,onSuccess:function(j){if(j!=""){j=JSON.decode(j);if(!j||j.error){var k={name:"saves add folder note",message:(j&&j.error?j.error:"Unknown error while adding folder note to : "+c)};ta.util.error.record(k,"addFolderNoteCall")}}g.fireEvent("addFolderNoteComplete",[j,c,d]);if(typeof h=="function"){h(j,c,d)}}}).send();return e},createFolderCall:function(c,g){var f=this;var e={action:"CREATE_FOLDER",name:c};var d=new Request({url:this.URL_SAVE_CONTROLLER,data:e,onSuccess:function(j){if(j!=""){j=JSON.decode(j);if(!j||j.error){var k={name:"saves create folder",message:(j&&j.error?j.error:"Unknown error while creating folder named : "+c)};ta.util.error.record(k,"createFolderCall")}}var h=j&&j.folderid?j.folderid:"";var l=j&&j.foldername?j.foldername:"";f.fireEvent("createFolderComplete",[j,h,l]);if(typeof g=="function"){g(j,h,l)}}}).send();return d},deleteFolderCall:function(c,g){var f=this;var e={action:"DELETE_FOLDER",id:c};var d=new Request({url:this.URL_SAVE_CONTROLLER,data:e,onSuccess:function(h){if(h!=""){h=JSON.decode(h);if(!h||h.error){var j={name:"saves delete folder",message:(h&&h.error?h.error:"Unknown error while deleting folder : "+c)};ta.util.error.record(j,"deleteFolderCall")}}f.fireEvent("deleteFolderComplete",[h,c]);if(typeof g=="function"){g(h,c)}}}).send();return d},renameFolderCall:function(c,d,h){var g=this;var f={action:"RENAME_FOLDER",id:c,name:d};var e=new Request({url:this.URL_SAVE_CONTROLLER,data:f,onSuccess:function(j){if(j!=""){j=JSON.decode(j);if(!j||j.error){var k={name:"saves rename folder",message:(j&&j.error?j.error:"Unknown error while renaming folder of : "+c)};ta.util.error.record(k,"renameFolderCall")}}g.fireEvent("renameFolderComplete",[j,c,d]);if(typeof h=="function"){h(j,c,d)}}}).send();return e},refreshLoggedInHoverSaves:function(){var c=ta.widgets.Saves;if(c.guideId!=0){c.saveGuideCall(c.guideId)}else{if(c.tripGuideId!=0){c.saveTripGuideCall(c.tripGuideId);ta.widgets.Saves.tripGuideId=0}else{c.saveCall(5,c.locationId)}}}});if(!ta.widgets.Saves){ta.widgets.Saves=new b()}var a=new Class({Implements:[Options,Events],lastBtnClicked:null,options:{isGuidePage:false,listingClass:"listing"},initialize:function(c){this.setOptions(c);this.PAGE=ta.id("PAGE");ta.widgets.Saves.addEvent("saveComplete",this.setBtnSavedState.bind(this));ta.widgets.Saves.addEvent("unsaveComplete",this.setBtnUnsavedState.bind(this));ta.widgets.Saves.addEvent("retrievedSaves",this.setAllBtnStates.bind(this));ta.widgets.Saves.addEvent("saveGuideComplete",this.onGuideSaved.bind(this));ta.widgets.Saves.addEvent("saveTripGuideComplete",this.onTripGuideSaved.bind(this));ta.queueForReady(function(){var d=ta.id("SAVE_ALL_BUTTON");if(d){d.addEvent("click",function(g){var f=this.get("data-guideid");var e=this.get("data-tripguideid");if(f){ta.widgets.Saves.guideId=f;ta.widgets.Saves.btn=this;ta.call("ta.overlays.Factory.openSavesHoverRegflow",g)}else{if(e&&!this.hasClass("saved")){ta.widgets.Saves.tripGuideId=e;ta.widgets.Saves.btn=this;ta.call("ta.overlays.Factory.openSavesHoverRegflow",g)}}g.preventDefault()})}})},refresh:function(){ta.widgets.Saves.getSavesCall()},bindListingEvents:function(){var d=this;var c=$$("."+this.options.listingClass);if(!c||!c.length){return}c.removeEvents("mouseenter").removeEvents("mouseleave").addEvents({mouseenter:function(){d.overHover(this)},mouseleave:function(){d.outHover(this)}})},setBtnSavedState:function(d,f,h,c,e){var g=this.getBtnsByLocationId(f);if(g.length){this.showSaved(g,h)}if(this.lastBtnClicked&&f==this.lastBtnClicked.get("data-locationid")){this.showSaveAlert(this.lastBtnClicked)}},setBtnUnsavedState:function(c,f,d){var e=this.getBtnsByLocationId(d);if(e.length){this.showUnsaved(e,f)}},setAllBtnStates:function(c){var e=this;if(!c){c=ta.widgets.Saves?ta.widgets.Saves.savedItems:{}}Object.each(c,function(f,g){var h=e.getBtnsByLocationId(g);if(h&&h.length){e.showSaved(h,f)}});ta.select(".savesHover").each(function(f){e.bindBtnEvents(f)});var d=ta.id("HEADING_GROUP");if(d){d.getElements(".savesContainer, .savesHover").setStyles({visibility:"visible",display:"block"})}if(this.options.isGuidePage){this.setGuideSaveState()}if(!isTabletOnFullSite){this.bindListingEvents()}},setGuideSaveState:function(e){var d=ta.id("GUIDE_DETAIL");if(!d){return}var c=d.getElements(".savesHover");var f=c.filter(".saved");if(e===true||c.length==f.length){ta.id("SAVE_ALL_BUTTON")&&ta.id("SAVE_ALL_BUTTON").hide();ta.id("ALL_SAVED_BUTTON")&&ta.id("ALL_SAVED_BUTTON").show()}else{if(e===false||c.length!=f.length){ta.id("ALL_SAVED_BUTTON")&&ta.id("ALL_SAVED_BUTTON").hide();ta.id("SAVE_ALL_BUTTON")&&ta.id("SAVE_ALL_BUTTON").show()}}},onGuideSaved:function(e,d,c){var f=this;if(e){this.setGuideSaveState(true);if(c&&c.length){c.each(function(h,g){var j=f.getBtnsByLocationId(h.entityid);f.showSaved(j,h.id)})}}},onTripGuideSaved:function(e,d,c){var f=this;if(e){ta.store("tripGuideSavedFolder",d.folderid);f.swapSaveText(ta.widgets.Saves.btn);ta.widgets.Saves.btn.addClass("saved");if(c&&c.length){c.each(function(h,g){var j=f.getBtnsByLocationId(h.entityid);f.showSaved(j,h.id)})}}},bindBtnEvents:function(e){var h=this;var f=e.getParent();var l=f.getElement(".saveOptions");e.removeEvents();if(l){l.getElement(".btn-delete").removeEvents()}if(e.hasClass("saved")){var m=e.get("data-locationid");var k=e.get("data-saveitemid");if(e.hasClass("savesHover-confirm-delete")){e.addEvent("click",function(){if(!l.isDisplayed()){h.showPositionedTip(this)}else{h.hidePositionedTip(l)}});l.getElement(".btn-delete").addEvent("click",function(){ta.widgets.Saves.unsaveCall(k,m);h.hidePositionedTip(l)})}else{e.addEvent("click",function(){ta.widgets.Saves.unsaveCall(k,m)})}h.closeHoverAlert(e)}else{var c=e.getParent(".savesContainer");if(c){var g=c.getElement(".hoverAlert");if(g){var d=false;e.addEvent("mouseenter",function(){if(!d){ta.trackEventOnPage("HoverSave","saveHover",m,1,false);d=true}h.showHoverAlert(e)});e.addEvent("mouseleave",function(){h.closeHoverAlert(e)})}var j=c.getElement(".saveAlert");if(j){h.closeSaveAlert(j)}}e.addEvent("click",function(o){var n=this.get("data-locationid");if(!n){return}ta.widgets.Saves.locationId=n;ta.widgets.Saves.btn=this;h.lastBtnClicked=this;ta.widgets.Saves.openSavesHoverRegflow(o);ta.trackEventOnPage("Saves","HoverButton",n,0)})}},overHover:function(e){e=ta.id(e);if(!e.hasClass("promoted")){if(!ta.isMetaHotels2013()&&!ta.has("meta.mini_meta_on_accommodations")){e.setStyle("background-color","#f1f1f1")}else{var d=e.getElement(".metaDisclaimer");if(d){d.setStyle("visibility","visible")}}}var c=e.getElement(".savesHover");if(c&&!c.hasClass("saved")&&c.hasClass("invisible")){c.removeClass("invisible")}var f=e.getElement(".hideHover");if(f&&f.hasClass("invisible")){f.removeClass("invisible")}},outHover:function(e){e=ta.id(e);if(!e.hasClass("promoted")){if(!ta.isMetaHotels2013()&&!ta.has("meta.mini_meta_on_accommodations")){e.setStyle("background-color","#fff")}else{e.removeClass("hoverShadow");var d=e.getElement(".metaDisclaimer");if(d){d.setStyle("visibility","hidden")}}}var c=e.getElement(".savesHover");if(c&&!c.hasClass("vr-heartContainer")&&!c.hasClass("saved")&&!c.hasClass("invisible")){c.addClass("invisible")}var f=e.getElement(".hideHover");if(f&&!f.hasClass("invisible")){f.addClass("invisible")}},getBtnsByLocationId:function(c){return ta.select(".savesHover-"+c)},showUnsaved:function(c,j){var e=this;if(c){if(c.length){c.each(function(m){e.showUnsaved(m,j)});return}if(c.hasClass("saved")){this.swapSaveText(c)}c.removeClass("saved");c.removeProperty("data-saveitemid");var f=c.getElement(".sprite-star_green");if(f){var g="sprite-star_gray";var l="sprite-star_green";f.addClass(g).removeClass(l)}if(c.getElement(".vr-icon")){var h=c.getElement(".vr-icon");if(h.hasClass("saved")){h.removeClass("saved");h.addClass("save");ta.vr.actionRecord("Unsave_VRR")}}var k=c.getElement(".sprite-hoverArrow");if(k){k.hide();var d=c.getElement(".vr_button_silver_border");if(d){d.removeClass("vr_button_silver_border").addClass("vr_button_silver")}}this.bindBtnEvents(c)}},showSaved:function(c,j){var e=this;if(c){if(c.length){c.each(function(m){e.showSaved(m,j)});return}if(!c.hasClass("saved")){this.swapSaveText(c)}c.addClass("saved");c.set("data-saveitemid",j);c.removeClass("invisible");var f=c.getElement(".sprite-star_gray");if(f){var g="sprite-star_green";var l="sprite-star_gray";f.addClass(g).removeClass(l)}if(c.getElement(".vr-icon")){var h=c.getElement(".vr-icon");if(h.hasClass("save")){h.removeClass("save");h.addClass("saved");if(h.hasClass("initial")){h.removeClass("initial")}else{ta.vr.actionRecord("Save_Success_VRR")}}}var k=c.getElement(".sprite-hoverArrow");if(k){k.show();var d=c.getElement(".vr_button_silver");if(d){d.removeClass("vr_button_silver").addClass("vr_button_silver_border")}}this.bindBtnEvents(c)}},swapSaveText:function(d){var c;var e;if(d.hasClass("vr-heartContainer")){c=d.getElement(".vr-saved");e=d.getElement(".vr-unsaved")}else{c=d.getElement(".saves-hover-txt-saved");e=d.getElement(".saves-hover-txt")}if(!ta.retrieve("ta.p13n.prodp13n_save_hover")){if(c){this.toggleVisibility(c)}if(e){this.toggleVisibility(e)}}},toggleVisibility:function(c){var d=!ta.has("fall_2013_hr_saves_right");var f=d?c.isVisible():c.getStyle("visibility")!=="hidden";if(f){if(d){c.hide()}else{c.setStyle("visibility","hidden")}}else{if(d){var e="inline";c.show(e)}else{c.setStyle("visibility","visible")}}},hidePositionedTip:function(c){if(c){c.hide()}},showPositionedTip:function(d,c){var e=d.getParent();var f=e.getElement(".saveOptions");if(!f){if(typeof c=="function"){c()}return}f.show()},showSaveAlert:function(g){var c=g.getParent(".savesWrap");var h=c?c.getElement(".saveAlert"):null;if(!h){return}if(ta.has("meta.full_meta_photos")&&!ta.has("meta.full_meta_photos_v3")){if(ta.id("SAVES")){var f=32;var d=-5;h.setStyles({top:f,left:d}).show()}}else{h.show()}var e=this;setTimeout(function(){e.closeSaveAlert(h,h)},5000)},closeSaveAlert:function(c){c=ta.id(c);if(c){c.hide()}},showHoverAlert:function(d){var c=d.getParent(".savesWrap");var e=c?c.getElement(".hoverAlert"):null;if(!e){return}e.show()},closeHoverAlert:function(d){var c=d.getParent(".savesWrap");var e=c?c.getElement(".hoverAlert"):null;e=ta.id(e);if(!e){return}if(e){e.hide()}},assetsLoaded:function(){if(ta.id("SAVES")){ta.id("SAVES").setStyle("top",ta.id("HEADING").getTop()-123);ta.id("SAVES").show()}},assetsLoadedHeader:function(){var d=ta.id("SAVES");var c=ta.id("HR_HACKATHON_CONTENT");if(d&&c&&!ta.has("meta.full_meta_photos")){d.setStyle("top",c.getCoordinates().top);d.show()}},loadSavesButton:function(d,g,e,c,f){if(!ta.retrieve("saves_button_"+d)){ta.store("saves_button_"+d,true);if(ta.id("saves_placeholder_"+d)){new Request({url:"/SavesButtonAjax",onSuccess:function(j){try{if(j&&j.trim()!="BAD_REQUEST"){ta.id("saves_placeholder_"+d).innerHTML=j;ta.select(".savesHover-"+d).each(function(k){ta.widgets.SavesButtons.bindBtnEvents(k);k.removeClass("invisible")})}else{ta.util.error.record(null,"Failed to load saves button BAD_REQUEST",null,{DBLE_ID:d},"WARN")}}catch(h){ta.util.error.record(h,"Failed to load saves button",null,{DBLE_ID:d})}},data:{pop:g,del:e,dble:d,head:c,referringServlet:f},evalScripts:true,method:"get"}).send()}}},loadAllSavesButtons:function(){if(!ta.has("SAVES_BUTTONS_LOADED")&&typeof saveLocationsOnPage!="undefined"){ta.store("SAVES_BUTTONS_LOADED",true);window.removeEvent("scroll",ta.widgets.SavesButtons.loadAllSavesButtons);new Request({url:"/SavesButtonAjax",onSuccess:function(f){try{if(f&&f.trim()!="BAD_REQUEST"){var d=JSON.decode(f);if(d){d.each(function(g){var e=ta.id("saves_placeholder_"+g.id);if(e){e.innerHTML=ta.util.escaping.escapeHTMLSafe(g.html)}});ta.select(".savesHover").each(function(e){ta.widgets.SavesButtons.bindBtnEvents(e)})}}else{ta.util.error.record(null,"Failed to load saves buttons BAD_REQUEST",null,null,"WARN")}}catch(c){ta.util.error.record(c,"Failed to load saves buttons")}},data:{locations:saveLocationsOnPage.join()},evalScripts:true,method:"post"}).send()}}});if(!ta.widgets.SavesButtons){ta.widgets.SavesButtons=new a({})}})();(function(){ta.widgets.SingleDateCalendar=new Class({Extends:ta.widgets.Calendar,Implements:[Options,Events],Binds:["onOutDateCalShow","updateInputStyling","updateDualDateInputStyling","showCalendarOverlay","setPositionElement","hashHack","getCalendarTopOffset","getCalendarLeftOffset","callOnSelect","setPageDates","getPageInDate","getPageOutDate"],options:{singleSelect:true,pickerOption:"in",autoAdvance:true,dualCalendar:true,dayMouseOver:"ta.widgets.calendar.calendarMouseOver",choiceLink:"ta.widgets.calendar.calendarMultiSelect",prevAction:"ta.widgets.calendar.calendarPrev",nextAction:"ta.widgets.calendar.calendarNext",selectedHoverClass:"rngDt",previousSelectedClass:"prevSel",inDateClass:"inDate",outDateClass:"outDate",selectionStartClass:false,selectionEndClass:false,captureKeyEvents:true,autoShow:false,displayCalendarInOverlay:true,formatter:ta.widgets.calendar.multiDateFormatter,monthChangeDuration:150,submitOnEnter:true,useClassicSkin:false,classicStyling:false},inDate:false,newInDate:false,oldInDate:false,startRangeElem:false,outDate:false,oneSelected:false,monthOffset:0,initialize:function(f,q,s,x,y){this.isIn=y;this.parent(f,this.input);this.crId=q;this.setPositionElement();if(typeof s==="function"){this.onSelect=s.bind(this)}this.argArray=x;if(this.options.displayCalendarInOverlay){var d=this.onCalendarOverlayShow.bind(this);var a=this.onCalendarOverlayHide.bind(this);var o=this.onCalendarOverlayShow.bind(this);var l=this.positionElement.getParent(".overlay");if(l){this.parentOverlay=l.overlay}var C=ta.overlays.ACTIVATE_CLICK;var p=ta.retrieve("datepicker_autoadvance")?0:(this.options.offsetLeft?this.options.offsetLeft:this.getCalendarLeftOffset());var w=this.options.offsetTop?this.options.offsetTop:this.getCalendarTopOffset();var A="date_picker_calendar";if(this.options.useClassicSkin){A="typeO"}if(this.options.classicStyling){A=A+" classicStyling"}if(!this.options.dualCalendar){A=A+" singleWidth"}if(!ta.widgets.calendar.hasPageDates()){A=A+" predates"}var u=ta.retrieve("tablet_calendar_update.enabled")?ta.overlays.BACKDROP_ALWAYS:ta.overlays.BACKDROP_NEVER;var c=ta.retrieve("tablet_calendar_update_v2.enabled")?0.01:0.6;var B=null;if(ta.retrieve("tablet_calendar_update_v2.enabled")){var e=ta.id("date_picker_in_"+this.crId+this.options.ext);var h=ta.id("date_picker_out_"+this.crId+this.options.ext);B=function(D){ta.widgets.calendar.clickDatepickerThroughBackdrop(D,e,h)}}var v=ta.overlays.RelativeOverlayBelow;var z={style:A,noPadding:true,autoShow:false,noCpu:true,backdrop:u,backdropOpacity:c,onBackdropClick:B,offsetLeft:p,offsetTop:w,activate:C,onShow:d,onHide:a,onFocus:o,zIndex:1001,showCloseButton:false,parentContainer:this.options.parentContainer,fontSize:this.options.fontSize,dontCloseOnClick:window.tabletOnFullSite&&ta.retrieve("meta.full_meta_photos_v4")};if(ta.has("hr_meta_focus_predates")||ta.has("hr_meta_focus_with_dates")||ta.has("sd_datepicker_focus")||ta.has("hotels_meta_focus")){z.zIndex=10001}if(f&&f.isGuestsRoomsCalendar){z.useTransparentOverlayPadding=true;z.transparentOverlayPaddingValue=80}if(ta.isTabletAlbumViewer()||ta.retrieve("tablet_maps_v1")){var n=document.getElement(".footerPocketWithInsert");if(n&&n.isVisible()){if(this.positionElement&&this.positionElement.getParent(".footerPocketWithInsert")){z.parentContainer=n}else{z.positionType="fixed"}var t=z.onShow;z.onShow=function(D){if(t){t(D)}window.addEvent("orientationchange",this.hide)};var r=z.onHide;z.onHide=function(D){if(r){r(D)}window.removeEvent("orientationchange",this.hide)}}}this.calendarOverlay=new v(z,this.positionElement);var b=ta.id(this.positionElement).getParent();if(b&&b.hasClass("date_picker_calendar_wrap")){b.onclick=function(){};ta.id(this.positionElement).removeEvents("click");ta.id(this.positionElement).getParent().addEvent("click",this.showCalendarOverlay.bind(this))}if(b&&!window.tabletOnFullSite){b.addEvent("focus",this.showCalendarOverlay.bind(this))}if(this.outDateField){ta.id(this.outDateField).getParent().onclick=function(){};ta.id(this.outDateField).getParent().addEvent("click",this.onOutDateCalShow.bind(this));if(!window.tabletOnFullSite){ta.id(this.outDateField).getParent().addEvent("focus",this.onOutDateCalShow.bind(this))}}this.calendarOverlay.inner.adopt(this.container);this.calendarOverlay.calendar=this;if(this.positionElement&&(this.positionElement.hasClass("isPreDatesPermanent")||this.positionElement.getParent(".isPreDatesPermanent"))){this.calendarOverlay.options.permanent=true;this.calendarOverlay.options.pinnable=ta.overlays.PINNABLE_ALWAYS}this.calendarOverlay.container.addEvent("click",function(D){if(D||window.event){D=new Event(D||window.event);D.stopPropagation()}});this.update();this.reposition()}var m=this.onDocumentClick.bind(this);document.addEvent("click",m);if(ta.retrieve("datepicker_autoadvance")){var k=ta.id("date_picker_out_"+this.crId+this.options.ext);var g=ta.id("date_picker_in_"+this.crId+this.options.ext);var j=(k&&g)?k.getCoordinates().left-g.getCoordinates().left:0;if(y){this.container.addClass("calIn");if(ta.util.i18n.isRtl()){this.calendarOverlay.options.offsetLeft=0-j}}else{this.container.addClass("calOut");if(!ta.util.i18n.isRtl()){this.calendarOverlay.options.offsetLeft=j}}this.container.addEvent("mouseleave",this.resetDatepickerOnHover.bind(this))}},addCustomDayStyleString:function(l,k,h,m,g,c){var n="";var b=this.getPageInDate();var j=this.getPageOutDate();var f="";if(b&&j){f=" prevSel"+(ta.retrieve("datepicker_autoadvance")?"":" inDate_DP7");if(g.getTime()>b.getTime()&&g.getTime()<j.getTime()){n=n+" prevSel"}}if(b&&h.date.getMonth()==b.getMonth()&&m==b.getDate()){n=n+" inDate start"+f}if(j&&h.date.getMonth()==j.getMonth()&&m==j.getDate()){n=n+" inDate end"+f}if(ta.retrieve("cal_xsell")&&(this.today.getMonth()==g.getMonth()||((this.today.getMonth()+1)%12)==g.getMonth())){var e=ta.util.date.getDaysInRange(this.today,g)-1;if(!this.isIn){e-=1}var a=ta.retrieve("cal_xsell");if(e>=0&&e<a.availability.length){var d=a.availability[e];if(!d){n+=" calXSellUnAvail"}}}return n},buildDayAnchorTag:function(g,d,f,b,e,h){var a=[];var c=this.getHolidays(this.options.holidaysOnCalendar,d,f,b);if(this.options.useLinks&&g){if(ta.has("checkrates.add_holding_windows")){a.push('<div href="javascript:void(0);" class="day no_cpu')}else{a.push('<div href="javascript:void(0);" class="day')}if(c){a.push(" hld")}a.push('" onclick="');a.push(g);a.push("(event,");a.push(d);a.push(",");a.push(f);a.push(",");a.push(b);a.push(',this)"');if(this.options.dayMouseOver){a.push(' onmouseover="');a.push(this.options.dayMouseOver);a.push("(event,");a.push(d);a.push(",");a.push(f);a.push(",");a.push(b);a.push(',this)"')}a.push(' value="');a.push(h.valueOf());a.push('"');a.push(">");if(c){a.push(c)}else{a.push(e)}a.push("</div>")}else{a.push(e)}return a.join("")},callOnSelect:function(){if(this.onSelect){this.fireEvent("onChangeDates");if(this.argArray&&this.argArray.length>0){this.onSelect.apply(this,this.argArray)}else{this.onSelect.call(this,this.crId,this.positionElement);if(ta.has("guests_rooms_picker_3.enabled")){ta.store("calendarClosedByDocClick",false)}}}},clear:function(b){this.date=null;ta.widgets.calendar.clearPageDates();if(this.positionElement&&!(this.positionElement.hasClass("tab0")&&this.positionElement.hasClass("header_tab"))){var a="";if(this.isIn){if(this.options.classicDateFormat&&typeof JS_DateFormat!="undefined"){a=JS_DateFormat}else{a=ta.retrieve("multiDP.checkIn")}}else{if(this.options.classicDateFormat&&typeof JS_DateFormat!="undefined"){a=JS_DateFormat}else{a=ta.retrieve("multiDP.checkOut")}}this.positionElement.innerHTML=a}this.fireEvent("onClear",[this,b]);if(this.calendarOverlay){this.calendarOverlay.hide()}},clearPrevSelectedDays:function(){if(!this.calendarTop){this.calendarTop=this.calendarOverlay.container.getElement(".calendar")}var a=this.calendarTop.getElements("td."+this.options.previousSelectedClass);a.removeClass(this.options.previousSelectedClass);this.options.selectionStartClass&&a.removeClass(this.options.selectionStartClass);this.options.selectionEndClass&&a.removeClass(this.options.selectionEndClass)},clearSelectedDays:function(){if(!this.calendarTop){this.calendarTop=this.calendarOverlay.container.getElement(".calendar")}var a=this.calendarTop.getElements("td."+this.options.selectedHoverClass);a.removeClass(this.options.selectedHoverClass);this.options.selectionStartClass&&a.removeClass(this.options.selectionStartClass);this.options.selectionEndClass&&a.removeClass(this.options.selectionEndClass)},createPagingElement:function(a,b,c){return'<span class="'+a+'" onclick="'+b+'(event, this);"></span>'},dayOver:function(c,f,b){ta.util.date.normalize(f);if(!this.oneSelected){if(ta.retrieve("datepicker_autoadvance")){if(!this.cursorLeftInitSel){if(!this.isIn&&this.getPageInDate()||this.isIn&&this.getPageOutDate()){var a=this.getPageInDate()||this.getPageOutDate();if(!b.getAttribute("value")||parseInt(b.getAttribute("value"))==a.valueOf()){return}}this.cursorLeftInitSel=true}this.updateDatepickerOnHover(f)}this.updateHoverElem(b);return}this.hoverDay=f;this.updateSelectedDays(f,b)},ensureValidDates:function(){var c=this.getPageInDate();var b=this.getPageOutDate();if(this.options.firstDate&&c){if(c<this.options.firstDate){ta.util.date.normalize(this.options.firstDate);c=this.options.firstDate;ta.widgets.calendar.setPageInDate(c);this.bypassSecondCal=true;var a=ta.widgets.calendar.getDateAfter(c);if(b&&b<a){b=a;ta.widgets.calendar.setPageOutDate(b)}}}if(b&&!c){c=ta.widgets.calendar.getDateBefore(b)}if(c&&!b){b=ta.widgets.calendar.getDateAfter(c)}ta.widgets.calendar.setPageInDate(c);ta.widgets.calendar.setPageOutDate(b)},focusOtherCalendar:function(){var a;if(this.isIn){a=ta.widgets.calendar.getPageOutCalendarField(this.crId,this.options.ext)}else{a=ta.widgets.calendar.getPageInCalendarField(this.crId,this.options.ext)}var b=document.getElement("#PERSISTENT_DATE_PICKER:not(.hidden)")||document;if(a===null&&ta.has("guests_rooms_picker_3.enabled")){if(this.isIn){a=b.getElement(".stayInfoHeaderDateTrigger.outDateTrigger")}else{a=b.getElement(".stayInfoHeader.inDateTrigger")}}if(a){if(a.click){ta.store("overlay.dontCloseOnClick",true);a.click();ta.store("overlay.dontCloseOnClick",false)}else{if(document.createEvent&&a.dispatchEvent){var c=document.createEvent("MouseEvent");c.initEvent("click",true,true);a.dispatchEvent(c)}}}},getCalendarLeftOffset:function(){var a=1;if(ta.util.i18n.isRtl()){a=127}if(ta.isMetaHomepageIntegration2013()){a=2;if(ta.util.i18n.isRtl()){a=121}}if(ta.retrieve("ta.calendar.isOutDateTrigger")&&ta.retrieve("ta.calendar.isPriceOverlayCalendar")){a=138}return a},getCalendarTopOffset:function(){if(ta.isMetaHomepageIntegration2013()){return -1}return -4},getFirstDate:function(){var b=this.getPageInDate();var a=this.getPageOutDate();if(this.isSecondCalShown()){if(!this.isIn&&b){return b}else{if(this.isIn&&a){return a}}}else{if((this.isIn)&&b){return b}else{if(!this.isIn&&a){return a}}}return this.today},getPageInDate:function(){return ta.widgets.calendar.getPageInDate()},getPageOutDate:function(){return ta.widgets.calendar.getPageOutDate()},getState:function(){var c=this.inDate,b=this.outDate,a={};if(c instanceof Date){Object.append(a,{inMonth:(c.getMonth()+1)+" "+c.getFullYear(),inDay:c.getDate()})}if(b instanceof Date){Object.append(a,{outMonth:(b.getMonth()+1)+" "+b.getFullYear(),outDay:b.getDate()})}return a},hashHack:function(){var a=ta.id(this.positionElement).get("id");if(a){a=a.substring(a.length-3,a.length);if(a=="olb"||a=="bin"||a=="som"){window.location.hash=" ";window.location.hash="#MetaPricesTab"}}},includeElemInRange:function(b,a){b.className=b.className+" "+a},isSecondCalShown:function(){if(!this.options.autoAdvance){return true}var a=ta.widgets.calendar.inOutCalendarSelected(!this.isIn);return a},isValidDateElem:function(b){if(!b||b.tagName!="TD"){return false}var a=b.className;if(a.match(/other/)||a.match(/disabled/)){return false}return true},initTracking:function(){if(!ta.remove("meta.datepicker_tracked")){var c=ta.id(this.positionElement).get("id")||this.options.ext||"_owl";var d=c.indexOf("_persist")>0;c=c.substring(c.length-3,c.length);var b=this.isIn?"CheckIn|":"CheckOut|";if(d){b+="Persistent|"}if(ta.retrieve("cal_xsell")){b+="CalXSell|"}if(c==="pdp"){b+="PERSISTENT_DATE_PICKER|"}switch(c){case"pto":b+="PHOTOS_LIGHTBOX";break;case"amo":b+="AMENITIES_LIGHTBOX";break;case"pop":b+="DHTML_FLYOUT";break;case"cro":b+="CalendarLightbox";break;case"inm":b+="DATES_INLINE|Tabs";ta.store("isPricesTabDatePicker",true);break;case"bin":b+="DATES_INLINE_FLEXIBLE";break;case"met":b+="DATES_LIGHTBOX";break;case"olb":b+="DATES_LIGHTBOX_FLEXIBLE";break;case"som":b+="DATES_State-Optimized-Modal_FLEXIBLE";break;case"cmp":b+="footer";break;case"hpt":b+="HOMEPAGE_PYPT";break;case"thc":b+="HAC_TOURISM";break;case"gnv":b+="GLOBAL_NAV";break;case"ond":b+="RoomTab";break;default:b+="DATES"}var a=this.getTrackingPrefix()+ta.widgets.calendar.getTrackingString();ta.widgets.calendar.trackCalendarEvent(a,"OPEN",b);ta.store("multiDP.trackString",false)}},multiSelect:function(f,g,b){if(f){new Event(f).stop()}ta.util.date.normalize(g);if(!g||!g.getTime){return}this.date=g;var a=null;var h=null;a=this.getPageInDate();h=this.getPageOutDate();var c=!a&&!h;var l=true;this.closedByDocOrDateClick=true;var k=false;if((!ta.widgets.calendar.getPageInDate()&&!ta.widgets.calendar.getPageOutDate())||(ta.retrieve("enteredDatesInPreDates")&&!ta.widgets.calendar.hasPageDates())){ta.store("enteredDatesInPreDates",true)}else{ta.store("enteredDatesInPreDates",false)}var j=ta.has("guests_rooms_picker_3.enabled")&&this.isIn;if(ta.retrieve("datepicker_autoadvance")||j&&!c){ta.widgets.calendar.cancelAllExistingHAC();this.bypassSecondCal=false;if(this.isIn){a=g;if(h&&g.getTime()>=h.getTime()){h=false;k=true;ta.widgets.calendar.clearPageOutDate(this.crId,this.options.ext);ta.widgets.calendar.removeInOutCalendarSelected(false)}if(!h){if(g.getDate()<=23){ta.store("datepicker_autoadvance_fday",this.currentMonth.date)}else{ta.remove("datepicker_autoadvance_fday")}}}else{h=g;if(a&&g.getTime()<(new Date()).getTime()){a=new Date();h=ta.widgets.calendar.getDateAfter(a)}else{if(a&&g.getTime()<=a.getTime()){a=false;k=true;ta.widgets.calendar.clearPageInDate(this.crId,this.options.ext);ta.widgets.calendar.removeInOutCalendarSelected(true)}else{if(a){ta.widgets.calendar.trackInOutCalendarSelected(true);this.bypassSecondCal=true}}}}}else{if(this.isIn&&h&&g.getTime()>=h.getTime()){a=this.date;h=false;k=true;ta.widgets.calendar.clearPageOutDate(this.crId,this.options.ext)}else{if(!this.isIn&&a&&g.getTime()<(new Date()).getTime()){a=new Date();h=ta.widgets.calendar.getDateAfter(a)}else{if(!this.isIn&&a&&g.getTime()<=a.getTime()){h=this.date;a=false;k=true;ta.widgets.calendar.clearPageInDate(this.crId,this.options.ext)}else{if(this.isIn){a=g;if(h){this.bypassSecondCal=true}}else{if(!this.isIn){h=g;if(a){this.bypassSecondCal=true}}}}}}}this.inDate=a;this.outDate=h;if(ta.has("guests_rooms_picker_3.enabled")){this.setPredatesState()}this.setPageDates(a,h);if(ta.has("guests_rooms_picker_3.enabled")&&ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.syncAllDatePickers();ta.commerce.meta.updateHeaderDates()}this.hoverDay=false;if(!ta.retrieve("datepicker_autoadvance")){if(!this.bypassSecondCal&&((!this.getPageOutDate()||!this.getPageInDate())&&!k)){this.bypassSecondCal=true}}this.updateNumNights();if(this.calendarOverlay){this.calendarOverlay.hide()}if(ta.commerce.persistentdatepicker){ta.commerce.persistentdatepicker.update()}if(this.bypassSecondCal&&!c&&(!this.getPageInDate()||!this.getPageOutDate())){this.bypassSecondCal=false}ta.overlays.Factory.destroyAnimatedDateCTA();if(!this.isSecondCalShown()&&!this.bypassSecondCal||(c&&ta.retrieve("metaUI.isMetaCalendarAutoadvancePredates"))){ta.widgets.calendar.trackInOutCalendarSelected(this.isIn);this.focusOtherCalendar()}else{this.hashHack()}this.removeErrorState();if(!ta.retrieve("datepicker_autoadvance")){if(this.getPageInDate()&&this.getPageOutDate()){this.fireEvent("onRangeSelect",[this.crId,this.options.ext])}this.fireEvent("onSelect",[this,f])}},next:function(){this.parent();this.resetStartRangeElem(true);var a=(this.currentMonth&&this.currentMonth.date?this.currentMonth.date.get("month"):"");ta.trackEventOnPage("DATEPICKER","NEXT_MONTH",(this.isIn?"Checkin":"Checkout"),a)},onCalendarOverlayKeyDown:function(a){if(this.options.submitOnEnter&&"enter"===a.key&&ta.isMetaHomepageIntegration2013()){var c=this.positionElement.getParent("form "),b="function"!==typeof this.options.submitOnEnter||this.options.submitOnEnter(a,c);if(b){c&&c.submit()}else{this.calendarOverlay.hide()}}if(a.key=="esc"||(ta.isMetaHomepageIntegration2013()&&!ta.retrieve("freeform_datepicker")&&a.key=="tab")){this.calendarOverlay.hide()}},onCalendarOverlayHide:function(b){if(this.isSecondCalShown()||ta.widgets.calendar.hasPageDates()){this.ensureValidDates()}ta.widgets.calendar.syncAllDatePickers();if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}if(this.options.captureKeyEvents&&this.keyEventListener){document.removeEvent("keydown",this.keyEventListener)}this.updateInputStyling(false);var f=this.getPageInDate();var e=this.getPageOutDate();var d=f&&f.getDate&&e&&e.getDate;if(this.isSecondCalShown()&&d){this.bypassSecondCal=true}var a=false;if((this.shouldFireOnSelect()||this.bypassSecondCal||(this.closedByDoc&&ta.has("guests_rooms_picker_3.enabled")))&&d&&this.closedByDocOrDateClick){var c=ta.retrieve("datepicker_autoadvance");if(this.closedByDoc&&ta.has("guests_rooms_picker_3.enabled")){ta.store("calendarClosedByDocClick",true);c=true}this.fireEvent("onChangeDates");if(c){this.fireEvent("onRangeSelect",[this.crId,this.options.ext])}this.callOnSelect();this.trackSelect(true);if(ta.retrieve("ta.calendar.isPriceOverlayCalendar")){a=true}}else{if(!this.closedByDoc){this.trackSelect(false)}}if(this.resetFireOnSelectCriteria&&(this.isSecondCalShown()&&this.closedByDocOrDateClick||ta.retrieve("datepicker_autoadvance")&&this.calendarOverlay.closedByDocClick)){this.resetFireOnSelectCriteria()}if(a){this.parentOverlay.hide()}if(ta.has("guests_rooms_picker_3.enabled")&&d){ta.widgets.calendar.displayStayInfoPicker()}},onCalendarOverlayShow:function(){ta.widgets.calendar.storePriorDates();this.inDate=this.getPageInDate();this.outDate=this.getPageOutDate();this.cursorLeftInitSel=false;this.bypassSecondCal=false;this.date=this.isIn?this.getPageInDate():this.getPageOutDate();if(ta.retrieve("datepicker_autoadvance")&&this.date){ta.widgets.calendar.trackInOutCalendarSelected(this.isIn)}if(ta.has("guests_rooms_picker_3.enabled")){this.setPredatesState();ta.widgets.calendar.updateGuestsRoomsPickerUI()}if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==ta.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}this.update();this.reposition();this.closedByDocOrDateClick=false;this.closedByDoc=false;if(ta.id(this.positionElement).getParent("#PERSISTENT_DATE_PICKER, #STATIC_DATE_PICKER_BAR.sticky")){ta.commerce.persistentdatepicker&&ta.commerce.persistentdatepicker.initCalendar(this)}else{if(ta.id(this.positionElement).getParent("#PERSISTENT_CHECK_RATES")){var a=ta.id(this.positionElement).getCoordinates().top;if(typeof(isIPad)=="undefined"||!isIPad){a=a-window.getScrollTop()}ta.id(this.calendarOverlay.container).setStyles({position:"fixed",top:a+29,zindex:9997})}}if(ta.retrieve("tablet_calendar_update.enabled")&&this.container){if(ta.retrieve("tablet_calendar_update_v2.enabled")){var d=window.innerWidth/document.documentElement.clientWidth;var b=Math.max(Math.min(Math.floor(150*d),150),100);this.container.setStyle("zoom",b+"%")}else{this.container.setStyle("zoom","150%")}if(this.calendarOverlay&&this.calendarOverlay.position){this.calendarOverlay.position()}}if(this.options.captureKeyEvents){try{this.keyEventListener=this.onCalendarOverlayKeyDown.bind(this);document.addEvent("keydown",this.keyEventListener)}catch(c){}}ta.id(this.positionElement).removeClass("date_picker_error");this.positionElement.blur();this.initTracking();this.updateInputStyling(true)},onDocumentClick:function(a){this.closedByDocOrDateClick=true;this.closedByDoc=true},onOutDateCalShow:function(a){ta.store("ta.calendar.isOutDateTrigger",true);this.calendarOverlay.show(a)},prev:function(){this.parent();this.resetStartRangeElem(false);var a=(this.currentMonth&&this.currentMonth.date?this.currentMonth.date.get("month"):"");ta.trackEventOnPage("DATEPICKER","PREV_MONTH",(this.isIn?"Checkin":"Checkout"),a)},removeErrorState:function(){if(ta.id("NO_DATES_ERROR")){ta.id("NO_DATES_ERROR").hide()}if(ta.id("calPnt")){ta.id("calPnt").removeClass("errorState")}var a=ta.find("#CHECK_RATES_CONT .date_picker_calendar_wrap");if(a){a.removeClass("errorState")}},resetDatepickerOnHover:function(){var d=this.getPageInDate();var c=this.getPageOutDate();var a=this.positionElement;if(!this.isIn){a=a.id.replace("date_picker_out","date_picker_in");if(a){a=ta.id(a)}}ta.widgets.calendar.updateDateDisplay(a,d,c);this.updateHoverElem();if(d){d=d.valueOf()}if(c){c=c.valueOf()}var b=document.getElements(".date_picker_calendar.overlay .calendar .today");var e=document.getElements(".date_picker_calendar.overlay .calendar .day");e.forEach(function(f){var g=f.getAttribute("value");if(g){g=parseInt(g);f=f.getParent();f.className="";if(d&&d==g){f.addClass("start")}else{if(c&&c==g){f.addClass("end")}}if(d&&c&&d<=g&&g<=c){f.addClass("prevSel")}}}.bind(this));b.addClass("today")},resetFireOnSelectCriteria:function(){ta.widgets.calendar.removeInOutCalendarSelected(this.isIn);ta.widgets.calendar.removeInOutCalendarSelected(!this.isIn)},resetStartRangeElem:function(e){if(!this.oneSelected){return}this.startRangeElem=false;this.clearSelectedDays();if(ta.util.i18n.isRtl()){e=!e}e?this.monthOffset++:this.monthOffset--;var b=this.calendarOverlay.container.getElements(".month");if(e){b.shift()}else{b.pop()}b.some(function(g,f){if(g){var h=ta.id(g).getElement("."+this.options.inDateClass);if(h){this.startRangeElem=h;return true}}return false},this);if(!this.startRangeElem){var a=false;if(this.monthOffset>0){var d=0;a=ta.id(b[d]).getElements("td");if(ta.util.i18n.isRtl()){a.reverse()}}else{var c=b.length-1;a=ta.id(b[c]).getElements("td");if(!ta.util.i18n.isRtl()){a.reverse()}}if(a){a.some(function(g,f){if(this.isValidDateElem(g)){this.startRangeElem=g;return true}return false},this)}}},selectLeftRightButtons:function(){var a={};if(this.options.useClassicSkin){a.leftIdle="classicLeftBtn";a.leftInactive="";a.rightIdle="classicRightBtn";a.rightInactive=""}else{a.leftIdle="sprite-date_picker-btnLeftIdle";a.leftInactive="sprite-date_picker-btnLeftInactive";a.rightIdle="sprite-date_picker-btnRightIdle";a.rightInactive="sprite-date_picker-btnRightInactive"}return a},setPageDates:function(b,a){ta.widgets.calendar.storePriorDates();if(b){ta.widgets.calendar.setPageInDate(b)}if(a){ta.widgets.calendar.setPageOutDate(a)}},setPermanent:function(b){if(this.calendarOverlay){this.calendarOverlay.options.permanent=b;this.calendarOverlay.options.pinnable=(b?ta.overlays.PINNABLE_ALWAYS:ta.overlays.PINNABLE_NEVER);var a=this.positionElement;if(this.positionElement&&!this.positionElement.hasClass("isPreDatesPermanent")){a=this.positionElement.getParent(".isPreDatesPermanent")}if(a){a.removeClass("isPreDatesPermanent")}}},setPositionElement:function(){if((ta.has("guests_rooms_picker_3.enabled")&&!ta.has("guests_rooms_picker_4.enabled"))&&this.options.creatorElem&&!this.options.creatorElem.getParent(".geoChkRates")&&!this.options.creatorElem.getParent("#PERSISTENT_DATE_PICKER")&&(this.options.creatorElem.getParent(".filterControls")||this.options.creatorElem.getParent(".jfy_header_dates_holder")||this.options.creatorElem.getParent(".meta_chevron_module_2014")||this.options.creatorElem.getParent("#HotelDateSearch")||(this.options.creatorElem.getParent(".baseHotelInfoLeft")))){this.positionElement=$$(".miniMetaShowHdr")[0];if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$(".hr_pre_date_minimalist .title")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$(".legend.metaDatesChosen")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$(".p13n_header_tab_wrap .tab0")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$("#STYLE2HEADER_V3 h1")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$("#HLDatesHeader")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$(".change_dates_button")[0]}}else{var a="date_picker_in_";if(!this.isIn){a="date_picker_out_"}this.positionElement=ta.id(a+this.crId+this.options.ext);if(!this.positionElement&&this.options.creatorElem.getParent("#PERSISTENT_DATE_PICKER")){this.positionElement=$$("#PERSISTENT_DATE_PICKER .bestPricesMsg")[0]}}if(!this.positionElement){ta.util.error.record(null,"ta.widgets.SingleDateCalendar.setPositionElement - this.positionElement is undefined",null,{},"WARN")}},setPredatesState:function(){if(this.inDate&&this.outDate){this.calendarOverlay.container.removeClass("predates")}else{this.calendarOverlay.container.addClass("predates")}},shouldFireOnSelect:function(){if(!this.onSelect){return false}return this.isSecondCalShown()&&this.calendarOverlay&&this.calendarOverlay.closedByDocClick},showCalendarOverlay:function(a){if(!this.calendarOverlay){return}if(this.parentOverlay&&this.parentOverlay.container&&ta.id(this.parentOverlay.container).hasClass("persistentCR")){this.calendarOverlay.options.activate=ta.overlays.ACTIVATE_CLICK}this.calendarOverlay.show(a)},trackSelect:function(c){var e=ta.id(this.positionElement).get("id");if(!e){var d="date_picker_in_";if(!this.isIn){d="date_picker_out_"}e=d+this.crId+this.options.ext}var j=e.indexOf("_persist")>0;e=e.substring(e.length-3,e.length);var b="START";var f="DATES";var h=-1;if(e=="ond"){f="RoomTab"}if(c){b="SELECT";if(ta.retrieve("ta.calendar.isPriceOverlayCalendar")){f="PRICE_CALENDAR"}else{if(this.inDate&&this.outDate){var g=ta.util.date.getDaysInRange(this.inDate,this.outDate)-1;if(g>ta.util.date.MAX_STAY_DURATION_DAYS){f="DATES_OVER_30_DAYS"}}}}if(this.isIn&&this.today&&this.inDate){h=ta.util.date.getDaysInRange(this.today,this.inDate)-1}else{if(!this.isIn&&this.inDate&&this.outDate){h=ta.util.date.getDaysInRange(this.inDate,this.outDate)-1}}if(ta.retrieve("meta.prof_photo_lb.post_date_close.overlay")){f="CalendarLightbox"}if(ta.retrieve("cal_xsell")){f="CalXSell"}if(f){f="|"+f}if(j){f="|Persistent"+f}if(ta.retrieve("isPricesTabDatePicker")){ta.remove("isPricesTabDatePicker");f+="|Tabs"}if(this.isIn){f="CheckIn"+f}else{f="CheckOut"+f}var a=this.getTrackingPrefix()+ta.widgets.calendar.getTrackingString();ta.widgets.calendar.trackCalendarEvent(a,b,f,h)},getTrackingPrefix:function(){return this.options.isVR?"VR_":""},updateDatepickerOnHover:function(d){var f=this.getPageInDate();var e=this.getPageOutDate();var b;if(this.isIn){f=d;if(e&&d.getTime()>=e.getTime()){e=null}b=this.positionElement}else{e=d;if(f&&d.getTime()<=f.getTime()){f=null}b=this.positionElement.id.replace("date_picker_out","date_picker_in");if(b){b=ta.id(b)}}ta.widgets.calendar.updateDateDisplay(b,f,e);f=this.getPageInDate();if(f){f=f.valueOf()}e=this.getPageOutDate();if(e){e=e.valueOf()}d=d.valueOf();var a=this.isIn?"end":"start";var c=document.getElements(".date_picker_calendar.overlay .calendar .today");var g=document.getElements(".date_picker_calendar.overlay .calendar .day");g.forEach(function(h){var j=h.getAttribute("value");if(j){j=parseInt(j);h=h.getParent();if(h.hasClass(a)){h.className="";h.addClass(a);if(this.isIn&&j<d||!this.isIn&&j>d){h.addClass("invalidPrevSel")}}else{h.className=""}if((this.isIn&&e&&e>=j&&j>=d&&e!=d)||(!this.isIn&&f&&f<=j&&j<=d&&f!=d)){h.addClass("prevSel")}}}.bind(this));c.addClass("today")},updateHoverElem:function(c){if(!this.calendarOverlay){return}var b="msdp_hover";var d=this.calendarOverlay.container.getElement("."+b);var a=ta.retrieve("datepicker_autoadvance")?(this.isIn?"start":"end"):"";if(d){d.removeClass(b);d.removeClass(a)}if(c&&c.getParent()){c.getParent().addClass(b+" "+a)}},updateInputStyling:function(a){a?this.positionElement.getParent().addClass("dualFieldOn"):this.positionElement.getParent().removeClass("dualFieldOn")},updateNumNights:function(){if(!ta.has("guests_rooms_picker_3.enabled")||!ta.widgets.calendar.hasPageDates()){return}var a=ta.widgets.calendar.getNumberOfNights(),b=$$(".grp-nights-value");if(b&&b.length>0){b.each(function(c){c.set("html",a)});ta.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".stayInfoContainer.nights",a)}},updatePrevNext:function(){var d=this.currentMonth.date;var c=this.options.dualCalendar?this.nextMonth.date:this.currentMonth.date;var g=ta.util.date.inSameMonth(d,this.options.firstDate);var f=ta.util.date.inSameMonth(c,this.options.lastDate);var b=ta.id(getChildByClass(this.container,"prev"));var a=ta.id(getChildByClass(this.container,"next"));if(ta.util.i18n.isRtl()){b=ta.id(getChildByClass(this.container,"next"));a=ta.id(getChildByClass(this.container,"prev"));g=ta.util.date.inSameMonth(c,this.options.lastDate);f=ta.util.date.inSameMonth(d,this.options.firstDate)}var e=this.selectLeftRightButtons();if(g){b.addClass(e.leftInactive).removeClass(e.leftIdle).setStyle("cursor","default")}else{b.addClass(e.leftIdle).removeClass(e.leftInactive).setStyle("cursor","pointer")}if(f){a.addClass(e.rightInactive).removeClass(e.rightIdle).setStyle("cursor","default")}else{a.addClass(e.rightIdle).removeClass(e.rightInactive).setStyle("cursor","pointer")}},updateSelectedDays:function(c,b){this.clearSelectedDays();var a=this.startRangeElem;this.includeElemInRange(a,this.options.selectedHoverClass);if(c.getTime()>this.newInDate.getTime()){this.updateSelectedDaysHelper(a,b.parentNode,true,this.options.selectedHoverClass);this.options.selectionStartClass&&ta.id(a).addClass(this.options.selectionStartClass);this.options.selectionEndClass&&ta.id(b.parentNode).addClass(this.options.selectionEndClass)}else{this.updateSelectedDaysHelper(a,b.parentNode,false,this.options.selectedHoverClass);this.options.selectionStartClass&&ta.id(a).addClass(this.options.selectionEndClass);this.options.selectionEndClass&&ta.id(b.parentNode).addClass(this.options.selectionStartClass)}},updateSelectedDaysHelper:function(e,k,g,h){if(!e||e==k){return}var f="nextSibling";var l="firstChild";if(!g){f="previousSibling";l="lastChild"}var d=false;if(this.isValidDateElem(e[f])){d=e[f]}else{var a=e.parentNode;if(a&&a[f]){d=a[f][l]}else{if(a&&ta.id(a).getParent(".month")){var c=ta.id(a).getParent(".month");if(ta.util.i18n.isRtl()){f=(f=="previousSibling")?"nextSibling":"previousSibling"}var j=c[f];if(!j){return}var b=ta.id(j).getElements("td");if(!g){b.reverse()}b.some(function(n,m){if(this.isValidDateElem(n)){d=n;return true}return false},this)}}}this.includeElemInRange(d,h);this.updateSelectedDaysHelper(d,k,g,h)}})})();ta.widgets.tabContainer=function(d,j){var a=d.getElements(".current");if(a.length!=1){throw new Error("You must have exactly one tab with a class of 'current'.")}else{a=a[0]}var g=a.className.match(/tab(\d+)/);if(g!=null&&g.length>=2){var b=Number(g[1])}else{return}if($("HOMEPAGE")&&window.location.hash){var h=window.location.hash.match(/t(\d)/);if(h&&h.length>0){b=parseInt(h[1]);a.removeClass("current");d.getElements(".tab")[b].addClass("current")}}var c=d.getElements(".tabContainerHead .tab");if(c.length==0){return}var f=d.getElements(".tabContainerBody .tabContent");return new TabSet(c,f,{show:b,onActive:function(m,n,k){var o=n.hasClass("xhr");if(o&&!n.hasClass("xhrComplete")){var e=n.getElement("a").href;if(e){var l=n;k.addEvent("onContentReplaced",function(){l.addClass("xhrComplete")});ta.util.element.replaceContent(m,k,e)}}if(n.hasClass("recordAction")){new Request({url:"/ActionRecord?action="+n.id}).send()}n.addClass("current");if(o&&m){m.stop()}},onBackground:function(k,l,e){l.removeClass("current")}})};ta.widgets.Carousel=new Class({Implements:Options,Binds:["shiftLeft","shiftRight"],options:{width:50,height:50,padding:5,num:7,offset:0,horizontal:true},initialize:function(a,b){this.setOptions(b);this.container=a;this.viewport=this.container.getElement(".viewport");this.leftKnob=this.container.getElement(".shiftLeft");this.rightKnob=this.container.getElement(".shiftRight");this.images=this.viewport.getElements("img");this.offset=this.options.offset;if(this.options.horizontal){this.viewport.setStyles({width:this.options.width*this.options.num+this.options.padding*(this.options.num-1),height:this.options.height})}else{this.viewport.setStyles({width:this.options.width+this.options.padding*2,height:this.options.height*this.options.num+this.options.padding*(this.options.num-1)})}this.leftKnob.addEvent("click",this.shiftLeft);this.rightKnob.addEvent("click",this.shiftRight);this.render()},render:function(){var a=this.offset+this.options.num;for(var b=this.images.length-1;b>=0;b--){if(b<this.offset||b>=a){this.images[b].setStyle("left",-999)}else{if(this.options.horizontal){this.images[b].setStyle("left",(this.options.width+this.options.padding)*(b-this.offset))}else{this.images[b].setStyles({top:(this.options.height+this.options.padding)*(b-this.offset),left:0})}}}if(this.offset==0){this.leftKnob.addClass("disabled")}else{this.leftKnob.removeClass("disabled")}if(this.offset==this.images.length-this.options.num){this.rightKnob.addClass("disabled")}else{this.rightKnob.removeClass("disabled")}},shiftLeft:function(){var a=this.offset;this.offset=Math.max(0,this.offset-this.options.num);if(this.offset!=a){this.render()}},shiftRight:function(){var a=this.offset;this.offset=Math.min(this.offset+this.options.num,this.images.length-this.options.num);if(this.offset!=a){this.render()}}});(function(b){b.util.action={record:function a(j,g,e){var f=null;if(b.util.Deferred){f=new b.util.Deferred()}var h=Object.merge({url:"/ActionRecord",data:{action:j},onSuccess:function(k){if(f){f.resolve(k)}},onFailure:function(k){if(f){f.reject(k)}}},g);e&&(h.trackEvent=e);new Request(h).get();if(f){return f.promise()}},recordPlus:function c(j,g,e){var f=null;if(b.util.Deferred){f=new b.util.Deferred()}var h=Object.merge({url:"/ActionRecordPlus",data:{action:j},onSuccess:function(k){if(f){f.resolve(k)}},onFailure:function(k){if(f){f.reject(k)}}},g);e&&(h.trackEvent=e);new Request(h).get();if(f){return f.promise()}},recordPid:function d(e){new Request({url:"/ActionRecord?pid="+e}).send()}}}(ta));ta.util.partials={requestTimeout:1000,maxDataRequests:12,dataRequestCount:0,incompleteDataRegex:/<\!-- incomplete\: ([\w, ]*) -->/,failedDataRegex:/<\!-- failed\: ([\w, ]*) -->/,partialsErrorRegex:/<\!-- error -->/,noOauthTokenRegex:/<\!-- no Oauth Token -->/,finishedInitialMPASequence:false,_resetPolling:function(){ta.util.partials.dataRequestCount=0},_newSeriesArgs:[],_runNextSeries:function(){var a=ta.util.partials._newSeriesArgs.shift();if(a){ta.util.partials.requestPartials.apply(this,a)}},requestMorePartials:function(a,d,b,c){ta.util.partials._newSeriesArgs.push(arguments);if(ta.util.partials.dataRequestCount===0&&ta.util.partials.finishedInitialMPASequence){ta.util.partials._runNextSeries()}},requestPartials:function(b,e,c,d){if(ta.util.partials.dataRequestCount>ta.util.partials.maxDataRequests||b.length==0){ta.util.partials.finishMPASequence();return}ta.util.partials.dataRequestCount++;if(ta.has("fb.partial.extraJS")){ta.retrieve("fb.partial.extraJS").each(function(g){new Asset.javascript(g)})}if(ta.has("fb.partial.extraCSS")){ta.retrieve("fb.partial.extraCSS").each(function(g){new Asset.css(g)})}var a=ta.remove("facebook.authcode.param");var f=Object.merge({parts:b.join(","),requestUrl:ta.retrieve("page.urlSafe")},e);if(a!=null){f=Object.merge(f,{FBAuthCode:a})}new Request({url:"/MultiPartAjax",method:"post",data:f,keepScripts:true,onRequest:function(){Cookie.dispose("FacebookAuthCode")},onSuccess:function(g){ta.util.partials.dataAvailable(e,b,c,d,null,null,g)}}).send()},handlePartialPaging:function(h,e,f){var g=f||{};ta.util.partials.dataRequestCount=0;if(!e||e.href==null){ta.util.error.record(null,"handlePartialPaging elmt.href null:"+e,null,null);return false}/parts=([\w,]+)/.test(e.href);var d=RegExp.$1.split(",");ta.store("partial.event.element",e);ta.store("partial.event.params",f);var c=ta.remove("facebook.authcode.param");var a=Object.merge({requestUrl:ta.retrieve("page.urlSafe")},g);var b=Object.clone(a);if(c!=null){a=Object.merge(a,{FBAuthCode:c})}new Request({url:e.href,method:"post",data:a,keepScripts:true,onSuccess:function(j){ta.store("fb.partial.isHandlePartialPaging",true);ta.util.partials.dataAvailable(b,d,"facebook",false,h,e,j)}}).send();return false},dataAvailable:function(d,k,j,f,p,c,g){if(f){var e=ta.util.partials.dataAvailable.pass([d,k,j,false,p,c,g]);f(e,g,k,d,j,f);return}if(g.match(ta.util.partials.noOauthTokenRegex)){if(ta.remove("fb.partial.isHandlePartialPaging")){ta.support.Facebook.pageDataAvailable(p,c,d,g)}return}if(g.match(ta.util.partials.partialsErrorRegex)){if(ta.has(j+".onPartialsError")){ta.remove(j+".onPartialsError").each(function(q){q()})}return}var n=[];var h=[];if(g.match(ta.util.partials.incompleteDataRegex)){n=RegExp.$1.split(",")}if(g.match(ta.util.partials.failedDataRegex)){h=RegExp.$1.split(",")}if(ta.has(j+".onDataAvail")){ta.remove(j+".onDataAvail").each(function(q){q()})}var o=[];var b=null;var m=/<style[^>]*>([\s\S]*?)<\/style>/gi;while((b=m.exec(g))){o.push(b[1])}if(o.length>0){o=o.join("\n");var l=document.createElement("style");l.type="text/css";document.getElementsByTagName("head")[0].appendChild(l);if(Browser.ie&&Browser.version<11){l.styleSheet.cssText=o}else{l.appendChild(document.createTextNode(o))}}g=g.stripScripts(true);g=g.replace(/<style[^>]*>([\s\S]*?)<\/style>/gi,"");var a=ta.id("PARTIAL_DATA")||new Element("div",{id:"PARTIAL_DATA",styles:{display:"none"}}).inject(document.body);a.adopt(Elements.from(g));setTimeout(function(){ta.util.partials.notifyListeners(k,j,n,h,a,d)},0)},notifyListeners:function(d,e,c,b,a,f){d.each(function(l){var p=e+".data.onAvail."+l;var n=c.contains(l);var k=b.contains(l);var q=ta.remove(p);if(q){for(var o=0,m=q.length;o<m;o++){if(q[o](a,n,k)===false){q[o]=null}}q=q.erase(null);if(n){if(q.length>0){ta.store(p,q)}else{c.erase(l)}}}if(!c.contains(l)&&!k){ta.keep("partials.pageProperties",l)}});var h="partials.data.onPage";var g=ta.remove(h);if(g){g.each(function(j){j()})}if(c.length>0){ta.util.partials.requestPartials.invokeLater(ta.util.partials.requestTimeout,null,[c,f,e])}else{ta.util.partials.finishMPASequence()}},finishMPASequence:function(){if(!ta.util.partials.finishedInitialMPASequence){ta.util.partials.recordGAEvent();ta.util.partials.finishedInitialMPASequence=true}ta.util.partials._resetPolling();ta.util.partials._runNextSeries()},recordGAEvent:function(){var b=ta.remove("partials.pageProperties");if(!b||b.length==0){return}var a="-"+b.sort().join("-")+"-";ta.trackEventOnPage("social","show",a)}};ta.util.partials.handleLightbox=ta.util.partials.handlePartialPaging;if(!ta.util){ta.util={}}ta.util.customEvent={_register:function(a){if(!Element.Events[a]){Element.Events[a]={}}},addListener:function(b,c,a){ta.util.customEvent._register(b);c=ta.id(c);if(c&&c.addEvent){c.addEvent(b,a)}},removeListener:function(b,c,a){c=ta.id(c);if(c&&c.addEvent){c.removeEvent(b,a)}}};ta.support.Facebook={ready:false,queue:[],enqueueForFBReady:function(a){if(ta.support.Facebook.ready){a()}else{ta.support.Facebook.queue.push(a)}},dequeueForFBReady:function(){try{ta.support.Facebook.queue.each(function(b){b()})}catch(a){ta.util.error.record(a,"Error calling dequeueForFBReady")}ta.support.Facebook.queue=[]},ipRevoke:function(a){setTimeout(function(){ta.util.pending.lock("fb.revoke.lb",function(){ta.util.pending.unlock("fb.revoke")})},a)},enqueueForFBAvailable:function(a){if(ta.retrieve("facebook.session.available")){a()}else{ta.keep("facebook.onSessionAvail",a)}},init:function(){if(ta.has("facebook.available")){return}ta.util.pending.multilock("facebook.data.canDisplay",ta.support.Facebook.showData,2);var a=ta.support.Facebook.timing=new ta.support.IPTiming();if(!ta.retrieve("facebook.invalidFBCreds")){ta.support.Facebook.initData(true)}ta.support.Facebook.markAvailable();FB.init({appId:ta.retrieve("facebook.appId"),status:true,cookie:true,xfbml:true,version:ta.retrieve("facebook.apiVersion"),frictionlessRequests:true,oauth:true});ta.support.Facebook.ready=true;ta.support.Facebook.dequeueForFBReady();if(!ta.retrieve("facebook.disableLogin")){if(ta.retrieve("facebook.skip.session.check")=="true"){ta.support.Facebook.sessionAvailable()}else{FB.getLoginStatus(ta.support.Facebook.onLoginStatus)}}else{if(!ta.has("facebookuserid")){ta.support.Facebook.sessionUnavailable()}}},transformToAuthResponse:function(c){var a=ta.retrieve("facebook.authFailed");var d=ta.retrieve("facebook.authSuccess");var b=c.authResponse;if(!b){if(a){a()}return null}if(c.status=="connected"){b.uid=ta.store("fb.auth.userId",b.userID);b.token=ta.store("fb.auth.token",b.accessToken);if(d){d()}return b}if(a){a()}return null},onLoginStatus:function(b){var a=ta.support.Facebook.transformToAuthResponse(b);if(a){if(ta.has("cached.facebookuid")&&ta.retrieve("cached.facebookuid")!=a.uid){ta.store("facebook.preFailed",true);ta.store("facebook.AuthCode.onAvail.needsReload",function(){window.location.reload()});ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(a))}if(ta.retrieve("facebook.invalidFBCreds")&&!ta.retrieve("facebook.signout.process")){ta.store("facebook.AuthCode.onAvail",ta.support.Facebook.sessionAvailable);ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(a))}else{ta.support.Facebook.sessionAvailable()}}else{if(!ta.retrieve("facebook.invalidFBCreds")){ta.store("facebook.preFailed",true);setOneTimeCookie("FacebookAuthCode","NoFBSessionAvailable");new Request({url:"/ActionRecord?action=fb_cached_token_no_session"}).send()}ta.support.Facebook.sessionUnavailable()}},initData:function(a){if(ta.remove("facebook.data.initialRequest.failed")){ta.support.Facebook.loadData({pre:a})}else{ta.util.pending.lock("facebook.data.initialRequest",ta.support.Facebook.loadData.partial({pre:a}))}},loadData:function(b){if(!ta.has("facebook.data.request")){return}ta.support.Facebook.timing.setBeginPartials();var a=ta.retrieve("facebook.data.request");ta.util.partials.requestPartials(a,Object.merge({},b,ta.retrieve("facebook.data.params")),"facebook",ta.support.Facebook.dataAvailable)},receiveCode:function(d){var a=ta.retrieve("facebook.AuthCode.onAvail");if(a!=null){ta.store("facebook.authcode.param",d);setOneTimeCookie("FacebookAuthCode",d);a()}var c=ta.retrieve("facebook.AuthCode.onAvail.needsReload");if(c!=null){setOneTimeCookie("FacebookAuthCode","ConflictedFBAccount");c()}var b=ta.retrieve("facebook.AuthCode.onAvail.paging");if(b!=null){ta.store("facebook.authcode.param",d);setOneTimeCookie("FacebookAuthCode",d);b()}},getCodeFromOAuthResponse:function(b){var d=ta.support.Facebook.parseFBSignedRequest(b.signedRequest).code;var c=ta.remove("facebook.taServerTime");var a=c-3600;var e=null;if(d&&!isNaN(a)){e=d.split(".")}if(e!=null&&e.length>3&&!isNaN(e[3])&&e[3]<a){ta.util.error.record(null,"Facebook sending up expired Code: ",null,{code:d,serverTime:c})}return d},parseFBSignedRequest:function(c){if(!c){return null}var a=c.split(".",2);var d=a[1];if(d){var b=ta.util.decoder.base64Decoder(d);try{return JSON.decode(b)}catch(f){ta.util.error.record(null,"couldn't parse Facebook SignedRequest to JSON object after decode ",null,{signedRequest:c,decoded:b})}}else{ta.util.error.record(null,"Facebook SignedRequest TA received doesn't contain data",null,{signedRequest:c})}},preemptiveRegex:/<\!-- PREEMPTIVE RESPONSE -->/,noOauthTokenRegex:/<\!-- no Oauth Token -->/,limitOfTry:4,dataAvailable:function(a,b,c,f,d,e){if(b.match(ta.support.Facebook.preemptiveRegex)&&ta.remove("facebook.preFailed")){return}if(b.match(ta.support.Facebook.noOauthTokenRegex)){delete f.pre;var g=ta.util.partials.requestPartials.partial(c,f,d,e);ta.store("facebook.AuthCode.onAvail",g);ta.support.Facebook.tryRegetOauthToken()}ta.store("facebook.data.handler",a);if(ta.retrieve("facebook.data.isShowDataOnce")){ta.support.Facebook.showData()}else{ta.util.pending.unlock("facebook.data.canDisplay")}},tryRegetOauthToken:function(){var a=ta.retrieve("fb.noOauthToken.counter");if(a==null){a=0}if(a<ta.support.Facebook.limitOfTry){ta.store("fb.noOauthToken.counter",a+1);FB.getLoginStatus(ta.support.Facebook.checkStatusAndGetCode)}},checkStatusAndGetCode:function(b){var a=ta.support.Facebook.transformToAuthResponse(b);if(a){ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(a))}},pageDataAvailable:function(e,b,d,a){var c=ta.util.partials.handlePartialPaging.partial(e,b,d);ta.store("facebook.AuthCode.onAvail.paging",c);ta.support.Facebook.tryRegetOauthToken()},showData:function(){ta.remove("facebook.data.handler")();if(!ta.retrieve("facebook.data.isShowDataOnce")){ta.store("facebook.data.isShowDataOnce",true);ta.support.Facebook.timing.recordEndTimes()}},markAvailable:function(){ta.store("facebook.available",true);if(ta.has("facebook.onAvail")){ta.remove("facebook.onAvail").each(function(a){a()})}},sessionAvailable:function(){var a=ta.retrieve("facebook.session.available");ta.store("facebook.session.available",true);ta.support.Facebook.timing.recordLoadTime();if(ta.has("facebook.onSessionAvail")){ta.remove("facebook.onSessionAvail").each(function(b){b()})}if(!a){ta.util.pending.unlock("facebook.data.canDisplay")}ta.support.Facebook.initData(false)},sessionUnavailable:function(){ta.store("facebook.session.available",false);ta.support.Facebook.timing.recordLoadTime();if(ta.has("facebook.onSessionUnavail")){ta.remove("facebook.onSessionUnavail").each(function(a){a()})}$$("#HEAD .FB_login_button").forEach(function(a){a.addEvent("click",function(){new Request({url:"/ActionRecord?action=FBC_Masthead"}).send()})});$$("#WoF_SigninLander .fbcBtnsmall").forEach(function(a){a.addEvent("click",function(){new Request({url:"/ActionRecord?action=WoF_SigninLander"}).send()})})},havePermission:function(b,d,c){var a=ta.retrieve("facebook.permissions");if(a){if(a.indexOf(b)==-1){return c?c():null}return d?d():null}else{FB.api({method:"users.hasAppPermission",ext_perm:b},function(e){if(e!=0){if(d){d()}}else{if(c){c()}}})}},requirePermission:function(a,c,b){ta.support.Facebook.login([a],c,b)},ifLoggedIn:function(b,a){if(ta.retrieve("facebook.session.available")&&b){b()}else{if(a){a()}}},loginButton:function(b,a){ta.support.Facebook.login()},login:function(m,a,d,c,b,k,o){var k=!!k;m=Array.from(m||[]);if(b!=null&&b.length>0){ta.store("facebook.flow",b)}else{ta.store("facebook.flow","FBC")}var e=userLoggedIn?"Connect":"Login";var f=e=="Login"?"":ta.retrieve("facebook.isFBC")=="true"?"Upgrade":"New";var j=ta.retrieve("facebook.trackingpid");ta.util.cookie.setPIDCookie(j);ta.util.action.record("FacebookConnect",null,{module:"social",action:e+"Attempt"+f});var n=function(){ta.util.cookie.setPIDCookie(j);ta.util.action.record("FacebookConnect",null,{module:"social",action:e+"Success"+f});var p={action:e,userType:f};if(a){a(p)}};if(!userLoggedIn||!userFbConnected||c){ta.support.Facebook._doLogin(m,n,d,c,k,o);return}var l=[];for(var h=0;h<m.length;h++){l.push(ta.support.Facebook.havePermission.partial(m[h]))}function g(){if(n){n()}}Function.executeContinuations([ta.support.Facebook.ifLoggedIn].concat(l).concat([g]),ta.support.Facebook._doLogin.partial(m,n,d,k,o))},addEmailLogin:function(b,a){var d={};var c=document.getElement("."+b).get("value");if(!c||!c.match(/.+\@.+\..+/)){document.getElement("."+a).removeClass("hidden");return}if(c){d.email=c}ta.support.Facebook.fbcRegistration(null,null,false,d)},_doLogin:function(c,h,a,f,b,e){var g=["email","user_hometown","friends_hometown","user_likes","friends_likes","user_location","friends_location","user_status","friends_status","friends_photos","publish_actions","user_photos"];var d=f;FB.login(function(k){var j=ta.support.Facebook.transformToAuthResponse(k);if(j&&j.token){ta.support.Facebook.setResultPID();ta.store("facebook.AuthCode.onAvail",function(){ta.store("facebook.uid",j.uid);ta.support.Facebook.fbcRegistration(d,h,b,e)});ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(j))}else{if(a){a()}}},{scope:g.join(",")})},setResultPID:function(){var a=ta.retrieve("facebook.trackingpid");if(a){ta.util.cookie.setPIDCookie(a)}},fbcRegistration:function(c,e,a,b){var d=!ta.retrieve("facebook.session.available")||!userLoggedIn||!userFbConnected;b||(b={});if(c!=null){d=d||c}if(d){ta.store("facebook.session.available",true);ta.store("registration.action","FB_CONNECT");ta.run("ta.overlays.registration.logAndPost",{},{flow:ta.retrieve("facebook.flow"),noreload:a},"FBC-start",Object.merge(b,{action:"FB_CONNECT"}))}if(e){e()}},loginWithFlow:function(a,b){ta.store("facebook.flow",a);ta.support.Facebook.login(null,null,null,b)},logout:function(){FB.logout(function(){window.location.reload()})},logoutNoRefresh:function(a){FB.logout(function(b){userLoggedIn=false;ta.store("facebook.session.available",false);ta.store("facebook.isFBC",false);if(a){a(b)}})},restart:function(){FB.logout(function(){ta.overlays.registration.post({action:"FB_LOGIN"})})},revoke:function(){FB.api({method:"Auth.revokeAuthorization"})},postWall:function(h,f,k,e,c,n,g,d,l,a,j,m,b){FB.ui({method:"feed",message:h,picture:n,link:f,name:k,to:l,caption:e,description:c,display:a,properties:j,actions:[{name:g,link:d}]},function(o){if(o&&o.post_id){if(m){m(o)}}else{if(o&&!o.post_id){ta.util.error.record(null,"Facebook postWall error response from facebook",null,null)}else{if(b){b(o)}}}})},publishStream:function(e,a,g,h,c,f,b,d){FB.login(function(k){var j=ta.support.Facebook.transformToAuthResponse(k);if(j){if(j.token){new Request({url:"/ActionRecord?action=POSTTOWALL_GRANTED"}).send();ta.support.Facebook.postWall(e,a,g,h,c,f,b,d)}}},{scope:"publish_stream"})},loginRequestSpecificPermission:function(b,c,a){FB.login(function(e){var d=ta.support.Facebook.transformToAuthResponse(e);if(d){if(d.token){ta.store("facebook.AuthCode.onAvail",function(){ta.support.Facebook.fbcRegistration(null,c)});ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(d))}else{if(a){a()}}}},{scope:b})},loginWithFlowAndRequest:function(b,c,d,a){ta.store("facebook.flow",b);ta.support.Facebook.loginRequestSpecificPermission(c,d,a)},signOutComplete:function(){try{ta.support.Facebook.ifLoggedIn(function(){ta.support.Facebook.logout()},function(){window.location.reload()})}catch(a){ta.util.error.record(a,"signoutAction - fb signout failed");window.location.reload()}},enqueueListenForFBAuthChange:function(a){ta.support.Facebook.enqueueForFBReady(function(){FB.Event.subscribe("auth.statusChange",a)})},googleClick:function(c,a){new Request({url:"/ActionRecord?action=Google404Test&pid="+a}).send();if(c){c.onclick=null}var b=ta.id("GOOG_SORRY");if(b){b.show()}}};ta.support.IPTiming=new Class({initialize:function(){this.active=ta.has("facebook.iptiming");if(this.active){this.timers=ta.retrieve("facebook.iptiming")}else{}},recordLoadTime:function(){if(this.active){this.sendActionRecord("LoadPage",this.timers.loaded-this.timers.started)}},setBeginPartials:function(){if(this.active&&!this.timers.partials){this.timers.partials=new Date().getTime()}},recordEndTimes:function(){if(this.active){var a=new Date().getTime();this.sendActionRecord("GetPartials",a-this.timers.partials);this.sendActionRecord("LoadAll",a-this.timers.started)}},sent:{},sendActionRecord:function(c,a){if(this.sent[c]){return}this.sent[c]=true;a=Math.round(a/1000);var b;if(a<=10){b=a.toString()}else{if(a>10&&a<=15){b="11-15"}else{if(a>15&&a<=20){b="16-20"}else{b="21+"}}}c+="_";c+=ta.retrieve("facebook.session.available")?"IP_":"NonIP_";c+=b+"_"+this.timers.servletName;if(this.timers.firstPage){c+="_FirstPage"}ta.util.action.record(c)}});(function(){window.ta||(window.ta={});window.ta.util||(window.ta.util={});var a=function(b){this.constructor=b};window.ta.util.extend=function(f){var c={};var g,h,e,d,b;for(d=1,b=arguments.length;d<b;d++){h=arguments[d];for(e in h){if(h.hasOwnProperty(e)){c[e]=h[e]}}if(h.hasOwnProperty("constructor")){c.constructor=h.constructor}}g=c.hasOwnProperty("constructor")?c.constructor:function(){return f.apply(this,arguments)};a.prototype=f.prototype;g.prototype=new a(g);g.prototype.__super__=f.prototype;for(e in c){g.prototype[e]=c[e]}return g}}());(function(d){d.fb||(d.fb={});var b=new RegExp(["User is already associated","Permissions error"].join("|"));var a=new RegExp(["Timeline is not activated","Requires extended permission","An unexpected error has occurred","An unknown error has occurred","load-error: unknown","Error validating access token","Object at URL.*requires an object of og:type","Could not retrieve data from URL","^unknown error"].join("|"));var c=/Temporarily Blocked/;d.fb.graph={api:function(j,l,k,g){var f=Array.prototype.slice.call(arguments);var e=d.util.Deferred();l||(l="get");k||(k={});g||(g={});g.recordErrors=(g.recordErrors!==false);(function h(m){FB.api(j,l,k,function(o){if(o&&!o.error){e.resolve(o)}else{var p={name:"None",message:"No FB.api response"};var n="ERROR";if(o&&o.error){p.name=o.error.type;p.message=(typeof o.error==="string")?o.error:o.error.message}if(m&&p.message.match("has og:type of '(?:tripadvisortravelmap|civ)")){k.scrape=true;h(false);return}if(a.test(p.message)){n="WARN"}if(g.recordErrors&&!b.test(p.message)){this.recordError(p,{FB_API_ARGS:f,FB_API_RESPONSE:o,FB_AUTH_RESPONSE:FB.getAuthResponse()},n)}e.reject(p)}}.bind(this))}.call(this,true));return e.promise()},remove:function(f,e){e||(e={});e.method="delete";return this.api("/"+f,"delete",e)},recordError:function(g,h,e){var f="ta.fb.graph.api";if(c.test(g.message)){f+=" blocked feature"}if(d.util.error){d.util.error.record(g,f,null,h,e)}return this}}}(ta));(function(a){a.fb.graph.Base=a.util.extend(Object,{constructor:function b(d,c){this.set(d);this.options=c||{};this.connections||(this.connections={})},set:function(d){for(var c in d){d.hasOwnProperty(c)&&(this[c]=d[c])}return this},api:function(c,f,e){if(!(this.id&&this.accessToken)){var d={name:"Missing auth credentials",message:"Facebook Graph object API calls require an id and access token"};a.fb.graph.recordError(d,{FB_ID:this.id,FB_ACCESS_TOKEN:this.accessToken,FB_API_ARGS:arguments},"WARN");return a.util.Deferred().reject(d)}c||(c="");if(/^\//.test(c)){c=c.slice(1)}e||(e={});e.access_token=this.accessToken;return a.fb.graph.api("/"+this.id+"/"+c,f,e)},getConnection:function(c){if(this.connections[c]){return new a.util.Deferred().resolve(this.connections[c])}return this.api(c).success(function(d){this.connections[c]=d.data;return a.util.Deferred().resolve(d.data)},this)},getClientConnection:function(c){if(!this.connections[c]){this.connections[c]=[];this.connections[c].all=false;this.connections[c].clientCount=0}return this.connections[c]},evictConnection:function(c){if(this.connections[c]){delete this.connections[c]}}})}(ta));ta.fb.graph.Application=ta.util.extend(ta.fb.graph.Base);(function(){ta.fb.openFeedDialog=function(b){var a=new ta.util.Deferred();b||(b={});b.method="feed";FB.ui(b,function(c){if(c&&c.post_id){a.resolve(c)}else{a.reject(c)}});return a.promise()}}());(function(a){a.fb.graph.mixin||(a.fb.graph.mixin={});var e=true;var b=true;var d=new RegExp(["Timeline is not activated","Requires extended permission"].join("|"));var c=300;a.fb.graph.mixin.OpenGraph={recordOpenGraph:function(g){var f=this.options.MapAction;if(f){Math.random()>0.2||f.record(g)}return this},getActions:function(f,g){f=this.options.appName+":"+f;var h=this.getClientConnection(f);if(h.all||(!g&&h.length>h.clientCount)){return a.util.Deferred().resolve(h)}return this.api(f,"get",{offset:h.length,limit:c}).success(function(j){Array.prototype.push.apply(h,j.data);if(!j.paging||(j.paging.previous&&!j.paging.next)){h.all=true}return a.util.Deferred(h)})},publishAction:function(g,k,j,h){if(!(a.retrieve("feature.ogPublish")&&e&&b)){return a.util.Deferred().reject("Publishing open graph actions is disabled.")}var f=this.options.appName;var l=this.options.ref;g=f+":"+g;h||(h={});h[k]=(!(/^http/).test(j)?"http://"+this.options.hostname:"")+j;if(l){h.ref=l+(h.ref?"__"+h.ref:"")}if(!a.retrieve("feature.openGraphLocationTagging")){delete h.place}var m=this.api(g,"POST",h).success(function(n){var p=this.getClientConnection(g);var o={id:n.id,data:{}};o.data[k]={url:h[k]};p.splice(p.clientCount,0,o);p.clientCount++;this.recordOpenGraph("OpenGraph_"+g)},this).failure(function(n){if(d.test(n.message)){e=false}});return m},publishLocatedAction:function(j,h,g,f){f||(f={});f.place=(!(/^http/).test(g)?"http://"+this.options.hostname:"")+g;return this.publishAction(j,h,g,f)},deleteActionsByObject:function(h,k,j){var g=this;if(+j!=j){j=(!(/^http/).test(j)?"http://"+this.options.hostname:"")+j}var l=Array.prototype.each?"each":"forEach";return(function f(m){return g.getActions(h,{next:m}).success(function(s){if(!s.all){return f(true)}var n=a.util.Deferred();var r=[];var q,o,p;for(p=0;p<s.length;p++){q=s[p];o=q.data[k];if(o&&(o.url==j||o.id==j)){r.push(q)}}if(!r.length){return n.resolve()}r[l](function(t){a.fb.graph.api(t.id,"delete").success(function(){r.splice(r.indexOf(t),1);var u=s.indexOf(t);s.splice(u,1);if(u<s.clientCount){s.clientCount--}if(!r.length){n.resolve()}}).failure(function(){n.reject()})});return n.promise()},this)}(false))},scrape:function(f){return a.fb.graph.api("/","post",{id:f,scrape:true})},setPublishState:function(f){e=!!f;b=!!f}}}(ta));(function(a){a.fb.graph.mixin||(a.fb.graph.mixin={});a.fb.graph.mixin.Feed={postLink:function(){},postStatus:function(){},postCheckin:function(){},postPhoto:function(){},postVideo:function(){},postFeed:function(b){return this.api("feed","POST",b)}}}(ta));(function(a){a.fb.graph.User=a.util.extend(a.fb.graph.Base,a.fb.graph.mixin.OpenGraph,a.fb.graph.mixin.Feed)}(ta));ta.fb.graph.User.prototype.inviteFriends=(function(b){var d=50;function a(e,f,j,h,g){var k=e.splice(0,d);g||(g=[]);FB.ui({method:"apprequests",message:f||"",title:j||"",new_style_message:true,to:k.join(",")},function(l){if(l&&l.to&&l.to.length){g.push.apply(g,l.to);if(!e.length){a(e,f,j,h,g)}else{h.resolve(g,l)}}else{h.reject(g,l)}})}return function c(f,g,h){var e=b.util.Deferred();a(f,g,h,e);return e.promise()}}(ta));ta.fb.graph.User.prototype.getAppRequests=function(a){if(!a&&this.appRequests){return ta.util.Deferred().resolve(this.appRequests)}return this.api("apprequests").success(function(b){this.appRequests=b},this)};ta.fb.graph.User.prototype.recordAndDeleteAppRequests=function(d,c,f){var a=this;d||(d=[]);if(!c){var b=window.location.search.match(/[?&](?:ref|fb_source)=([^&]*)/);c=b&&b[1]}function e(h){var k=[];var j=0;var g=ta.util.Deferred();h.each(function(m){var l="";ta.fb.graph.api("/"+m,"get").success(function(n){if(n&&n.from&&n.from.id){l=n.from.id}}).always(function(){ta.fb.graph.api("/"+m,"delete",null,{recordErrors:false});k.push((f?f+"_":"")+"AppRequestId_"+m+"_"+l);j++;if(j==h.length){if(a.options.MapAction&&k.length){a.options.MapAction.record(k.join(",")).success(function(){g.resolve()}).failure(function(){g.reject()})}else{g.resolve()}}})});return g.promise()}if(c=="bookmarks"){return this.getAppRequests().success(function(g){g.data.each(function(h){var j=h.id.split("_")[0];~d.indexOf(j)||d.push(j)})}).always(function(){return e(d)})}return e(d)};(function(a){var b=10000;a.fb.graph.TAUser=a.util.extend(a.fb.graph.User,{locationToOgType:function(c){return/^g(?:eo)?|10004/.test(c)?"city":/^a(?:ttraction)?|10021/.test(c)?"attraction":/^e(?:atery)?|10022/.test(c)?"restaurant":/^h(?:otel)?|^lodging|10023/.test(c)?"hotel":null},pin:function(c,f,n){n||(n={});var l=a.util.Deferred();var e=false;var d,h,j,m;if(c){d=this.locationToOgType(c.type);h=c.url}if(!(d&&c.url&&f&&f.length)){return l.reject()}j=!!(this.location&&this.location.latitude&&this.location.longitude);m=!!(this.hometown&&this.hometown.latitude&&this.hometown.longitude);var k=Array.prototype.each?"each":"forEach";var g=0;f[k](function(p){var r=p=="been"?"pin":p;var q={};var s=false;if(a.retrieve("feature.ogRefContainsFbid")){q.ref="fbid="+this.id}if(r=="pin"){var o={};var t;if(j){o.lat=this.location.latitude;o.lng=this.location.longitude}else{if(m){o.lat=this.hometown.latitude;o.lng=this.hometown.latitude}}t=a.travelmap.util.getDistance(c,o,this.locale);if(t){q.distance=t.value;q.distance_unit=t.unit;q.cur_loc_used=j}}else{if(r=="going"){q.end_time="5000-01-01"}}if(n.suppressFeed||(r=="pin"&&f.length>1)){q.no_feed_story=1}if(n.suppressMap||d!="city"||r=="going"||!c.redistributable||r=="pin"&&f.length>1){s=true}this[s?"publishAction":"publishLocatedAction"](r,d,h,q).failure(function(){e=true}).always(function(){if(++g==f.length){l[e?"reject":"resolve"]()}})},this);return l.promise()},visit:function(e,h,g,d){var c=a.util.Deferred();var f={};var j=h.join(",");f.tags=j;if(g){f["fb:explicitly_shared"]=true}this.publishLocatedAction("visit","city",e,f);return c.promise()},removePin:function(e,k){var c=a.util.Deferred();var d=false;var g,f;if(e){g=this.locationToOgType(e.type);f=e.url}if(!(g&&e.url&&k&&k.length)){return c.reject()}var j=Array.prototype.each?"each":"forEach";var h=0;k[j](function(l){var m=l=="been"?"pin":l;var n={};this.deleteActionsByObject(m,g,f).failure(function(){d=true}).always(function(){if(++h==k.length){c[d?"reject":"resolve"]()}})},this);return c.promise()},removeBadge:function(c){var d=false;var f,e;if(c){var f="badge";var e="/MemberTravelMap?ns=badge&badgeId="+c.id}if(!(f&&e)){return new a.util.Deferred().reject()}return this.deleteActionsByObject("earn",f,e)},rate:function(c){var g="rate";var f="attraction";var e=c.url;var d={};if(a.retrieve("feature.ogRefContainsFbid")){d.ref="fbid="+this.id}return this[c.redistributable?"publishLocatedAction":"publishAction"](g,f,e,d)},review:function(e,h,c){var g="review";var f="";if(e.indexOf("/Attraction")==0){f="attraction"}else{if(e.indexOf("/Hotel")==0){f="hotel"}else{if(e.indexOf("/Restaurant")==0){f="restaurant"}}}var d={title:h,body:c};d["fb:explicitly_shared"]=true;return this.publishAction(g,f,e,d)},earnBadge:function(c,f,j){var h="earn";var g="badge";var e="/MemberTravelMap?ns=badge&badgeId="+c;var d={};if(f){d["fb:explicitly_shared"]=true;e+="&story_type=badge_explicit_og"}if(j){d.no_feed_story=true}return this.publishAction(h,g,e,d)},endorseFriend:function(d,c){var h="endorse";var g="friend";var f="/MemberTravelMap?ns=friend&serial="+d;var e={city:"http://"+this.options.hostname+c};return this.publishAction(h,g,f,e)},updateMap:function(c){this._needToScrapeMap=true;if(this._intervalID&&!c){return a.util.Deferred().resolve()}this._intervalID||(this._intervalID=window.setInterval(this.scrapeMap.bind(this),b));return this.options.MapAction.getTravelMapMetaData().always(function(d){var h="publish";var g="map";var f="/MemberTravelMap?ns=map&uid="+this.options.guid;var e={};if(d&&d.tmTotalDistance){e={total_distance:Math.round(d.tmTotalDistance),distance_unit:d.tmDistanceUnit}}if(a.retrieve("feature.ogRefContainsFbid")){e.ref="fbid="+this.id}if(c){e["fb:explicitly_shared"]=true;f+="&story_type=map_explicit_og"}return this.publishAction(h,g,f,e)},this)},shareMapLink:function(){var c={};c.name=tm.hub.messages.myTravelMap;c.link="http://"+this.options.hostname+"/MemberTravelMap?ns=map&uid="+this.options.guid+"&story_type=map_link";c.picture="http://"+this.options.hostname+"/img2/facebook/dlRecentPinned.jpg";return this.postFeed(c)},scrapeMap:function(c){if(this._needToScrapeMap||c){this._needToScrapeMap=false;return this.scrape("http://"+this.options.hostname+"/MemberTravelMap?ns=map&uid="+this.options.guid)}return a.util.Deferred().resolve()}})}(ta));if(!ta.popups){ta.popups={}}ta.popups.PopUtil={windowType:{CHECK_RATE:0,PROV_WIN:1,HOLDING:2,COMMERCE:3,VFM:4,COOKIE:5},taPopunderSlots:null,taPopupSlots:null,taHoldingWindowCap:2,taPopWindowSet:[],taWindowCount:0,maxPopunders:4,hwClosed:false,getAndUpWindowCount:function(){return this.taWindowCount++},tryHoldingWindows:function(a,b){try{var g=true;for(var c=0;c<b;c++){var f=this.launchHoldingWindow(a);if(!f.windowObject){g=false}}if(g){return true}}catch(d){ta.util.error.record(d,"try two hw")}return false},getPopunderSlots:function(){if(this.taPopunderSlots===null){this.taPopunderSlots=new ta.popups.PopunderSlotSet()}return this.taPopunderSlots},getPopupSlots:function(){if(this.taPopupSlots===null){this.taPopupSlots=new ta.popups.PopupSlotSet()}return this.taPopupSlots},createCheckRatesWindow:function(a){return this.buildNewWindow(this.windowType.CHECK_RATE,a)},createHoldingWindow:function(b){var a=this.buildNewWindow(this.windowType.HOLDING,b);if(a&&ta.has("checkrates.belligerent_hw")&&Browser.version>22){ta.store("checkrates.popunder",a)}return a},createVFMWindow:function(a){return this.buildNewWindow(this.windowType.VFM,a)},createCookieConsentWindow:function(a){return this.buildNewWindow(this.windowType.COOKIE,a)},buildNewWindow:function(b,d){var a=new ta.popups.TAPopWindow(b,d);if(!a){return false}if(!a.errorOpening&&!a.errorMoving&&a.windowObject){try{if(ta.has("checkrates.add_holding_windows")&&d.windowHook&&d.windowHook.location&&d.windowHook.location.href.test(/RuleBasedPopunder/)){this.taPopWindowSet.unshift(a)}else{this.taPopWindowSet[this.taPopWindowSet.length]=a}if(!d.windowHook&&b==this.windowType.HOLDING){this.trackPopunder(d.url,this.numPopundersCheck())}return a}catch(c){ta.util.error.record(c,"Window Popup - could not register new window")}}return false},getHoldingWindowSet:function(){var e=[];for(var b=0;b<this.taPopWindowSet.length;b++){var a=this.taPopWindowSet[b];if(a&&a.type==this.windowType.HOLDING){var c=a.windowObject;if(c&&"closed" in c){if(!c.closed){e[e.length]=a}else{if(ta.has("checkrates.add_holding_windows")&&c.closed){this.hwClosed=true;var d=window.cookieDomain;if(d){Cookie.write("CommercePopunder","SuppressAll",{domain:d,duration:0})}}}}}}return e},attemptHoldingWindowFromGeoCR:function(){},attemptHoldingWindowWNumChecked:function(){},openCloseTab:function(){var c,d;if(ta.has("popunder.popunder_by_self_closing_tab")){try{d=document.createElement("a");d.href="http://"+window.location.hostname+"/vpages/tab.html";document.body.appendChild(d);c=document.createEvent("MouseEvents");c.initMouseEvent("click",false,true,window,0,0,0,0,0,true,false,false,true,0,null);d.dispatchEvent(c);d.parentNode.removeChild(d)}catch(h){ta.util.error.record(h,"self-closing tab blur method failed")}}else{if(ta.has("checkrates.cr_popunder_by_shift_ctrl")&&Browser.version>23){try{d=document.createElement("a");d.href="about:blank";d.target="popunderwindowhelper";document.body.appendChild(d);c=document.createEvent("MouseEvents");var f=true;var b=true;c.initMouseEvent("click",f,b,window,0,0,0,0,0,true,false,false,true,0,null);d.dispatchEvent(c);d.parentNode.removeChild(d);window.open("about:blank","popunderwindowhelper").close()}catch(h){ta.util.error.record(h,"shift-ctrl blur method failed")}}else{var a=ta.retrieve("checkrates.popunder");if(ta.has("checkrates.belligerent_hw")&&a&&Browser.version>22){var g=window.open("about:blank");if(g){g.close()}ta.remove("checkrates.popunder");try{if(a.windowObject&&a.isTAWindow()){a.moveBehindMain(a.windowObject)}}catch(h){ta.util.error.record(h,"holding window blur")}}}}},attemptHoldingWindow:function(a){if(this.useShiftClick()){return}if(ta.has("checkrates.add_holding_windows")){var b=this.numPopundersCheck();if(b>=this.maxPopunders){return}else{this.launchHoldingWindow(a)}}else{if(this.taHoldingWindowCap>this.getHoldingWindowSet().length){this.launchHoldingWindow(a)}}},launchHoldingWindow:function(a){if(!a){return false}var b=ta.retrieve("checkrates.holdingWindowURI");if(ta.has("checkrates.avlb_popup_win")){b="http://"+window.location.hostname+"/AlsoViewedLB?checkRatesType=checkRates&avlbType=popup&d="+a}if(b){ta.store("checkrates.HWtracking","date");var c={url:b};return this.createHoldingWindow(c)}return false},launchAddHoldingWindow:function(c,a){var b=a||{};b.url=c;return this.createHoldingWindow(b)},popunderReminder:function(b){var a={windowHook:b};this.createHoldingWindow(a)},numPopundersCheck:function(){try{var f=this.getHoldingWindowSet();var b=0;var a=new Cookie("CommercePopunder").readRaw();var d=a?a.match(/\d+/):null;if(!a||!d){b=f.length}else{b=Math.max(f.length,parseInt(d[0],10))}return b}catch(c){ta.util.error.record(c,"CommercePopunder - numPopundersCheck")}},trackPopunder:function(j,h){try{if(!h||!j){return}var c="CommerceEnhancedPopunder";if(j.match(/AlsoViewedLB/)){c="AlsoViewedLB"}else{var a=j.match(/RuleBasedPopunder\?Rule=\d+/);if(a){var d=a[0].match(/\d+/);c="RuleBasedPopunder_"+d[0]}}var b="OpenWindow";var g=ta.retrieve("checkrates.HWtracking");if(g){b="OpenWindow_"+g;ta.remove("checkrates.HWtracking")}ta.trackEventOnPage("CommercePopunder",b,c,h,true)}catch(f){ta.util.error.record(f,"CommercePopunder - trackPopunder")}},trackPopup:function(f){try{if(!f){return}var b="DHTMLOverlay";var g=f.match(/RuleBasedPopup/);if(g){var a=f.match(/Rule=\d+/);if(a){var c=a[0].match(/\d+/);b="RuleBasedPopup_"+c[0]}}ta.trackEventOnPage("Popup","OpenPopup",b,1,true)}catch(d){ta.util.error.record(d,"Popup - trackPopup")}},hasMTPU:function(){try{var c=false;var f=this.getHoldingWindowSet();for(var a=f.length;a--;){var b=f[a].windowObject;if(b&&b.location.href.match(/RuleBasedPopunder/)){c=true;break}}return c}catch(d){ta.util.error.record(d,"CommercePopunder - hasMTPU")}},getProviderWindowDims:function(a,d){var b=null;var f=null;var e=null;var c=null;if(a=="hotels.com"){b=975}if(screen.width>=1280){b=1000;f=897;if(!d){e=0;c=0;if(Browser.chrome){f-=50}else{if(Browser.firefox){f-=87}else{if(Browser.ie){b-=12;f-=179}}}}}return{customWidth:b,customHeight:f,widthOffset:e,heightOffset:c}},useShiftClick:function(){if(ta.has("checkrates.chrome_provider_on_shift_click")){var b=this.getProviderWindowDims();var a=66;if(((window.outerHeight>b.customHeight)||(window.outerWidth>b.customWidth))&&((window.outerHeight<(screen.height-a))&&(window.outerWidth<(screen.width-a)))){ta.store("checkrates.use_chrome_provider_on_shift_click",true);return true}}if(!ta.has("checkrates.cr_provider_on_mousedown")){ta.remove("checkrates.use_chrome_provider_on_shift_click")}return false},expandSidebarWindow:function(c,a,b){if(ta.trackEventOnPage){ta.trackEventOnPage("traffic_acquisition_sidebar","any",a,1)}if(b=="true"){window.moveTo(0,0);window.resizeTo(screen.width,screen.height)}document.getElementById("SliderHolder").style.display="none";document.getElementById("PAGE").style.marginLeft="0px"},cookieSettingsPanel:function(d){if(d){d.stop()}var a={};a.en=451;a.en_UK=834;a.en_IE=835;a.en_ZA=2635;a.sv=720;a.no=721;a.da=1199;a.fr=1197;a.de=1201;a.de_AT=2719;a.el=1198;a.it=1202;a.es=1200;a.pl=1208;a.nl=1209;a.fi=2968;a.hu=3049;a.cs=3128;a.sk=3233;a["default"]=451;var b;if(posLocale in a){b="http://info.evidon.com/pub_info/"+a[posLocale]+"?v=1&nt=0"}else{b="http://info.evidon.com/pub_info/"+a["default"]+"?v=1&nt=0"}var c={customWidth:830,customHeight:620,name:"Cookie Consent Tool",url:b,scrollbars:1,menubar:0,toolbar:0,left:0,top:0};ta.popups.PopUtil.createCookieConsentWindow(c)},newWindowFromExitPop:function(b,a){var c=window.open(a,"_blank","height="+screen.height+",width="+screen.width+",toolbar=yes,menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes");if(window.focus){c.focus()}},displayCommerceClickInterstitial:function(g,b,d){var c=ta.id("meta_click_interstitial_wrap");if(c){var a=c.getElement(".provider_logo");if(a){a.setProperty("src",(b||""))}try{g.document.write(c.get("html"));ta.trackEventOnPage("COMMERCE_CLICK","INTERSTITIAL_LOADED",(d||""))}catch(f){}}},pollForPartnerLoad:function(a,b,c){if(a){setTimeout(function(){var f=null;var d=new Date().getTime()-b.getTime();try{f=a.document}catch(g){}if(!f){ta.trackEventOnPage("COMMERCE_CLICK","PROVIDER_LOADED",(c||""),d)}else{if(d>20000){ta.trackEventOnPage("COMMERCE_CLICK","PROVIDER_TIMEOUT",(c||""),d)}else{if(a.closed){ta.trackEventOnPage("COMMERCE_CLICK","PROVIDER_CLOSED",(c||""),d)}else{ta.popups.PopUtil.pollForPartnerLoad(a,b,c)}}}},100)}},redirectToUrl:function(a,c){if(a){if(ta.retrieve("commerce_history_injection.enabled")&&a.history&&a.history.pushState){try{a.history.pushState({fromBackClick:true},"",window.location.href);ta.trackEventOnPage("COMMERCE_HISTORY_INJECT","history_injected","")}catch(b){ta.util.error.record(b,"commerce history injection failed",null,null,"WARN")}}a.location=c}else{window.location=c}},maximizeWindow:function(){window.moveTo(0,0);window.resizeTo(screen.availWidth,screen.availHeight)},beforePopTargetBlankIE:function(c){var b,d,a;if(!c||!c.href){return true}b=ta.id(c);if(!b||!b.getProperty||b.getProperty("target")!=="_blank"){return true}if(!ta.browser||!ta.browser.isIE10Metro()){if(ta.browser&&!ta.browser.isIE9orHigher()){a=window.getSize();if(a){d=window.open(c.href,"_blank","location=yes,resizable=yes,menubar=yes,scrollbars=yes,toolbar=yes,width="+a.x+",height="+a.y)}}else{d=window.open(c.href,"_blank")}}if(!d||d.closed||typeof d.closed==="undefined"){b.removeProperty("target");if(ta.util&&ta.util.cookie){ta.util.cookie.setPIDCookie(38821)}return true}else{return false}},attemptOpenUrlNewTab:function(b){var c;if(!ta.browser||!ta.browser.isIE10Metro()){if(ta.browser&&window.isIE&&!ta.browser.isIE9orHigher()){var a=window.getSize();if(a){c=window.open(b,"_blank","location=yes,resizable=yes,menubar=yes,scrollbars=yes,toolbar=yes,width="+a.x+",height="+a.y)}}else{c=window.open(b,"_blank")}}if(!c||c.closed||typeof c.closed==="undefined"){if(ta.util&&ta.util.cookie){ta.util.cookie.setPIDCookie(38821)}window.location=b}}};ta.popups.TAPopWindow=new Class({Implements:Options,options:{name:"TAWin",url:"",windowHook:false,customWidth:false,customHeight:false,toolbar:1,location:1,directories:1,status:1,menubar:ta.browser.isIE9orHigher()?0:1,resizable:1,copyhistory:1,scrollbars:1,alwaysRaised:false,alwaysLowered:false,widthOffset:8,heightOffset:164,delayLoad:false},initialize:function(j,m){var f,l,b;this.setOptions(m);this.type=j;this.assignSlot();if(this.options.customWidth){this.width=this.options.customWidth}if(this.options.customHeight){this.height=this.options.customHeight}if(this.options.widthOffset!=null){this.widthOffset=this.options.widthOffset}if(this.options.heightOffset!=null){this.heightOffset=this.options.heightOffset}if(this.options.delayLoad){this.delayLoad=this.options.delayLoad}if(this.options.windowHook){this.windowObject=this.options.windowHook;if(!ta.has("checkrates.add_holding_windows")){this.windowObject.refresh()}return true}if(ta.has("checkrates.chrome_dates_entry_holding")){this.options.scrollbars=0}this.url=this.options.url;this.assignWinArgs();try{if(this.type==ta.popups.PopUtil.windowType.HOLDING){ta.util.cookie.setPIDCookie(28962)}if(Browser.chrome&&this.options.inTab){var h=Math.random().toString(36).substring(7);if(this.options.popunder){f=document.createElement("a");f.href=this.url;f.target=h;document.body.appendChild(f);l=document.createEvent("MouseEvents");l.initMouseEvent("click",false,true,window,0,0,0,0,0,true,false,false,true,0,null);f.dispatchEvent(l);f.parentNode.removeChild(f);this.windowObject=window.open(this.url,h);return}else{this.windowObject=window.open(this.url,h);return}}if(ta.has("checkrates.use_chrome_provider_on_shift_click")){f=document.createElement("a");f.href=this.url;document.body.appendChild(f);l=document.createEvent("MouseEvents");l.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,true,false,0,null);this.windowObject=f.dispatchEvent(l);f.parentNode.removeChild(f)}else{if(this.type==ta.popups.PopUtil.windowType.HOLDING&&ta.has("popunder.popunder_by_self_focus")){window.open("javascript:window.focus()","_self","")}var a=Browser.chrome&&Browser.version>31;if(a){this.windowObject=window.open("","_blank")}else{if(this.options.popunder){if(Browser.ie8||Browser.ie9||Browser.ie10||Browser.ie11){this.windowObject=window.open("pages/blank.html","_blank",this.winArgs);try{this.windowObject.blur()}catch(d){}window.focus()}else{if(Browser.safari&&Browser.Platform.name!=="ios"){this.windowObject=window.open("","_blank",this.winArgs);if(this.windowObject){var k=window.open("","_blank");k.close()}window.focus()}else{if(Browser.firefox){this.windowObject=window.open("","_blank",this.winArgs);window.open("","_self","");window.focus()}else{this.windowObject=window.open("","_blank",this.winArgs)}}}}else{this.windowObject=window.open("","_blank",this.winArgs)}}b=this.windowObject;if(b&&this.isTAWindow()){if(this.type==ta.popups.PopUtil.windowType.CHECK_RATE){ta.popups.PopUtil.pollForPartnerLoad(b,new Date(),this.options.name)}if(!this.delayLoad){if(ta.retrieve("meta_click_interstitial.enabled")){ta.popups.PopUtil.displayCommerceClickInterstitial(b,this.options.providerLogo,this.options.name);var c=this.url;setTimeout(function(){try{ta.popups.PopUtil.redirectToUrl(b,c)}catch(n){}},500)}else{ta.popups.PopUtil.redirectToUrl(this.windowObject,this.url)}}}else{if(!b&&Browser.ie&&this.type===ta.popups.PopUtil.windowType.CHECK_RATE&&this.url&&ta.has("ta.ie_commerce_popup_block_fix")){if(ta.util&&ta.util.cookie){ta.util.cookie.setPIDCookie(38822)}window.location=this.url}}}}catch(g){this.errorOpening=g;ta.util.error.record(this.errorOpening,"pop window opening failure",null,{type:this.type,url:this.url})}try{b=this.windowObject;if(b&&this.isTAWindow()){if(this.type==ta.popups.PopUtil.windowType.HOLDING){this.moveBehindMain(b)}}}catch(g){this.errorMoving=g;ta.util.error.record(this.errorMoving,"popunder window moving",null,{type:this.type,url:this.url})}},repurpose:function(d,b,f){if(this.type==ta.popups.PopUtil.windowType.HOLDING){this.type=ta.popups.PopUtil.windowType.CHECK_RATE;this.slot.occupied=false;this.assignSlot();this.url=d;if(b){this.width=b;this.options.widthOffset=0}if(f){this.height=f;this.options.heightOffset=0}var a=this.windowObject;if(a&&this.isTAWindow()){try{if(!this.options.inTab){a.moveTo(0,0);a.resizeTo(this.width+this.options.widthOffset,this.height+this.options.heightOffset);a.moveTo(this.x,this.y)}if(!this.delayLoad&&!this.options.keepFocus){a.focus()}if(!this.delayLoad){a.location=this.url}}catch(c){ta.util.error.record(this.errorMoving,"repurpose popunder fail",null,{type:this.type,url:this.url})}}return this}return false},assignWinArgs:function(){this.winArgs="toolbar="+this.options.toolbar;this.winArgs+=",location="+this.options.location;this.winArgs+=",directories="+this.options.directories;this.winArgs+=",status="+this.options.status;this.winArgs+=",menubar="+this.options.menubar;this.winArgs+=",resizable="+this.options.resizable;this.winArgs+=",copyhistory="+this.options.copyhistory;this.winArgs+=",scrollbars="+this.options.scrollbars;this.winArgs+=",width="+this.width;this.winArgs+=",height="+this.height;this.winArgs+=",left="+this.x;this.winArgs+=",top="+this.y;this.winArgs+=",screenx="+this.x;this.winArgs+=",screeny="+this.y;if(this.options.alwaysRaised){this.winArgs+=",alwaysRaised"}if(this.options.alwaysLowered){this.winArgs+=",alwaysLowered"}},assignSlot:function(){if(this.type==ta.popups.PopUtil.windowType.HOLDING){this.slot=ta.popups.PopUtil.getPopunderSlots().getOpenSlot();this.width=this.slot.tw;this.height=this.slot.th;this.x=this.slot.tx;this.y=this.slot.ty}else{this.slot=ta.popups.PopUtil.getPopupSlots().getOpenSlot();this.width=this.slot.w+this.options.widthOffset;this.height=this.slot.h+this.options.heightOffset;this.x=this.slot.x;this.y=this.slot.y}this.slot.occupied=this},moveBehindMain:function(c){if(!ta.has("popunder.popunder_by_self_focus")||ta.has("popunder.popunder_by_self_focus_shift_ctrl")){if(ta.has("checkrates.cr_popunder_by_shift_ctrl")&&Browser.version>23){ta.popups.PopUtil.openCloseTab()}else{if(ta.has("checkrates.chrome_dates_entry_holding")&&!(ta.has("checkrates.belligerent_hw")&&Browser.version>22)){try{var a=window.open("about:blank");if(a){a.focus();a.close()}}catch(b){ta.util.error.record(b,"holdingWindow - Chrome blur failed")}}}}c.blur();c.opener=self;c.moveTo(this.slot.x,this.slot.y);c.resizeTo(this.slot.w,this.slot.h);if(!this.delayLoad){c.location=this.url}window.focus();if(!document.activeElement.hasClass("globalNav2011_reset")){ta.trackEventOnPage("checkrates","no_focus_on_main",Browser.version,1)}},isTAWindow:function(){var c=true;try{var a=this.windowObject.location;this.windowObject.status="";if(a===null||a===""){c=false}}catch(b){c=false}return c}});ta.popups.Slot=new Class({initialize:function(c,b,d,a){this.x=c;this.y=b;this.w=d;this.h=a;this.occupied=null}});ta.popups.SlotSet=new Class({initialize:function(){this.nW=525;this.nH=460;this.nXI=24;this.nYI=24;this.totalSlots=20;this.slots=[];try{if(screen.width>1024){this.nW=800;this.nH=600;this.nXI=80;this.nYI=40}else{if(screen.width>800){this.nW=620;this.nH=500;this.nXI=60;this.nYI=30}}}catch(a){this.error=a;ta.util.error.record(this.error,"slot set",null,{"slot set":"general"})}},getUsedCount:function(){var b=0;if(this.slots){for(var a=0;a<this.slots.length;a++){if(this.slots[a].occupied&&!this.slots[a].occupied.closed){b++}}}return b},getOpenSlot:function(f){if(!f||f<0||f>this.totalSlots){f=0}var d=function(m){try{var h=false;var k=false;try{k=this.slots[m].occupied}catch(l){}if(!k){h=true}else{try{var g=k.windowObject;if(!g||g.closed){h=true}}catch(l){h=true}}}catch(l){ta.util.error.record(l,"get open slot - get pop slot",null,{totalSlots:this.totalSlots,slotNumber:m})}if(h){this.slots[m].occupied=null;var j=this.slots[m];j.slotPos=m;return j}return false}.bind(this);try{for(var a=f-1;a>=0;a-=1){var c=d(a);if(c){return c}}for(var a=f;a<this.slots.length;a++){var c=d(a);if(c){return c}}}catch(b){ta.util.error.record(b,"get open slot",null,{totalSlots:this.totalSlots})}return false}});ta.popups.PopunderSlot=new Class({Extends:ta.popups.Slot,initialize:function(b,j,d,f,c,a,e,g){this.parent(b,j,d,f);this.tx=c;this.ty=a;this.tw=e;this.th=g}});ta.popups.PopupSlotSet=new Class({Extends:ta.popups.SlotSet,initialize:function(){this.parent();this.nX=500;var b=1160;try{if(screen.width<1660){if(screen.width>1024&&screen.width<1280){b=960}else{if(screen.width<=1024){b=740}}this.nX=screen.width-b}this.nY=!isNaN(window.screenTop)?window.screenTop:!isNaN(window.screenY)?window.screenY:0}catch(c){this.error=c;this.nY=0;ta.util.error.record(this.error,"slot set",null,{"slot set":"popup"})}for(var a=0;a<this.totalSlots;a++){this.slots[a]=new ta.popups.Slot(this.nX,this.nY,this.nW,this.nH);this.nX=this.nX+this.nXI;this.nY=this.nY+this.nYI}}});ta.popups.PopunderSlotSet=new Class({Extends:ta.popups.PopupSlotSet,initialize:function(){this.parent();try{this.nX=(window.screenLeft||window.screenX);this.nY=(window.screenTop||window.screenY)}catch(b){this.error=b;this.nX=200;this.nY=200}this.w=1;this.h=1;this.x=5000;this.y=5000;this.totalSlots=4;try{if(Browser.ie7){this.w=250;this.h=100}if(Browser.safari||Browser.chrome){this.w=85;this.h=100}if(typeof(this.nX)=="undefined"){this.nX=0;this.nY=0;this.x=this.nX+window.screen.availWidth-this.w;this.y=this.nY+window.screen.availHeight-this.h}else{this.x=this.nX+window.getWidth()-this.w;this.y=this.nY+window.getHeight()-this.h}if(Browser.ie7){this.y=this.y-95;this.x=this.x+13}else{if(Browser.safari||Browser.chrome){this.y=this.y-16}}}catch(b){this.error=b}if(this.error){ta.util.error.record(this.error,"slot set",null,{"slot set":"popunder"})}for(var a=0;a<this.totalSlots;a++){this.slots[a]=new ta.popups.PopunderSlot(this.nX,this.nY,this.nW,this.nH,this.x,this.y,this.w,this.h);this.nX=this.nX+this.nXI;this.nY=this.nY+this.nYI}}});(function(a,c,b,d){b.commerce.meta=(function(h){var g=function(){return typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates},f=function(r,o,s){var p="sprite-",n=p+o,q=p+s;if(r.hasClass(n)){r.removeClass(n);r.addClass(q)}},j=function(){var n=h.retrieve("meta.chevronTracking"),p=h.retrieve("meta.chevronAction"),o=h.retrieve("meta.chevronLabel");if(n&&p){if(!o){h.trackEventOnPage(n,p)}else{h.trackEventOnPage(n,p,o)}}h.remove("meta.chevronTracking");h.remove("meta.chevronAction");h.remove("meta.chevronLabel")},e=function(r,n){var o,q,p,s;if(n!==null&&r!==null){h.commerce.meta.suppressCRArea(r);o=r.getElement(".metaDatesNotChosen");q=r.getElement(".metaDatesChosen");if(q&&h.retrieve("meta.bc.show_title")){if(o){o.addClass("miniMetaHideHdr");o.removeClass("miniMetaShowHdr")}q.addClass("miniMetaShowHdr");q.removeClass("miniMetaHideHdr")}r.getElements(".minimalist_datepicker_wrap.hidden").each(function(t){t.removeClass("hidden")});p=r.getElement(".postShowMetaCR");if(p!=null){p.destroy()}p=r.getElement(".postShowMetaCRLB");if(p!=null){p.destroy()}p=r.getElement(".postShowMetaCRLBPCR");if(p!=null){p.destroy()}s=r.getElement("fieldset");h.commerce.meta.adoptMiniMetaElem(s,n)}},l=function(n){if(!n){return}if(n.getElement(".hacMiniComplete")&&!n.getElement(".anyOfferCompletedSuccessfully")){n.getElements(".photos_lb_update_avail").each(function(o){o.addClass("hidden")});n.getElements(".photos_lb_update_no_avail").each(function(o){o.removeClass("hidden")})}else{n.getElements(".photos_lb_update_avail").each(function(o){o.removeClass("hidden")});n.getElements(".photos_lb_update_no_avail").each(function(o){o.addClass("hidden")})}},k=function(n){n.getElements(".textLinks").each(function(o){o.addClass("hidden")});n.getElements(".maybeCheck").each(function(o){o.addClass("hidden")});n.getElements(".disclaimer").each(function(o){o.addClass("hidden")});n.getElements(".photos_lb_update_links").each(function(o){o.removeClass("hidden")});n.getElements(".taxesAndFees").each(function(o){o.addClass("hidden")});l(n)},m=function(o,n,p){o=o?o:"";n=n?n:"";p=p?p:"";var q=[o,n,p].join("|").replace("||","|").replace(/(\|$)/g,"");h.commerce.meta.updateNavArea(q)};return{updateInlineMeta:function(p,o){if(!h.widgets.calendar.hasPageDates()){h.commerce.meta.popInlineDatePicker(o,p);return}var n=h.id("CHECK_RATE");if(!n){return}},popInlineDatePicker:function(p,q){if(!q){return}var n;var o="_inm";if(p&&p.target&&p.target.getParent("#CHECK_RATES_CONT")){n=h.id("date_picker_"+q)}n=n||h.id("date_picker_"+q+o);if(n){var r=n.getParent(".date_picker_calendar_wrap");if(r&&r.onclick){r.onclick(p,r,q,o);r.fireEvent("click",p,r,q,o);(function(){try{h.retrieve("avail.data."+q+o).calendar.calendarOverlay.position()}catch(s){}}).delay(200)}}},clickMetaShowPrices:function(o){var n;if(!h.widgets.calendar.hasPageDates()&&!(h.retrieve("datepicker_autoadvance")&&h.widgets.calendar.getPageInDate())){h.widgets.calendar.setErrorStyling(new Event(o).target);return}n=a.getElement(".cr_lb_overlay");if(n&&n.overlay){n.overlay.hide()}},showLowestPriceCTA:function(t){var o=(t)?"metaLowestPriceCTAInline":"metaLowestPriceCTA";if(h.has(o)){var s=true;if(t){var w=a.getElement(".meta_rates_content");s=w&&w.style.display=="block"}if(s){var p=h.retrieve(o);if(p.hasOwnProperty("idx")){var u=(t)?"Meta_LP_CTA_Display_Inline":"Meta_LP_CTA_Display";var r=(p.idx===0)?"Not_Displayed":"Displayed";var v=p.idx+"";h.trackEventOnPage(u,r,v)}var q=(t)?"LP_CTA_INLINE":"LP_CTA";var n=h.id(q);if(n){(function(){n.fade("in")}).delay(1000)}}}},chevronHover:function(r,p,o,q){if(p&&o&&q){var n=h.id(p).getElement("."+q);if(n){n.removeClass(q);n.addClass(o)}}},chevronBlur:function(r,p,o,q){if(p&&o&&q){var n=h.id(p).getElement("."+o);if(n){n.removeClass(o);n.addClass(q)}}},hoverTopOffer:function(){var n=a.getElement(".rgba_gray_arrow_up");if(n){n.removeClass("rgba_gray_arrow_up");n.addClass("rgba_yellow_arrow_up")}},blurTopOffer:function(){var n=a.getElement(".rgba_yellow_arrow_up");if(n){n.removeClass("rgba_yellow_arrow_up");n.addClass("rgba_gray_arrow_up")}},hoverBookBtn:function(n){var o=h.id(n);f(o,"bookBtnOrangeIdle","bookBtnOrangeOver");f(o,"bookBtnGreyIdle","bookBtnGreyOver");f(o,"bookIdle","bookOver");f(o,"goIdle","goOver");f(o,"selectIdle","selectOver");f(o,"bookSmallIdle","bookSmallOver");f(o,"goSmallIdle","goSmallOver");f(o,"selectSmallIdle","selectSmallOver");f(o,"goBtnGrey","goBtnGreyOver");f(o,"goBtnOrange","goBtnOrangeOver");f(o,"chevronOrangeIdle35","chevronOrangeOver35");f(o,"chevronGreyIdle27","chevronGreyOver27");f(o,"chevronIdle_ylw","chevronHover_ylw")},blurBookBtn:function(n){var o=h.id(n);f(o,"bookBtnOrangeOver","bookBtnOrangeIdle");f(o,"bookBtnGreyOver","bookBtnGreyIdle");f(o,"bookOver","bookIdle");f(o,"goOver","goIdle");f(o,"selectOver","selectIdle");f(o,"bookSmallOver","bookSmallIdle");f(o,"goSmallOver","goSmallIdle");f(o,"selectSmallOver","selectSmallIdle");f(o,"goBtnGreyOver","goBtnGrey");f(o,"goBtnOrangeOver","goBtnOrange");f(o,"chevronOrangeOver35","chevronOrangeIdle35");f(o,"chevronGreyOver27","chevronGreyIdle27");f(o,"chevronHover_ylw","chevronIdle_ylw")},hoverSmallBookBtn:function(o){var n=h.id(o).getElement(".bookBtn");if(n==null){return}f(n,"bookBtnOrangeIdleSmall","bookBtnOrangeIdleSmallOver");f(n,"bookSmallIdle","bookSmallOver");f(n,"goSmallIdle","goSmallOver");f(n,"selectSmallIdle","selectSmallOver")},blurSmallBookBtn:function(o){var n=h.id(o).getElement(".bookBtn");if(n==null){return}f(n,"bookBtnOrangeIdleSmallOver","bookBtnOrangeIdleSmall");f(n,"bookSmallOver","bookSmallIdle");f(n,"goSmallOver","goSmallIdle");f(n,"selectSmallOver","selectSmallIdle")},providerHoverOn:function(o,u,t){var s=h.id(o);s.addClass("partnerHvr");var n=s.getElement(".price_overlay");if(n){var r=s.getElement(".perNight");var q=r.getCoordinates().width+29;n.addClass("show");if(h.util.i18n.isRtl()){n.setStyles({position:"absolute",left:q,zindex:"101"})}else{n.setStyles({position:"absolute",right:q,zindex:"101"})}}var p=o.getElement(".bookBtn");if(p){h.commerce.meta.hoverBookBtn(p)}h.store("meta.hoverProvider",u);h.store("meta.hoverProviderPosn",t)},providerHoverOff:function(o){var q=h.id(o);q.removeClass("partnerHvr");var n=q.getElement(".price_overlay");if(n){n.removeClass("show")}var p=o.getElement(".bookBtn");if(p){h.commerce.meta.blurBookBtn(p)}h.remove("meta.hoverProvider")},restoreProviderHover:function(){var n=h.retrieve("meta.hoverProvider");var r=h.retrieve("meta.hoverProviderPosn");if(n&&r){var q=h.id("PROVIDER_BLOCK");if(q){var p=q.getElements(".metaProvider");var o=q.getElement(".provider_"+n);if(p&&o&&o.hasClass("order_"+r)){p.each(function(s){h.commerce.meta.providerHoverOff(s)});h.commerce.meta.providerHoverOn(o,n,r)}}}},updateNavArea:function(n){var o=h.retrieve("ta.meta.navArea");if(!o||o.indexOf(n)<0){h.store("ta.meta.navArea",n)}},getNavAreaContextFromDom:function(o,n){o=h.id(o);if(o.getParent(".persistentCR")){return(n)?"|PCR":"PCR"}else{if(o.getParent(".photosOverlay")||o.getParent("#LOC_PHOTO_ALBUMS")){return(n)?"|Photo_Lightbox":"Photo_Lightbox"}else{if(o.getParent(".amenities_lightbox")){return(n)?"|Amenities_Lightbox":"Amenities_Lightbox"}else{if(o.getParent("#CHECK_RATES_LB")){return(n)?"|Photo_LB":"Photo_LB"}else{return}}}}},updateNavAreaMini:function(o,p,n){p=h.id(p);var q=h.commerce.meta.getNavAreaContextFromDom(p);q=q?"|"+q:"";m(o,q,n)},loadBestPriceXsell:function(D,G,r,q){try{if(h.retrieve("checkrates.one_second_xsell")!==true){return}var F=r&&r.isInline;var z="";var s="";var L=r&&r.isMetaLighboxV3;if(h.isHRTabs2014()&&F){return}if(L){z="meta_lightbox_v3"}var E=1000;var n="loadBestPriceXsell_numTries";var t="loadBestPriceXsell_curCancelKey";if(F){n="loadBestPriceXsellInline_numTries";t="loadBestPriceXsellInline_curCancelKey"}var K="meta.xsellTravelData";if(F){K="meta.xsellTravelDataInline"}var v=h.retrieve(K);if(q==null){q=new Date().getTime();h.store(n,0);v=h.widgets.calendar.getCheckRatesData();h.store(K,v);var w=h.id(G);if(w){w.innerHTML="";w.setStyle("height",0);w.setStyle("opacity","0");var B=h.retrieve("metaCheckRatesOverlay");B=h.id(B);if(!F&&B&&B.container&&B.container.getPosition){c.scrollTo(0,B.container.getPosition().y)}}if(F){h.commerce.meta.metaInYourMeta_resetInline()}else{h.commerce.meta.metaInYourMeta_resetLB()}}var u="loadBestPriceXsell_"+q+"_cancel";if(F){u="loadBestPriceXsellInline_"+q+"_cancel"}if(h.retrieve(u)){return}if(h.has(t)){var J=h.retrieve(t);if(J!=u){h.store(J,true)}}if(!h.has(u)){h.store(u,false);h.store(t,u)}var x=h.retrieve(n);var N=x+1;h.store(n,N);if(!v){return}var M="";if(typeof(pageServlet)!==d&&pageServlet){M=pageServlet}var C={};if(h.meta&&h.meta.update){C=h.commerce.meta.getMetaParams()}var y=Object.merge(v,{detail:D,"try":h.retrieve(n),reqNum:r.secondTry?"2":"1",type:z,isInlineRequest:F?"1":"0",openedVendors:s,origServlet:M},C);var p=Object.toQueryString(y);if(!p||!p.trim()){h.util.error.record(null,"ta.commerce.meta.loadBestPriceXsell  - toQueryString failure",null,y);return}var o=h.retrieve("ta.meta.navArea");var A;try{A=h.commerce.meta.tracking.setTimingForNavArea(o)}catch(I){h.util.error.record(I,"problem locking timing in ta.commerce.meta.loadBestPriceXsell")}if(A){y.metaRequestTiming=A}if(h.commerce.meta.tracking.hasAnySuppressedAreas()){var H=h.commerce.meta.tracking.getSuppressedAreasAsString();if(H){y.suppressImpressionsOnComplete=H}}new Request({url:"/MetaBestPriceCrossSellAjax?"+p,evalScripts:true,onSuccess:function(P){if(h.retrieve(u)){return}var O=P.contains("xsellHacStatusReady")||P.contains("xsellHacStatusSOL")||r.secondTry;if(!O){setTimeout(function(){var R={secondTry:true,xsell:true,isInline:F,isHrRedesignTest:false,openedVendors:s};h.commerce.meta.loadBestPriceXsell(D,G,R,q)},E)}else{var Q=h.id(G);if(Q){Q.setStyle("height",0);Q.setStyle("opacity","0");Q.setContent(P);h.commerce.meta.metaInYourMeta(G,{xsell:true,inline:F})}h.store(n,0)}},onFailure:function(){h.store(n,0);h.util.error.record(null,"ta.commerce.meta.loadBestPriceXsell - MetaBestPriceCrossSellAjax request failed")}}).send()}catch(I){h.util.error.record(I,"ta.commerce.meta.loadBestPriceXsell")}},loadGeoCrAutoBroadenContents:function(s,u){var A=5;var q=1000;var p="QC_Meta_Mini|GeoCheckRatesLightBox";try{var n=function(){v=false};var y=function(){s.fireEvent("close",s);s.hide()};var v=true;var x=h.id(s.inner);if(!x){throw new Error("Cannot find parent: "+s)}var r=function(E){var D=0;E.each(function(G){var F=G.getHeight();if(F>D){D=F}});E.each(function(F){F.setStyle("height",D)})};var B=h.commerce.meta.tracking.setTimingForNavArea(p);s.addEvent("close",n);var z={d:u,area:p,metaRequestTiming:B};var C=h.widgets.calendar.getCheckRatesData();if(!C){throw new Error("Cannot find dates and/or adults")}Object.merge(z,C);if(h.meta&&h.meta.update){Object.merge(z,h.commerce.meta.getMetaParams())}var t=0;var o=function(){if(!v){return}++t;z.attempt=t;new Request({url:"/GeoCrAutoBroadenAjax",data:z,method:"get",evalScripts:true,onSuccess:function(D){try{if(!v){return}var F=Elements.from(D,true);var G=F.getElement(".progress").filter(function(J){return J})[0];if(!G){h.util.error.record(null,"geo check rate malform response missing progress",null,z);y()}else{if(/\bfallbackUrl-(\S+)\b/.exec(G.className)){var I=RegExp.$1;var E=h.util.URL.getServletNameFromUrl(I);if(!E){h.util.error.record(null,"geo check rate cannot get servlet name from "+I,null,z);E="UNKNOWN"}h.setEvtCookie("MetaGeoLightBox","unload","Redirect",0,"/"+E);a.location.href=I}else{x.setStyles({overflow:"hidden",height:"auto"});x.innerHTML="";x.adopt(F);r(x.getElements("#GEO_CR_AUTO_BROADEN .recs .rec .info .distance"));r(x.getElements("#GEO_CR_AUTO_BROADEN .recs .rec .info .amenity"));if(!G.hasClass("isHacComplete")&&t<A){setTimeout(o,q)}else{x.getElements(".showUntilLast").dispose();x.getElements(".hideUntilLast").removeClass("hidden")}}}}catch(H){h.util.error.record(H,"cannot process geo check rate response",null,z);y()}},onFailure:function(D){h.util.error.record(null,"geo check rate request failed: status="+(D&&D.status),null,z);y()}}).send()};o()}catch(w){h.util.error.record(w,"cannot send geo check rate initial request");if(y){y()}}},xSellResponses:{lb_hac:false,lb_xsell:false,inline_hac:false,inline_xsell:false},metaInYourMeta_resetLB:function(){h.commerce.meta.xSellResponses.lb_hac=false;h.commerce.meta.xSellResponses.lb_xsell=false},metaInYourMeta_resetInline:function(){h.commerce.meta.xSellResponses.inline_hac=false;h.commerce.meta.xSellResponses.inline_xsell=false},hacIsBlockingXSell:function(n){var o=h.commerce.meta.xSellResponses;if(n){return o.inline_xsell}else{return o.lb_xsell}},metaInYourMeta:function(q,y){var p=y&&y.inline;var o=y&&y.xsell;var t=h.commerce.meta.xSellResponses;if(p){if(o){t.inline_xsell=true}else{t.inline_hac=true}}else{if(o){t.lb_xsell=true}else{t.lb_hac=true}}if((p&&t.inline_xsell)||(!p&&t.lb_xsell&&t.lb_hac)){var w=h.id("META_PRICE_XSELL");var v=h.id("STATE_OPT_RESPONSE");if(p){w=h.id("META_PRICE_XSELL_INLINE");v=h.id("STATE_OPT_RESPONSE_INLINE")}if(w&&w.hasClass&&!w.hasClass("hidden")){return}if(v&&v.hasClass&&!v.hasClass("hidden")){return}var x=w;var s=0;if(h.meta&&h.meta.update){s=h.meta.update.getMetaPricesCount(p)}else{if(g()){s=dd.commerce.checkrates.getMetaPricesCount(p)}}if(s==null){s=0}if(s<1&&v){x=v}var u=h.id(q);if(u){if(x){h.commerce.meta.revealBestPriceXsell(u,x,p,false)}else{var n="lA";if(p){n=n+"_Inline"}var r=h.id(n);if(r&&r.removeClass){r.removeClass("hidden")}}}}},revealBestPriceXsell:function(t,y,o,B){if(t){t=h.id(t)}if(y){y=h.id(y)}if(!t||!y){h.util.error.record(null,"revealBestPriceXsell - required elements missing");return}if(y.removeClass){y.removeClass("hidden")}var s=new Fx.Tween(t,{property:"opacity"});if(B){var q=h.retrieve("metaLeaveBehindOverlay");if(q&&q.container){var n=q.container;if(n.hasClass&&n.hasClass("hidden")&&n.removeClass){n.removeClass("hidden")}if(h.meta&&h.meta.cr){h.meta.cr.removePCR()}else{if(g()){dd.commerce.checkrates.removePCR()}}}}else{var u="META_MINI_META_MAYBE";if(o){u="META_MINI_META_MAYBE_INLINE"}var A=h.id(u);var x=true;if(A){x=false}var w="Displayed_Lightbox";if(o){w="Displayed_Inline"}var v=y.getElements(".hotelListing").length;if(v===0){v="0";w="Not_"+w}h.trackEventOnPage("Meta_State-Optimized_XSell",w,v)}var r=y.getSize().y;var z=new Fx.Tween(t,{property:"height",onComplete:function(){if(!B){s.start(0,1)}}});z.start(r);var p=h.retrieve("metaCheckRatesOverlay");if(p&&p.container&&p.closeBtn&&h.id(c).getScroll().y>p.container.getPosition().y){h.util.element.scrollIntoView(p.closeBtn)}},hideBestPriceXsell:function(r){var q=h.id(r);var o=h.id("META_PRICE_XSELL");if(!q||!o){return}var n=new Fx.Tween(q,{property:"height"});var p=new Fx.Tween(q,{property:"opacity",onComplete:function(){n.start(0);if(o.addClass){o.addClass("hidden")}}});p.start(1,0)},loadMetaAF:function(r,s,t){try{if(h.retrieve("checkrates.meta_af")!==true||h.retrieve("ta.redirectingPage")){return}var p="meta_af_last_request";var o=new Date().getTime();h.store(p,o);var q=1000;var x=false;var v=false;if(h.meta&&h.meta.update){x=h.widgets.calendar.getCheckRatesData();if(!x){return}var w={};if(h.meta&&h.meta.update){w=h.commerce.meta.getMetaParams()}v=Object.merge(x,{detail:r,reqNum:t?"2":"1",type:"af"},w)}else{if(g()){return dd.commerce.checkrates.loadMetaAF(r,s,t)}else{return}}var n=Object.toQueryString(v);if(!n||!n.trim()){h.util.error.record(null,"ta.commerce.meta.loadMetaAF - toQueryString failure",null,v);return}new Request({url:"/MetaBestPriceCrossSellAjax",data:v,evalScripts:true,onSuccess:function(D){if(h.retrieve(p)!=o){return}var E=D.contains("xsellHacStatusReady")||D.contains("xsellHacStatusSOL")||t;if(!E){setTimeout(function(){h.commerce.meta.loadMetaAF(r,s,true)},q)}else{var B=h.id(s);var y=a.getElement(".clearDates");if(B){B.show();B.setStyle("height",0);B.setStyle("opacity","0");B.setContent(D);h.meta.cross_sell.relatedResetStateFlag();var C=a.getElement(".tablet_desktop .mapsv2-more .clearDates");if(y&&y!=C){y.style.display="none"}var F=h.id("ALSO_VIEWED_LIST");if(F){var z=new Fx.Tween(B,{property:"opacity"});var A=F.getSize().y;var G=new Fx.Tween(B,{property:"height",onComplete:function(){B.setStyle("height","auto");z.start(0,1)}});G.start(0,A)}}}},onFailure:function(){if(h.retrieve("ta.redirectingPage")){return}h.util.error.record(null,"ta.commerce.meta.loadMetaAF - MetaBestPriceCrossSellAjax request failed")}}).send()}catch(u){h.util.error.record(u,"ta.commerce.meta.loadMetaAF")}},updateProvAreaFromLightBox:function(r){var o=h.retrieve("meta.baseLocationId");if(o&&r==o){var q=h.retrieve("meta.postShowMetaCR");var p=h.retrieve("meta.postShowMetaCRLB");var n=h.retrieve("meta.postShowMetaCRLBPCR");if(q&&p&&n){h.commerce.meta.updateProvArea(q,p,n);return}}if(h.widgets.calendar.datesExist()){if(h.meta&&h.meta.update){h.meta.update.request(o)}else{if(g()){dd.commerce.checkrates.checkRatesMiniMeta(null,a.getElementById("CHECK_RATE"),o,"checkrates")}}}},updateProvArea:function(x){var r=a.getElement("#CHECK_RATES_CONT.chkRates");var q=a.getElement("#LOC_PHOTO_ALBUMS.photos_lb_update .metaCrosssell .chkRates");var v=a.getElement("#LOC_PHOTO_ALBUMS.photos_lb_update .sidebar .chkRates");var s=a.getElement("#AMENITY_LIGHTBOX.photos_lb_update .chkRates");var A=a.getElement(".similarCarousel");var z=a.getElement(".premiumTimeout");if(A&&z){var n=r.getElement("div.bc_text_content");if(n){var o=x.getChildren()[1];if(o){var w=o.clone(false);w.innerHTML=o.innerHTML;n.innerHTML="";n.adopt(w)}}}else{e(r,x)}if(q){e(q,x);k(q);var y=a.getElement(".featuredImageWrap.metaCrosssell");if(y){var t=y.getElement(".premium_offers_area");if(t){var p=t.getElements(".offer.wrap.premium");var u=y.getElement(".chkRates");if(p&&u){u.toggleClass("noOffers",p.length===0)}}}}if(v){e(v,x);k(v)}if(s){e(s,x);l(s)}if(h.has("meta.isHackathonBC")){h.commerce.meta.alignPriceBlocks();if(h.has("meta.bc.isRevisedUnavailability")){h.commerce.meta.truncateProviderNames()}}if(h.has("hr_room_options_iframe")){if(h.commerce.bookroomlist){h.commerce.bookroomlist.updateRoomOptions()}}c.fireEvent("postAjaxMetaUpdate");if(x&&x.getElement(".hacMiniComplete")){j(x)}},updatePCRAreaWithMiniMeta:function(p,n){if(n==null||p==null){return}var s=p.inner;if(!s){return}h.commerce.meta.suppressCRArea(s);var q=s.getElement(".postShowMetaCRLBPCR");if(q!=null){q.destroy()}var r=s.getElement("fieldset.miniMetaContainer");var o=n.getElement(".disclaimer");if(o!=null){o.destroy()}h.commerce.meta.adoptMiniMetaElem(r,n);if(!h.widgets.calendar.datesInRange()){h.commerce.meta.showCRArea(s)}},adoptMiniMetaElem:function(p,n){if(p!=null){var q=p.getElement(".disclaimer");if(q!=null&&!q.getParentBySelector("#hover_table_display_area")){q.destroy()}var o=n.clone(false);o.innerHTML=n.innerHTML;p.adopt(o)}},miniMetaAjax:function(n,o){if(g()){dd.commerce.checkrates.miniMetaAjax(n,o)}},suppressCRArea:function(n){var o=n.getElements(".miniMetaShow");Array.each(o,function(p){p.removeClass("miniMetaShow");p.addClass("miniMetaHide")})},showCRArea:function(n){var p=n.getElement(".postShowMetaCR");if(p!=null){p.destroy()}var o=n.getElements(".miniMetaHide");Array.each(o,function(q){q.removeClass("miniMetaHide");q.addClass("miniMetaShow")})},showCurrencyPicker:function(){},selectCurrency:function(){},clearStoredMiniData:function(){if(h.retrieve("checkrates.meta_ui_post_click_prices")){h.store("meta.postShowMetaCRLBPCR",null);h.store("meta.postShowMetaCR",null);h.store("meta.postShowMetaCRLB",null)}},storeMiniData:function(o){if(h.retrieve("checkrates.meta_ui_post_click_prices")){var q=o.getElement(".postShowMetaCR");var n=o.getElement(".postShowMetaCRLBPCR");var p=o.getElement(".postShowMetaCRLB");if(q&&p&&n){h.store("meta.postShowMetaCRLBPCR",n);h.store("meta.postShowMetaCR",q);h.store("meta.postShowMetaCRLB",p)}}},providerButtonClicked:function(o){if(o&&!h.has("hotels.hasTimeoutDates")){var n="CheckIn|provider_logo";h.trackEventOnPage("DATEPICKER","OPEN",n,o);h.store("meta.datepicker_tracked",true)}},moreSitesLinkClicked:function(n){if(n&&!h.has("hotels.hasTimeoutDates")){h.trackEventOnPage("DATEPICKER","OPEN","more_sites_link",n);h.store("meta.datepicker_tracked",true)}},buildMetaHacParamObj:function(){var o={};try{var n=a.getElement("#HAC_FORM input[name=geo]");if(n&&n.value){o.geo=n.value}if(!o.geo){var t=a.getElement("#SEARCH_LHN input[name=geo]");if(t){o.geo=t.value}}var u=a.getElementById("searchAll");if(u&&u.value!="true"){var r=h.widgets.calendar.getPageInDate();if(r){o.inDay=r.getDate();o.inMonth=(r.getMonth()+1)+"/"+r.getFullYear()}var q=h.widgets.calendar.getPageOutDate();if(q){o.outDay=q.getDate();o.outMonth=(q.getMonth()+1)+"/"+q.getFullYear()}var p=h.widgets.calendar.getPageAdultsCount();if(p!=2){o.adults=p}o.searchAll="false"}}catch(s){h.util.error.record(s,"buildHACUrlParams")}return Object.toQueryString(o)},getHACCategory:function(){var o=a.getElements(".tab.selected");var p="1";if(o&&o.length&&o.length>0){var n=o[0].className.match(/cat_(\d+)/);if(n){p=n[1]}}return p},buildHACSearchData:function(){var r=h.widgets.calendar.getPageInDate();var v=h.widgets.calendar.getPageOutDate();var w=h.widgets.calendar.getPageAdultsCount();var x=a.getElementById("geo");var o;if(x==null){o=a.getElementsByName("geo");if(o&&o.length>0){x=o[0]}}var u;if(x&&x.value){u=x.value}else{if(c.modelGeoId){u=c.modelGeoId}}var q=false;var y=h.commerce.meta._padZero;var t=r?y(r.getDate()):null;var p=v?y(v.getDate()):null;var s=r?y(r.getMonth()+1)+"/"+r.getFullYear():null;var z=v?y(v.getMonth()+1)+"/"+v.getFullYear():null;var n={};n.adults=w;n.geo=u;n.searchAll=q;n.inDateOfMonth=t;n.outDateOfMonth=p;n.inMonthYear=s;n.outMonthYear=z;n.category=h.commerce.meta.getHACCategory();return n},buildMetaHACUrl:function(){var n=h.commerce.meta.buildHACSearchData();var o="/HACSearch?adults="+n.adults+"&geo="+n.geo+"&searchAll="+n.searchAll;if(n.category){o=o+"&cat="+n.category}if(n.inDateOfMonth){o=o+"&inDay="+n.inDateOfMonth}if(n.outDateOfMonth){o=o+"&outDay="+n.outDateOfMonth}if(n.inMonthYear){o=o+"&inMonth="+n.inMonthYear}if(n.outMonthYear){o=o+"&outMonth="+n.outMonthYear}var p=o+c.location.hash;return p},redirectHACSearch:function(){h.setEvtCookie("Mini_meta_LP_chevron_display","Clicked","Unavailable","","/HACSearch");c.location=h.commerce.meta.buildMetaHACUrl()},_padZero:function(n){return String("0"+n).slice(-2)},anchorToOpenTab:function(){if(h.id("ReviewsTab").hasClass("selected")){h.commerce.meta.scrollToReviews()}else{if(h.id("MetaPricesTab").hasClass("selected")){var n=h.id("ReviewsTab");n.click();h.commerce.meta.scrollToReviews()}}},scrollToReviews:function(){var n=h.id("REVIEWS");if(n!=null){h.util.element.scrollIntoView(n)}else{h.util.error.record(null,"couldnt find reviews element on page!")}},scrollToId:function(n){if(n&&h.id(n)){h.util.element.scrollIntoView(h.id(n))}},initNoAvailCarousel:function(){try{var n=h.id("ALSO_VIEWED_LIST"),u;if(!n){return}var r=n.getElement("ul");if(!r){return}var x=r.getElements("li").length;var v=new Fx.Tween(r,{property:"left"});var o=353;var s=1;var w=n.getElement(".prev");var p=n.getElement(".next");if(!p||!w){return}var t=function(y){var B,z,A,C;if((s===1&&y<0)||(s===x&&y>0)){return}if(y<0){h.trackEventOnPage("Pager_Arrows","Scroll_Left","Mini_Carousel_Xsell")}else{if(y>0){h.trackEventOnPage("Pager_Arrows","Scroll_Right","Mini_Carousel_Xsell")}}s+=y;B=parseInt(r.getStyle("left"),10);z=o*y*-1;A=B+z;v.start(A);C=n.getElement(".paginator");if(C){if(s===1&&y<0){u="front"}else{if(s===x&&y>0){u="end"}else{u="middle"}}C.className="paginator "+u}};w.addEvent("click",function(){t(-1)});p.addEvent("click",function(){t(1)})}catch(q){h.util.error.record(q,"ta.commerce.meta.initNoAvailCarousel")}},showRemainingProviders:function(o,n){n=h.id(n);if(n){n.destroy()}h.store("checkrates.hr_bc_see_all_click",true);if(h.retrieve("ibdm_impression_tracking")){h.trk("n_more_sites",false,a.getElement(".premium_offers_area"))}a.getElements(".remaining").removeClass("remaining");c.fireEvent("remainingMetaProvidersShown")},showRemainingProviders_Flyout:function(o,n){n=h.id(n);var q=h.id("SHOW_REMAINING_PROVIDERS_FLYOUT");var r=a.getElements(".remaining");try{if(q&&r){a.body.addEvent("click",function(s){if(n&&!s.target||!s.target.getParents().contains(n)||q.isDisplayed()){q.hide();a.body.removeEvents("click")}else{q.adopt(r);q.show()}})}}catch(p){h.util.error.record(p,"showRemainingProviders_Flyout")}},alignPriceBlocks:function(){h.util.element.makeTextFitOneLine(".chevron_redesign .offer.premium .priceBlock .price",true);h.util.element.makeTextFitOneLine(".chevron_redesign .offer.premium .priceBlock .featuredText",true);h.util.element.makeTextFitOneLine(".chevron_redesign .offer.premium .priceOutsideChevron .price",true);h.util.element.makeTextFitOneLine(".chevron_redesign .offer.premium .priceOutsideChevron .featuredText",true);h.util.element.makeTextFitOneLine(".offer.premium .priceBlock.flag_bump .price",true);h.util.element.fitToContentsHorizontally(".chevron_redesign .offer.premium .lowest_price_folded .text",0,65);h.select(".chevron_redesign .offer.premium.unsized .loading").setStyle("display","none");h.select(".chevron_redesign .offer.premium.unsized").removeClass("unsized");h.util.element.makeSameWidth("#HotelDateSearch .postShowMetaCR .priceBlock")},toggleBlueChevronLowestPriceCTA:function(o){if(h.retrieve("meta_guests_field_v2.CTAActivated")&&!a.getElements(".overlay").length){if(h.has("meta_guests_field_v2.CTATimer")){clearTimeout(h.remove("meta_guests_field_v2.CTATimer"))}var n=h.id("BC_LP_CTA");if(n&&n.fade){if(o){n.fade("in")}else{n.fade("out")}}}},displayBlueChevronLowestPriceCTA:function(){var p="bcMetaLowestPriceCTA",x,v,z,o,w,u,n,y,s;if(h.has(p)&&!h.has("hr_chevron_redesign")){x=h.retrieve(p);if(x.hasOwnProperty("idx")){v=(x.idx===0)?"Not_Displayed":"Displayed";z=x.idx+"";h.trackEventOnPage("BlueChevron_LP_CTA_Display",v,z)}o=h.id("BC_LP_CTA");if(o&&o.fade){(function(){o.fade("in");if(h.retrieve("meta_guests_field_v2.enabled")){h.store("meta_guests_field_v2.CTATimer",(function(){o.fade("out")}).delay(5000));h.store("meta_guests_field_v2.CTAActivated",true)}}).delay(700)}w=h.id("bc_lp_cta_text");if(w){u=w.getSize().y;if(u==12){while(w.getSize().y<=u){w.style.width=""+(w.getSize().x-1)+"px"}w.style.width=""+(w.getSize().x+1)+"px"}if(x.displayTop){n=o.parentNode.getElement(".priceBlock");o.style.position="relative";o.style.left=(345-w.getSize().x)+"px";o.style.top=""+(-n.getSize().y-22)+"px"}else{y=o.getElement(".bc_lp_cta_triangle");o.style.left="-"+(w.getSize().x+20)+"px";y.style.left=""+(w.getSize().x+10)+"px"}w.style.marginTop=""+Math.round((25-w.getSize().y)/2)+"px"}s=5800;if(h.retrieve("check_width_for_CTA_fade")){var B=a.getElement(".bc_lp_cta");var q=a.getElement(".priceBlock");if(B&&q){var r=B.getSize().x+q.getSize().x;var t=250;if((r>t)&&!x.displayTop){(function(){o.fade("out")}).delay(s)}}}else{var A=h.retrieve("fadeBcLpCTAout");if(A&&A==1&&!x.displayTop){(function(){o.fade("out")}).delay(s)}}}},truncateProviderNames:function(){var s=a.getElement(".textLink");if(s){var p=s.getSize().x;var r=s.getElement(".price");if(r){var o=r.getSize().x;var n=p-o-28;if(h.retrieve("meta.paymentsTipText")){n=n-20}var q=$$(".textLinks .providerName");if(n>0){Array.each(q,function(t){if(t.getNext(".price")){t.setStyle("width",n)}})}}}},expandProvidersInline:function(p){p=h.id(p);if(!p){return}var o=p.getParent(".metaPriceInfo");if(!o){return}var q=o.getElements(".provider");if(!q){return}q.show();p.hide();if(h.retrieve("assisted_booking_desktop_entry")){var n=p.getParents();n.forEach(function(r){if(r.hasClass("metaPriceInfo")){if(h.meta&&h.meta.treeTrack&&h.meta.treeTrack.hasTrackingTree(r)){h.trk("n_more_sites",false,r)}}})}},flipHoverClass:function(o,n){if(o){o=h.id(o);var p=n+"Idle";var q=n+"Over";o&&o.toggleClass(p).toggleClass(q)}},trackHotelRatingsInfoClickInHR:function(n){n.target=n.target||n.srcElement;if(n.target&&n.target.href){h.setEvtCookie("Ratings_Info","all_hotels","",0,n.target.href)}},cleanupForMapView:function(){var n=h.retrieve("maps.floaterDiv");if(n){n.hide()}},navigateToHotelDetail:function(q,p,o,n){var r=h.id(q.target);if(r&&!r.match("img")&&!r.match("a")&&!r.hasClass("taLnk")&&!r.hasClass("greenLeaderTaLnk")&&!r.getParent(".metaPriceInfo")&&!r.getParent("a")&&!r.hasClass("jfy_yes_no")&&!r.getParent(".p13n_inline_info")){if(h.retrieve("open_hotels_in_new_tab.enabled")){h.util.cookie.openWindowWithPID(o,n)}else{if(n){h.util.cookie.setPIDCookie(n)}c.location.href=o}}},updateHeaderMsg:function(o,p){var n=a.getElement(o);if(p&&n){n.innerHTML=p}},updateHeaderDates:function(){try{if(h.widgets.calendar.hasPageDates()){var p=$$(".dateHeader.inDate");var o=$$(".dateHeader.outDate");var n=h.widgets.calendar.getDatePickerFormat("short");var s=h.widgets.calendar.getDatePickerFormat("classic");if(p){var r=h.widgets.calendar.dateToString(h.widgets.calendar.getPageInDate(),n);Array.each(p,function(u){var v=h.id(u);if(v){v.innerHTML=r}})}if(o){var q=h.widgets.calendar.dateToString(h.widgets.calendar.getPageOutDate(),s);Array.each(o,function(u){var v=h.id(u);if(v){v.innerHTML=q}})}}}catch(t){h.util.error.record(t,"ta.commerce.meta.updateHeaderDates")}},enableAdultsPicker:function(){var q=a.getElement(".adultsText");if(q){q.addClass("hide")}var o=a.getElement(".changeAdults");if(o){o.addClass("hide")}var p=a.getElement(".overlay .date_picker_adults_wrap");if(p){p.removeClass("hide")}var n=a.getElement(".overlay .showPriceButtonHide");if(n){n.removeClass("showPriceButtonHide")}h.store("meta_guests_field_v2.originalAdults",h.retrieve("date.picker.adultsCount"))},disableAdultsPicker:function(o){if(!(o&&o.container)){return}var r=o.container.getElement(".adultsText");if(r){r.removeClass("hide")}var p=o.container.getElement(".changeAdults");if(p){p.removeClass("hide")}var q=o.container.getElement(".date_picker_adults_wrap");if(q){q.addClass("hide")}var n=o.container.getElement(".showPriceButton");if(n){n.addClass("showPriceButtonHide")}},adultsGoButtonClick:function(n,q,t,p,v){var r=h.widgets.calendar.getPageInDate();var w=h.widgets.calendar.getPageOutDate();var o=r&&r.getDate&&w&&w.getDate;if(o){var x=h.widgets.calendar.getCalendarObjectKey(t,p,"out");var u=h.retrieve(x);if(u){var s=u.calendar;if(s){s.onCalendarOverlayHide();s.fireEvent("onRangeSelect",[s.crId,s.options.ext]);s.fireEvent("onSelect",[s,n])}}}else{h.overlays.Factory.simulateDatePickerClick(n,q,t,p,v)}},updateAdultsText:function(){var n=a.getElement(".adultsText");if(n){h.widgets.calendar.updateAdultsDisplay(n)}},hhRedirectIfNoOffers:function(){var n=a.getElements("#HotelDateSearch .offer");if(n&&!h.commerce.meta._overlayOnPage()){h.store("ta.redirectingPage",true);h.setEvtCookie("NoOffersHH","redirect","",0,"/HotelHighlight");var o=/-r\d+-/;c.location.href=c.location.href.replace("Hotel_Review-","Hotel_Review-s1-").replace("ShowUserReviews-","Hotel_Review-s1-").replace(o,"-")}},getResponseAvailability:function(n){if(!n){return false}return{anyAvailable:!!n.match(/\shacComplete\s.*\sanyOfferCompletedSuccessfully\s/g),allUnavailable:!!n.match(/\shacComplete\s.*\shacMiniOfferNotAvailable\s/g),maybeAvailable:!!n.match(/\shacComplete\s.*\shasDisplayUnavailability\s/g)}},_overlayOnPage:function(){return h.overlays&&h.overlays.getCurrent&&h.overlays.getCurrent()},hhRemoveDatePickerForErrorMessaging:function(p){if(!h.widgets.calendar.hasPageDates()){h.commerce.meta.clickMetaShowPrices(p);return}var o=h.id("GEO_CHECK_RATES_BALANCE");if(o){o.hide()}var n=a.getElement("#HLBASE .unavailHdr");if(n){n.removeClass("hidden")}},setupMiniMetaOnAccomPolling:function(n){if(!h.pages.hac.updateHACData||!h.hac.filters.updateResults){h.util.error.record(null,"setupMiniMetaOnAccomPolling bad linkage")}h.pages.hac.startHACUpdate();if(n){h.hac.filters.updateResults()}},checkRatesCreateGeoCrAutoBroadenLb:function(p,o,n){try{if(h.has("hr_to_hh_redirect_no_offers")&&c.pageServlet&&c.pageServlet!=="HotelHighlight"){if(h.widgets.calendar.hasPageDates()){h.widgets.calendar.justUpdateSessionDates(function(){h.commerce.meta.hhRedirectIfNoOffers&&h.commerce.meta.hhRedirectIfNoOffers.delay(300)})}else{h.widgets.calendar.setErrorStyling(new Event(p).target)}return}if(!h.widgets.calendar.hasPageDates()){h.commerce.meta.clickMetaShowPrices(p);return}if(o.getParent(".meta_date_wrapper")){h.trackEventOnPage("MetaGeoLightBox","open","DatePicker",0,false)}else{h.trackEventOnPage("MetaGeoLightBox","open","ShowPrices",0,false)}h.run("ta.overlays.Factory.loadGeoCrAutoBroadenOverlay",{},o,n)}catch(q){h.util.error.record(q,"ta.commerce.meta.checkRatesCreateGeoCrAutoBroadenLb cannot track/create lightbox")}},metaListingClickReporting:function(n){if(!n||!n.target){return}if(n.target.hasClass("photo_image")){h.trackEventOnPage("PRICE_SAVER","CLICK","THUMBNAIL")}else{if(n.target.nodeName==="A"&&n.target.parentNode.hasClass("review_stubs_item")){h.trackEventOnPage("PRICE_SAVER","CLICK","REVIEW")}else{if(n.target.hasClass("property_title")){h.trackEventOnPage("PRICE_SAVER","CLICK","PROPERTY_TITLE")}else{if(n.target.getParent(".metaPriceInfo")!=null){h.trackEventOnPage("PRICE_SAVER","CLICK","META")}}}}},getMetaParams:function(){return{metaReferer:c.pageServlet}},trackAdBlock:function(){if(h.id(a.body)){var n=1;var o=new Element("div",{"class":"adInner",styles:{height:n,visibility:"hidden"}});h.id(a.body).adopt(o);if(o.getSize().y!=n){h.trackEventOnPage("ADBLOCK","ENABLED",null,null,true)}else{h.trackEventOnPage("ADBLOCK","DISABLED",null,null,true)}o.dispose()}},updateSessionDatesRedirect:function(n){if(h.widgets.calendar.hasPageDates()){h.widgets.calendar.justUpdateSessionDates(function(){c.location.href=n},false,true)}else{c.location.href=n}}}}(b))}(document,window,ta));ta.commerce.minimeta={ajax:{MAX_POLL_ATTEMPT:13,ALL_HAC_COMPLETE:"hotelsMeta.allHacComplete",LOCS_ON_PAGE:"hotelsMeta.locsOnPage",ATTEMPT_STORE_KEY:"hotelsMeta.ajaxNum",TIME_EXPIRED:"hotelsMeta.timeExpired",MINI_META_APPEAR_LOADING_TIMEOUT:5000,MINI_META_STOP_LOADING_TIMEOUT:60000,send:function(c,a){var b=ta.commerce.minimeta.ajax;setTimeout(function(){new Request({method:"post",url:b.getUrl(),data:b.buildPostData(a),onSuccess:function(d){var e=new Element("div",{html:d});b.updateDOM(e);if(!c&&b.shouldResubmit()){ta.commerce.minimeta.ajax.send()}b.updateAttemptNum()}}).send()},ta.commerce.meta.polling.getPollWaitTimeForPollingAttempt(ta.retrieve(ta.commerce.minimeta.ATTEMPT_STORE_KEY)))},getUrl:function(){return"/BulkMiniMetaCRAjax"},buildPostData:function(b){var a={};a.area="QC_Meta_Mini";a.returnAllOffers=true;a.detail=ta.commerce.minimeta.ajax._getLocOnPageString(b);a.action="getMiniMetaForLocations";return a},updateDOM:function(d){var a=d.getElement(".isAllHacComplete");if(a||ta.retrieve(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE)){ta.store(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE,true);var c=$$(".metaDisclaimer");if(c&&c.hasClass("hidden")){c.removeClass("hidden")}}var b=document.getElements(".listing");b.each(function(k){var j=k.id;var h=j.substring(j.indexOf("_")+1);var g=d.getElement("."+h);ta.commerce.minimeta.ajax.updateLoadingState(d);if(g){var e=g.getElement(".metaPriceInfo");var f=k.getElement(".metaPriceInfo");ta.commerce.minimeta.ajax._setPrice(e,h);ta.commerce.minimeta.ajax._setAccomType(e,h);e.replaces(f)}})},resetAjaxCall:function(){ta.remove(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE);ta.remove(ta.commerce.minimeta.ajax.LOCS_ON_PAGE);ta.remove(ta.commerce.minimeta.ajax.ATTEMPT_STORE_KEY);ta.remove(ta.commerce.minimeta.ajax.TIME_EXPIRED)},shouldResubmit:function(){if(ta.retrieve(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE)){return false}else{var a=ta.retrieve(ta.commerce.minimeta.ATTEMPT_STORE_KEY);if(!a||a<ta.commerce.minimeta.ajax.MAX_POLL_ATTEMPT-1){return true}else{return false}}},updateAttemptNum:function(){var a=ta.retrieve(ta.commerce.minimeta.ATTEMPT_STORE_KEY);if(!a){ta.store(ta.commerce.minimeta.ATTEMPT_STORE_KEY,1)}else{ta.store(ta.commerce.minimeta.ATTEMPT_STORE_KEY,a+1)}},_getLocOnPageString:function(b){var c=document.getElements(".listing");var a="";c.each(function(f){var d,e;if(ta.commerce.minimeta.ajax._isHacComplete(f)&&!b){return}e=f.id;d=e.substring(e.indexOf("_")+1);a=a+d+","});if(a===""){ta.store(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE,true)}return a},_isHacComplete:function(a){return a.getElement(".metaPriceInfo.hacComplete")},_setPrice:function(b,f){var a=b.getElement(".classicPrice");if(a){var d="classicPrice_"+f;var c=ta.retrieve(d);if(ta.retrieve("hotels.shouldHideClassicPrices")){a.hide()}else{if(c&&c!==0){var e=a.getElement(".price");e.set("html",c);a.toggleClass("hidden",false)}else{a.hide()}}}},_setAccomType:function(a,d){var c=a.getElement(".contactStr");if(c){var b="accomType_"+d;var e=ta.retrieve(b);if(!e||e=="T_HOTEL"){c.set("html",ta.retrieve("hotels.contactHotel"))}else{c.set("html",ta.retrieve("hotels.contactAccom"))}}},updateLoadingState:function(b){if(ta.retrieve(ta.commerce.minimeta.ajax.TIME_EXPIRED)){var d=b.getElements(".loading_bubbles_gry");var c=new Element("span",{"class":"sprite-visitSite"});d.each(function(f){c.clone().replaces(f)});var a=b.getElements(".loadingHeader");var e=ta.retrieve("hotels.checkSites");a.each(function(f){f.set("html",e)})}}},storeAccomDetails:function(){var b=document.getElements(".classicPrices");b.each(function(d){ta.store(d.id,d.value)});var a=document.getElements(".accomTypes");a.each(function(d){ta.store(d.id,d.value)});var c=$$(".metaDisclaimer");if(c){c.addClass("hidden")}},doMetaDateSearch:function(){if(!ta.widgets.calendar.hasPageDates()){var c=document.getElement(".metaDatePicker .date_picker_calendar_wrap");c.fireEvent("click")}else{if(ta.has("hac.filter.changed")||ta.has("meta.mini_meta_on_accommodations")){ta.hac.filters.updateResults()}else{if(!ta.retrieve("hotels.datesChanged")){ta.hac.filters.updateResults();ta.servlet.HACSearch.destroyAnimatedDateCTA()}else{var b=ta.hac.filters.buildHACUrlParamString();var a="/HACSearch?"+b+window.location.hash;window.location=a}}}},lowestPriceBookBtnHover:function(b){try{var a=document.getElement(".LowestPrice .bookBtn");if(!a){ta.util.error.record(null,"lowestPriceBookBtnHover - no button for .LowestPrice .bookBtn",null,{out:b});return}if(b){a.className=a.className.replace(/Over\b/,"Idle")}else{a.className=a.className.replace(/Idle\b/,"Over")}}catch(c){ta.util.error.record(c,"lowestPriceBookBtnHover - cannot change button hover appearance",null,{out:b})}}};ta.commerce.AvailDataWidget=new Class({Implements:[Options],options:{calendarOptions:{},argArray:[]},initialize:function(h,d,c,b,e,l){this.setOptions(l);if(h||window.event){h=new Event(h||window.event);if(h){h.stop()}}this.locId=d;this.ext=b;var k=null;if(this.ext){k="date_picker_adults_"+this.locId+this.ext}else{k="date_picker_adults_"+this.locId}this.adultField=ta.id(k);this.options.calendarOptions=Object.merge(this.options.calendarOptions,{ext:this.ext?this.ext:"",creatorElem:h&&h.target});var j=true;if(h){var g=ta.id(h.target);if(g&&(g.hasClass("out_date")||(ta.has("guests_rooms_picker_3.enabled")&&g.hasClass("outDateTrigger")))){j=false}}this.calendar=new ta.widgets.SingleDateCalendar(this.options.calendarOptions,this.locId,e,this.options.argArray,j);var a=ta.retrieve("adultFieldsMap");if(!a){a={}}if(this.adultField){this.adultsField=a[k];var f=this.adultField.getParent(".overlay");if(!this.adultsField||(f&&this.adultsField.parentOverlay!=f.overlay)){this.adultsField=new ta.widgets.AdultsField(this.adultField,this.locId,e,h);a[k]=this.adultsField;ta.store("adultFieldsMap",a)}}this.show(c);if(ta.widgets.calendar.trackCalendarObject){ta.widgets.calendar.trackCalendarObject(this)}},show:function(a){if(a=="calendar"&&this.calendar&&this.calendar.calendarOverlay){this.calendar.showCalendarOverlay()}else{if(a=="adults"&&this.adultsField){this.adultsField.adultsOverlay.show()}}if(ta.has("persistentFilters.showing")&&tabletOnFullSite&&this.calendar.calendarOverlay.container){this.calendar.calendarOverlay.container.setStyle("position","fixed")}},clear:function(){if(this.adultField){if(!ta.retrieve("meta_guests_field_v2.enabled")){ta.widgets.calendar.setPageAdultsCount(2)}ta.widgets.calendar.syncAllDatePickers()}this.calendar.clear()},getState:function(d){var b=this.calendar.getState();var a={adults:"2"};if(this.adultsField){a=this.adultsField.getState()}else{if(ta.widgets.calendar.getPageAdultsCount()){a={adults:ta.widgets.calendar.getPageAdultsCount()+""}}}var c=Object.merge(b,a);if(d){return c}return Object.toQueryString(c)}});ta.widgets.AdultsField=new Class({adultsSelRegex:/.*_(\d)\s*$/,adultsExRegex:/.*_\d+_(.*)$/,initialize:function(k,c,f){this.adultsField=k;this.crId=c;this.selectionFunction=f;var l=this.adultsField.getParent(".overlay");if(l){this.parentOverlay=l.overlay}var g=ta.overlays.ACTIVATE_CLICK;if(this.parentOverlay&&this.parentOverlay.container&&ta.id(this.parentOverlay.container).hasClass("persistentCR")){g=ta.overlays.ACTIVATE_NEVER}this.guestFieldLabel=this.generateGuestFieldLabel(this.adultsField.id);this.adultsOverlay=new ta.overlays.RelativeOverlayBelow({style:"dp",showCloseButton:false,noPadding:true,autoShow:false,offsetLeft:1,activate:g,onShow:this.onAdultsShow.bind(this),onHide:this.onAdultsHide.bind(this)},this.adultsField);this.adultsField.onclick=function(){};ta.id(this.adultsField).addEvent("click",this.adultsOverlay.show);var j=ta.id(this.adultsOverlay.container).getElement(".adults_pre_selected");try{this.count=ta.retrieve("date.picker.adultsCount");if(!this.count){this.count=this.adultsSelRegex.exec(j.id)[1]}}catch(h){}if(!this.count){this.count="2"}ta.widgets.calendar.setPageAdultsCount(this.count);var a=ta.id(this.adultsOverlay.container).getElements(".option");var d=this.adultSelect.bind(this);a.each(function(n,e){var m=function(o){d.pass([e+1,n,o.event])()};ta.id(n).addEvent("click",m)});var b=this.adultsField.clientWidth;b=b+"px";ta.id(this.adultsOverlay.container).setStyles({width:b});this.optionElems=a},generateGuestFieldLabel:function(c){var b=this.adultsExRegex.exec(c);var a=ta.retrieve("open_guest_field.servletName");if(!a){a=window.pageServlet}if(!b){if(!a){return""}else{if(a=="Hotel_Review"){return"Guest_HR"}else{if(a=="Hotels"){return"Guest_Hotels"}else{if(a=="ShowUserReviews"){return"Guest_Hotels"}else{return""}}}}return"Guests"}else{if(b[1]=="pop"){return"Guest_Flyout"}else{if(b[1]=="met"){return"Guest_MetaLightbox"}else{if(b[1]=="pto"){return"Guest_HR_PhotoLightbox"}else{if(b[1]=="amo"){return"Guest_HR_AmenitiesLightbox"}else{return""}}}}}},trackGuestFieldEvent:function(b,a){try{ta.trackEventOnPage("GuestPicker",b,a)}catch(c){ta.util.error.record(c,"ta.widgets.AdultsField.trackGuestFieldEvent")}},onAdultsShow:function(){try{if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==ta.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}this.keyEventListener=this.onAdultsOverlayKeyDown.bind(this);document.addEvent("keydown",this.keyEventListener);this.adultsField.blur();var a=document.getElements(".date_picker_adults_option");if(a){Array.each(a,function(d){ta.id(d).removeClass("adults_selected");ta.id(d).removeClass("adults_pre_selected")})}if(ta.id(this.adultsField).getParent("#PERSISTENT_CHECK_RATES")){var b=ta.id(this.adultsField).getCoordinates().top;if(typeof(isIPad)=="undefined"||!isIPad){b=b-window.getScrollTop()}ta.id(this.adultsOverlay.container).setStyles({position:"fixed",top:b+29,zindex:9997})}this.count=ta.retrieve("date.picker.adultsCount");if(ta.retrieve("meta_guests_field_v2.enabled")){this.optionElems[this.count-1].addClass("adults_pre_selected");this.preSelectElem=this.optionElems[this.count-1]}if(ta.retrieve("meta_guests_field_v2.trackingEnabled")){this.trackGuestFieldEvent("Open",this.guestFieldLabel)}}catch(c){ta.util.error.record(c,"ta.widgets.AdultsField.onAdultsShow")}},onAdultsHide:function(){try{if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}if(this.keyEventListener){document.removeEvent("keydown",this.keyEventListener)}}catch(a){}},onAdultsOverlayKeyDown:function(a){if(a.key=="esc"){this.adultsOverlay.hide()}},adultSelect:function(e,d,c){ta.commerce.meta.tracking.resetAllTimingLocks();ta.commerce.meta.tracking.clearSuppressedAreas();ta.commerce.meta.polling.clearAllPollingInfo();this.updateValue(e,d.innerHTML);this.adultsOverlay.hide();var b=this.guestFieldLabel+"|"+this.count;if(ta.retrieve("meta_guests_field_v2.trackingEnabled")){this.trackGuestFieldEvent("Select",b)}if(!ta.widgets.calendar.hasPageDates()){return}if(this.selectionFunction){if(this.selectionFunction===ta.widgets.calendar.launchInlineMeta){this.selectionFunction.call(this,c)}else{this.selectionFunction.call(this,this.crId,this.adultsField)}}if(ta.commerce.metajson){ta.commerce.metajson.refetchAll()}if(typeof oxapp!="undefined"&&oxapp&&oxapp.context){var a=oxapp.context.get("TravelDates");if(a){a.save()}}if(ta.has("checkrates.meta_af")){ta.commerce.meta.loadMetaAF(this.crId,"AV_ABOVE_FOLD_META",false)}ta.widgets.calendar.trackCalendarEvent("DATEPICKER","CHANGE","GUESTS",e)},updateValue:function(a,b){this.count=a;this.adultsField.innerHTML=b;ta.widgets.calendar.setPageAdultsCount(this.count);ta.widgets.calendar.syncAllDatePickers();ta.widgets.calendar.justUpdateSessionAdults();var c=document.getElements(".adults");c.each(function(d){d.innerHTML=b})},getAdultsCount:function(){return this.count},getState:function(){return{adults:this.count+""}}});ta.commerce.meta.tracking={getTimingForNavArea:function(a){if(!a){return}var b=ta.commerce.meta.tracking.processNavArea(a);return ta.retrieve(b)},setTimingLockForNavArea:function(b,a){ta.store(b+"-LOCK",a)},isTimingLocked:function(b){var c=ta.commerce.meta.tracking.processNavArea(b);var d=ta.retrieve(c);if(!d){return false}var a=Date.now();if(a-d>=2000){ta.commerce.meta.tracking.resetTimingLockForNavArea(c);return false}return true},resetTimingLockForNavArea:function(a){var b=ta.commerce.meta.tracking.processNavArea(a);if(ta.retrieve(b+"-LOCK")){ta.remove(b+"-LOCK")}},resetAllTimingLocks:function(){var a=["QC_Meta_Inline","QC_Meta_Mini","QC_Meta_Metro","QC_Meta_Micro","QC_Meta_Lightbox"];for(var b=0;b<a.length;b++){ta.commerce.meta.tracking.resetTimingLockForNavArea(a[b])}},processNavArea:function(a){if(!a){return}if(a.indexOf("QC_Meta_Inline")===0){return"QC_Meta_Inline"}if(a.indexOf("QC_Meta_Mini")===0){return"QC_Meta_Mini"}if(a.indexOf("QC_Meta_Metro")===0){return"QC_Meta_Metro"}if(a.indexOf("QC_Meta_Micro")===0){return"QC_Meta_Micro"}if(a.indexOf("QC_Meta_Lightbox")===0){return"QC_Meta_Lightbox"}},setTimingForNavArea:function(c,b){if(!c){return}if(!b){b=Date.now()}var a=ta.commerce.meta.tracking.processNavArea(c);if(ta.commerce.meta.tracking.isTimingLocked(a)){return ta.commerce.meta.tracking.getTimingForNavArea(a)}ta.store(a,b);ta.commerce.meta.tracking.setTimingLockForNavArea(a,b);if(a=="QC_Meta_Inline"&&!ta.commerce.meta.tracking.containsSuppressedArea("QC_Meta_Mini")){ta.commerce.meta.tracking.setTimingLockForNavArea("QC_Meta_Mini",b)}return b},updateUrlWithTiming:function(b,a){if(!b||!a){return}var c=ta.commerce.meta.tracking.setTimingForNavArea(a);if(!c){return b}if(b.contains("&metaRequestTiming=")){var d=new RegExp("(&|\\?)metaRequestTiming=[^&]*");b=b.replace(d,"&metaRequestTiming="+c)}else{b+="&metaRequestTiming="+c}return b},suppressImpressionsForArea:function(c){if(!c){return}var b=ta.commerce.meta.tracking.processNavArea(c);if(ta.commerce.meta.tracking.containsSuppressedArea(b)){return}var a=ta.retrieve("suppressed.areas");a.push(b);ta.store("suppressed.areas",a)},getSuppressedAreas:function(){var a=ta.retrieve("suppressed.areas");if(!a){a=[];ta.store("suppressed.areas",a)}return a},getSuppressedAreasAsString:function(){var b=ta.commerce.meta.tracking.getSuppressedAreas();var a="";if(b.length>0){for(var c=0;c<b.length;c++){a+=b[c]+";"}}return a},hasAnySuppressedAreas:function(){var a=ta.commerce.meta.tracking.getSuppressedAreas();return a.length>0},containsSuppressedArea:function(d){if(!d){return false}var b=ta.commerce.meta.tracking.processNavArea(d);var a=ta.commerce.meta.tracking.getSuppressedAreas();for(var c=0;c<a.length;c++){if(a[c]==b){return true}}return false},removeSuppressedArea:function(e){if(!e){return}var b=ta.commerce.meta.tracking.processNavArea(e);var f;var c;if(ta.commerce.meta.tracking.containsSuppressedArea(b)){var a=ta.commerce.meta.tracking.getSuppressedAreas();for(var d=0;d<a.length;d++){if(a[d]==b){c=d;f=true}if(f){a=ta.commerce.meta.tracking.removeElementByIndex(a,c);ta.store("suppressed.areas",a)}}}},removeElementByIndex:function(b,a){if(b&&a>=0&&a<b.length){b.splice(a,1)}return b},clearSuppressedAreas:function(){ta.store("suppressed.areas",[])},getTrackFunctionForSuggestedAccommodations:function(){var a=function(){var g=ta.widgets.calendar.getPageOutDate();var c="hotelsAccommodationGroupTracking";var f=ta.id(c);if(f){var e=f.getBoundingClientRect();if(e&&e.top>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)){var d="Hotels on Tourism";var h="Impression";var b="dated";if(g===false){b="undated"}var j=ta.has("suggestedAccommodationsIsDmoSponsored")?1:0;ta.trackEventOnPage(d,h,b,j);window.removeEvent("scroll",a)}}};return a},getTrackFunctionForSuggestedVRs:function(){var a=function(){var g=ta.widgets.calendar.getPageOutDate();var c="vrsAccommodationGroupTracking";var f=ta.id(c);if(f){var e=f.getBoundingClientRect();if(e&&e.top>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)){var d="VRs on Tourism";var h="Impression";var b="dated";if(g===false){b="undated"}var j=ta.has("suggestedAccommodationsIsDmoSponsored")?1:0;ta.trackEventOnPage(d,h,b,j);window.removeEvent("scroll",a)}}};return a}};ta.commerce.meta.polling={setPollingAttemptForRequest:function(a,b){var c=ta.commerce.meta.polling.getPollingMap();if(!b){b=1}c[a]=b;ta.commerce.meta.polling.setPollingMap(c)},getPollingAttemptForRequest:function(a){if(ta.commerce.meta.polling.isRequestBeingPolled(a)){var c=ta.commerce.meta.polling.getPollingMap();var b=c[a];if(b){return b}}},getPollingWaitTimeForRequest:function(a){var b=ta.commerce.meta.polling.getPollingAttemptForRequest(a);return ta.commerce.meta.polling.getPollWaitTimeForPollingAttempt(b)},isRequestBeingPolled:function(a){var c=ta.commerce.meta.polling.getPollingMap();var b=a&&c[a];if(b){return true}return false},incrementPollingAttemptForRequest:function(a){var c=ta.commerce.meta.polling.getPollingMap();var b=c[a];if(b){b=b+1;c[a]=b}ta.commerce.meta.polling.setPollingMap(c);return b},clearAllPollingInfo:function(){ta.store("ta.meta.polling.map")},removePollingInfoForRequest:function(a){if(ta.commerce.meta.polling.isRequestBeingPolled(a)){var b=ta.commerce.meta.polling.getPollingMap();delete b[a];ta.commerce.meta.polling.setPollingMap(b)}},getPollingMap:function(){var a=ta.retrieve("ta.meta.polling.map");if(!a){a={};ta.store("ta.meta.polling.map",a)}return a},setPollingMap:function(a){if(a){ta.store("ta.meta.polling.map",a)}},getPollWaitTimeForPollingAttempt:function(a){switch(a){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:return 1000;case 11:return 5000;case 12:return 15000;case 13:return 30000;case undefined:case null:default:return 1000}},getMaxPollingAttemptNumber:function(){return 13}};ta.commerce.meta.horizontalXSell=(function(){var l=10;var g=1000;var h=false;var c=null;var o=null;var m=null;var q=0;var f=function(r){if(r.contains("hacComplete")&&(r.contains("hacMiniOfferNotAvailable")||r.contains("hacMiniOfferUnavailable"))){return true}return false};var k=function(r){if(!a()){return false}if(!r.contains("hacMiniOfferUnavailable")){return true}return false};var e=function(u,x){try{if(ta.retrieve("ta.redirectingPage")||ta.retrieve("non_comm_hr_xsell_2014")){return}if(!x){q=0}c=new Date().getTime();var w=c;var v=ta.widgets.calendar.getCheckRatesData();if(!v){return}var s={};if(ta.meta&&ta.meta.update){s=ta.commerce.meta.getMetaParams()}var r=Object.merge(v,{detail:u,reqNum:x?"2":"1",type:"horizontal_hr"},s);var y=Object.toQueryString(r);if(!y||!y.trim()){ta.util.error.record(null,"ta.commerce.meta.horizontalXSell.loadHorizontalXSell - toQueryString failure",null,r);return}new Request({url:"/MetaBestPriceCrossSellAjax",data:r,evalScripts:true,onSuccess:function(E){if(w!=c){return}var B=new Element("div",{html:E});var D=B.getElement(".xsellHacStatusReady")||B.getElement(".xsellHacStatusSOL")||x;if(ta.has("meta.full_meta_photos_v3")){E+='<div class="gap_spacer"></div>'}if(!D&&q<l){setTimeout(function(){q=q+1;e(u,true)},g)}else{var G=ta.id("HORIZONTAL_CROSS_SELL");var A=B.getElement(".metaMicro");if(G&&A){if(G.getElement(".metaMicro")){G.setContent(E)}else{G.setStyle("opacity","0");var F=new Fx.Tween(G,{property:"opacity"});G.setStyle("height",0);var C=122;var z=new Fx.Tween(G,{property:"height",onComplete:function(){G.setStyle("height","auto");G.setContent(E);F.start(0,1)}});z.start(0,C)}if(o){o()}d(true)}}},onFailure:function(){if(ta.retrieve("ta.redirectingPage")){return}ta.util.error.record(null,"ta.commerce.meta.horizontalXSell.loadHorizontalXSell - MetaBestPriceCrossSellAjax request failed")}}).send()}catch(t){ta.util.error.record(t,"ta.commerce.meta.horizontalXSell.loadHorizontalXSell")}};var j=function(r,s){if(!r||!r.getElement(".bc_flags")){return}var t=r.getElement(".bc_flags").className;if(k(t)){n()}else{if(f(t)){e(s,false)}}};var n=function(){var r=ta.id("HORIZONTAL_CROSS_SELL");var t=ta.id("HORIZONTAL_CROSS_SELL_LIST");var u=document.getElement("#HORIZONTAL_CROSS_SELL_LIST .lodging");if(r&&t&&u){var v=t.getSize().y;r.setStyle("height",v);var w=new Fx.Tween(t,{duration:200,property:"opacity",onComplete:function(){t.addClass("hidden");s.start(v,0).chain(function(){r.setStyle("height",0);r.innerHTML=""})}});w.start(1,0);var s=new Fx.Tween(r,{duration:"long",property:"height"});if(m){m()}d(false)}};var a=function(){return h};var d=function(r){h=r};var p=function(r){o=r};var b=function(r){m=r};return{updateHorizontalXSell:j,removeHorizontalXSell:n,isLoaded:a,setLoaded:d,setOnloadFunction:p,setOnRemoveFunction:b}}());ta.commerce.meta.horizontalXSellExtensions={putAvafBelowMap:function(){if(ta.commerce.meta.horizontalXSell.isLoaded()){return}var d=ta.id("AV_ABOVE_FOLD_META");var c=ta.id("RHS_MAP");var b=d.parentNode;if(d&&c&&b){var a=b.getElement(".bxDivider.map");if(a){b.insertBefore(a,d);b.insertBefore(c,a)}else{b.insertBefore(c,d)}}},putAvafAboveMap:function(){if(!ta.commerce.meta.horizontalXSell.isLoaded()){return}var c=ta.id("AV_ABOVE_FOLD_META"),b=ta.id("RHS_MAP"),a=c.parentNode;if(c&&b&&a){a.insertBefore(c,b)}}};if(!ta.meta){ta.meta={}}if(!ta.meta.link){ta.meta.link={}}(function(a){a.OPEN_IN_NEW_TAB="new_tab";a.OPEN_IN_SAME_TAB="same_tab";a.OPEN_IN_NEW_WINDOW="new_window";a.getUrlFromClickElem=function(m){if(!m){return null}var n=m.get("data-commerceClickData");if(!n||!n.trim||n.trim()===""||typeof asdf!=="function"){return null}n=asdf(n).replace(/&amp;/g,"&");return n};a.click=function(n,u){var v=ta.id(u),q,s,t,x,m,A,z,p,w,o;try{q=a.getUrlFromClickElem(v);if(!q){return}s=v.get("data-vendorName");t=v.get("data-locationId");x=v.get("data-navArea");m=v.get("data-contentId");A=v.get("data-openBehavior");z=v.get("data-imageUrl");p=v.get("data-mcid");if(!x){w=v.get("data-navAreaPre");o=v.get("data-navAreaPost");x=l(w,u,o)}if(x){x=x.replace("+","|")}if(ta.browser.isIE10Metro()){x="QC_Meta_Metro_Lightbox"}if(u.getParent("#LOC_PHOTO_ALBUMS")){if(u.getParent(".featuredImageWrap")){x=x+"|PHOTOS_LB|Featured_Reel"}else{x=x+"|PHOTOS_LB"}}else{if(u.getParent("#AMENITY_LIGHTBOX")){x=x+"|AMENITIES_LB"}}c(x);var r=x;x=h(v);if(x==null||x.indexOf("null")!=-1||x.indexOf("Unknown")!=-1){x=r}if(q&&s&&t){g(q,x,s,t,A,v,z,p)}else{j(null,"Invalid commerce click",q,x)}}catch(y){j(y,"Invalid commerce click",q,x)}setTimeout(function(){try{window.fireEvent("metaLinkClick",[v,s,x,t,m,A])}catch(B){j(B,"Commerce click tracking failed",q,x)}},300)};a.photoClick=function(n,q,o,m,p){if(o.hasOwnProperty("area")){o.area=a.getPhotoNavArea(n)}ta.util.Doer.aimdoit(q,o,m,p)};a.getPhotoNavArea=function(m){return h(m,{"data-navArea-metaType":"Pro_Photo","data-navArea-availability":"NA"})};function g(s,q,y,x,t,o,B,w){var C=s;var D=new RegExp("(&|\\?)area=[^&]*");C=C.replace(D,"$1area="+q);if(crPageServlet){var r=new RegExp("(&|\\?)from=[^&]*");C=C.replace(r,"$1from=HotelDateSearch_"+crPageServlet)}var n=ta.commerce.meta.tracking.setTimingForNavArea(q);if(n&&o&&!o.hasClass("bookableOffer")){if(C.contains("&metaRequestTiming=")){var p=new RegExp("(&|\\?)metaRequestTiming=[^&]*");C=C.replace(p,"&metaRequestTiming="+n)}else{C+="&metaRequestTiming="+n}}if(w){C+="&m="+w}var u=ta.analytics.getCommentTrackingPath(o);if(u&&u.length>0){var v=u.getLast();if(v&&v.indexOf(":")===-1){C+="&tp="+v}else{j(null,"ibdm_cc: no placement found",C,q,"WARN")}}else{j(null,"ibdm_cc: no tracking path found",C,q,"WARN")}var A=C.indexOf("/StartBooking")>=0;if(ta.retrieve("commerce_history_injection_v2")&&!A){C="/NewWindowRedirect?url="+encodeURIComponent(C)}if(ta.has("assisted_booking_clicks_new_tab")&&t===a.OPEN_IN_NEW_TAB&&A&&ta.browser&&ta.browser.isIE10Metro()){t=a.OPEN_IN_SAME_TAB}var z=!ta.has("reverse_test_flyouts")&&(!ta.retrieve("hotels_placements_short_cells")||ta.retrieve("ib_room_list_match_flyout")&&window.pageServlet!=="Hotels")&&!ta.retrieve("sd_short_cells")&&!ta.retrieve("persistent_meta_hr");var m=ta.has("hotels_placements_short_cells_ib_flydown");if(o.getAttribute("data-suppressFlyout")==="true"){z=false}if(z||m){if(ta.widgets.ChooseRoomFlyout&&A&&o.getParent("#CHECK_RATES_CONT")&&o.getParent("#CHECK_RATES_CONT").getParent("#MAIN.Hotel_Review")&&!o.getParentBySelector(".non_comm_xsell")){ta.widgets.ChooseRoomFlyout.expand(C)}else{if(ta.widgets.HotelsChooseRoomFlyout&&A&&o.getParent(".listing")&&o.getParent(".listing").getParent("#MAIN.Hotels")){ta.widgets.HotelsChooseRoomFlyout.expand(C,o)}else{if(ta.widgets.SDChooseRoomFlyout&&A&&o.getParent(".illisting")&&window.pageServlet=="SmartDeals"){ta.widgets.SDChooseRoomFlyout.expand(C,o)}else{if(ta.widgets.SDChooseRoomFlyout&&A&&(o.getParent(".baseHotel")||o.getParent(".illisting"))&&window.pageServlet=="HotelHighlight"&&!ta.retrieve("no_ib_flyout_for_short_cell.enabled")){ta.widgets.SDChooseRoomFlyout.expand(C,o)}else{if(t===a.OPEN_IN_NEW_TAB){d(C,B,y,o)}else{if(t===a.OPEN_IN_SAME_TAB){b(C,o)}else{k(y,C,B)}}}}}}}else{if(t===a.OPEN_IN_NEW_TAB){d(C,B,y,o)}else{if(t===a.OPEN_IN_SAME_TAB){b(C,o)}else{k(y,C,B)}}}if(window.pageServlet==="Hotel_Review"&&ta.widgets.ChooseRoomFlyout&&!A&&o.getParent("#CHECK_RATES_CONT")&&o.getParent("#CHECK_RATES_CONT").getParent("#MAIN.Hotel_Review")&&!o.getParentBySelector(".non_comm_xsell")&&t!==a.OPEN_IN_SAME_TAB){ta.metaFocus.hr.onMetaOfferClick()}if(window.IS_DEBUG){ta.store("ta.lastCommerceClickUrl",C)}}function d(q,n,p,o){var m=window.open("","_blank");if(!m&&typeof(Browser)!=="undefined"&&Browser.ie&&ta.has("ta.ie_commerce_popup_block_fix")&&ta.has("assisted_booking_clicks_new_tab")&&q.indexOf("/StartBooking")>=0){if(ta.util&&ta.util.cookie){ta.util.cookie.setPIDCookie(38822)}b(q,o);return}if(ta.retrieve("meta_click_interstitial.enabled")){ta.popups.PopUtil.displayCommerceClickInterstitial(m,n,p);setTimeout(function(){try{ta.popups.PopUtil.redirectToUrl(m,q)}catch(r){}},500)}else{ta.popups.PopUtil.redirectToUrl(m,q)}ta.popups.PopUtil.pollForPartnerLoad(m,new Date(),p)}function b(p,n){ta.meta.treeTrack.logTrackingTreeClickEvtCookie(p,n);if(ta.meta&&ta.meta.treeTrack){var o=function(){e(p)};if(n&&n.getParentBySelector(".metaCheckRatesOverlay")!=null){ta.meta.treeTrack.logLightboxTreeImpression(o)}else{if(ta.meta.treeTrack.isInitialized()){try{ta.meta.treeTrack.logTreeImpression(o)}catch(m){ta.util.error.record(m," Error in openMetaProviderSameTab");e(p)}}}}else{e(p)}}function e(m){if(ta.retrieve("ta.isIE11orHigher")){window.open(m,"_self",null,false)}else{window.location.href=m}}function k(s,r,o){var m=s,q=ta.popups.PopUtil.getProviderWindowDims(m,true),n=1,p;if(window&&window.chrome){n=0}p={customWidth:q.customWidth,customHeight:q.customHeight,widthOffset:q.widthOffset,heightOffset:q.heightOffset,name:m,url:r,scrollbars:n,providerLogo:o};ta.popups.PopUtil.createCheckRatesWindow(p)}function c(m){var n=ta.retrieve("ta.meta.navArea");if(!n||n.indexOf(m)<0){ta.store("ta.meta.navArea",m)}}function l(m,q,n,p){var r="";if(q.getParent(".persistentCR")){r=(p)?"|PCR":"PCR"}else{if(q.getParent(".photosOverlay")||q.getParent("#LOC_PHOTO_ALBUMS")){r=(p)?"|Photo_Lightbox":"Photo_Lightbox"}else{if(q.getParent(".amenities_lightbox")){r=(p)?"|Amenities_Lightbox":"Amenities_Lightbox"}else{if(q.getParent("#CHECK_RATES_LB")){r=(p)?"|Photo_LB":"Photo_LB"}}}}r=r?"|"+r:"";m=m?m:"";r=r?r:"";n=n?n:"";var o=[m,r,n].join("|").replace("||","|").replace(/(\|$)/g,"");return o}function j(p,o,q,n,m){ta.util.error.record(p,o,null,{servlet:window.pageServlet,url:q,area:n},m)}function h(n,o){var r;var q={"data-navArea-metaType":null,"data-navArea-linkType":null,"data-navArea-availability":null,"data-navArea-placement":null};var p=4;if(o){for(r in q){if(o.hasOwnProperty(r)){q[r]=o[r];p--}}}var s=null;while(n&&p>0){for(r in q){if(q[r]===null){q[r]=n.get(r);if(q[r]!==null){if(q[r]==="@trigger"){s=n}p--}}}n=n.getParent()}while(q["data-navArea-placement"]==="@trigger"&&s){while(s&&!s.overlay){s=s.getParent()}if(s&&s.overlay.options&&s.overlay.options.trigger){s=s.overlay.options.trigger}else{s=null;q["data-navArea-placement"]="null"}while(s){q["data-navArea-placement"]=s.get&&s.get("data-navArea-placement");if(q["data-navArea-placement"]!==null){break}s=s.getParent()}}var m=[];for(r in q){m.push(q[r]?q[r]:"null")}if(window.isTabletOnFullSite){m.push(f()?"Portrait":"Landscape")}else{m.push("Desktop")}return m.join("|")}function f(){if(ta.common&&ta.common.tablet){return ta.common.tablet.isPortrait()}return window.matchMedia&&window.matchMedia("(orientation: portrait)")&&window.matchMedia("(orientation: portrait)").matches}})(ta.meta.link);if(!ta.meta){ta.meta={}}if(!ta.meta.linkTracking){ta.meta.linkTracking={}}(function(e){e.setup=function(){try{ta.util.customEvent.addListener("metaLinkClick",window,k)}catch(l){ta.util.error.record(l,"trouble building event - metaLinkClick")}};e.actionRecord=function(l){new Request({url:"/ActionRecord?action="+l}).send()};e.restoreCRPageServlet=function(){var l=ta.retrieve("crPageServlet_orig");if(l){window.crPageServlet=l}};function k(m,q,l,o,p,n){g(q,l,o,n);b(m,p);d(m);j(m,p);a(o,true);if(n!=ta.meta.link.OPEN_IN_SAME_TAB){h(m)}}function h(l){if(ta.meta&&ta.meta.treeTrack){if(l&&l.getParentBySelector(".metaCheckRatesOverlay")!=null){ta.meta.treeTrack.logLightboxTreeImpression()}else{if(ta.meta.treeTrack.isInitialized()){ta.meta.treeTrack.logTreeImpression()}}ta.meta.treeTrack.logTrackingTreeClickTrk(l)}}function a(o,m){try{var l={locId:o,isMetaCheckRates:m};ta.common.ads.loadClickoutMonikers(l)}catch(n){ta.util.error.record(n,"click out monikers failure (meta="+m+")")}}function g(q,m,p,o){var n="CheckRates";var r=1;ta.trackPhysicalCommerce(n,m,r,p);ta.trackAttemptedCommerce(n,m,q,r);var l=o?(o===ta.meta.link.OPEN_IN_NEW_TAB?"TAB_OPENED":(o===ta.meta.link.OPEN_IN_NEW_WINDOW?"WINDOW_OPENED":"SAME_TAB")):"";ta.trackEventOnPage("COMMERCE_CLICK",l,(q||""))}function j(n,o){var p=n.getParent("#HotelDateSearch");if(p){var m="bcMetaLowestPriceCTA";var q="BlueChevron_LP_CTA_Click";if(ta.has(m)){var u=ta.retrieve(m);if(u.hasOwnProperty("idx")&&u.hasOwnProperty("provider")){try{var s=f(p);var l=null;for(var r=0;r<s.length;r++){if(o==s[r]){l=r}}if(l){ta.trackEventOnPage(q,u.idx,l,0,false)}}catch(t){ta.util.error.record(t,"error logging blue chevron lowest price click info")}}}}}function b(m,n){var o=m.getParent("div#PROVIDER_BLOCK")||m.getParent("div#PROVIDER_BLOCK_INLINE");if(o){var v=(o.id=="PROVIDER_BLOCK_INLINE")?true:false;var r=(v)?"metaLowestPriceCTAInline":"metaLowestPriceCTA";var p=(v)?"Meta_LP_CTA_Click_Inline":"Meta_LP_CTA_Click";if(ta.has(r)){var t=ta.retrieve(r);if(t.hasOwnProperty("idx")&&t.hasOwnProperty("provider")){try{var s=c(o);var l=null;for(var q=0;q<s.length;q++){if(n==s[q]){l=q}}if(l){ta.trackEventOnPage(p,t.idx,l,0,false)}}catch(u){ta.util.error.record(u,"error logging lowest price click info")}}}}}function c(q){var n=[];n[0]=-1;try{if(q){var m=q.getElements(".jsPrvdr");for(var l=0;l<m.length;l++){var p=m[l]&&ta.id(m[l]).get("data-contentid");if(p){n.push(p)}}}}catch(o){ta.util.error.record(o,"error scraping meta providers")}return n}function f(q){var n=[];n[0]=-1;try{if(q){var m=q.getElements(".offer");for(var l=0;l<m.length;l++){var p=m[l]&&ta.id(m[l]).get("data-contentid");if(p){n.push(p)}}}}catch(o){ta.util.error.record(o,"error scraping blue chevron providers")}return n}function d(m){var s=ta.id(m);try{var r=s.get("data-offer-author");if(!r){return}var u=null,l=null;var o=s.getParent(".overlay .skv3");var t=s.getParent(".mapsv2-listitem")||s.getParent(".mapsv2-dropdownlist");if(t&&t.get("data-sponsor")){u=t.get("data-sponsor");l=t.get("data-sponsor-provider")}else{if(o&&o.hasAttribute("data-sponsor")&&pageServlet){u=o.get("data-sponsor");l=o.get("data-sponsor-provider")}else{var n=ta.id("mapsv2-sponsordetail");if(n&&n.get("data-sponsor")){u=n.get("data-sponsor");l=n.get("data-sponsor-provider")}}}if(l&&r==l){var q=(pageServlet=="LocalMapsRedesign")?"LocalMap":(pageServlet=="HACSearch"||pageServlet=="Hotels")?"HACMap":"FloatingMap";ta.trackEventOnPage(q,"sponsor_cr_sent",u)}}catch(p){ta.util.error.record(p,"Error while trying to log map sponsored provider clicks")}}})(ta.meta.linkTracking);if(!ta.meta.treeTrack){ta.meta.treeTrack={}}(function(e){var d=false;var b={hotelListSelector:null,singleHotelSelector:null,placementName:null,getImpressionString:null};var c="ibdm_impression_tracking";e.init=function(h){if(d){ta.util.error.record(null,"ta.meta.treeTrack should be initialized only once");return false}b=h;d=true};e.isInitialized=function(){return d};e.hasTrackingTree=function(h){if(!h||typeof h.previousSibling==="undefined"){return false}var j=h.previousSibling||h.nextSibling;if(j){if(f(j)){return true}return f(j.previousSibling)}return false};var f=function(j){if(j){var h=j.nodeValue;return h&&(h.contains("trk")||h.contains("etk"))}return false};e.logImpressionTreeOnPageLoad=function(){if(ta.retrieve("assisted_booking_desktop_entry.logTreePoll")&&ta.widgets.calendar.hasPageDates()&&!ta.retrieve("vrTabOnHotels")){var j=1;var l=4;var h;if(!ta.retrieve("treeTrackImpressionInProgess")){ta.store("treeTrackImpressionInProgess",true);var k=setInterval(function(){if(ta.retrieve("isTrackTreeFresh")){h=e.logTreeImpression(null,(j<l))}if(!h&&j<l){j++}else{ta.store("isTrackTreeFresh",false);ta.store("treeTrackImpressionInProgess",false);clearInterval(k)}},2000)}}};e.logTreeImpression=function(l,k){if(!ta.retrieve(c)||ta.retrieve("vrTabOnHotels")){if(l){l()}return false}if(!d){ta.util.error.record(null,"ta.meta.treeTrack.logTreeImpression called before being initialized");if(l){l()}return false}var h=a();var j=b.getImpressionString(h);if(!j&&h<=0){if(l){l()}return false}if(j&&j.indexOf("I:IllegalContext")===-1){ta.recordImpression(j,l);return true}else{if(!k){ta.util.error.record(null,"ta.meta.treeTrack.logTreeImpression called but no tracking tree html found!",null,{},"WARN")}}if(l){l()}return false};e.logLightboxTreeImpression=function(j){if(!ta.retrieve(c)){if(j){j()}return false}var h=g();if(h){ta.recordImpression(h,j);return true}if(j){j()}};var g=function(){var h=$$(".metaCheckRatesOverlay .impressionTrackingTree");if(h){return h[0].innerHTML}};e.logTrackingTreeClickTrk=function(h){if(!ta.retrieve(c)){return}if(e.hasTrackingTree(h)){if(h.hasClass("bookableOffer")){ta.trk("sherpa_click",false,h)}else{var j=[];var k="PP:";if(h.getAttribute("data-pernight")){k+=h.getAttribute("data-pernight")}else{k+="-1"}j.push(k);var l="PN:";if(h.getAttribute("data-offer-author")){l+=h.getAttribute("data-offer-author")}else{l+="None"}j.push(l);ta.trk("meta_click",false,h,j)}}};e.logTrackingTreeClickEvtCookie=function(j,h){if(!ta.retrieve(c)){return}if(e.hasTrackingTree(h)){if(h.hasClass("bookableOffer")){ta.setEvtCookieAndPath("sherpa_click",j,h)}else{ta.setEvtCookieAndPath("meta_click",j,h)}}};e.getElmtHeight=function(h){if(h){return h.offsetHeight}};function a(){if(!b.hotelListSelector||!b.singleHotelSelector){return 0}var j=0;var h=0;var k=document.getElements(b.hotelListSelector);k.each(function(l){l.getElements(b.singleHotelSelector).each(function(m){if(m.match(b.singleHotelSelector)){j++;if(m.isFullyVisible()){h=j}}})});return h}})(ta.meta.treeTrack);if(!ta.meta.update){ta.meta.update={}}ta.util.customEvent.addListener("newInlinePageDates",window,function(b,a){ta.meta.update.request(b,a)});(function(o){var b="miniMetaHacRequest_longTimeoutKey";var f="miniMetaHacRequest_appearLoadedTimeoutKey";o.request=function(z,y){m(z);x(z,y)};o.completeOnInitialPage=function(y){a(true,"",y)};o.buildUrl=function(F,P,M,E,X,J,H,C,D,y){var z=e(X),I=ta.widgets.calendar.getCheckRatesData(),Y="",O="",S="",L="",K="";if(I){Y=Object.toQueryString(I)}if(E){O="&metaVersion="+E}if(ta.has("meta.baseLocationId")){S="&baseLocId="+ta.retrieve("meta.baseLocationId")}if(ta.retrieve("checkrates.mini_meta_by_percent_cpc_see_all_click")||ta.retrieve("checkrates.hr_bc_see_all_click")||(ta.retrieve("checkrates.hr_bc_see_all_click.lb")&&F==="MetaCheckRatesAjax")){L="&seeAllClick=true"}if(window.pageServlet){K="&metaReferer="+window.pageServlet}var T=ta.retrieve("meta.requestFromArea");if(!T){T="";if(document.getElement("#LOC_PHOTO_ALBUMS")){T="&requestFromArea=pal"}else{if(document.getElement("#AMENITY_LIGHTBOX")){T="&requestFromArea=amo"}}ta.store("meta.requestFromArea",T)}var B="/"+F+"?detail="+P+"&"+Y+"&area="+z+"&returnAllOffers=true"+K+O+S+L+T,Q=B;try{B=ta.commerce.meta.tracking.updateUrlWithTiming(B,z)}catch(W){ta.util.error.record(W,"problem updating url with timing in CheckRates.buildVarMetaHacUrl");B=Q}if(ta.commerce.meta.tracking.hasAnySuppressedAreas()){var U=ta.commerce.meta.tracking.getSuppressedAreasAsString();if(U){B+="&suppressImpressionsOnComplete="+U}}if(ta.retrieve("ta.commerce.suppress_commerce_impressions.enabled")){Q=B;try{B=n(B,D);if(!B){B=Q}}catch(W){ta.util.error.record(W,"problem updating url with isFirstPageLoad in CheckRates.buildVarMetaHacUrl");B=Q}}if(M){B+="&finalRequest=true"}if(J){B+="&numTries="+J}if(C){B+="&loadingTimeoutPassed="+C}if(y){B+="&isDateChangedRequest="+y}if(ta.maps&&ta.maps.mapsponsor){var A=ta.maps.mapsponsor.getSponsorForLocation(P);if(A){B+="&mapSponsorship="+A}}var G="meta.premiumIdsForNextPoll";if(C&&ta.has(G)){B+="&premiumContentId="+ta.retrieve(G)}else{if(H){var N=H[0];if(N){B+="&premiumContentId="+N;for(var R=1;R<H.length;R++){N=H[R];B+=","+N}}}}if(C&&ta.has("meta.displacedChevronOfferContentId")){B+="&displacedChevronOffer="+ta.retrieve("meta.displacedChevronOfferContentId")}var V="ta.commerce.MetaHacOverlay.currency";if(ta.has(V)){B+="&currency="+ta.retrieve(V);ta.remove(V)}return B};o.overlayRequest=function(S,U,aa,P,H){var R,E="metaHacRequest_curCancelKey",J,M,F,Y,B,Q,N,W,z=13,V,y,D,L,G,O,I;try{if(!S){return}ta.commerce.meta.clearStoredMiniData();J=ta.widgets.calendar.getCheckRatesData();if(U==null){ta.store("meta.travelData",J);U=new Date().getTime();M=false;if(aa){if(ta.has("metaCheckRatesUpdateDivInline")){M=ta.id(ta.retrieve("metaCheckRatesUpdateDivInline"))}}else{if(ta.has("metaCheckRatesUpdateDiv")){M=ta.id(ta.retrieve("metaCheckRatesUpdateDiv"))}}if(M&&M.removeClass){M.removeClass("hidden")}}F="metaHacRequest_"+U+"_cancel";if(ta.has(E)){Y=ta.retrieve(E);if(Y!=F){ta.store(Y,true);ta.commerce.meta.polling.removePollingInfoForRequest(Y)}}if(aa){B=document.getElement(".meta_rates_content .postShowMetaCR");if(ta.has("checkrates.mini_meta_by_percent_cpc")&&ta.retrieve("checkrates.mini_meta_by_percent_cpc_see_all_click")){Q=B.getElement(".seeMore.threshold");if(Q){N=B.getElements(".postClickPrice.hide");N.each(function(ab){ab.removeClass("hide")});Q.hide()}}ta.commerce.meta.updateProvArea(B)}if(!ta.has(F)){ta.store(F,false);ta.store(E,F)}if(ta.retrieve(F)===true){return}W=ta.retrieve("metaCheckRatesOverlay");if(!W&&!aa){return}R=false;if(W){R=W.inner}if(ta.has("metaCheckRatesUpdateDiv")){R=ta.id(ta.retrieve("metaCheckRatesUpdateDiv"))}if(aa&&ta.has("metaCheckRatesUpdateDivInline")){R=ta.id(ta.retrieve("metaCheckRatesUpdateDivInline"))}}catch(X){ta.util.error.record(X,"overlayRequest setup")}if(!R){return}try{if(ta.commerce.meta.polling.isRequestBeingPolled(F)){V=ta.commerce.meta.polling.getPollingAttemptForRequest(F);if(!V||V>z){ta.commerce.meta.polling.removePollingInfoForRequest(F);return}}else{V=1;ta.commerce.meta.polling.setPollingAttemptForRequest(F,V)}if(!R.innerHTML.contains("hacComplete")){y=false;if(aa){y="QC_Meta_Inline"}if(!P){P=1}var K=ta.meta.update.buildUrl("MetaCheckRatesAjax",S,true,H,y,P);setTimeout(function(){new Request({url:K,onSuccess:function(ab){if(ta.retrieve(F)){return}if(ta.retrieve("metaCheckRatesOverlay")||ta.retrieve("metaCheckRatesUpdateDivInline")){R.innerHTML=ab;if(ta.retrieve("checkrates.meta_ui_sk_box")){ta.commerce.meta.restoreProviderHover()}}if((ta.meta.update.getMetaPricesCount(aa)>0||V>9)&&ta.commerce.meta.hacIsBlockingXSell(aa)){if(aa){ta.commerce.meta.metaInYourMeta("REC_CONT_INLINE",{xsell:false,inline:true})}else{ta.commerce.meta.metaInYourMeta("REC_CONT",{xsell:false,inline:false})}}ta.commerce.meta.polling.incrementPollingAttemptForRequest(F);ta.meta.update.overlayRequest(S,U,aa,P+1,H)},evalScripts:true}).send()},ta.commerce.meta.polling.getPollingWaitTimeForRequest(F))}else{try{ta.commerce.meta.polling.removePollingInfoForRequest(F);D=ta.id("META_HAC_DATE_HEADLINE");if(D){var Z=D.getElements(".headlineLegend");if(Z.length>=2){Z.forEach(function(ab){ab.addClass("hidden")});if(R.getElement(".anyOfferCompletedSuccessfully")){Z[0].removeClass("hidden");if(ta.retrieve("lightbox_improvements")){ta.commerce.meta.hideBestPriceXsell("REC_CONT")}}else{if(R.getElement(".partnersAllNotAvailable")&&ta.retrieve("lightbox_improvements")&&Z.length>2){Z[2].removeClass("hidden");if(aa){ta.commerce.meta.loadBestPriceXsell(S,"REC_CONT_INLINE",{isInline:true});ta.commerce.meta.metaInYourMeta("REC_CONT_INLINE",{xsell:false,inline:true})}else{var C={isMetaLighboxV3:ta.retrieve("meta_lightbox_v3.enabled")};if(!ta.id("META_PRICE_XSELL")){ta.commerce.meta.loadBestPriceXsell(S,"REC_CONT",Object.merge(C,{isInline:false}))}ta.commerce.meta.metaInYourMeta("REC_CONT",{xsell:false,inline:false})}}else{Z[1].removeClass("hidden");if(ta.retrieve("lightbox_improvements")){ta.commerce.meta.hideBestPriceXsell("REC_CONT")}}}}if(!ta.retrieve("lightbox_improvements")){if(aa){ta.commerce.meta.loadBestPriceXsell(S,"REC_CONT_INLINE",{isInline:true});ta.commerce.meta.metaInYourMeta("REC_CONT_INLINE",{xsell:false,inline:true})}else{ta.commerce.meta.loadBestPriceXsell(S,"REC_CONT",{isInline:false});ta.commerce.meta.metaInYourMeta("REC_CONT",{xsell:false,inline:false})}}}if(W){ta.commerce.meta.storeMiniData(W.inner)}if(ta.retrieve("assisted_booking_desktop_entry.logTreePoll")&&R){var T=R.getElement(".impressionTrackingTree");if(T){ta.trkImpTree(T)}}L=j(R);O="complete";if(aa){if(ta.id("COMHVY")){G="Mini-Meta";if(ta.find(".NotShowing .postClickPrice")){O+="_may_be_available"}else{if(ta.find("#HotelDateSearch .price .minCost")){if(ta.find(".strikeHigh")){O+="_available_lp_chevron"}else{O+="_available"}}else{O+="_unavailable"}}}else{G="Metainline"}}else{G="meta_lightbox"}if(R.innerHTML.contains("doneNoAvailability")){ta.widgets.calendar.trackCalendarEvent("DATEPICKER","RESULTS_EMPTY",ta.widgets.calendar.getPageAdultsCount(),ta.widgets.calendar.getPageAdultsCount());if((ta.id("MAYBE_BUTTONS_INLINE")&&aa)||(ta.id("MAYBE_BUTTONS")&&!aa)&&G!="Mini-Meta"){O+="|may_be_availabile"}else{if(G!="Mini-Meta"){O+="|unavailable"}}}else{ta.widgets.calendar.trackCalendarEvent("DATEPICKER","RESULTS_PRESENT",ta.widgets.calendar.getPageAdultsCount(),ta.widgets.calendar.getPageAdultsCount())}ta.trackEventOnPage(G,O,L.toString());ta.commerce.meta.showLowestPriceCTA(aa);window.fireEvent("MetaLightboxHacComplete");I=ta.find(".overlay .skv3");if(I&&I.hasAttribute("data-sponsor")){var A=I.getAttribute("data-sponsor");ta.maps.ads.injectMetaLightBoxAd(A)}}catch(X){ta.util.error.record(X,"overlayRequest - failure in complete results block")}}}catch(X){ta.util.error.record(X,"meta HAC - ajax requests")}};o.displayRemainingProviders=function(B){try{var A=ta.id("CHECK_RATES_CONT");var z=A.getElements("li");for(var y=z.length;y--;){z[y].removeClass("hide")}B.hide();ta.store("checkrates.mini_meta_by_percent_cpc_see_all_click",true)}catch(C){ta.util.error.record(C,"displayRemainingProviders")}};o.updateCRForm=function(y){try{if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers();return}var K=ta.id("HotelDateSearch"+y);var J=ta.id("HotelDateSearch");var C=["select","input[type=checkbox]","input[type=hidden]","input[type=text]"];if(K&&J){for(var F=C.length;F--;){var A=C[F];var M=J.getElements(A);var B=K.getElements(A);for(var E=B.length;E--;){var L=B[E];var I=L.id.split("_")[0];for(var D=M.length;D--;){var H=M[D];if(H.id.contains(I)){if(A=="input[type=checkbox]"){var N=H.getParent("li");if(N&&!N.hasClass("unavailable")){var z=L.getParent("li");if(z){z.removeClass("unavailable")}}}if(A=="select"){L.selectedIndex=H.selectedIndex}else{if(A=="input[type=checkbox]"&&y!="_pop"){L.checked=H.checked}else{if(!L.id.contains("hacPid")){L.value=H.value}}}}}}}}}catch(G){ta.util.error.record(G,"updateCRForm")}};o.getMetaPricesCount=function(y){var A=0,C;var z=ta.retrieve("metaCheckRatesOverlay");var B=false;if(z){B=z.inner}if(ta.has("metaCheckRatesUpdateDiv")){B=ta.id(ta.retrieve("metaCheckRatesUpdateDiv"))}if(y&&ta.has("metaCheckRatesUpdateDivInline")){B=ta.id(ta.retrieve("metaCheckRatesUpdateDivInline"))}if(!B){return}C=B.getChildren("#HR_HACKATHON_CONTENT .roomPrice");if(C){A=C.length}return A};function c(D){var C=ta.id("PROVIDER_BLOCK");if(!C){return}if(typeof CDNHOST!="undefined"){var B='<img class="provLoading" src="'+CDNHOST+'/img2/meta_sprites/loadingAnim.gif">';C.getElements(".rightBox").each(function(E){E.setContent(B)})}var z=C.get("html");var y=1000;var A="metaHacRequest_"+y+"_cancel";ta.remove(A);new Request({url:ta.meta.update.buildUrl("MetaCheckRatesAjax",D,true),onSuccess:function(E){C.setContent(E);ta.meta.update.overlayRequest(D)},onFailure:function(){C.setContent(z)}}).send()}function x(z,y){if(y=="pop"){ta.store("ta.meta.request.locId",z);ta.store("ta.meta.request.placement",y);ta.run("ta.overlays.Factory.metaCheckRatesOverlay")}else{if(y=="met"||y=="solb"){if(!ta.has("meta.widget")){c(z)}}}}function j(A){var B;var C;var y=0;var z=0;A=ta.id(A);C=A.getChildren("#HR_HACKATHON_CONTENT .roomPrice");B=A.getChildren("#HR_HACKATHON_CONTENT .textLinks .offer .price");if(C){y=C.length}if(B){z=B.length}return y+z}function m(C,F,K,J){if(ta.retrieve("tablet_maps_v1")&&ta.retrieve("maps_v2_open")){return}if(!K){K=0}if(!J){J=false}var G="miniMetaHacRequest_curCancelKey";var E=13;if(F==null){F=new Date().getTime()}var D="miniMetaHacRequest_"+F+"_cancel";if(ta.retrieve(D)===true){return}if(ta.has(G)){var M=ta.retrieve(G);if(M!=D){ta.store(M,true);ta.commerce.meta.polling.removePollingInfoForRequest(M)}}if(!ta.has(D)){ta.store(D,false);ta.store(G,D)}var L;if(ta.commerce.meta.polling.isRequestBeingPolled(D)){L=ta.commerce.meta.polling.getPollingAttemptForRequest(D);if(!L||L>E){ta.commerce.meta.polling.removePollingInfoForRequest(D);return}}else{L=1;ta.commerce.meta.polling.setPollingAttemptForRequest(D,L)}var z=[];if(J){var I=$$("#CHECK_RATES_CONT div.premium:not(.tripConnectDemo)");for(var B=0;B<I.length;B++){var A=I[B].get("data-contentid");z.push(parseInt(A,10))}}if(K<1){var H;if(ta.has(b)){H=ta.retrieve(b);clearTimeout(Number.from(H))}if(ta.has(f)){H=ta.retrieve(f);clearTimeout(Number.from(H))}H=setTimeout(function(){v()},ta.commerce.minimeta.ajax.MINI_META_STOP_LOADING_TIMEOUT);ta.store(b,Number.from(H))}var y=ta.retrieve("hotels.datesChanged");if(y&&ta.has("hac_timezone_awareness")){o.clearDatesBumpedMessage()}new Request({url:ta.meta.update.buildUrl("MiniMetaCRAjax",C,true,null,"QC_Meta_Mini",K,z,J,D,y),onSuccess:function(N){a(false,N,C,F,K,J,D,y)},evalScripts:true}).send()}o.clearDatesBumpedMessage=function(){var z=ta.id("HAC_DATES_MOVED_FORWARD");var y=document.getElement("#CHECK_RATES_CONT .legend.metaDatesChosen");if(z&&y){z.dispose();y.removeClass("hidden")}};function d(y){y.getChildren().each(function(z){var A=z.getAttribute("data-targetEvent");if(A){ta.fireEvent(A,z);z.destroy()}})}function a(J,K,Q,S,M,z,E,y){if(ta.retrieve(E)===true){return}var H,V,O,L;if(J){var U=ta.select("#CHECK_RATES_CONT fieldset")[0];K=U.get("html");H=new Element("div",{html:K});V=true;O=document.getElement(".similarCarousel");L=H.getChildren()}else{H=new Element("div",{html:K});d(H);V=K.contains("hacMiniComplete");O=document.getElement(".similarCarousel");L=Elements.from(K)}if(!O||M<1){ta.commerce.meta.updateProvArea(H.getElement(".postShowMetaCR"));if(ta.retrieve("hr_tabs_show_prices")&&!ta.retrieve("hr_geo_check_rates")){ta.servlet.HotelReview.updatePriceTab()}window.fireEvent("miniMetaOnHRUpdate",K)}if(!document.getElement(".dropdownMiniMeta")){var C=document.getElement(".postShowMetaCR");if(C){h(K,C)}}w(K);if(ta.retrieve("hotel_review_low_price_message")&&L.filter("#PRICE_ALERT_RIBBON_UPDATE")[0]){var W=document.getElement("#PRICE_ALERT_RIBBON_CONTAINER");if(W){var X=W.getElementById("PRICE_ALERT_RIBBON");if(X){X.destroy()}X=L.filter("#PRICE_ALERT_RIBBON_UPDATE")[0].getElement(".price_alert_ribbon");if(X){W.innerHTML=X.outerHTML;ta.util.element.makeTextFitOneLine("#PRICE_ALERT_RIBBON",false);var F=ta.id("CHECK_RATES_CONT");if(F&&!X.hasClass("hidden")){F.addClass("hasPriceSaverRibbon")}var N=X.getElement(".priceAlertText b");if(V&&N&&N.innerHTML&&N.innerHTML.length>0){ta.trackEventOnPage("hotel_review_low_price_message","Display",N.innerHTML)}}}}if(V&&!K.contains("bookableOffer")){window.fireEvent("hacComplete_noBookingOffersFound")}if(V||z){if(K.contains("bookableOffer")){window.fireEvent("hacComplete_bookingOffersFound")}}var P=ta.id("HR_META_INTERSTITIAL");if(P){var T=document.getElement("#HR_HACKATHON_CONTENT fieldset");if(T){if(M<1&&!J){ta.store("show_hr_meta_interstitial",true);window.setTimeout(function(){ta.store("show_hr_meta_interstitial",false);P.addClass("hidden");T.removeClass("hr_meta_loading_hidden")},2000);T.addClass("hr_meta_loading_hidden");var I=document.getElement("#HR_HACKATHON_CONTENT .metaExplanation");if(I){I.addClass("hidden")}P.removeClass("hidden")}else{if(!P.hasClass("hidden")&&(!ta.retrieve("show_hr_meta_interstitial")||V)){P.addClass("hidden");T.removeClass("hr_meta_loading_hidden")}}}}if(ta.has("meta.isHackathonBC")&&!ta.has("hr_unavail_xsell_flyout")){ta.commerce.meta.horizontalXSell.updateHorizontalXSell(H,Q)}if(!V&&ta.has("meta.isHackathonBC")&&K.contains("firstRequest")){var G=setTimeout(function(){s(Q,S,M)},ta.commerce.minimeta.ajax.MINI_META_APPEAR_LOADING_TIMEOUT);ta.store(f,Number.from(G))}if(V&&ta.has(f)){var D=ta.retrieve(f);clearTimeout(Number.from(D))}if(!V){if(ta.has("meta.isHackathonBC")&&K.contains("anyOfferCompletedSuccessfully")){ta.commerce.meta.updateHeaderMsg(".metaDatesChosen",ta.retrieve("meta.bc.bestPricesForYourStay"));if(ta.has("guests_rooms_picker_3.enabled")){ta.commerce.meta.updateHeaderDates()}}if(ta.has("guests_rooms_picker_4.enabled")&&ta.overlays.NumberPickerOverlay){ta.overlays.NumberPickerOverlay.updateHeaderMsg(".metaDatesChosen")}ta.commerce.meta.polling.incrementPollingAttemptForRequest(E);setTimeout(function(){m(Q,S,M+1,z)},ta.commerce.meta.polling.getPollingWaitTimeForRequest(E))}else{if(ta.has("meta.isHackathonBC")){var A="meta.bc.bestPricesForYourStay";if(K.contains("allNotAvailable")){A="meta.bc.pricesTravelSitesNotAvailDates"}ta.commerce.meta.updateHeaderMsg(".metaDatesChosen",ta.retrieve(A));if(ta.has("guests_rooms_picker_3.enabled")){ta.commerce.meta.updateHeaderDates()}if(ta.has("guests_rooms_picker_4.enabled")&&ta.overlays.NumberPickerOverlay){ta.overlays.NumberPickerOverlay.updateHeaderMsg(".metaDatesChosen")}if(ta.retrieve("meta.full_meta_photos")){var B=document.getElement(".metaDatesChosen");if(B){if(K.contains("allNotAvailable")){if(ta.has("ibex_lead_with_supplier_direct_logo")){document.getElement(".headerWrapper").addClass("no_offers_available");document.getElement(".changeStayInfoButton").addClass("no_offers_available")}B.addClass("no_offers_available")}else{if(ta.has("ibex_lead_with_supplier_direct_logo")){document.getElement(".headerWrapper").removeClass("no_offers_available");document.getElement(".changeStayInfoButton").removeClass("no_offers_available")}B.removeClass("no_offers_available")}}}ta.commerce.meta.polling.removePollingInfoForRequest(E);ta.commerce.meta.displayBlueChevronLowestPriceCTA();window.fireEvent("HRHacComplete");if(!z){p(S,false)}var R=document.getElement(".similarCarousel");if(z&&R){g(K)}if(!J){setTimeout(function(){u()},1000)}}}if(V&&!ta.retrieve("hotels_to_seo_hotels_redirect")&&y&&!z&&!ta.retrieve("meta.persist.visible")&&!(K.contains("cancelRedirect"))){if(K&&K.match(/\shacComplete\s.*\shacMiniOfferNotAvailable\s/g)){ta.trackEventOnPage("NoAvailability","redirect","",0,"/HotelHighlight")}if(K&&K.match(/\shacComplete\s.*\shasDisplayUnavailability\s/g)){ta.trackEventOnPage("MaybeAvailable","redirect","",0,"/HotelHighlight")}}if(V){ta.fireEvent("HRHacAvailabilityDetermined",{availability:ta.commerce.meta.getResponseAvailability(K),loadingTimeoutPassed:z,cancelRedirect:K.contains("cancelRedirect"),datesChanged:y,hasBookableOffer:K.contains("bookableOffer")})}l(V,H);t(S,V,z)}function h(A,y){var B=new Element("div",{html:A}),z=B.getElement(".dropdownMiniMeta");if(z){z.inject(y)}}function w(A){var y=document.getElement(".rgba_flyout.dropdownMiniMeta"),B,C,z;if(y){B=new Element("div",{html:A});z=B.getElement(".dropdownMiniMeta");if(z){C=y.getElement(".inner");C.innerHTML="";z.set("class","dropdownMiniMeta");C.adopt(z)}q()}}function q(){if(ta.retrieve("dropdownMiniMeta.hover")){ta.commerce.meta.hoverTopOffer()}else{if(ta.retrieve("dropdownMiniMeta.blur")){ta.commerce.meta.blurTopOffer()}}}function s(B,z,y){var A="miniMetaHacRequest_"+z+"_cancel";if(ta.retrieve("datepicker_autoadvance")&&ta.retrieve(A)){return}k();p(z,true);m(B,new Date().getTime(),y+1,true)}function e(y){var z="";if(ta.browser.isIE10Metro()){if(y=="QC_Meta_Book_Inline"){z="QC_Meta_Metro_Inline"}else{z="QC_Meta_Metro_Lightbox"}}else{if(!y){if(ta.has("ta.meta.navArea")){z=ta.retrieve("ta.meta.navArea")}else{ta.util.element.trackIfMapView();z="QC_Meta_Lightbox"}}else{z=y}}return z}function v(){var A=document.getElement("#CHECK_RATES_CONT div.hacMiniComplete");var y=document.getElement("#CHECK_RATES_CONT div.hacMiniCompleteTimeOut");if(A||y){return}var z=document.getElement("div.bc_flags");if(z){z.addClass("hacMiniCompleteTimeOut")}k();u()}function k(z){var y=z?"metaHacRequest_curCancelKey":"miniMetaHacRequest_curCancelKey";if(ta.has(y)){var A=ta.retrieve(y);ta.store(A,true);ta.commerce.meta.polling.removePollingInfoForRequest(A)}}o.cancelAllMetaCurrentQuery=function(){k(false);k(true)};function r(){var A=document.getElements("#CHECK_RATES_CONT span.textLinkLoading");var z=document.getElements("#CHECK_RATES_CONT div.loading");var y=0;if(A){y+=A.length}if(z){y+=z.length}return y}function n(y,B){var z,A;if(!y||!B){return}z=B+"_suppressCommerceImpressionState";A=ta.commerce.meta.polling.getPollingAttemptForRequest(B);if(A){if(A===1){if(ta.retrieve("meta.isFromDatesChange")){ta.remove("meta.isFromDatesChange");ta.store(z,true);y+="&isFirstPageLoad=false";return y}}else{if(ta.retrieve(z)){y+="&isFirstPageLoad=false";return y}}}return y}function p(E,H){var A=0;var F="unknown";if(H){A=ta.commerce.minimeta.ajax.MINI_META_APPEAR_LOADING_TIMEOUT;var G=r();var z=document.getElements("#CHECK_RATES_CONT div.premium");var B=document.getElements("#CHECK_RATES_CONT span.textLink");var D=0;if(z){D+=z.length}if(B){D+=B.length}var y=D-G;if(D>0){var C=Math.round((y/D)*10)*10;if(C%10===0&&C>-1&&C<101){F=""+C+"percent"}}}else{A=new Date().getTime()-E;F="100percent"}ta.trackEventOnPage("HAC","HACComplete",F,A,true)}function g(C){var B=Elements.from(C)[0];if(!B){return}var A=B.getElementsByClassName("price");var z=B.getElementsByClassName("priceBlock");var y=0;if(A){y+=A.length}if(z){y+=z.length}ta.trackEventOnPage("HAC","StateCarouselDisplayed","",y,true)}function u(){var y=r();if(y>0){ta.trackEventOnPage("HAC","HACError","LoadingAfterHACComplete",y,true)}}function l(A,y){if(A&&ta.retrieve("ibdm_impression_tracking")){var z=y.getElement(".impressionTrackingTree");if(z){ta.trkImpTree(z)}}}function t(B,A,y){if(A||y){var C="meta.lowestPricePromotionTracking.tracked"+B;if(ta.has("meta.lowestPricePromotionTracking")&&!ta.has(C)){var z=ta.retrieve("meta.lowestPricePromotionTracking");if(z&&z.bidDifference&&z.priceDifference&&z.bidDifference>=0.43&&z.priceDifference>=10){ta.store(C,true);ta.trackEventOnPage("lowest_price_promoted_impression",z.providers,z.bidDifference+"|"+z.priceDifference)}}}}})(ta.meta.update);if(!ta.meta){ta.meta={}}if(!ta.meta.cross_sell){ta.meta.cross_sell={}}(function(e){var f=0;var b=false;var c=0;e.relatedHoverOver=function(j,g){try{if(f!==0){return}if(g===0){a()}else{d((j)?(j.target||j.srcElement):null,g)}}catch(h){ta.util.error.record(h,"also viewed - avafIn")}};e.relatedHoverOut=function(k){try{if(f!=1||!b){return}if(!k){k=window.event}if(!k){return}var g=(k.relatedTarget)?k.relatedTarget:k.toElement;var j=ta.id("ALSO_VIEWED_LIST");while(g&&g!=j&&g.nodeName!="BODY"){g=g.parentNode}if(g==j){return}clearTimeout(b);b=false;f=0}catch(h){ta.util.error.record(h,"also viewed - avafOut")}};e.relatedExpand=function(g,j){var h,l;try{ta.trk("AVAF_EXPAND_"+(j?"MORE":"LESS"),false,(g)?(g.target||g.srcElement):null);if(j){h=ta.id("hideableMore");if(!h){return}h.addClass("hidden");h=ta.id("expand_av_on_more");if(!h){return}h.removeClass("hidden");if(c===0){h.addClass("expanding");c=h.getSize().y;h.removeClass("expanding")}h.addClass("show");new Fx.Tween(h,{duration:"long",property:"height"}).start(0,c)}else{h=ta.id("expand_av_on_more");if(!h){return}new Fx.Tween(h,{duration:"long",property:"height"}).start(h.getSize().y,0).chain(function(){h.removeClass("show");h.addClass("hidden");l=ta.id("hideableMore");if(!l){return}l.removeClass("hidden")})}}catch(k){ta.util.error.record(k,"also viewed - avafMore")}};e.relatedResetStateFlag=function(){f=0};function d(h,g){try{f=1;b=setTimeout(function(){a(h)},g)}catch(j){ta.util.error.record(j,"also viewed - avafWait")}}function a(h){try{ta.trk("AVAF_HOVER_EXPAND",false,h);f=2;var g=ta.id("expand_av_on_hover");if(!g){return}g.removeClass("hidden");g.addClass("expanding");var m=g.getSize().y;g.removeClass("expanding");g.addClass("show");var l=g.getParent("#AV_ABOVE_FOLD_META");if(l){l.setStyle("height","auto")}var k=new Fx.Tween(g,{duration:"long",property:"height"});k.start(0,m)}catch(j){ta.util.error.record(j,"also viewed - avafExpand")}}e.largerChangesTest6=(function(){var n,p,m;function g(s){s=ta.id(s);if(s){var r=s.getParent("li");if(r&&r.id){return r.id.replace("avaf_id_","")}}}function k(t,r){t=ta.id(t);if(r){$$("#ALSO_VIEWED_LIST .showCommerce").erase(t).each(j)}if(t){t.addClass("showCommerce");var s=t.getElement(".data");if(s){s.setStyle("bottom",(t.clientHeight-s.clientHeight)+"px")}}}function j(r){r=ta.id(r);if(r){r.removeClass("showCommerce");r.getElements(".data").setStyle("bottom",null)}}function h(t,r,s){if(!q()){ta.util.cookie.setPIDCookie(n);ta.setEvtCookieAndPath(t,r,s);if(p){ta.popups.PopUtil.attemptOpenUrlNewTab(r)}else{window.open(r,"_self")}}}function l(){ta.id("ALSO_VIEWED_LIST").removeClass("noOverlayVisible").addClass("overlayVisible")}function o(){ta.id("ALSO_VIEWED_LIST").removeClass("overlayVisible").addClass("noOverlayVisible")}function q(){return ta.id("ALSO_VIEWED_LIST").hasClass("overlayVisible")}return{setup:function(r,s){n=r;p=s},setOverlayVisible:l,isOverlayVisible:q,click:function(r){h("Background",r)},datedSetup:function(){$$("#ALSO_VIEWED_LIST .date_picker_calendar_wrap").addEvent("click",function(w){w.stopPropagation();l();var v=g(w.target);var t=w.target.hasClass("date_picker_calendar_wrap")?w.target:w.target.getParent(".date_picker_calendar_wrap");var r=t.hasClass("out_date")?"out":"in";var s=ta.widgets.calendar.getCalendarObjectKey(v,"_av_above_fold",r);var x=ta.retrieve(s);var u=w.target.getParent(".oh");if(x&&!x.av_above_fold_setup&&x.calendar&&x.calendar.calendarOverlay){x.calendar.calendarOverlay.addEvent("onHide",function(){o();var z=ta.widgets.calendar.getPageInDate();var y=ta.widgets.calendar.getPageOutDate();if(((z&&y)||(!z&&!y))){setTimeout(function(){var A=ta.id("ALSO_VIEWED_LIST").querySelector(".oh:hover");if(A!==u&&u.getElements(".dualFieldOn").length===0){j(u);if(A&&!A.hasClass("showCommerce")){k(A)}}},5)}else{m=true}});x.calendar.calendarOverlay.addEvent("onShow",l);x.av_above_fold_setup=true}});ta.id("ALSO_VIEWED_LIST").addClass("dates-setup")},undatedMouseOver:function(r,s){if(r&&s&&!s.contains(r.relatedTarget||r.fromElement)){if(!m&&ta.id("ALSO_VIEWED_LIST").hasClass("dates-setup")&&$$("#ALSO_VIEWED_LIST .dualFieldOn").length===0){k(s,true)}m=false}},undatedMouseOut:function(r,s){if(r&&s&&!s.contains(r.relatedTarget||r.toElement)){s=ta.id(s);if(s.getElements(".dualFieldOn").length===0){j(s)}}},handleNewDates:function(s,u){ta.widgets.calendar.handleNewDates(s,u);var t=ta.id("avaf_id_"+s);var r=t&&t.getAttribute("data-property-href");if(r){ta.widgets.calendar.justUpdateSessionDates(false,false,true);o();h("Dates",r,t)}},datedMouseOver:function(r,s){if(r&&s&&!s.contains(r.relatedTarget||r.fromElement)){if($$(".micro_meta_flyout").length===0){k(s,true)}}},datedMouseOut:function(r,s){if(r&&s&&!s.contains(r.relatedTarget||r.toElement)){if($$(".micro_meta_flyout").length===0){j(s)}}},microMetaOnHide:function(r){return function(){o();setTimeout(function(){var s=ta.id("ALSO_VIEWED_LIST").querySelector(".oh:hover");var t=ta.id("avaf_id_"+r).getElement(".oh");if(s!==t){j(t);if(s&&!s.hasClass("showCommerce")){k(s)}}},5)}}}})()})(ta.meta.cross_sell);if(!ta.meta.cr){ta.meta.cr={}}(function(b){b.updateCRCalendar=function(c){if(c.form){a(c.form)}b.updateCRFormElement(this);if(ta.id("META_UI_INLINE")){ta.meta.update.updateCRForm("_imt")}};b.findInlineCRLocationId=function(){var g=null;var h=ta.id("HotelDateSearch");if(h){var c=h.getElements("input[type=text]");for(var f=c.length;f--;){var d=c[f];var e=d.id.match(/_(\d+)/);if(e.length){g=e[1];break}}}return g};b.updateCRFormElement=function(g){try{g=ta.id(g);var o=g.get("tag").toLowerCase();if(o=="li"){g=g.getElement("input[type=checkbox]")}var h=g.id.split("_")[0],k=this.findInlineCRLocationId(),n=h+"_"+k,f=g.id,c=f.substring(f.length-4),r=[n,n+"_icr",n+"_per",n+"_imt"],j,q,d,m,p;if(this.crSyncExtensions.contains(c)){for(j=r.length;j--;){n=r[j];if(n!=f){p=ta.id(n);if(p){if(o=="li"&&c!="_pop"){p.checked=g.checked;q=g.getParent("li");if(q&&!q.hasClass("unavailable")){d=p.getParent("li");if(d){d.removeClass("unavailable")}}}else{if(o=="select"){p.selectedIndex=g.selectedIndex}else{if(o=="input"){m=n.substring(n.length-4);if(!this.crSyncExtensions.contains(m)){m=""}this.updateCRFormElement_In(k,g,c,m)}}}}}}}}catch(l){ta.util.error.record(l,"updateCRFormElement")}};b.getPropIdFromCRElement=function(d){if(d){var c=null;if(c=d.className.match(/id_(\d+)/)){return c[1]}}return null};b.removePCR=function(){var c=ta.retrieve("pcr.overlay");if(c){c.hide()}};b.availCheck=function(d){var c=ta.id("availability")&&ta.id("availability").value=="1";var f=ta.id(d).getElement(".overlaySrc");if(c&&f){var e=f.innerHTML;f.innerHTML=e.replace(/cid=(\w+_)?&amp;/,"")}};b.crSyncExtensions=["_pop","_icr","_pto","_per","_amo","_cro","_met","_imt","_pal","_inm"];function a(c){if(ta.retrieve("checkrates.datesChanged")){return}try{var d=ta.id(c);d.getElements(".unavailable").each(function(e){e.removeClass("unavailable");if(e.hasClass("js_ua_checked")){e.getElements("input").set("checked",true)}ta.meta.update.updateCRFormElement(e)});ta.store("checkrates.datesChanged",true)}catch(g){ta.util.error.record(g,"_showSuppressedProviders")}}})(ta.meta.cr);(function(a){a.GoogleCSA={addCallback:function(c,b){b.adLoadedCallback=function(h,d){var f=ta.id(c);if(f&&!d){try{f.dispose()}catch(g){ta.util.error.record(g,"Google CSA")}}};return b}}}(ta.commerce));if(!ta.sales){ta.sales={}}ta.sales.metaImpressionTag=(function(h,f,e){var g=null,k=null,c=null,d=false,j=function(p){if(e.find(p)){var n=e.select(p);for(var m=0;m<n.length;m++){var o=n[m];if(((o.get("data-provider")&&o.get("data-provider")==k)||(o.get("data-offer-author")&&o.get("data-offer-author")==k)||(o.get("data-vendorname")&&o.get("data-vendorname")==c))&&!o.hasClass("hidden")){b();return true}}}return false},b=function(){var m=g+Math.floor(Math.random()*100000);h.body.appendChild(new Element("img",{"class":"tracking",src:m,height:"0",width:"0"}));d=true;a()},l=function(){f.addEvent("HotelsHacComplete",e.sales.metaImpressionTag.chkHotels);f.addEvent("HRHacComplete",e.sales.metaImpressionTag.chkHR);f.addEvent("MicroMetaHacComplete",e.sales.metaImpressionTag.chkMicroMeta);f.addEvent("MetaLightboxHacComplete",e.sales.metaImpressionTag.chkLightbox);f.addEvent("MetaFetchComplete",e.sales.metaImpressionTag.chkMapDetailCard);f.addEvent("MetaFetchComplete",e.sales.metaImpressionTag.chkSmartDeals);f.addEvent("MapListMetaComplete",e.sales.metaImpressionTag.chkMapListCard)},a=function(){f.removeEvent("HotelsHacComplete",e.sales.metaImpressionTag.chkHotels);f.removeEvent("HRHacComplete",e.sales.metaImpressionTag.chkHR);f.removeEvent("MicroMetaHacComplete",e.sales.metaImpressionTag.chkMicroMeta);f.removeEvent("MetaLightboxHacComplete",e.sales.metaImpressionTag.chkLightbox);f.removeEvent("MetaFetchComplete",e.sales.metaImpressionTag.chkMapDetailCard);f.removeEvent("MetaFetchComplete",e.sales.metaImpressionTag.chkSmartDeals);f.removeEvent("MapListMetaComplete",e.sales.metaImpressionTag.chkMapListCard)};return{chkLightbox:function(){if(d){return}j(".overlay #PROVIDER_BLOCK .metaLbOffers .offer.premium")},chkMicroMeta:function(){if(d){return}j("#micro_meta_ajax .provider")},chkHotels:function(){if(d){return}j("#PAGE .metaPriceInfo .header")},chkMapDetailCard:function(){if(d){return}j(".mapsv2-detail-info .mapsv2-chevron")},chkMapListCard:function(){if(d){return}j(".mapsv2-listcard .mapsv2-listitem .mapsv2-dropdownfirstitem")},chkSmartDeals:function(){if(d){return}j("#AVAILABLEHOTELDEALS .lpContainer .offer")},chkHR:function(){if(d){return}j("#CHECK_RATES_CONT .offer.premium:not(.remaining):not(.noLink)")},setProviderName:function(m){k=m},setTrackingPixel:function(m){g=m},setVendorName:function(m){c=m},registerEvents:function(){if(!k||!c||!g){return}l()}}}(document,window,ta));window.setupLazyLoad=function(){var a=new LazyLoad({range:200},lazyImgs,lazyHtml);return a};var LazyLoad=new Class({Implements:[Options,Events],options:{range:200,fireScroll:true,mode:"vertical"},initialize:function(o,m,p){this.setOptions(o);this.container=window;var b=(this.options.mode=="vertical"?"y":"x");this.containerDimension=this.container.getSize()[b];this.start=0;var l=this.containerDimension+this.options.range;var k=ta.retrieve("ta.commerce.obf");if(k){try{var h=k.given.split("");var f=k.replace.split("");var d=k.token}catch(j){ta.util.error.record(j,"obfuscation object corrupted")}}var n=0;this.htmlBlocks=p.filter(function(s){var r=ta.id(s.id);if(r&&(r.getPosition()[b]>l&&s.scroll)){n++;return true}else{if(r){try{var v=s.data.indexOf(d);if(k&&v==0){var t=s.data.substr(d.length).split("");for(var q=t.length;q--;){var u=t[q];var v=f.indexOf(u);if(v!=-1){t[q]=h[v]}}r.innerHTML=t.join("")}else{r.innerHTML=s.data}}catch(w){ta.util.error.record(w,"lazy html",null,{id:s.id})}return false}else{return false}}},this);var c=0;this.images=m.filter(function(q){var e=ta.id(q.id);if(e){e.oSRC=q.src||q.data;e.priority=q.priority||1000;if(q.logerror){e.onerror=function(){ta.util.error.record(new Error("lazy img did not load from "+e.src),null,null,null,"WARN")}}if((!e.isVisible()||e.getPosition()[b]>l)&&q.scroll){c++;return true}else{ta.queueLazyImg(e);return false}}else{return false}},this);ta.processLazyImages();var a=function(){var e=this.getScroll();if(e>this.start){this.load();this.start=e}this.fireEvent("scroll");if(!this.images.length){this.container.removeEvent("scroll",a);this.fireEvent("complete")}}.bind(this);this.load=function(){this.htmlBlocks=this.htmlBlocks.filter(function(r){try{var q=ta.id(r.id);if((q&&q.getPosition&&((this.getScroll()+this.options.range+this.containerDimension)>=q.getPosition()[b]))||(q&&!q.getPosition)){q.innerHTML=r.data;return false}}catch(s){ta.util.error.record(s,"lazy",null,{id:r.id})}return true},this);this.images=this.images.filter(function(r){try{var q=ta.id(r.id);if((q&&q.getPosition&&((this.getScroll()+this.options.range+this.containerDimension)>=q.getPosition()[b]))||(q&&!q.getPosition)){ta.queueLazyImg(q);return false}}catch(s){ta.util.error.record(s,"lazy",null,{src:r.src})}return true},this);ta.processLazyImages()}.bind(this);var g=function(){var e=this.container.getSize()[b];if(e>this.containerDimension){this.containerDimension=e;this.load()}}.bind(this);this.container.addEvent("scroll",a);this.container.addEvent("resize",g);if(this.options.fireScroll){this.container.fireEvent("scroll")}},getScroll:function(){if(this.container&&this.container.getScroll){return this.container.getScroll()[this.options.mode=="vertical"?"y":"x"]}else{return 9000}}});var sTAMGFooterCookieName="hideTAMGFooter";var sFooterDivId="TM_FTR";var hmOngoingHover={};var savedDomain="tripadvisor.com";if(typeof cookieDomain!="undefined"){savedDomain=cookieDomain.substring(1,cookieDomain.length)}function _closeOverlay(){var a=ta.retrieve("overlays.current");if(a){a.hide()}}function setTAMGFooterCookie(d,c){var b=new Date();b.setTime(b.getTime());var e=1000*60*60*24*7;var a=new Date(b.getTime()+(e));document.cookie=sTAMGFooterCookieName+"="+escape(d)+";expires="+a.toGMTString()+";path=/"+((savedDomain)?";domain="+savedDomain:"");hideFooter(c)}function openUrl(b){var a=window.open(b);a.opener=null}function getTAMGFooterCookie(){var e=document.cookie.split(";");var a="";var c="";var d="";var b=false;for(i=0;i<e.length;i++){a=e[i].split("=");c=a[0].replace(/^\s+|\s+$/g,"");if(c==sTAMGFooterCookieName){b=true;if(a.length>1){d=unescape(a[1].replace(/^\s+|\s+$/g,""))}return d}a=null;c=""}if(!b){return null}}function hideFooter(b){if(!b){b=sFooterDivId}var a=document.getElementById(b);if(a){a.style.display="none"}}function tamgShowFly(c,d,b,a){hmOngoingHover[d]=true;setTimeout(function(){if(hmOngoingHover[d]){tamgCreateFly(c,b,a)}},250)}function tamgHideFly(a,c,b){var d=b.toElement||b.relatedTarget;while(d&&d!=a){d=d.parentNode}if(d!=a){hmOngoingHover[c]=false;setTimeout(function(){if(hmOngoingHover[c]==false){$$("."+c)[0].hide()}},250)}}function tamgCreateFly(g,j,e){var f=$(g).getElements(".ftrFly")[0];if($(f).getElements("img")[0]){f.show()}else{var k=CDNHOST+"/img2/x.gif";var h="ftrFlyLogo "+j;var d=new Element("img",{"class":h,src:k}).inject(f,"top");d.setProperty("height","25");d.setProperty("width",e);var c=new Element("div",{"class":"triWrap"});var b=new Element("span",{"class":"cssTri"});var a=new Element("span",{"class":"cssTri"});b.inject(a);a.inject(c);c.inject(f,"bottom");f.show()}}function getTAMGFooterViaAjax(d,c,a,b,e){new Request({url:"/TAMGFooterAjax",onSuccess:function(g){var h=ta.id("TAMGFooterHolder");if(h){h.innerHTML=g}var f="RuleBasedFooter_"+e;ta.trackEventOnPage("Footer","OpenFooter",f,1,true)},data:{a:"SHOW_FOOTER",dis:d,loc:c,"new":a,serv:b},evalScripts:true,method:"get"}).send()}function getFullDisclaimerText(){new Request({url:"/TAMGFooterAjax",onSuccess:function(b){try{ta.id("PDISCLAIMER").innerHTML=b}catch(a){ta.util.error.record(a,"Fail to find element (id PDISCLAIMER)")}},data:{a:"SHOW_FULL_DISCLAIMER"},evalScripts:true,method:"get"}).send()}ta.util.taLnk={mouseover:function(b){$(b).addClass("underline")},mouseout:function(b){$(b).removeClass("underline")},redirect:function(a){window.location.href=a}};var StringBuffer=new Class({initialize:function(a){this.strings=new Array();if(a){this.append(a)}},append:function(a){this.strings.push(a);return this},toString:function(){return this.strings.join("")},isEmpty:function(){return this.strings.length==0}});var Table=new Class({Implements:[Options],options:{properties:{cellpadding:0,cellspacing:0,border:0},rows:[]},initialize:function(a){this.setOptions(a);this.table=new Element("table").setProperties(this.options.properties);this.tbody=new Element("tbody").inject(this.table);this.options.rows.each(this.push.bind(this))},push:function(d,c,a){var b=new Element("tr").inject(c||this.tbody);d.each(function(e){var f=new Element(a?"th":"td").inject(b);if(e.properties){f.setProperties(e.properties)}if(e.content){f.setContent(e.content)}else{f.setContent(e)}});return this},pushHead:function(a){if(!this.thead){this.thead=new Element("thead").inject(this.table,"top")}this.push(a,this.thead,true);return this},pushFoot:function(a){if(!this.tfoot){this.tfoot=new Element("tfoot").inject(this.table)}this.push(a,this.tfoot);return this},pushCaption:function(a){new Element("caption").setContent(a).inject(this.table,"top");return this}});var TabSet=new Class({Implements:[Options,Events],options:{onActive:function(){},onBackground:function(){},show:0,collapsable:false},initialize:function(){var a,b,c;Array.each(arguments,function(f,e){switch(typeOf(f)){case"object":a=f;break;default:var d=$$(f);if(!b){b=d}else{c=d}}});this.togglers=b||[];this.elements=c||[];this.setOptions(a);this.elements.each(function(e,d){this.togglers[d].addEvent("click",this.display.bind(this).partial(Function._,d));if(this.options.show===d){e.show();this.previous=d;this.fireEvent("onActive",[null,this.togglers[d],e])}else{e.hide()}},this)},display:function(b,a){if(this.options.collapsable&&a==this.previous){if(this.elements[a].isHidden()){this.fireEvent("onActive",[b,this.togglers[a],this.elements[a]]);this.elements[a].show()}else{this.fireEvent("onBackground",[b,this.togglers[a],this.elements[a]]);this.elements[a].hide()}return this}if(this.previous||this.previous===0){this.elements[this.previous].hide();this.fireEvent("onBackground",[b,this.togglers[this.previous],this.elements[this.previous]])}this.previous=a;this.elements[a].show();this.fireEvent("onActive",[b,this.togglers[a],this.elements[a]]);return this}});var ToggleSet=new Class({initialize:function(b,c,a){this.index=a||0;this.togglers=b||[];this.elements=c||[];this.togglers.each(function(e,d){this.togglers[d].addEvent("click",this.display.bind(this,d));this.elements[d].hide()},this)},add:function(c,b){var a=this.togglers.length;this.togglers.push(c);this.elements.push(b);c.addEvent("click",this.display.bind(this,a));b.hide()},expand:function(a){this.togglers[a].addClass("open");this.elements[a].show();return this},collapse:function(a){this.elements[a].hide();this.togglers[a].removeClass("open");return this},display:function(a){if(this.previous==a){if(this.elements[a].isHidden()){this.expand(a)}else{this.collapse(a)}}else{if(this.previous||this.previous===0){this.collapse(this.previous)}this.previous=a;this.expand(a)}return this}});var doBehavior=function(b){var b=new Event(b||window.event);var a=ta.id(b.target);if(a.get("tag")!="a"){a=a.getParent("a")}if(/pid(\d+)/.test(a.className)){ta.util.cookie.setPIDCookie(RegExp.$1)}(a.className.match(/(js_\w+)/g)||[]).each(function(e){if(window.linkMap){var d=linkMap[e];if(typeof d==="function"){d(a,b)}}})};function _processLink(a){if(a.className.indexOf("js_")>=0||a.className.indexOf("pid")>=0){if(a.addEventListener){a.addEventListener("click",doBehavior,false)}else{a.attachEvent("onclick",doBehavior)}try{if(a.className.match(/\b(js_pop)/)&&window.noPopClass){a.className=a.className+" "+window.noPopClass}}catch(b){ta.util.error.record(b,"_processLink - add no pop class")}}}function processLinks(a){var b=Array.from(a.getElementsByTagName("a"));b.each(_processLink);return b.length}if(typeof behavior=="undefined"){ta.queueForLoad(function(){processLinks(document)},"ProcessLinkBehavior")}(function(){function a(){if(window==window.top){var j=Cookie.read("ajaxAction");if(j){j=j.split("|");if(/^target:(\/[\w\d_-]+)/.test(j[0])){if(window.location.pathname.indexOf(RegExp.$1)!==0){return}j=j.slice(1)}else{if(window.opener){return}}Cookie.dispose("ajaxAction",{domain:cookieDomain,path:"/"});if((j[0]=="focus"||j[0]=="click")&&j.length>1){for(var f=0;f<j.length;f+=2){var d=ta.select(j[f+1]);if(d&&d.length){try{d[0][j[f]]()}catch(g){ta.util.error.record(g,"ajaxAction",null,{funcName:j[f],elmt:j[f+1]})}}}}else{try{var b=j.slice(1);b.unshift({});b.unshift(j[0]);ta.run.apply(null,b)}catch(h){ta.util.error.record(h,"ajaxAction",null,{funcName:j[0]})}}}}}ta.queueForLoad(function(){Cookie.dispose("TATypeAhead");a();if(Browser.firefox||Browser.safari||Browser.chrome){var c=window.location.hash;if(c.length>1){c=c.substring(1)}var b=ta.id(c);if(b&&b.getTop()!=window.getScrollTop()){window.scrollTo(0,b.getTop())}}if(/^#save/.test(location.hash)){doSavesPostLoginPopup()}freshVSCookieCheck()},"On_Load_Popups")}());ta.queueForLoad(function(){if(typeof cpu_run!="undefined"){cpu_run()}},"Commerce Popunder");function freshVSCookieCheck(){if(typeof freshVSTrackingCookie!="undefined"&&freshVSTrackingCookie){var a=new Cookie("v1st").readRaw();if(a){new Request({url:"/VSCookieRequest"}).send()}}}function royBatty(){if(typeof taSecureToken=="undefined"||!taSecureToken){return}try{var d=Cookie.read("roybatty");if(!d){Cookie.write("roybatty",taSecureToken+",1",{domain:cookieDomain});if(ta.browser&&ta.browser.isIEMetro&&ta.browser.isIEMetro()){new Request({url:"/CookiePingback?metroBrowser=true"}).send()}else{new Request({url:"/CookiePingback"}).send()}}else{var b=d.split(",");if(b&&b.length==2){var a=parseInt(b[1],10);Cookie.write("roybatty",taSecureToken+","+a,{domain:cookieDomain})}else{if(b&&b.length==1){Cookie.write("roybatty",taSecureToken)}else{ta.util.error.record(null,"royBatty -- Bad value in cookie: "+d)}}}ta.store("roybatty.checked",true)}catch(c){ta.util.error.record(c,"javascript exection bot detection error")}}ta.queueForLoad(function(){if(typeof royBatty!="undefined"){royBatty()}},"RoyBatty");var doSavesPostLoginPopup=function(){if(typeof savesIncluded!="undefined"){handleSavesPostLoginPopup()}else{new Asset.javascript(savesJS);doSavesPostLoginPopup.delay(125)}};if(window.showPopup){showPopup()}var popupConfig={};function DHTMLOverlayRequest(f,e,c,d){var b="?";if(popupConfig.servletUrl.contains(b)){b="&"}if(popupConfig.servletUrl.contains("fromServlet=")){var a=popupConfig.servletUrl+b+"Action="+f}else{var a=popupConfig.servletUrl+b+"Action="+f+"&fromServlet="+pageServlet}new Request({url:a,onSuccess:e,onFailure:c,data:d,evalScripts:true}).send()}function showDHTMLPopup(b,g,d,a,f){try{popupConfig.servlet=b;popupConfig.servletUrl=g;popupConfig.lightbox=d||(a&&a.lightbox)||false;popupConfig.options=a;if(a&&a.loading&&f){f=new Event(f);ta.id(a.loading).show().inject(document.body).setStyles({left:f.page.x+20,top:f.page.y})}DHTMLOverlayRequest("Open",DHTMLOverlayResponse,null,a?a.data:null)}catch(c){ta.util.error.record(c,"showDHTMLPopup - "+b,f)}}var DHTMLOverlayResponse=function(g){if(!g){return}if(!ta.overlays||!ta.overlays.Factory){ta.load("ta-overlays",function(){DHTMLOverlayResponse(g)});return}if(popupConfig.options&&popupConfig.options.forward&&window.popupForward){window.location=window.popupForward}$$("#FLYOUT").each(function(k,j){k.dispose()});window.lightbox.deactivate();$$(".overlay").each(function(k,j){if(k.overlay&&k.overlay.hide){k.overlay.hide()}else{if(k.hide){k.hide()}else{k.dispose()}}});if(popupConfig.options&&popupConfig.options.loading){ta.id(popupConfig.options.loading).hide()}var d;var c={};if(popupConfig.lightbox){c.backdrop=ta.overlays.BACKDROP_ALWAYS}if(popupConfig.options&&popupConfig.options.delayedPosition){c.delayedPosition=popupConfig.options.delayedPosition}if(popupConfig.options&&popupConfig.options.permanent){c.permanent=popupConfig.options.permanent}if(popupConfig.options&&popupConfig.options.center){c.autoShow=false;d=new ta.overlays.CenteredOverlay(c)}else{if(popupConfig.options&&popupConfig.options.permanent){c.xOffset=ta.id("PAGE").getLeft()+100;c.yOffset=ta.id("PAGE").getTop()+220;d=new ta.overlays.PermanentOverlay(c)}else{if(popupConfig.options&&popupConfig.options.daodaoPopup){c.xOffset=ta.id("PAGE").getLeft()+240;c.yOffset=ta.id("PAGE").getTop()+220;d=new ta.overlays.AbsoluteOverlay(c)}else{c.xOffset=ta.id("PAGE").getLeft()+100;c.yOffset=ta.id("PAGE").getTop()+220;d=new ta.overlays.AbsoluteOverlay(c)}}}d.loadRemoteSuccess(g);d.show();ta.popups.PopUtil.trackPopup(popupConfig.servletUrl);var h=function(){if(typeof dhtmlRedirectLink!="undefined"){window.location=dhtmlRedirectLink;return}if(this.inner.getElement(".refreshOnClose")){document.location.reload();return}if(typeof addPopupCloseClass!="undefined"&&!this.inner.getElement(".silentClose")){DHTMLOverlayRequest("Close")}if(this.inner.getElement(".popupBackOnClose")){if(/(?:^|;)\\s*TAReturnTo=\%1\%([^;]*)/.test(document.cookie)){window.location=decodeURIComponent(RegExp.$1)}else{window.location="/"}}};d.addEvent("onHide",h);if(popupConfig.servlet){d.container.addClass(popupConfig.servlet);d.container.addClass("np");if(popupConfig.servlet=="RuleBasedPopup"&&popupConfig.options&&popupConfig.options.cmsDisplayName){d.container.addClass(popupConfig.options.cmsDisplayName)}d.inner.getElements(".popupConvert").each(function(k,j){k.addEvent("click",function(){DHTMLOverlayRequest("Convert")})});d.inner.getElements(".popupDecline").each(function(k,j){k.addEvent("click",function(){DHTMLOverlayRequest("Decline")})});d.inner.getElements(".dhtmlclose").each(function(k,j){k.addEvent("click",function(){var l=d;l.hide()})});var b=function(k){var j=(k.charCode)?k.charCode:((k.which)?k.which:k.keyCode);if(j==13||j==10){e(k)}};var f=function(k){var j=(k.charCode)?k.charCode:((k.which)?k.which:k.keyCode);if(j==13||j==10){new Event(k).preventDefault()}};d.inner.getElements(".popupSubmitOnEnter").each(function(k,j){k.addEvent("keydown",b)});var a=function(j){$$("#POPUP_FORM #sendpass").setProperty("value","true");e(j)};d.inner.getElements(".popupSendForgotEmail").each(function(k,j){k.addEvent("click",a)});var e=function(j){new Event(j).preventDefault();d.inner.getElements(".popupSubmit").each(function(l,k){l.removeEvent("click",e)});d.inner.getElements(".popupSendForgotEmail").each(function(l,k){l.removeEvent("click",a)});d.inner.getElements(".popupSubmitOnEnter").each(function(l,k){l.removeEvent("keydown",b);l.addEvent("keydown",f)});d.inner.getElements(".focusClear").each(function(l,k){l.setProperty("value","")});if(popupConfig.options&&popupConfig.options.disableOnHideForSubmit){d.removeEvent("onHide",h)}DHTMLOverlayRequest("Submit",DHTMLOverlayResponse,null,d.inner.getElementById("POPUP_FORM"))};d.inner.getElements(".popupSubmit").each(function(k,j){k.addEvent("click",e)})}if(popupConfig.options&&popupConfig.options.callback){popupConfig.options.callback(d.container)}};function showOwnersDHTMLPopup(b,c){var a={callback:enableAffilBox};showDHTMLPopup(b,c,true,a)}function enableAffilBox(c){if(typeof c=="undefined"||c==null){return}for(var a=0;a<3;a++){var d="affil_"+a;var b=c.getElementById(d);if(b!=null&&b!=false&&b!=""){b.style.visibility="visible"}}}var cpu_win;function doCookieCheck(){Cookie.write("SessionTest","true",{duration:0});if(Cookie.read("SessionTest")){Cookie.dispose("SessionTest");return true}return false}var blurPopunder=function(){try{var a=window.open("about:blank");if(a){a.focus();a.close()}}catch(b){ta.util.error.record(b,"commercePopunder - FF/Chrome blur failed")}};var suppressPopOnClick=function(g){var d=new Event(g||window.event);var c=ta.id(d.target);if(c){if(window.noPopClass&&(c.hasClass&&c.hasClass(window.noPopClass))||(c.getParent&&c.getParent("."+window.noPopClass))){return"no_cpu_class"}var a=c.onclick;if(a&&a.toString&&a.toString().match(/window\.open/g)){return"onclick_script"}if(ta.has("checkrates.belligerent_hw")&&Browser.version>22){var f=c;while(f){var b=f.onclick?f.onclick.toString():false;if(b&&(b.match(/ta\.call/g)||b.match(/ta\.util\.Doer\.aimdoit/g))){return"onclick_ta_call"}f=f.parentNode}if(d.target&&d.target.nodeName&&d.target.nodeName.toLowerCase()=="html"){return"onclick_invalid_target"}if(d.type=="mousedown"&&d.event&&d.event.button!=0){return"onclick_not_left_button"}}if(c.target&&"a"===c.get("tag")){return"has_target"}}if(ta.browser.isIE10Metro()){return"ie10metro"}return false};var flashMouseUp=function(c){try{if(flashObj){if(c==1){var m=flashObj.options;var d=[];for(var b in m){d.push(b+"="+m[b])}var l=window.open(flashObj.uri,flashObj.name,d.join(","));if(l){Cookie.write("CommercePopunder","SuppressAll*"+new Date().getTime(),{domain:flashObj.cDomain,duration:flashObj.cookieDuration})}}else{var a=ta.id("FLASH_CHIP");if(a){a.dispose()}if(Browser.chrome){var k=("TA"+Math.random()+"").replace(".","");var f=window.open("http://"+window.location.hostname+"/vpages/tab.html",k);if(f){f.close()}}else{var j=window.name;window.name=("TA"+Math.random()+"").replace(".","");window.open("",window.name);window.name=j}}}}catch(h){ta.util.error.record(h,"flashMouseUp")}};var isFlashEligible=function(c){try{while(c){var a=c.tagName!=null?c.tagName.toUpperCase():"";if(c&&(a=="A"||a=="BUTTON"||a=="OBJECT"||a=="LI"||a=="SELECT"||c.onclick!=null||c.onmousedown!=null||c.onmouseup!=null||c.onmouseover!=null||c.hasClass("no_cpu")||c.hasClass("overlay")||c.hasClass("button")||c.id=="SAVES"||(a=="INPUT"&&(c.type=="button"||c.type=="submit")))){return false}c=c.getParent()}return true}catch(b){ta.util.error.record(b,"isFlashEligible")}};if((typeof cpu_enabled!="undefined"&&cpu_enabled)){var cpu_paused=false;var flashObj=null;var cpu_go_impl=function(J,q){try{var k=ta.has("checkrates.add_holding_windows");var j=new Cookie("CommercePopunder").readRaw();var N=ta.popups.PopUtil.numPopundersCheck();var g=ta.popups.PopUtil.hasMTPU();if(q=="unload"){if(Browser.chrome){return"Chrome_unload"}else{if(k&&Browser.ie){return"IE_unload"}}}if(cpu_paused&&q=="unload"&&!isTakeOver){return"paused"}if(!doCookieCheck()){return"failed_cookie_check"}if(k&&(ta.popups.PopUtil.hwClosed||j.substr(0,11)=="SuppressAll")){return"user closed holding window"}if(!k||(k&&N>=ta.popups.PopUtil.maxPopunders)){if(j&&isTakeOver&&q=="click"){return"already_popped"}else{if(j&&!isTakeOver){if(j!="SuppressUnload"||q!="click"){return"already_popped"}}}}var G=typeof IS_MTPU_ENABLED!="undefined"&&IS_MTPU_ENABLED&&typeof MTPU_RULE!="undefined"&&MTPU_RULE>0&&!g;var W=G;if(q=="click"){try{var B=suppressPopOnClick(J);if(ta.has("checkrates.add_holding_windows")&&!G){var z=false;var m=/Hotel_Review|ShowUserReviews|Hotels|SmartDeals/;if(pageServlet&&m.test(pageServlet)){z=true;ta.store("checkrates.HWtracking","page")}var E=false;if(J.target&&J.target.href&&m.test(J.target.href)){E=true;ta.store("checkrates.HWtracking","link")}if(!z&&!E){B="add holding windows ineligible"}}if(B){return B}}catch(F){ta.util.error.record(F,"commercePopunder - suppressPopOnClick");return"error"}}if(typeof blockPU!="undefined"&&blockPU){return"block_pu"}var I="";if(typeof pageServlet!="undefined"&&pageServlet!==null){I=pageServlet}var Q=new Cookie("TASession").readRaw();if(Q&&/\*PD(\d+)\.(\d+)/.test(Q)&&/\*CC\.(\d+)/.test(Q)&&!W){return"commerce_click_happened"}if((!Q||!(/\*LL\.(\d+)/.test(Q)))&&!W){return"bug_28579"}var O=1;var S=1;try{if(Browser.ie7){O=250;S=100}if(Browser.safari||Browser.chrome){O=85;S=100}}catch(F){ta.util.error.record(F,"commercePopunder - access to window attributes",J,{type:q})}var r=0,o=0;try{r=(window.screenLeft||window.screenX);o=(window.screenTop||window.screenY)}catch(V){ta.util.error.record(F,"commercePopunder - setting nX and nY",J,{type:q});r=undefined;o=undefined}var M=0,L=0;try{if(typeof(r)=="undefined"){r=0;o=0;M=r+window.screen.availWidth-O;L=o+window.screen.availHeight-S}else{M=r+window.getWidth()-O;L=o+window.getHeight()-S}}catch(F){ta.util.error.record(F,"commercePopunder - setting x and y",J,{type:q});M=200;L=200}try{if(Browser.ie7){L=L-95;M=M+13}else{if(Browser.safari||Browser.chrome){L=L-16}else{M=5000;L=5000}}}catch(F){ta.util.error.record(F,"commercePopunder - access to window attributes",J,{type:q})}if(!c){c=""}try{if(window.localStorage){localStorage.setItem("CommercePopunder.timeStamp",new Date().getTime())}}catch(T){ta.util.error.record(T,"commercePopunder - localStorage after before pop",null,{},"WARN")}var D="";if(typeof overlayBackupLoc!=undefined&&overlayBackupLoc){D="&backupLoc="+overlayBackupLoc}var s="";try{if(!!ta.retrieve("popunder.similar_hotels_new_rules")){s="http://"+window.location.hostname+"/SimilarHotelsPopunder?MTPU_RULE=0"}else{var b=window.escape(window.location.href);s="http://"+window.location.hostname+"/CommercePopunderEnhanced?mainWindowReturnTo="+b+"&fromServlet="+I+D}}catch(F){ta.util.error.record(F,"commercePopunder - error accessing window.location setting cpu_uri",J,{type:q})}var a=790;var f=660;var n=false;if(ta.retrieve("popunder.https_required")){n=true}if(!!ta.retrieve("popunder.similar_hotels")&&typeof MTPU_RULE!="undefined"&&(MTPU_RULE==286||MTPU_RULE==287||MTPU_RULE==315||MTPU_RULE==584||MTPU_RULE==586||MTPU_RULE==597||MTPU_RULE==598||MTPU_RULE==599||MTPU_RULE==600||MTPU_RULE==601||MTPU_RULE==602||MTPU_RULE==603||MTPU_RULE==604||MTPU_RULE==610||MTPU_RULE==611||MTPU_RULE==613||MTPU_RULE==629||MTPU_RULE==630||MTPU_RULE==632||MTPU_RULE==633||MTPU_RULE==634||MTPU_RULE==635||MTPU_RULE==680||MTPU_RULE==681||MTPU_RULE==682||MTPU_RULE==683||MTPU_RULE==684||MTPU_RULE==685||MTPU_RULE==689||MTPU_RULE==690||MTPU_RULE==692||MTPU_RULE==693||MTPU_RULE==694||MTPU_RULE==695||MTPU_RULE==696||MTPU_RULE==697||MTPU_RULE==698||MTPU_RULE==699||MTPU_RULE==712||MTPU_RULE==716||MTPU_RULE==717||MTPU_RULE==719||MTPU_RULE==720||MTPU_RULE==721||MTPU_RULE==722||MTPU_RULE==723||MTPU_RULE==724||MTPU_RULE==726||MTPU_RULE==727||MTPU_RULE==733||MTPU_RULE==734||MTPU_RULE==735||MTPU_RULE==736||(MTPU_RULE==771&&!!ta.retrieve("popunder.similar_hotels_new_rules")))){s="http://"+window.location.hostname+"/SimilarHotelsPopunder?MTPU_RULE="+MTPU_RULE;if(Browser.ie){f=750;a=950}else{a=960}if(ta.retrieve("similar_hotels_exit_window_chevron")){a=1040}}else{if(G){var A=n?"https":"http";if(typeof geoParam!="undefined"&&geoParam){s=A+"://"+window.location.hostname+"/RuleBasedPopunder?Rule="+MTPU_RULE+"&fromServlet="+I+geoParam+D}else{s=A+"://"+window.location.hostname+"/RuleBasedPopunder?Rule="+MTPU_RULE+"&fromServlet="+I+D}if(typeof popunderCommerceURL!="undefined"&&popunderCommerceURL){s+="&puurl="+popunderCommerceURL}if(typeof popunderPhotoURL!="undefined"&&popunderPhotoURL){s+="&puphoto="+popunderPhotoURL}}}if(q=="click"){s=s+"&onclick=1"}var U=(s.test(/RuleBasedPopunder\?Rule=286/)||s.test(/RuleBasedPopunder\?Rule=287/))?true:false;if(U){a=740;f=700;if(Browser.ie){a=a+10}}try{if(window.fireEvent){window.fireEvent("onPopunderBlur")}var l=1;var d=1;var u=ta.retrieve("ta.isIE11orHigher");if(u||(ta.browser&&ta.browser.isIE9orHigher&&ta.browser.isIE9orHigher())){l=0}else{if(Browser.chrome||Browser.firefox||(Browser.safari&&Browser.version>6)){if(Browser.chrome){d=0}O=a;S=f;M=r+(window.getWidth()-a)/2;L=o+(window.getHeight()-f)/2}}if(k){if(ta.has("checkrates.avlb_popup_win")&&!G){var p=ta.id(J.target);var t=["checkRatesType=checkRates","avlbType=popup"];var P=false;var H=false;if(p&&p.href){var v=p.href.match(/-d(\d+)/);if(v){t.push("d="+v[1]);P=true}else{var R=p.href.match(/-g(\d+)/);if(R){t.push("g="+R[1]);H=true}}}else{if(typeof(modelLocId)!="undefined"&&modelLocId){t.push("d="+modelLocId);P=true}else{if(typeof(modelGeoId)!="undefined"&&modelGeoId){t.push("g="+modelGeoId);H=true}}}if(P||H){s="http://"+window.location.hostname+"/AlsoViewedLB?"+t.join("&")}else{return}}cpu_win=ta.popups.PopUtil.launchAddHoldingWindow(s)}else{if(ta.has("popunder.popunder_by_self_focus")){window.open("javascript:window.focus()","_self","")}if(Browser.chrome&&(Browser.version>29)&&!ta.has("popunder.popunder_by_flash")){return"chrome_version_too_high"}if(ta.has("popunder.popunder_by_flash")){flashObj={uri:s,name:"CommercePopunder",options:{toolbar:1,location:1,directories:1,status:1,menubar:l,resizable:1,copyhistory:1,scrollbars:d,width:O,height:S,left:M,top:L}}}else{cpu_win=window.open(s,"CommercePopunder","toolbar=1,location=1,directories=1,status=1,menubar="+l+",resizable=1,copyhistory=1,scrollbars="+d+",width="+O+",height="+S+",left="+M+",top="+L)}}var C=1;var c=window.cookieDomain;if(!c){c=""}if(ta.has("popunder.popunder_by_flash")){flashObj.cookieDuration=C;flashObj.cDomain=c;return}if(cpu_win!=null){if(!ta.has("popunder.popunder_by_self_focus")||ta.has("popunder.popunder_by_self_focus_shift_ctrl")){if(ta.has("checkrates.cr_popunder_by_shift_ctrl")&&Browser.version>23){ta.popups.PopUtil.openCloseTab()}else{if(ta.has("checkrates.belligerent_hw")&&Browser.version>22){ta.store("checkrates.popunder",true)}}}var K=N+1;if(!k){ta.popups.PopUtil.trackPopunder(s,K)}if(!k){try{try{if((Browser.firefox&&Browser.version>3.6)||((Browser.chrome&&(Browser.version<17||(Browser.version>20&&Browser.version<23)))&&q=="click")){blurPopunder()}}catch(T){ta.util.error.record(T,"commercePopunder - FF/Chrome did not blur")}cpu_win.opener=self;cpu_win.blur();window.focus();try{if(!Browser.chrome&&!Browser.firefox){cpu_win.moveTo(r+(window.getWidth()-a)/2,o+(window.getHeight()-f)/2);cpu_win.resizeTo(a,f)}}catch(T){ta.util.error.record(T,"commercePopunder - after pop, resize/move")}}catch(T){ta.util.error.record(T,"commercePopunder - after pop",null,{},"WARN")}Cookie.write("CommercePopunder","SuppressAll*"+new Date().getTime(),{domain:c,duration:C})}else{Cookie.write("CommercePopunder","HW"+K,{domain:c,duration:0})}}else{ta.util.error.record(null,"commercePopunder - past rules, no pop",null,{},"WARN");if(q=="unload"){try{if(window.localStorage){localStorage.setItem("CommercePopunder.timeStamp",new Date().getTime())}}catch(T){ta.util.error.record(T,"commercePopunder - localStorage after pop unload fail",null,{},"WARN")}Cookie.write("CommercePopunder","SuppressUnload",{domain:c,duration:C})}}}catch(F){ta.util.error.record(F,"commercePopunder - pop window",J,{type:q})}}catch(T){ta.util.error.record(T,"commercePopunder - general",J,{type:q})}};var cpu_go=function(c,a){var b=cpu_go_impl(c,a);if(false&&document.getElement("#MAIN .poolR")&&b&&!ta.has("popunder.actionrecord")&&(b<4||b>6)){ta.store("popunder.actionrecord",true);new Request({url:"/ActionRecord?action=CPU_block_"+b}).send()}};var cpu_resume=function(){window.cpu_paused=false};var cpu_pause=function(c){var b=new Event(c||window.event);var a=ta.id(b.target);if(!cpu_paused&&a&&(a.get("tag")=="a"||a.getParent("a"))){window.cpu_paused=true;cpu_resume.delay(1000)}};var cpu_run=function(){if(Browser.chrome&&(Browser.version>29)&&!ta.has("popunder.popunder_by_flash")){return}if(window.location.protocol=="https:"&&!ta.retrieve("popunder.https_required")){return}if(ta.has("popunder.popunder_by_flash")){document.addEventListener("mousedown",function(c){try{var a=ta.id("FLASH_CHIP");var b=ta.id(c.target);if(!isFlashEligible(b)||c.which!=1||!a||!b){return}else{setTimeout(1000,function(){if(a){a.dispose()}});a.style.top=(c.pageY-5)+"px";a.style.left=(c.pageX-5)+"px";cpu_go(c,"click")}}catch(c){ta.util.error.record(c,"flash mousedown listener failed")}})}else{window.addEvent("beforeunload",function(a){cpu_go(a,"unload")});if(ta.has("checkrates.belligerent_hw")&&Browser.version>22){document.addEvent("mousedown",cpu_pause)}else{document.addEvent("click",cpu_pause)}if(ta.has("checkrates.belligerent_hw")&&Browser.version>22){document.addEvent("mousedown",function(a){cpu_go(a,"click")});document.addEvent("click",ta.popups.PopUtil.openCloseTab)}else{document.addEvent("click",function(a){cpu_go(a,"click")})}}}}function expandIframe(c,a,b){if(document.getElementById(c)){document.getElementById(c).width=a;document.getElementById(c).height=b}}function collapseAd(c){var a=ta.id(c);if(a==null){return}var b=ta.id(a.parentNode);if(b&&b.hasClass&&b.hasClass("adServer")){b.addClass("taEmpty")}else{ta.util.error.record(null,"ta.common.ads.collapseAd:fail",null,{},"WARN")}}function createAdIframe(d,b,a){var c=document.createElement("iframe");c.setAttribute("id",d);c.setAttribute("name",d);c.setAttribute("height",0);c.setAttribute("width",0);c.setAttribute("scrolling","no");c.setAttribute("border","0");c.setAttribute("marginheight","0");c.setAttribute("marginwidth","0");c.setAttribute("frameBorder","0");c.setAttribute("src","//"+document.location.host+"/"+b+"#"+a);return c}function injectAds(){var d=$$(".adServer .details");if(d.length==0){return}var b="adp/adp.html";if(adpHtml){b=adpHtml}var a=window.documentDomainChanged?"dd+":"";for(var c=0;c<d.length;c++){var e=ta.id(d[c]).getParent(".adInner");if(e&&e.hasClass("deferAd")){continue}var f=d[c].id+"_iframe";if(!ta.id(f)){d[c].getParent().appendChild(createAdIframe(f,b,a+d[c].id))}}}function injectAdsTargeted(a,b){if(!ta.has("p13n.requestAds")||ta.retrieve("p13n.requestAds")){ta.common.ads.injectAdsTargeted(a,b)}}function getIncrementedAdsAjaxCount(){return ta.common.ads.getIncrementedAdsAjaxCount()}window.addEvent("load",function(){if(ta.has("ads.gptEnabled")){window.addEvent("onPopunderBlur",function(){ta.common.ads.resetAdRefreshFlag();ta.common.ads.setLocalStorageTargeting()});if(!ta.has("ads.disableEventRefresh")){window.addEvent("focus",ta.common.ads.refreshAllAdsPolitely);window.addEvent("onOverlayClose",ta.common.ads.refreshAllAdsPolitely);if(ta.has("ads.calendarSelectRefresh")){window.addEvent("onCalendarSelect",function(){if(ta.common.ads.noOverlaysDisplayed()){ta.common.ads.refreshAllAdsPolitely()}})}if(window.pageServlet==="Attractions"){window.addEvent("onAttractionFilterChange",ta.common.ads.refreshAllAds)}if(window.pageServlet==="Restaurants"){window.addEvent("onRestaurantFilterChange",ta.common.ads.refreshAllAds)}if(window.pageServlet==="Search"){window.addEvent("onUpdateSearchResults",ta.common.ads.refreshAllAds)}}if(window.pageServlet==="Hotels"){window.addEvent("onChangeCategory",ta.common.ads.refreshAdsWithType)}if(ta.has("ads.reverseScroll")){if(window.pageServlet==="Hotel_Review"||window.pageServlet==="Attraction_Review"||window.pageServlet==="Restaurant_Review"){window.addEvent("scrollingTabs_Start",ta.common.ads.pauseOnScrollInjection);window.addEvent("scrollingTabs_End",ta.common.ads.resumeOnScrollInjection)}}}else{injectAds.delay(10)}});ta.common.ads=(function(r,k,l,j){var a=0,s=1237,d=0,x=new Date().getTime(),z=10000,m=true,u=false,e=l.util&&l.util.localstorage&&l.util.localstorage.canUseLocalStore(),v=function(B){return typeof B=="string"||typeof B=="number"||typeof B=="boolean"},c="medium_rectangle_bottom",A=function(){var F=k.getWidth,C=k.getHeight,E=100;var B=(typeof F==="function")?Math.floor(F()/E)*E:0;var D=(typeof C==="function")?Math.floor(C()/E)*E:0;B=(B>2000)?9999:B;D=(D>1500)?9999:D;return"w"+B+"_h"+D},b=function(D){var C="WIN_SIZE";if(D&&D.win_size&&D.report){var E=D.report;for(var B=0;B<E.length;B++){if(E[B].indexOf(C)>-1){E[B]=E[B].replace(C,D.win_size);break}}}},o=function(){if(!u){return}l.remove("deferAds.ads");var C=k.getScroll().y;var G=l.retrieve("ads.adStubs");if(G){try{for(var F=0,B=G.length;F<B;F++){var E=G[F];var D=l.id(E.tgt);var I=l.common.ads.getAd(E);if(D&&I&&!I.adInjected&&!I.gutterAd){if(l.has("scrollAd.enableScroll")&&E.type===c){l.common.scrollAd.resetScrollAd()}else{I.injectOnScrollUp=D.getCoordinates().bottom<C}I.injectWhenViewable(false)}}}catch(H){l.util.error.record(H,"error resetting ads after autoScroll")}u=false;if(l.has("scrollAd.enableScroll")){k.fireEvent("scroll")}}},q=function(B){var D=false;try{var F=B.adStub.tgt;if(F.match(/ref\d+/)){var C=parseInt(F.match(/ref(\d+)/)[1],10)+1;D=F.replace(/ref\d+/,"ref"+C)}else{D=F+"-ref1"}}catch(E){l.util.error.record(E,"error building refresh ad id")}return D},g=function(F){try{var G=F.adStub;var B=q(F);if(!B){var C=(F&&F.adElem&&F.adElem.id)?F.adElem.id:null;throw new Error("unable to build refresh ad id for "+C)}G.tgt=B;var J=l.id(F.adElem.cloneNode(false));J.id=G.tgt;J.removeClass("taEmpty");if(J.className.toLowerCase().indexOf("gutterad")==-1){J.set("style","")}var I=l.id(F.adId);var H=I.parentNode;H.replaceChild(J,I);var D=new l.common.ads.TripAd(G);D.addTargeting(F.slotTargeting);D.injectWhenViewable()}catch(E){l.util.error.record(E,"error cloning ad for refresh")}},n=function(){if(!m){return false}var B=new Date().getTime();if(B-x>z){x=B;return true}else{return false}},y=function(){var C=0;if(!l.has("ads.reverseScroll")){return C}if(k.location.hash){var B=r.getElement(k.location.hash);if(B&&B.isVisible()){if(l.has("scrollingTabs.scrollOnPageLoad")){C=l.retrieve("scrollingTabs.scrollOnPageLoad")}else{C=B.getCoordinates().top}}}return C},p=function(B,I,D,L,G){try{if(B&&I&&I.requestStart&&D&&L){var J=50,H=D-I.requestStart,M=Math.floor(H/J)*J,E=new Date().getTime()-I.requestStart,F=Math.floor(E/J)*J,O=I.adId.replace("gpt-ad-","").replace(/-ref\d+/g,""),N=[O,((G)?"ad:y":"ad:n"),B.creativeId],C="recvd_"+M;l.trackEventOnPage("ad_latency",N.join("|"),C,F,true);I.requestStart=null}}catch(K){}},w=function(E){if(E){try{var C=E.slot.getSlotId().getDomId();var B=l.id(C);if(C&&B){var I=l.retrieve("tripads."+C);if(I&&I.requestStart){var D=new Date().getTime();var H=!E.isEmpty&&!B.hasClass("taEmpty");var F=B.getElement("div iframe");if(H&&F){F.addEvent("load",function(){p(E,I,D,new Date().getTime(),H)})}else{p(E,I,D,D,H)}}}}catch(G){}}},h=function(C){try{if(C&&C.slot&&C.creativeId){var B=l.id(C.slot.getSlotId().getDomId());if(B){B.setAttribute("data-creative-id",C.creativeId)}}}catch(D){}},f=function(B){h(B);if(l.has("ads.requestTracking")){w(B)}},t=function(C){if(l.has("scrollAd.enableScroll")){if(C&&C.type&&C.type===c){try{l.common.scrollAd.addScrollHandler()}catch(B){l.util.error.record(B,"error checking for scrolling ad")}}}};return{TripAd:new Class({adBase:null,adElem:null,adId:null,adSizes:[],adInjected:false,refreshWithNewContext:true,requestStart:null,adStub:null,adSlot:null,slotTargeting:{},id:null,type:null,options:{debug:false,collapse:true},Implements:[Options],initialize:function(C,B){try{this.setOptions(B);this.adStub=C;this.adBase=C.base;this.adSizes=C.size;this.adId=C.tgt;this.id=C.tgt;this.type=C.type;this.errorKey="ads.fail."+C.tgt;this.adElem=l.id(this.adId);this.injectOnScrollUp=false;this.injectOnScrollUpReady=false;this.reservedHeight=(this.adElem&&this.adElem.getParent(".ad"))?this.adElem.getParent(".ad").offsetHeight:0;if(!this.adElem){throw new Error("element for ad slot does not exist")}if(!l.has("tripads."+this.adId)){this.adSlot=googletag.defineSlot(C.base,C.size,C.tgt).addService(googletag.pubads()).setCollapseEmptyDiv(this.options.collapse,!this.adStub.isExpanded);if(C.custom_targeting&&C.custom_targeting.companion){this.adSlot.addService(googletag.companionAds())}}else{throw new Error("ad slot has already been created")}if(C.custom_targeting){this.addTargeting(C.custom_targeting)}this.addElementTargeting();l.store("tripads."+this.adId,this)}catch(D){throw new Error("Unable to create TripAd for target "+this.adId+": "+D.message)}},inject:function(C){if(C==false){this.refreshWithNewContext=false}if(this.gutterAd&&!l.common.gutterAd.shouldDisplay()){this.refreshWithNewContext=false}try{if(this.adInjected){var B=l.id(this.adId);if(B){this.adStub.isExpanded=!B.hasClass("taEmpty")&&B.getStyle("display")!="none";B.removeClass("taEmpty");if(this.refreshWithNewContext){googletag.pubads().refresh([this.adSlot]);t(this)}else{this.refresh()}}else{throw new Error("ad refresh fail, elem does not exist: "+this.adId)}}else{googletag.display(this.adId);this.adInjected=true;if(l.has("ads.requestTracking")){this.requestStart=new Date().getTime()}t(this)}}catch(D){if(!l.has(this.errorKey)){l.util.error.record(D,"unable to inject TripAd for target: "+this.adId);l.store(this.errorKey,true)}}},refresh:function(){g(this)},injectWhenViewable:function(B){if(B==false){this.refreshWithNewContext=false}try{if(this.isInView()){this.inject(this.refreshWithNewContext)}else{this.defer()}}catch(C){l.util.error.record(C,"unable to inject/defer TripAd")}},defer:function(){var D=l.retrieve("deferAds.ads")||[];var B=D.length>0;var F=false;if(B){for(var E=0;E<D.length;E++){var C=D[E];if(this.adId==C.adId){F=true;break}}if(!F){D.push(this);l.store("deferAds.ads",D)}}else{D.push(this);l.store("deferAds.ads",D);k.ta_handleAdDefer=l.common.ads.deferAds;k.addEvent("scroll",k.ta_handleAdDefer)}},getPosY:function(){var B=this.adElem;return B.getCoordinates().top},isInView:function(){if(u){return false}if(!l.has("ads.deferEnabled")){return true}var B=k.getScroll().y;if(this.injectOnScrollUp){if(B>=d){this.injectOnScrollUpReady=true}return this.injectOnScrollUpReady&&this.getPosY()+this.reservedHeight>B}else{return this.getPosY()<B+k.getHeight()}},isLeaderboard:function(){return this.adId.indexOf("gpt-ad-728x90")>-1},addElementTargeting:function(){if(this.adElem&&this.adElem.getAttribute("data-targeting")){var C=this.adElem.getAttribute("data-targeting");if(k.JSON&&JSON.parse){try{var B=JSON.parse(C.replace(/'/g,'"'));this.addTargeting(B)}catch(D){l.util.error.record(D,"error applying element ad targeting")}}}},addTargeting:function(C){try{C=this.mergeTargeting(C);this.slotTargeting=C;for(var B in C){this.adSlot.setTargeting(B,C[B])}}catch(D){l.util.error.record(D,"error applying ad slot targeting")}},mergeTargeting:function(H){var D=this.slotTargeting;for(var C in H){if(D[C]==H[C]){continue}if(C=="kw"){D.kw=H.kw;continue}if(C=="proptype"){D.proptype=H.proptype;continue}if(!D[C]){D[C]=H[C]}else{if(v(D[C])){D[C]=[D[C]]}if(v(H[C])){H[C]=[H[C]]}var G=D[C].concat(H[C]);var F=[];for(var B=G.length-1;B>-1;B--){var E=G.pop();if(!F.contains(E)){F.push(E)}}D[C]=F.reverse()}}return D},clearTargeting:function(){this.adSlot.clearTargeting();this.slotTargeting={}},updateHotelStyle:function(C){if(C&&this.adSlot){C=C.toLowerCase();var B={};B.triptype=C;var D=l.common.ads.SEGMENT_MAP[C];if(D){B.seg=D}this.addTargeting(B)}},updateHotelType:function(B){if(B&&this.adSlot){B=B.toLowerCase();var C={};C.proptype=B;var D=l.common.ads.SEGMENT_MAP[B];if(D){C.seg=D}this.addTargeting(C)}},isVisible:function(){return this.adElem.isVisible()}}),injectAjaxAds:function(D,B,C){if(!(k.googletag&&k.googletag.cmd)){l.util.error.record(null,"googletag not defined, unable to inject ads for servlet: "+D+","+B);return}googletag.cmd.push(function(){if(typeof D=="string"){var J="ads."+D.toLowerCase();var E=l.retrieve(J+".adStubs");var G=l.retrieve(J+".pageTargeting");var N=r.getElement(B);if(E&&E.length&&N&&N.id){var M=false;for(var I=0;I<E.length;I++){var H=E[I];if(H&&H.tgt){var F=H.tgt.split("-").slice(0,3).join("-");if(N.id.indexOf(F)>-1){H.tgt=N.id;M=H;break}}}if(M){try{var L=l.common.ads.getAd(M);if(L){if(G){L.addTargeting(G)}L.inject(C)}}catch(K){l.util.error.record(K,"unable to inject ajax ad for: "+M.tgt)}}}}})},getAd:function(H){var F=null;if(H){try{if(H.tgt){var I="tripads."+H.tgt;if(l.has(I)){F=l.retrieve(I);F.adElem=l.id(F.adId)}else{try{F=new l.common.ads.TripAd(H)}catch(G){return null}}}else{var B=l.retrieve("ads.adStubs");if(B){for(var E=0;E<B.length;E++){var D=B[E];if(D.tgt==H){try{F=new l.common.ads.TripAd(D);break}catch(G){return null}}}}}if(l.common.gutterAd){var J=l.id(H.tgt);if(J&&J.hasClass(l.common.gutterAd.adElemClass)&&F){F.gutterAd=true}}}catch(G){var C=(typeof H=="string")?H:H.tgt;l.util.error.record(G,"unable to get ad for id: "+C)}}return F},getIncrementedAdsAjaxCount:function(){return ++a},disableRefresh:function(){m=false},initDoubleClick:function(){var B=r.createElement("script");B.async=true;B.type="text/javascript";var D="https:"==r.location.protocol;B.src=(D?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js";var C=r.getElementsByTagName("script")[0];C.parentNode.insertBefore(B,C);googletag.cmd.push(function(){l.common.ads.addPageTargeting();if(l.has("jwplayerHelper.adUrl")){googletag.pubads().enableVideoAds()}googletag.enableServices();l.common.ads.injectViewable();if(l.has("ads.peelbackEnabled")&&l.id("gpt-peelback")&&l.has("ads.gptBase")){if(r.body.offsetWidth>=s){googletag.defineOutOfPageSlot(l.retrieve("ads.gptBase"),"gpt-peelback").addService(googletag.pubads()).setCollapseEmptyDiv(true);googletag.display("gpt-peelback")}else{l.store("ads.pbSuppress",true)}}googletag.pubads().addEventListener("slotRenderEnded",f);if(l.has("ads.hotels_side_banner")){l.common.gutterAd.init()}else{if(l.has("ads.hotels_side_banner_control_tracking")){l.common.gutterAd.init_justTracking()}}})},addPageTargeting:function(){try{var C=l.retrieve("ads.pageTargeting")||{};C.win_size=A();b(C);for(var B in C){googletag.pubads().setTargeting(B,C[B])}}catch(D){l.util.error.record(D,"GPT init: unable to add page targetiing")}},injectViewable:function(){d=y();var F=l.retrieve("ads.adStubs");if(F&&F.length){for(var E=0;E<F.length;E++){var D=F[E];if(D.tgt){var C=l.id(D.tgt);if(C&&C.hasClass&&!C.hasClass("delayAd")){try{var B=new l.common.ads.TripAd(D);if(l.has("ads.reverseScroll")&&B.getPosY()<d){B.injectOnScrollUp=true}if(B.isInView()){B.inject()}else{B.defer()}}catch(G){l.util.error.record(G,"unable to create TripAd object for "+D.tgt)}}}}}},collapseAd:function(B){if(l.has("ads.gptEnabled")&&B&&B.parentNode){var C=B.parentNode;do{if(C.className&&C.className.indexOf("gptAd")>-1){C.className+=" taEmpty";break}}while(C=C.parentNode)}},injectAdsTargeted:function(E,G){if(E==null||typeof E!="object"){l.util.error.record("ad injection requires target element, element passed is "+typeof E);return}if(l.has("ads.gptEnabled")){var I=E;I.inject(this.refreshWithNewContext);return}var F=E.getElements(".adServer .details");if(F.length==0){return}var C="adp/adp.html";if(adpHtml){C=adpHtml}var B=k.documentDomainChanged?"dd+":"";for(var H=0;H<F.length;H++){var L=F[H].getParent(".adServer");var J=F[H].id+"_iframe";if(l.id(J)){var K=F[H].cloneNode(true);L.empty().grab(K)}var D=createAdIframe(J,C,B+F[H].id);if(G){l.id(D).addEvent("load",G)}L.appendChild(D)}},getMetaContent:function(D){var G=r.getElementsByTagName("meta");for(var C=0;C<G.length;C++){var F=G[C];var B=F.name;var E=new RegExp(D,"i");if(B.match(E)){return F.content.replace(/["<>]/g,"")}}return""},loadMonikersAdcomHelper:function(){var B=l.common.ads.getMetaContent("keywords");var D=l.common.ads.getMetaContent("description");var E=r.location.href;var G=r.referrer;var C="/uvpages/adcom.html?pageRef="+encodeURIComponent(G)+"&keywords="+encodeURIComponent(B)+"&description="+encodeURIComponent(D)+"&pageUrl="+encodeURIComponent(E);var F=r.createElement("iframe");F.setAttribute("width","1");F.setAttribute("height","1");F.setAttribute("src",C);r.body.appendChild(F)},SEGMENT_MAP:{"family-friendly":"fam",trendy:"trendy_hotel",business:"biz",on_the_beach:"beach",ski_in_out:"ski",luxury:"luxury",spa:"spa",casino:"casino"},refreshAdAjax:function(C,B,D,E){new Request({url:"/InjectAdAjax?t="+B+"&adParamKey="+D+"&adParamVal="+E,method:"get",evalScripts:true,onSuccess:function(F){var G=r.getElement(C);if(G){G.empty();G.set("html",F);injectAdsTargeted(G)}else{l.util.error.record(null,"ta.common.ads.refreshAdAjax: target not found")}},onFailure:function(){l.util.error.record(null,"ta.common.ads.refreshAdAjax: request failed")}}).send()},deferAds:function(){var J=l.retrieve("deferAds.ads"),F,G;if(!J){return}try{var I=false;for(F=0,G=J.length;F<G;F++){var E=J[F];if(E&&E.isVisible()&&E.isInView()){injectAdsTargeted(E);I=true;delete J[F]}}if(I){var B=[];for(F=0,G=J.length;F<G;F++){if(typeof J[F]!="undefined"){B.push(J[F])}}if(B.length>0){l.store("deferAds.ads",B)}else{l.remove("deferAds.ads");k.removeEvent("scroll",k.ta_handleAdDefer)}}}catch(H){try{k.removeEvent("scroll",k.ta_handleAdDefer)}catch(H){}var C=(E&&E.id)?E.id:"undefined";var D="ta.common.Ads.deferAds: Error with defer. ad ID: "+C;l.util.error.record(H,D)}},getAdID:function(B){var C=this.getAdIDs(B);return(C&&C[B])?C[B]:null},getAdIDs:function(C){var H=[];var B=l.retrieve("ta.ads.adIDs")||[];var F=(C)?$$("#"+C):$$(".adInner");if(F){for(var E=0;E<F.length;E++){var G=F[E];if(B[G.id]){H[G.id]=B[G.id]}else{var D=this.scrapeAdId(G.id);if(D){H[G.id]=B[G.id]=D}}}}l.store("ta.ads.adIDs",B);return H},scrapeAdId:function(G){var H;var B=/.*\/\w+;(\d{8,});.*/;var K=["noscript","a","iframe","param","script"];var M=false;try{var N=l.id(G);var L=this.getAdServerDiv(N);if(L){for(var E=0;E<K.length;E++){var D=L.getElementsByTagName(K[E]);for(var C=0;C<D.length;C++){var J=(K[E]=="noscript")?D[C].textContent||D[C].innerHTML:D[C].href||D[C].src||D[C].value;if(J&&J.indexOf("doubleclick.net")>0){var F=decodeURIComponent(unescape(J)).match(B);if(F&&F.length>1){H=F[1];M=true;break}}}if(M){break}}}}catch(I){l.util.error.record(I,"ta.common.Ads.scrapeAdId: Error scraping ad ID")}return H},getAdInfo:function(){var C=this.getAdIDs();var D="";for(var B in C){if(C.hasOwnProperty(B)){D+=";"+B+":"+C[B]}}return(D.length)?D.substring(1):D},getAdServerDiv:function(C){C=l.id(C);if(C){if(C.id=="ad728X90"){var D=C.getElement(".details");if(!D){return C.getElement(".adServer")}}var B=C.getElements("iframe");for(var E=0;E<B.length;E++){if(B[E].src.indexOf("adp/adp")>0){var F=B[E].contentDocument||B[E].contentWindow.document;return F.getElementById("adServer")}}}return null},getAdScript:function(E){if(!E){return null}var D=false;var F=/http(s)?:\/\/ad\.doubleclick\.net(\/N\d+)?\/adj.*/;var B=E.getElementsByTagName("script");for(var C=0;C<B.length;C++){var G=B[C];if(G&&G.src&&F.test(G.src)){D=G;break}}if(!D){l.util.error.record(null,"ta.common.Ads.getAdScript: Ad script not found",null,{},"WARN")}return D?D.src:null},getScriptVal:function(E,C){if(E){var D=new RegExp(C+"=([\\w,+,%,-]+)");var B=E.match(D);return(B&&B.length==2)?B[1]:"none"}return"none"},queueForInjection:function(B){if(!(k.googletag&&k.googletag.cmd)){l.util.error.record(null,"googletag not defined, unable to queue ad for injection");return}if(B&&B.each){googletag.cmd.push(function(){B.each(function(C){var D=l.common.ads.getAd(C);if(D){D.injectWhenViewable(false)}})})}},refreshAdTypes:function(B){if(!(k.googletag&&k.googletag.cmd)){l.util.error.record(null,"googletag not defined, unable to refresh ad types");return}try{if(B&&B.length){if(l.has("scrollAd.enableScroll")){if(B.indexOf(c)>-1){l.common.scrollAd.resetScrollAd()}}googletag.cmd.push(function(){var G=l.retrieve("ads.adStubs");if(G){for(var F=0;F<B.length;F++){for(var D=0;D<G.length;D++){var E=G[D];if(B[F]===E.type&&E.tgt&&l.id(E.tgt)){var H=l.common.ads.getAd(E);H.injectWhenViewable(false);break}}}}})}}catch(C){l.util.error.record(C,"unable to refresh ad types")}},resetAdRefreshFlag:function(){x=new Date().getTime()},setLocalStorageTargeting:function(){if(e){if(l.has("ads.gptBase")){localStorage.setItem("ads.storage.gptBase",l.retrieve("ads.gptBase"))}if(l.has("ads.pageTargeting")){localStorage.setItem("ads.storage.pageTargeting",JSON.stringify(l.retrieve("ads.pageTargeting")))}}},getLocalStorageTargeting:function(){var B={};if(e){if(localStorage.getItem("ads.storage.gptBase")){B.gptBase=localStorage.getItem("ads.storage.gptBase")}if(localStorage.getItem("ads.storage.pageTargeting")){B.pageTargeting=JSON.parse(localStorage.getItem("ads.storage.pageTargeting"))}}return B},hasStoredGeo:function(){var B=false;if(e&&localStorage.getItem("ads.storage.pageTargeting")){var C=JSON.parse(localStorage.getItem("ads.storage.pageTargeting"));B=!!C.geo}return B},pauseOnScrollInjection:function(){if(l.has("deferAds.ads")){u=true}},resumeOnScrollInjection:function(){if(l.has("deferAds.ads")){o()}},noOverlaysDisplayed:function(){if(l.overlays&&l.overlays.getCurrent){return typeof l.overlays.getCurrent()==="undefined"}else{return true}},refreshAllAdsPolitely:function(){l.common.ads.refreshAllAds.delay(1)},refreshAllAds:function(){if(!(n()&&k.googletag&&k.googletag.cmd)){return}googletag.cmd.push(function(){try{var B=k.getScroll().y;var F=l.retrieve("ads.adStubs");if(F){googletag.pubads().updateCorrelator();for(var E=0;E<F.length;E++){var D=F[E];var C=l.id(D.tgt);if(C){var H=l.common.ads.getAd(D);if(H&&H.slotTargeting&&H.slotTargeting.disable_event_refresh){continue}else{if(l.has("scrollAd.enableScroll")&&D.type===c){l.common.scrollAd.resetScrollAd()}if(H.adElem.getCoordinates().bottom<B){H.injectOnScrollUp=true}else{H.injectOnScrollUp=false}if(H.gutterAd){H.inject()}else{H.injectWhenViewable(false)}}}}}}catch(G){l.util.error.record(G,"error refreshing all ads")}})},refreshAdsWithStyle:function(B){l.common.ads.refreshAdsWithStyleOrType(B)},refreshAdsWithType:function(B){if(!B){var C=l.retrieve("sel.category");if(C){var D={cat_1:"hotels",cat_2:"bbs_inns",cat_3:"spec_lodge"};B=D[C]}}if(B){l.common.ads.refreshAdsWithStyleOrType(null,B)}},refreshAdsWithStyleOrType:function(D,C){var B=l.id("right_hand_rail")!==null||l.find(".scrollingGutterAd")!==null;if(!D&&!C){return}if(D){D=D.toLowerCase()}if(C){C=C.toLowerCase()}if(l.has("ads.gptEnabled")){if(!(k.googletag&&k.googletag.cmd)){l.util.error.record(null,"googletag not defined, unable to refresh ads for style change");return}try{if(l.has("scrollAd.enableScroll")&&B){l.common.scrollAd.resetScrollAd()}googletag.cmd.push(function(){try{var I=l.retrieve("ads.adStubs");if(I&&I.each){if(B){I.each(function(L){if(L.tgt&&l.id(L.tgt)){var K=l.common.ads.getAd(L);if(K&&!(K.slotTargeting&&K.slotTargeting.kw)){D&&K.updateHotelStyle(D);C&&K.updateHotelType(C);K.injectWhenViewable(false)}}})}else{for(var H=0;H<I.length;H++){var G=I[H];if(G.type==="leaderboard_top"&&l.id(G.tgt)){var F=l.common.ads.getAd(G);if(F&&!(F.slotTargeting&&F.slotTargeting.kw)){D&&F.updateHotelStyle(D);C&&F.updateHotelType(C);F.injectWhenViewable(false);break}}}}}}catch(J){l.util.error.record(J,"unable to refresh ads for style change via googletag")}})}catch(E){l.util.error.record(E,"unable to refresh ads for style change")}return}else{l.util.error.record(null,"Non GPT call to refresh ads for style change")}},refreshSidebarAds:function(){l.common.ads.refreshAdTypes(["medium_rectangle_top","medium_rectangle_bottom"])},refreshSideBarAdsWithRefreshOrdKey:function(){if(l.retrieve("did_ad_refresh")){return}l.store("did_ad_refresh",true);if(l.has("ads.gptEnabled")){var C=l.select(".sidebar .gptAd");var B=r.getElement(".iab_leaBoa .gptAd");if(B){C.push(B)}if(C.length){C.each(function(D){var E=l.retrieve("tripads."+D.id);if(E){E.injectWhenViewable()}})}}else{l.util.error.record(null,"Non GPT call to refresh sidebar ads")}},stringifyTargeting:function(C){var D="";for(var B in C){if(D.length){D+="&"}if(v(C[B])||(typeof C[B]=="object"&&C[B].length)){D+=B+"="+C[B].toString()}}return encodeURIComponent(D)},setMinRefresh:function(B){z=B}}}(document,window,ta));var ta=ta||{};ta.common=ta.common||{};ta.common.ads=ta.common.ads||{};ta.common.ads.remarketingOptions=ta.common.ads.remarketingOptions||{};(function(){var b=function(c){return ta.common.ads.remarketingOptions[c]};var a=ta.util&&ta.util.error?ta.util.error.record:function(){};ta.common.ads.loadMonikers=function(c){try{if(!b("pixelsEnabled")){return null}c=c||{};c.isClickout="0";return ta.common.ads._loadMonikers(c)}catch(d){a(d,"ads.loadMonikers",null,{context:c})}return null};ta.common.ads.loadClickoutMonikers=function(c){try{if(!(b("pixelsEnabled")&&b("clickoutPixelsEnabled"))){return null}c=c||{};c.isClickout="1";return ta.common.ads._loadMonikers(c)}catch(d){a(d,"ads.loadClickoutMonikers",null,{context:c})}return null};ta.common.ads._buildPixelUrl=function(e){if(!b("pixelServlet")){a(null,"ads._buildPixelUrl: remarketing.pixelServlet not set");return null}var f=b("pixelList");if(!f){return null}var c="/"+b("pixelServlet")+"?pixelList="+f;for(var d in e){if(e.hasOwnProperty(d)){c+="&"+d+"="+e[d]}}return c};ta.common.ads._appendMonikersIFrame=function(c){var d=document.createElement("iframe");d.setAttribute("id","Monikers");d.setAttribute("width","1");d.setAttribute("height","1");d.setAttribute("src",c);document.body.appendChild(d);return d};ta.common.ads._loadMonikers=function(g){var j,c,f;try{j=b("pixelContext");if(!j){c=g}else{if(!g){c=j}else{c={};for(f in j){if(j.hasOwnProperty(f)){c[f]=j[f]}}for(f in g){if(g.hasOwnProperty(f)){c[f]=g[f]}}}}var d=ta.common.ads._buildPixelUrl(c);if(!d){return null}return ta.common.ads._appendMonikersIFrame(d)}catch(h){a(h,"ads._loadMonikers",null,{pixelContext:j,extraContext:g})}return null}})();if(typeof ta.common=="undefined"){ta.common={}}ta.common.dmp=function(l,k,f){var d=null,h=null,e=false,c=false,g=function(n){if(n){var o=true;o&=b(n,"getName");o&=b(n,"load");o&=b(n,"setUUID");o&=b(n,"setBehaviors");o&=b(n,"addBehavior");o&=b(n,"send");return o}return false},b=function(o,n){if(o){return typeof o[n]=="function"}else{return false}},j=function(n,o){if(typeof o=="undefined"){o="INFO"}if(o=="ERROR"){f.common.dmp.errorRecord(null,n,null,null,o.toUpperCase())}if(c&&console.log){console.log("[ta.common.dmp] ["+o.toUpperCase()+"] "+n)}},m=function(o,n){if(typeof n=="undefined"||n==null||typeof n=="object"){return o}var p=n.toString();if(p.length){if(o==null||o.length<1){o=p}else{o+="_"+p}}return o},a=function(n){if(f.common.dmp.behaviorTracker&&typeof f.common.dmp.behaviorTracker.isValidGABehavior=="function"){return f.common.dmp.behaviorTracker.isValidGABehavior(n)}return true};return{isEnabled:function(){if(!h){if(f.common.dmp.store){h=f.common.dmp.store.getValue("dmpEnabled")===true}else{h=false}}return h},errorRecord:function(){if(f&&f.util&&f.util.error&&f.util.error.record){f.util.error.record.apply(this,arguments)}},isValidBehavior:function(n){if(f.common.dmp.behaviorTracker&&typeof f.common.dmp.behaviorTracker.isValidBehavior=="function"){return f.common.dmp.behaviorTracker.isValidBehavior(n)}return true},init:function(){try{if(!f.common.dmp.isEnabled()){j("DMP disabled","INFO");return}if(f.common.dmp.behaviorTracker&&typeof f.common.dmp.behaviorTracker.init=="function"){f.common.dmp.behaviorTracker.init()}var o=f.common.dmp.store.getBehaviors();var p=f.common.dmp.store.getActiveDMP();if(p){if(g(p)){d=p;var s=f.common.dmp.store.getValue("taUUID");if(s){d.setUUID(s)}if(c){for(var r in o){for(var q=0;q<o[r].length;q++){j("setting initial behavior "+r+"="+o[r][q])}}}if(o!=null){d.setBehaviors(o)}f.common.dmp.store.clearBehaviors();d.load()}else{var n=(typeof p.getName=="function")?p.getName():"Unknown DMP";j(n+" failed interface sanity check","ERROR")}}e=true}catch(t){j("init failed. "+t,"ERROR")}},addBehavior:function(o,p){try{if(this.isEnabled()&&this.isValidBehavior(p)){if(e&&d){j("addBehavior "+o+"="+p,"DEBUG");d.addBehavior(o,p)}else{j("addBehavior called, but DMP not yet initialized; adding to stored behaviors: "+o+"="+p,"DEBUG");var n=f.common.dmp.store.getBehaviors();if(!n[o]){n[o]=[p]}else{n[o].push(p)}f.common.dmp.store.setBehaviors(n)}}}catch(q){j("addBehavior failed. "+q,"ERROR")}},addBehaviorBatch:function(n,r){if(this.isEnabled()){for(var q in n){if(n.hasOwnProperty(q)){var o=n[q];if(Object.prototype.toString.call(o)==="[object Array]"){for(var p=0;p<o.length;p++){this.addBehavior(q,o[p])}}else{if(typeof o=="string"||typeof o=="number"){this.addBehavior(q,o)}}}}if(r){f.common.dmp.send()}}},addGABehavior:function(q,r,p,v,u){var n=false;try{var s=f.common.dmp.behaviorTracker&&typeof f.common.dmp.behaviorTracker.addDeviceSpecificGABehaviors=="function"&&f.common.dmp.behaviorTracker.addDeviceSpecificGABehaviors(q,r,p,v);if(s){return true}var o=m(null,q);if(q=="p13n_tag"&&r!=null){o=m(o,r.split(":",1)[0])}else{o=m(o,r)}if(!(q=="Attractions"&&p.match(/^\d+$/))){o=m(o,p)}if(!(((q=="Meta_HAC_Filter"&&p=="neighborhood")||q=="FlashPhotoUploader")&&v.match(/^\d+$/))){o=m(o,v)}if(o!=null&&o.length&&a(o)){f.common.dmp.addBehavior("GARecord",o);n=true}}catch(t){j("addGABehavior failed. "+t,"ERROR")}return n},sendGABehavior:function(o,s,n,r,q){var p=f.common.dmp.addGABehavior(o,s,n,r,q);if(p){try{f.common.dmp.send()}catch(t){j("Calling ta.common.dmp.send failed in sendGABehavior. "+t,"ERROR")}}},sendEventBehavior:function(q,s,p,r,o){if(f.common.dmp&&typeof f.common.dmp.behaviorTracker.addEventBehavior=="function"){var n=f.common.dmp.behaviorTracker.addEventBehavior(q,s,p,r,o);if(n){f.common.dmp.send()}}},send:function(){try{if(f.common.dmp.isEnabled()&&e&&d){j("send behaviors","DEBUG");d.send()}}catch(n){j("send failed. "+n,"ERROR")}},sendAjaxBehavior:function(n,o){if(typeof n=="string"&&n.length>0&&o!=null){f.common.dmp.addBehavior(n,o);f.common.dmp.send()}},log:j}}(document,window,ta);ta.common.dmp.bluekai=(function(s,o,p){var z="Bluekai",v=o.bluekaiClientId||17576,r=20645,h=4,g={},n=false,m=null,f=false,w=0,d=false,A=("https:"==s.location.protocol?"https":"http")+"://tags.bkrtx.com/js/bk-coretag.js",k=0,l=s.domain,B=false,b="",x=function(){var E=false;b="";for(var D in g){for(var C=0;C<g[D].length;C++){if(p.common.dmp.isValidBehavior(g[D][C])){q("adding behavior "+D+" = "+g[D][C],"DEBUG");m.bk_addPageCtx(D,g[D][C]);E=true;if(B){b+=(b.length>0?"::":"")+D+"="+g[D][C]}}}}return E},u=function(){if(p.common.dmp.store&&p.common.dmp.store.isMobileDevice()){return r}return v},j=function(){try{if(e("_addSendBehaviors")){var C=x();if(C){if("https:"==s.location.protocol){m.bk_pixel_url="https://tags.bluekai.com/"}m.bk_doJSTag(u(),h);t();if(B){B=false;p.trackEventOnPage("DMPBluekai","internal_tracking",b)}}}else{q("Bluekai._addSendBehaviors couldn't send. The API isn't accessible (_hasAPILoaded returned false) even though _loaded = "+d,"WARN")}}catch(D){q("Bluekai._addSendBehaviors general exception: "+D,"ERROR")}},c=function(){return n!==false},t=function(){g={}},q=function(D,E){try{if(typeof E=="undefined"){E="DEBUG"}if(console.log&&f){console.log("[ta.common.dmp.bluekai] ["+E+"] "+D)}if(E!="DEBUG"){p.common.dmp.errorRecord(null,D,null,null,E.toUpperCase())}}catch(C){}},e=function(D){if(!m){if(s.getElementById("BK_CONTAINER")&&s.getElementById("BK_CONTAINER").contentWindow){m=s.getElementById("BK_CONTAINER").contentWindow}}var C="";if(D&&typeof D=="string"){C=D+" -> "}C=C+"Bluekai._hasAPILoaded returned false ";if(!s.getElementById("BK_CONTAINER")){q(C+"- iframe element has not created","WARN");return false}else{if(!s.getElementById("BK_CONTAINER").contentWindow){q(C+"- the iframe contentWindow returned null","WARN");return false}else{if(!m){q(C+"- BK iframe container is not yet initialised","WARN");return false}else{if(typeof m.bk_addPageCtx!="function"){q(C+"- BK API bk_addPageCtx function is not found","WARN");return false}else{if(typeof m.bk_doJSTag!="function"){q(C+"- BK API bk_doJSTag function is not found","WARN");return false}else{return true}}}}}},y=function(){try{var D=false;if(o.ta&&p.common.dmp.store){D=p.common.dmp.store.getValue("dmpPerfLoggingEnabled")===true}if(D&&w>0){q("Bluekai loaded in "+(new Date().getTime()-w)+" ms.","INFO")}}catch(C){}},a=function(){return p.common.dmp.store&&p.common.dmp.store.getValue("dmpMeasureTest")};return{getName:function(){return z},load:function(){try{f=p.common.dmp.store&&p.common.dmp.store.getValue("dmpConsoleDebugEnabled");q("loading Bluekai API","DEBUG");var C='<script type="text/javascript" src="'+A+'"><\/script>';var G='<iframe name="__bkframe" height="0" width="0" frameborder="0" src="javascript:void(0)"></iframe>';var D='<script type="text/javascript"> if( top.ta && top.ta.common &&  top.ta.common.dmp && top.ta.common.dmp.bluekai){   if(top.ta.common.dmp.bluekai.shouldIframeDomainBeSet()) {    document.domain = top.ta.common.dmp.bluekai.getParentPageDomain();  }  top.ta.common.dmp.bluekai.sendAfterLoad(); }<\/script>';var E=s.createElement("iframe");E.id="BK_CONTAINER";E.src="javascript:'<html><head>"+C+"</head><body>"+G+D+"</body></html>'";E.width=0;E.height=0;E.frameBorder=0;E.title="";E.role="presentation";w=new Date().getTime();s.body.appendChild(E);m=E.contentWindow}catch(F){q("Bluekai.load general exception. Failed to load API. "+F,"ERROR")}},shouldIframeDomainBeSet:function(){try{m.document&&typeof m.bk_addPageCtx=="function"}catch(C){return true}return false},getParentPageDomain:function(){return l},setUUID:function(C){n=C},setBehaviors:function(C){g=C||{}},addBehavior:function(C,D){if(!g[C]){g[C]=[D]}else{g[C].push(D)}},sendAfterLoad:function(){try{if(e("sendAfterLoad")){y();d=true;if(k>0){q("Bluekai API successfully loaded after "+k+" retries.","WARN")}q("sending initial behaviors","DEBUG");m.bk_addPageCtx("__bk_l",s.location.href);if(c()){q("sending UUID: "+n,"DEBUG");m.bk_addPageCtx("uuid",n)}m.bk_allow_multiple_calls=true;if(p.common.dmp.store&&p.common.dmp.store.getValue("dmpBlueKaiEnableMultipleIframes")){m.bk_use_multiple_iframes=true}m.bk_ignore_meta=true;B=a();j()}else{k++;if(k<=3){o.setTimeout(p.common.dmp.bluekai.sendAfterLoad,(200*k))}else{q("Bluekai API failed to load after 3 retries. Giving up.","WARN")}}}catch(C){q("Bluekai.sendAfterLoad general exception: "+C,"ERROR")}B=false},send:function(){if(d){j()}}}}(document,window,ta));ta.common.dmp.store=(function(){var a={};var b={};var d=null;var c=false;return{setBehaviors:function(e){a=e||{}},clearBehaviors:function(){a={}},getBehaviors:function(){return a},storeValue:function(e,f){b[e]=f},hasValue:function(e){return typeof b[e]!="undefined"},getValue:function(e){return b[e]},getActiveDMP:function(){return d},setMobileDevice:function(){c=true},isMobileDevice:function(){return c},setActiveDMP:function(e){d=e}}}());ta.common.dmp.behaviorTracker=(function(u,k,l){var B={};var A=[];var C=/^(Meta_Homepage|meta_lightbox|Meta_VP|Meta_LP_CTA|Meta_Micro|Meta_State-Optimized|meta_best_price_cross_sell)/;var a=/^(modules|geo_specific|av_above_fold|hotels_placeholder|AttractionContact|LockUp_Hero|GeoDesc|grid_|photo_photosloaded|pinLander|sampleEmail)/;var v=/^(RestaurantListing|Restaurant_Links_Menu|Restaurant_Links_Update)/;var p=[/^ad_latency/,/^Footer/,/^DATEPICKER_OPEN_DATES/,/^Meta_HAC_Loading/,/single_hotel_detail/,/^(BlueChevron_LP_|Mini_meta_LP)/,/^HAC_HACComplete_/,/^postLinks_/,/^open_info_window/,/^Popup_/,/^social/,/^CommercePopunder/,/^dynamic_large_map_sidebar/,C,a,/^(HoverSave_|Saves_Hover)/,v,/^(Reviews_BLSlideshow|BL_SO|BLSlideshow)/,/(switch_to_.*)+/,/^tourism_engagement_/i,/^tourism_modules_/i,/datepicker/i,/^reviews_(?!expand$)/i,/carousel/,/^price_saver_display_/i,/close/i,/hover/i,/^map_cataloging_map_initialized_unknow_/i,/photo_lb_traveler/i,/^qc_persist_meta_open/i,/impression/i,/smart_deals2013_sd_datebar_/i,/^hotel_review_low_price_message_display/i,/^tab_bar_tabs/i,/^photos_traveler_image/i,/^sur_scrolled_control/i,/^meta_on_photoviewer_isoverlap_true$/i,/screensizerecord_/i,/resize/i,/show_0/i,/^topnav_search_focus$/i,/^meta_on_photoviewer_placementshown$/i,/stinterrupter/i,/^.*-bing$/i,/^.*gmaps3$/i,/test/i,/^non-commerce_property_loaded_non-dated_0$/i,/^attraction_review_rhs_show_0$/i,/unknown/i,/^pypt_search_/i,/^noavailability_xsell_flyout$/i,/^hotelsmetafocuspredates_/i,/^.*hacpollingcomplete/i,/undated/i,/display_0/i,/fblb/i,/^fb_foaf_/i,/^autobroadenhotels_/i,/^rac_result_lafourchette_success_predates$/i,/interrupter/i,/has_dates/i,/no_availability/i,/shown_0/i,/click_0/i,/no_dates/i,/dates_0/i,/cancel/i,/^SortChanged$/,/FILTER_BEDROOM_MAP_VRAC/,/FILTER_PRICE_MAP_VRAC/,/FILTER_AMENITIES_MAP_VRAC/,/LRSuitability_pers_VRAC/,/BookOnline_VRAC/,/VR_PRICEHAT4_SRP/,/PersistInquiryImp_VRR/,/prodp13n/,/HISTORY_INJECT/,/lowest_price/,/leavebehind/i,/leave_behind/i,/owner_reg/,/Oyster/,/PhotosLB_n_more_sites/,/dynamic_large_map/,/list_view_card/,/MAPS_V2/,/float_map/,/Filters_Map/,/Search_Near_Map/,/neighborhood_widget/,/^DMPBluekai_internal_tracking/i];var h=[/^modules\.common\.CityPageRatings/,/^meta_lightbox_open_button/,/^Meta_VP_Submit_Hotels/,/^reviews_travelerphotos/i];var w=[/casino/i,/^ski$/i,/^last_minute$/i,/^biz$/i,/^fam$/i,/^romance$/i,/^golf$/i,/^spa$/i,/^beach$/i,/^natparks$/i,/^theme_park$/i,/^trendy_hotel$/i,/^vaca$/i,/^carrent$/i,/^cruise$/i,/^culture$/i,/^xtend$/i,/^thirty_days$/i,/^budget$/i,/^midlevel$/i,/^luxury$/i,/^suplux$/i,/^review$/i,/^vrpi$/i,/^attrpi$/i,/^hotelspi$/i,/^flightspi$/i,/^bookingpi$/i,/^travelocitypi$/i,/^expediapi$/i,/^hotelscompi$/i,/^pricelinepi$/i,/^cheaptixpi$/i,/^venerepi$/i,/^splendiapi$/i,/^agodapi$/i,/^olotelspi$/i,/^hrspi$/i,/^ebookerspi$/i,/^edreamspi$/i,/^hotelclubpi$/i,/^tcookukpi$/i,/^wotifaupi$/i,/^despegarpi$/i,/^beach_b$/i,/^budget_b$/i,/^luxury_b$/i,/^natparks_b$/i,/^romance_b$/i,/^spa_b$/i];var e=[/photo_lb_photo_photo_scroll/i,/photo.*scroll.*vrr/i];var f=false,z=false;var q=/^\/((Hotel|Restaurant|Attraction)_Review|VacationRentalReview)/i,b=/reviews/i,r=null;var x=function(D){try{for(var E=0;E<h.length;E++){if(h[E].test(D)){return true}}for(E=0;E<p.length;E++){if(p[E].test(D)){o("Blacklisted behavior: "+D,"DEBUG");return false}}}catch(F){o("Error evaluating GARecord behavior blacklists","ERROR")}return true},y=function(D){try{for(var E=0;E<e.length;E++){if(e[E].test(D)){return true}}return false}catch(F){o("Error evaluating GARecord interaval blacklists","ERROR")}},s=function(D){try{if(D&&y(D)){var E=B[D];if(E===undefined){E=0}B[D]=E+1;return(E%5===0)}else{return true}}catch(F){o("Error evaluating whether to send interval behavior to DMP","ERROR")}return true},c=function(){try{if(k.ta&&l.widgets&&l.widgets.calendar&&l.util&&l.util.date){var D=l.widgets.calendar.getPageInDate();if(D){var F=l.util.date.getDaysInRange(new Date(),D)-1;l.common.dmp.addBehavior("Calendar","days_to_trip_"+F);var K=n(D);if(K){l.common.dmp.addBehavior("Calendar","start_"+K)}var L=t(D);if(L){l.common.dmp.addBehavior("Calendar_Month",L)}var I=l.widgets.calendar.getPageOutDate();if(I){var E=l.util.date.getDaysInRange(D,I)-1;l.common.dmp.addBehavior("Calendar","stay_duration_"+E);var G=n(I);if(G){l.common.dmp.addBehavior("Calendar","end_"+G)}var J=t(I);if(J&&J!=L){l.common.dmp.addBehavior("Calendar_Month",J)}}}}}catch(H){o("Error adding calendar behaviors","ERROR")}},t=function(D){var E=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];try{if(D&&D.getMonth()>=0&&D.getMonth()<E.length){return E[D.getMonth()]}}catch(F){o("Error getting month from date "+D,"ERROR")}return"unknown"},n=function(D){var F=["sun","mon","tue","wed","thu","fri","sat"];try{if(D&&D.getDay()>=0&&D.getDay()<F.length){return F[D.getDay()]}}catch(E){o("Error getting day of week from date "+D,"ERROR")}return"unknown"},d=function(E,D){z=E||z;f=D||f;if(z&&f){l.common.dmp.addBehavior("Meta_Click",z+"_rank_"+f);z=false;f=false}},o=function(D,E){if(l.common.dmp&&typeof l.common.dmp.log=="function"){l.common.dmp.log(D,E)}},j=function(){var F=l.find("#REVIEWS .reviewSelector");if(F){var D=F.getCoordinates().top||0;var E=k.getScroll().y;var G=k.getHeight();if(D>0&&(E+(G/2))>=(D)){g("reviews_scrolled",true);clearInterval(r)}}},g=function(G,F){if(!G||!k.location){return}var E=q.exec(k.location.pathname);var D="";if(E&&E.length>=2){D=E[1]}if(D&&D.length>0){l.common.dmp.addBehavior(G,D)}if(F){l.common.dmp.send()}},m=function(){if(k.location){var D=k.location.pathname;var E=k.location.hash;if(D&&q.test(D)){if(E&&b.test(E)){g("reviews_viewed")}else{if(l.common.dmp.store&&l.common.dmp.store.getValue("dmpReviewReadTest")){r=j.periodical(30000)}}}}};return{init:function(){c();m();if(l.common.dmp.store&&l.common.dmp.store.getValue("dmpMetaExposedEnabled")){this.sendMetaExposedTags();k.addEvent("HRHacComplete",this.sendMetaExposedTags)}},isValidBehavior:function(D){try{for(var E=0;E<w.length;E++){if(w[E].test(D)){o("Blacklisted behavior: "+D,"DEBUG");return false}}}catch(F){o("Error evaluating behavior blacklists","ERROR")}return true},isValidGABehavior:function(D){return x(D)&&s(D)},addDeviceSpecificGABehaviors:function(E,G,D,F){if(G=="meta_click"){d(false,F);return true}if(E=="CheckRates"){d(D,false);return true}if(E=="DATEPICKER"&&G=="SELECT"){c();return true}return false},sendMetaExposedTags:function(){if(l.common.dmp.store&&l.common.dmp.store.getValue("dmpMetaExposedEnabled")){var E=/MainCommerce.*\\N:(\d+).*?\\PN:(BookingCom).*?\\F:(\w+)/;try{$$(".impressionTrackingTree").each(function(H){if(H){var G=H.innerHTML;var F=E.exec(G);if(F&&F.length>3){var K=F[2];var I=F[3];var J=F[1];var L=K+"_"+I+"_rank_"+J;if(!A.contains(L)){l.common.dmp.sendAjaxBehavior("Meta_Exposed",L);A.push(L)}}}})}catch(D){o("Error scraping meta exposed data for DMP. "+D,"ERROR")}}}}}(document,window,ta));window.addEvent("load",function(){window.addEvent("scrollingTabs_updateTabBar",ta.common.scrollAd.adjustForPersistentHeader)});ta.common.scrollAd=(function(v,r,t,n){var f=10,B=0,w=[0,250,600],D=null,j=null,q=15,h=q,a=null,s=false,c=null,b=null,C=1000,y=100,k=t.select(".sidebar_ad_parent"),z=k.length>0,x=1000,e=null,A=function(F){if(F){var E=F.getElements(".ad.iab_medRec");a=g(E);if(!a){B++}else{return a.getElement(".adInner")}}return null},g=function(F){for(var E=F.length-1;E>-1;E--){if(F[E].offsetHeight>y){return F[E]}}return null},d=function(){return v.getElement("#BODYCON .gridA .sidebar")||v.getElement("#BODYCON .gridR .sidebar")||v.getElement("#ATTRACTIONS_NARROW .overview_sidebar")},o=function(){if(D&&a){var E=w[Math.round(D.offsetHeight/300)];if(E>0){j=E;if(v.all){a.style.zoom="1";D.style.position="static"}a.addClass("reserveH");a.style.height=E+"px";s=true}}},u=function(E){var H=null;for(var F=0;F<k.length;F++){var G=k[F].getCoordinates();if(E+h>G.top&&E+h+j<G.bottom){H=k[F];break}}return H},m=function(){r.removeEvent("scroll",t.common.scrollAd.handleScroll);if(D&&a){D.removeClass("scrollAd");a.removeClass("reserveH");a.removeProperty("style")}},l=function(F,E){var J=false,G=v.getElement(F),I,H;if(G&&G.getCoordinates&&j!=null&&h!=null&&E!=null){H=G.getCoordinates();if(H!=null){I=H.top;if(I!=null){J=E+j+h>I&&E<I+G.offsetHeight}}}return J},p=function(E){var F=false;F=l("#HSCS.similar_tab_rhr",E);if(!F&&t.retrieve("hr_room_options_iframe")){F=l("#ROOMOPTIONS_TAB",E)}return F};return{handleScroll:function(){try{if(!c){c=v.getElement("#BODYCON .gridA .balance")||v.getElement("#BODYCON .gridR .balance")||v.getElement("#ATTRACTIONS_NARROW .overview_balance")}if(!b){b=d()}if(!(D&&D.id&&t.id(D.id))){D=A(b);if(D){D.setStyle("top",h);o()}}if(D&&b&&c){if(B>f){if(!z){m();return}}var K=c.getCoordinates().bottom;var G=b.getCoordinates().bottom;var I=G-h;var F=K-j-h;var J=K-G-j>0;var E=r.getScroll().y;if(E<F){if(J){if(E>I&&!p(E)){D.addClass("scrollAd");B=0}else{D.removeClass("scrollAd")}}else{B++}}else{if(z&&t.has("ads.contentBlocks")){if(e){var H=e.getCoordinates();if(E<H.top+h||E+h+j>H.bottom){e=u(E)}}else{e=u(E)}if(e&&e.offsetHeight>x){D.addClass("scrollAd")}else{D.removeClass("scrollAd")}}else{D.removeClass("scrollAd");if(!J){B+=f}}}}else{m()}}catch(L){m();t.util.error.record(L,"ta.common.scrollAd:handleScroll")}},adjustForPersistentHeader:function(E){if(E&&parseInt(E.height,10)){h=q+parseInt(E.height,10)}},addScrollHandler:function(){try{setTimeout(function(){r.addEvent("scroll",t.common.scrollAd.handleScroll)},C)}catch(E){t.util.error.record(E,"unable to init scrolling ad")}},resetScrollAd:function(){try{m();D=null;j=null;a=null;c=null;b=null;s=false;B=0}catch(E){t.util.error.record(E,"error resetting scrolling ad")}}}}(document,window,ta));var SocialHistory=function(){var o={f:["http://www.facebook.com/","https://login.facebook.com/login.php","http://www.facebook.com/home.php"]};var l={};function m(t,s,r){if(t.currentStyle){var u=t.currentStyle[r]}else{if(window.getComputedStyle){var u=s.defaultView.getComputedStyle(t,null).getPropertyValue(r)}}return u}function j(r){r.parentNode.removeChild(r)}function p(){var r=document.createElement("iframe");r.style.position="absolute";r.style.visibility="hidden";document.body.appendChild(r);if(r.contentDocument){r.doc=r.contentDocument}else{if(r.contentWindow){r.doc=r.contentWindow.document}}r.doc.open();r.doc.write("<style>");r.doc.write("a{color: #000000; display:none;}");r.doc.write("a:visited {color: #FF0000; display:inline;}");r.doc.write("</style>");r.doc.close();return r}var g=p();function c(s,t){var r=g.doc.createElement("a");r.href=s;r.innerHTML=a;g.doc.body.appendChild(r)}for(var a in o){var n=o[a];for(var h=0;h<n.length;h++){c(n[h],a);if(n[h].match(/www\./)){var e=n[h].replace(/www\./,"");c(e,a)}else{var d=n[h].indexOf("//")+2;var f=n[h].substring(0,d)+"www."+n[h].substring(d);c(f,a)}}}var q=g.doc.body.childNodes;for(var h=0;h<q.length;h++){var k=m(q[h],g.doc,"display");var b=k!="none";if(b){l[q[h].innerHTML]=true}}j(g);return new (function(){var r=[];for(var s in l){r.push(s)}this.visitedSites=function(){return r};this.doesVisit=function(u){if(typeof(o[u])=="undefined"){return -1}return typeof(l[u])!="undefined"};var t=[];for(var s in o){t.push(s)}this.checkedSites=function(){return t}})()};function sniffFacebook(){var d=false;try{var a=SocialHistory();var b=a.visitedSites();if(b[0]=="f"){d=true}}catch(c){}return d}function registerOnLoad(b,a){if(ta&&ta.queueForLoad){ta.queueForLoad(b,a)}else{window.addEvent("load",b)}}function registerOnUnload(a){window.addEvent("unload",a)}function getScrollOffset(){return[window.getScrollLeft(),window.getScrollTop()]}function isIn(h,k,a){var d=getScrollOffset();k=$(k);var g=findPos(k);var e=g[0]-d[0];var j=g[1]-d[1];var c=e+k.clientWidth;var f=j+k.clientHeight;if(a){if(typeof(a)=="number"){e=e-a;j=j-a;c=c+a;f=f+a}else{if(a instanceof Array&&(a.length==2||a.length==4)){j=j-a[0];c=c+a[1];e=e-(a.length==4?a[3]:a[1]);f=f+(a.length==4?a[2]:a[0])}}}return(h[0]>=e&&h[0]<=c&&h[1]>=j&&h[1]<=f)}function setDetails(b,d,a,c){new Event(b).stop();$("title").value=d;$("category").value=a;$("space").value=c;$("newPage").submit()}function setOneTimeCookie(a,b){Cookie.write(a,b,{domain:cookieDomain,time:5});return true}var getChildByClass=function(e,d,c){if(!d||d.length==0){if(c==e.tagName){return e}}else{if(e.className&&(!c||c==e.tagName)){var f=-1;do{f=e.className.indexOf(d,f+1);if(f>=0&&(f==0||e.className.charCodeAt(f-1)==32)&&(f+d.length==e.className.length||e.className.charCodeAt(f+d.length)==32)){return e}}while(f>=0)}}for(var b=0;b<e.childNodes.length;b++){var a=getChildByClass(e.childNodes[b],d,c);if(a){return a}}return null};function showPrivacyPolicy(){window.open("/pages/privacy.html","PrivacyPolicy","toolbar=0,resizable=1,menubar=0,location=0,status=0,scrollbars=3,width=800,height=600,screenX=30,screenY=25,left=30,top=25")}(function(a){a.util||(a.util={});a.util.typeOf=function(b){return Object.prototype.toString.call(b).match(/(\w+)\]$/)[1].toLowerCase()};a.util.merge=function(g){for(var c=1;c<arguments.length;c++){var e=arguments[c];if(!e){continue}g||(g=(a.util.typeOf(e)==="array")?[]:{});for(var b in e){var f=e[b];if(e.hasOwnProperty(b)&&a.util.typeOf(f)!=="undefined"){var d=a.util.typeOf(f);if(d==="string"||d==="number"||d==="boolean"||d==="function"||f===null){g[b]=f;continue}g[b]=a.util.merge(g[b],f)}}}return g}}(ta));(function(a,b){var c=function(e){var d=false;new Request({url:"/AuthCheck",data:{product:e},async:false,method:"get",onSuccess:function(f){if("true"===f.trim()){d=true}}}).send();return d};b.isAuthorized=function(d){return c(d)};b.register=function(f,e){if(f.popup){return a.registration.popup.open(f,e)}var g={servlet:"Register",action:"SIGNIN",data:function(){return{}}};var d=a.retrieve("ta.registration.currentUrlDefaults");f=a.util.merge(g,d,f||{},e||{});if(!f.product){return false}if(c(f.product)){return true}if(f.successAction){a.registration.setSuccessActionCookie(f.successAction)}a.util.post({url:"/"+f.servlet,https:true,data:{product:f.product,action:f.action,url:f.url,urlKey:f.urlKey,partnerKey:f.partnerKey,data:JSON.encode(f.data())}});return false};b.popup={defaultWidth:547,defaultHeight:435,options:null,urloptions:null,isPopup:null,open:function(p,q){a.registration.popup.options=p;a.registration.popup.urloptions=q;var j={servlet:"Register",action:"SIGNIN",data:function(){return{}}};var f=a.retrieve("ta.registration.currentUrlDefaults");p=a.util.merge(j,f,p||{},q||{});if(!p.product){return false}if(c(p.product)){return true}var m=document.location;var l=m.protocol+"//"+m.host;if(m.port){l+=":"+m.port}var e=l.replace("http://","https://")+"/"+p.servlet;var n=[];n.push("popup=true");n.push("product="+p.product);n.push("action="+p.action);n.push("url="+p.url);n.push("urlKey="+p.urlKey);n.push("partnerKey="+p.partnerKey);n.push("data="+JSON.encode(p.data()));e=e+"?"+n.join("&");var g=a.registration.popup.defaultWidth;var o=a.registration.popup.defaultHeight;var h=(screen.width-g)/2;var k=(screen.height-o)/2;var d=window.open(e.toString(),"registration","width="+g+", height="+o+", top="+k+", left="+h+", resizable=yes, scrollbars=yes");if(!d&&!isTabletOnFullSite){a.registration.popup.fallback()}return false},init:function(){if(a.registration.popup.isPopup==null){a.registration.popup.isPopup=isTabletOnFullSite||(window.opener&&window.getSize().x<(a.registration.popup.defaultWidth+150))}if(a.registration.popup.isPopup){var f=a.id("REG_CON");if(f){var e=f.getElement("div.regDlg");if(!e){e=f.getElement("div.whyDlg")}if(e){a.registration.popup.resize(e)}}var d=a.id("SS_SSO");if(d){var g=d.getElement("input[type=button]");if(g){g.addEvent("click",function(){a.registration.popup.resizeTo(980,560,true)})}}}else{window.location="/RegisterDone?fallback=true"}},done:function(e,g){if(window.opener){var f=window.opener;if(f.ta){if(g){a.registration.popup.fallback(true)}else{var d;if(f.ta.registration&&f.ta.registration.popup.options){d=f.ta.registration.popup.options.successAction}if(d){f.ta.registration.runSuccessAction(d)}else{if(e){f.location=e}}a.registration.popup.updateMasthead(a.registration.popup.close)}}else{a.registration.popup.close()}}else{if(e){a.registration.returnTo(e)}}},close:function(){if(window.opener&&window.opener!=window){window.opener=window;window.close()}},updateMasthead:function(j){var f=0;var h=setInterval(function(){f++;var k=a.id("avatarImage");if(h>20||!k||k.get("src")){clearInterval(h);try{if(window.opener&&window.opener.ta){e();g()}}catch(l){a.util.error.record(l,"secure popup - unable to update masthead",null,{},"WARN")}if(j){j()}}},250);var d=function(l){if(l&&window.opener){var k=new Element("div").adopt(l).innerHTML;if(k){l=window.opener.Elements.from(k)}}return l};var e=function(){var l=window.opener.document.getElement("head");var k=a.id("IP_HEADER_CSS");if(l&&k){k=d(k);if(k){l.adopt(k)}}};var g=function(){var k=a.id("USER_PREFS");var l=window.opener.ta.id("USER_PREFS");if(k&&l){k=d(k);if(k){k.replaces(l)}}}},fallback:function(e){var f=window;if(e&&window.opener){f=window.opener}f.focus();if(f.ta&&f.ta.registration){var d=f.ta.registration.popup;if(d.options){d.options.popup=false;f.ta.registration.register(d.options,d.urloptions)}}if(e){a.registration.popup.close()}},resize:function(f){if(f){a.registration.popup.disableScrollBars();var e=f.getScrollSize().x;var d=f.getScrollSize().y;window.onresize=function(){window.onresize=null;var h=e-window.getSize().x+1;var g=d-window.getSize().y+1;if(h!=0||g!=0){window.onresize=function(){window.onresize=null;a.registration.popup.center(e+h,d+g);a.registration.popup.enableScrollBars()};a.registration.popup.resizeBy(h,g)}else{a.registration.popup.enableScrollBars();a.registration.popup.center()}};a.registration.popup.resizeTo(e,d)}},resizeTo:function(f,e,d){if(d){window.onresize=function(){window.onresize=null;a.registration.popup.center()}}window.resizeTo(f,e)},resizeBy:function(f,e,d){if(d){window.onresize=function(){window.onresize=null;a.registration.popup.center()}}window.resizeBy(f,e)},center:function(g,d){if(!g){g=window.getSize().x}if(!d){window.getSize().y}var f=(screen.width-g)/2;var e=(screen.height-d)/2;window.moveTo(f,e);window.focus()},disableScrollBars:function(){window.document.getElement("body").setStyle("overflow","hidden")},enableScrollBars:function(){window.document.getElement("body").setStyle("overflow")}};(function(e,g){var k="1070328450902.apps.googleusercontent.com";var d={cookiepolicy:"single_host_origin",requestvisibleactions:"http://schemas.google.com/AddActivity",clientid:k,client_id:k,immediate:false,apppackagename:"com.tripadvisor.tripadvisor"};var f=0;function j(){e.store("registration.google.avail",true);var l=e.remove("registration.google.onAvail");l&&l.each(function(m){m()})}function h(){if(typeof d.scope==="undefined"){var l=["https://www.googleapis.com/auth/plus.login","https://www.googleapis.com/auth/userinfo.email"];if(e.retrieve("google_wallet_permission_desktop_signin.enabled")){l.push("https://www.googleapis.com/auth/payments.make_payments")}d.scope=l.join(" ")}return d}g.google={init:function(l){if(l){g.google.onAvail(l)}new Asset.javascript("https://plus.google.com/js/client:plusone.js",{onLoad:function(){if(gapi&&gapi.auth){gapi.auth.init(j)}else{var m=setInterval(function(){if(gapi&&gapi.auth){clearInterval(m);gapi.auth.init(j)}},100)}}})},onAvail:function(l){if(e.retrieve("registration.google.avail")){l()}else{e.keep("registration.google.onAvail",l)}},connect:function(l){if(l){f=l}if(typeof gapi=="undefined"){e.registration.google.init(e.registration.google.connect)}else{if(!e.has("google.sso.sending")){e.store("google.sso.sending",true);gapi.auth.signIn(Object.merge({callback:function(n){if(n&&n.status&&n.status.signed_in&&n.access_token){if(!e.has("google.sso.receiving")){e.remove("google.sso.sending");e.store("google.sso.receiving",true);var m="/GoogleRegistration?token="+n.access_token+"&pid="+f;new Request.JSON({url:m,method:"get",onSuccess:function(o){e.remove("google.sso.receiving");if(o.success){if(o.created){e.overlays.registration.connect({flow:"MASTHEAD"},"GOOGLE_SIGNUP")}else{if(o.connected){e.overlays.registration.request("GOOGLE_THANKS",{token:n.access_token})}else{e.overlays.registration.cancel()}}}},onError:function(){e.remove("google.sso.receiving")},onFailure:function(){e.remove("google.sso.receiving")}}).send()}}}},h()))}}},ifConnected:function(m,l){if(gapi&&gapi.auth){gapi.auth.authorize({client_id:k,immediate:true,scope:h().scope.split(" ")},function(o){if(o&&o.status&&o.status.signed_in){var n="/GoogleRegistration?token="+o.access_token+"&verify=true";var p=e.retrieve("google.sso.returnTo");if(p){n+="&returnTo="+p}new Request.JSON({url:n,method:"get",onSuccess:function(q){if(q.success&&m){m()}else{if(l){l()}}},onFailure:l}).send()}else{if(l){l()}}})}else{l()}},ifLoggedIn:function(n,l){if(typeof gapi!="undefined"&&gapi.auth){var m={client_id:k,session_state:null};gapi.auth.checkSessionState(m,function(o){if(o===false){n()}else{if(l){l()}}})}},disconnect:function(){if(typeof gapi=="undefined"){e.registration.google.init(e.registration.google.disconnect)}else{gapi.auth.authorize(h(),function(l){if(l&&l.access_token){new Request.JSONP({url:"https://accounts.google.com/o/oauth2/revoke?token="+l.access_token,method:"get",onSuccess:function(){e.overlays.registration.post({action:"GOOGLE_DISCONNECT"})}}).send()}})}}}})(a,b);(function(f,h){var e=4194307;var j=656;var g=382;var d=null;h.vkontakte={connect:function(l,q,m){if(l){new Request({url:"/ActionRecord?action=vkAuthAttempt&pid="+l}).send()}if(f.retrieve("vk.sso.clicked")&&d&&d.window){d.window.close();f.store("vk.sso.clicked",false)}if(!f.retrieve("vk.sso.clicked")){f.store("vk.sso.clicked",true);var p=(screen.height-g)/2;var k=(screen.width-j)/2;var o="https://oauth.vk.com/authorize?client_id="+m+"&scope="+e+"&redirect_uri=https%3A%2F%2F"+location.hostname+"%2FVKRegistration";if(q){o+="Masthead"}d=window.open(o,"registration","width="+j+", height="+g+", top="+p+", left="+k+", resizable=yes, scrollbars=yes");if(!d){f.store("vk.sso.clicked",false);new Request({url:"/Actionrecord?action=vkAuthPopupBlocked&pid=39094"}).send();if(!q){this.showSSOError(f.retrieve("popupBlockerSSOError"))}}else{var n=setInterval(function(){if(d.closed){clearInterval(n);if(q){document.window.location.reload()}f.store("vk.sso.clicked",false)}},500)}}},registrationSuccess:function(){f.overlays.registration.connect({flow:"MASTHEAD"},"VK_SIGNUP")},loginSuccess:function(){f.overlays.registration.request("SIGNIN")},showSSOError:function(k){f.store("vk.sso.clicked",false);var l=f.id("ssoErrorMessage");if(l){l.removeClass("hidden");l.set("html",k)}},done:function(l,k){try{if(window.opener.ta&&window.opener.ta.retrieve("vk.sso.clicked")){this.performPostAuthAction(l,k)}}catch(m){window.close()}window.close()},doneMasthead:function(){window.close()},performPostAuthAction:function(k,l){var m=window.opener;m.ta.store("vk.sso.clicked",false);if(k){if(m.ta.registration.vkontakte){if(k==="vkLogin"){m.ta.registration.vkontakte.loginSuccess()}else{if(k==="vkSignup"){m.ta.registration.vkontakte.registrationSuccess()}else{if(k==="error"){if(l){m.ta.registration.vkontakte.showSSOError(l)}}}}}}},disconnect:function(){f.overlays.registration.post({action:"VK_DISCONNECT"})}}})(a,b);b.done=function(d,e){if(window.opener){a.registration.popup.done(d,e)}else{a.registration.returnTo(d)}};b.returnTo=function(d){if(window.opener){window.opener.location=d;a.registration.popup.close()}else{window.location=d}};b.runSuccessAction=function(f,h){var j=f.split("|");try{var d=j.slice(1);d.unshift({});d.unshift(j[0]);if(h){d.push(h)}a.run.apply(null,d)}catch(g){a.util.error.record(g,"successAction",null,{funcName:j[0]})}};b.runSuccessActionCookie=function(){var d=a.registration.getSuccessActionCookie();if(d){a.registration.runSuccessAction(d,true)}};b.setSuccessActionCookie=function(d){Cookie.write("successAction",window.pageServlet+"|"+d,{domain:cookieDomain,path:"/"})};b.getSuccessActionCookie=function(){if(window==window.top){var f=Cookie.read("successAction");if(f){var d=f.split("|");var e=d[0];d=d.slice(1);if(window.pageServlet==e){Cookie.dispose("successAction",{domain:cookieDomain,path:"/"});return d.join("|")}}}return};a.queueForLoad(function(){a.registration.runSuccessActionCookie()})}(ta,ta.registration));(function(a){a.util||(a.util={});a.util.post=function(c){if(!c||!c.url||!c.data){return false}c.url=a.util.URL.getAbsoluteUrl(c.url);if(!!c.https){if(c.url.indexOf("http:")===0){c.url=c.url.substring(4,c.url.length);c.url="https"+c.url}}var e=document.createElement("form");e.setAttribute("method","post");e.setAttribute("action",c.url);for(var d in c.data){if(c.data.hasOwnProperty(d)){var b=document.createElement("input");b.setAttribute("type","hidden");b.setAttribute("name",d);b.setAttribute("value",c.data[d]);e.appendChild(b)}}document.body.appendChild(e);e.submit()}}(ta));(function(c){var f={};function h(l,k,j,m){k=k.replace(/\.js$/i,"");f[l+":"+k]={reqs:j,inifunc:m}}function a(j,o,q){o=o.replace(/\.js$/i,"");var n=j[o];if(n){return n}var l=j.widget.name+":"+o;if(q[o]){throw l+" depends on itself recursively"}var m=f[l];if(!m){throw"dependency "+m+" can't be resolved"}q[o]=true;var r=m.reqs;var p=[];for(var k=0;k<r.length;k++){p.push(a(j,r[k],q))}n=m.inifunc.apply({},p);q[o]=false;j[o]=n;return n}function b(k,l){var j=e(k);if(j){return a(j,l,{})}}function g(j){var l,k;if(!j){j=document}j=c.id(j);l=j.getElements(".prw_rup");for(k=0;k<l.length;k++){d(l[k])}l=j.getElements(".prw_dyn");for(k=0;k<l.length;k++){d(l[k])}}function d(n){var l,j,k,m;if(!n){return}if(n._prWidgetContext){return}l=n.getAttribute("data-prwidget-init");if(typeof(l)!="string"){return}k=n.getAttribute("data-prwidget-name");if(!k){return}l=l.match(/[^\s,]+(\s+[^\s,]+)*/g)||[];j={widget:{name:k,element:n,modules:l}};n._prWidgetContext=j;for(m=0;m<l.length;m++){var o=l[m];a(j,o,{})}}function e(l){var k;if(!l){return null}var j=l._prWidgetContext;if(j){return j}k=l;while(k&&!k.hasAttribute("data-prwidget-init")){k=k.parentNode}if(k){j=k._prWidgetContext;if(j){l._prWidgetContext=j;return j}}return}c.prwidgets={define:h,getjs:b,initWidgets:g}})(ta);if(!ta.p13n){ta.p13n={}}ta.p13n.placements=(function(){var a={};var d={};function e(g,h,f,j){h=h.replace(/\.js$/i,"");a[g+":"+h]={reqs:f,inifunc:j}}function c(f,g,n,o){n=n.replace(/\.js$/i,"");var l=f[n];if(l){return l}var j=g+":"+n;if(o[n]){throw j+" depends on itself recursively"}var k=a[g+":"+n];if(!k){throw"dependency "+k+" can't be resolved"}o[n]=true;var p=k.reqs;var m=[];for(var h=0;h<p.length;h++){m.push(c(f,g,p[h],o))}l=k.inifunc.apply({},m);o[n]=false;f[n]=l;return l}function b(j,k,h){k=k.replace(/\.js$/i,"");var f=h.id;var g=d[f];if(!g){g={placement:h};d[f]=g;h.prepareRequestData=function(){return{detail:""+h.location_id,placementName:h.name,servletClass:h.servletClass}};h.requestAJAXPlacement=function(o,l,n){var m=h.prepareRequestData();if(n){m=Object.merge(m,n)}new Request({url:"/MetaPlacementAjax",data:m,evalScripts:true,onSuccess:o,onFailure:function(){ta.util.error.record(null,h.name+" load - MetaPlacementAjax request failed");if(l){l()}}}).send()}}return c(g,j,k,{})}return{define:e,load:b}})();(function(){Fx.Scroll=new Class({Extends:Fx,options:{offset:{x:0,y:0},wheelStops:true},initialize:function(c,b){this.element=this.subject=document.id(c);this.parent(b);if(typeOf(this.element)!="element"){this.element=document.id(this.element.getDocument().body)}if(this.options.wheelStops){var d=this.element,e=this.cancel.pass(false,this);this.addEvent("start",function(){d.addEvent("mousewheel",e)},true);this.addEvent("complete",function(){d.removeEvent("mousewheel",e)},true)}},set:function(){var b=Array.flatten(arguments);if(Browser.firefox){b=[Math.round(b[0]),Math.round(b[1])]}this.element.scrollTo(b[0],b[1])},compute:function(d,c,b){return[0,1].map(function(e){return Fx.compute(d[e],c[e],b)})},start:function(c,d){if(!this.check(c,d)){return this}var b=this.element.getScroll();return this.parent([b.x,b.y],[c,d])},calculateScroll:function(g,f){var d=this.element,b=d.getScrollSize(),h=d.getScroll(),k=d.getSize(),c=this.options.offset,j={x:g,y:f};for(var e in j){if(!j[e]&&j[e]!==0){j[e]=h[e]}if(typeOf(j[e])!="number"){j[e]=b[e]-k[e]}j[e]+=c[e]}return[j.x,j.y]},toTop:function(){return this.start.apply(this,this.calculateScroll(false,0))},toLeft:function(){return this.start.apply(this,this.calculateScroll(0,false))},toRight:function(){return this.start.apply(this,this.calculateScroll("right",false))},toBottom:function(){return this.start.apply(this,this.calculateScroll(false,"bottom"))},toElement:function(d){var c=document.id(d).getPosition(this.element),b=a(this.element)?{x:0,y:0}:this.element.getScroll();return this.start.apply(this,this.calculateScroll(c.x+b.x,c.y+b.y))},scrollIntoView:function(d,g,e){g=g?Array.from(g):["x","y"];d=document.id(d);var j={},f=d.getPosition(this.element),k=d.getSize(),h=this.element.getScroll(),b=this.element.getSize(),c={x:f.x+k.x,y:f.y+k.y};["x","y"].each(function(l){if(g.contains(l)){if(c[l]>h[l]+b[l]){j[l]=c[l]-b[l]}if(f[l]<h[l]){j[l]=f[l]}}if(j[l]==null){j[l]=h[l]}if(e&&e[l]){j[l]=j[l]+e[l]}},this);if(j.x!=h.x||j.y!=h.y){this.start(j.x,j.y)}return this},scrollToCenter:function(e,f,h){f=f?Array.from(f):["x","y"];e=document.id(e);var j={},c=e.getPosition(this.element),d=e.getSize(),b=this.element.getScroll(),g=this.element.getSize();["x","y"].each(function(k){if(f.contains(k)){j[k]=c[k]-(g[k]-d[k])/2}if(j[k]==null){j[k]=b[k]}if(h&&h[k]){j[k]=j[k]+h[k]}},this);if(j.x!=b.x||j.y!=b.y){this.start(j.x,j.y)}return this}});function a(b){return(/^(?:body|html)$/i).test(b.tagName)}})();(function(a,c,b,e){c.currencyCodes=["USD","EUR","GBP","CAD","AUD","CHF","JPY","RMB","INR","SEK","BRL","TRY","DKK","MXN","ARS","CLP","COP","NOK","PLN","SGD","THB","KRW","RUB","IDR","TWD","MYR","EGP","PEN","HKD","VEF"];c.lastCompleted=-1;c.requestsSinceCompletedChange=0;c.resultsUpdatedCallback=null;c.resultsUpdated=function(l){var p=b.retrieve("filters.waitDialog"),m;if(c.filterFormUpdates&&parseInt(filterFormUpdates.sequence,10)<=responseSequenceID){c.filterFormUpdates=null;if(p){b.run("ta.overlays.Factory.showFilterWaitOverlay",{},false)}return}else{if(filtersChangedTimeout){c.hacXhrInFlight=false;return}}if(c.filterFormUpdates){c.responseSequenceID=parseInt(filterFormUpdates.sequence,10)}var r=$$(".commerceOverlay");if(r&&r.length>0){for(m=0;m<r.length;m++){var j=r[m];if(j&&j.overlay){j.overlay.hide()}}}var q=new Element("div",{html:l});b.commerce.minimeta.ajax.updateLoadingState(q);if(b.retrieve("hotels.shouldHideClassicPrices")){var k=q.getElements(".classicPrice");k.each(function(s){s.hide()})}l=q.innerHTML;var n=b.id("HAC_RESULTS")||b.id("DEALS");try{if(b.id("DEALS")&&n==b.id("DEALS")){var o=a.createElement("div");o.innerHTML=l;b.id("SDSLCALL").innerHTML="";b.id("AVAILABLEHOTELDEALS").innerHTML="";b.id("UNAVAILABLEHOTELDEALS").innerHTML="";b.servlet.SmartDeals.runScripts(o);for(m=0;m<o.childNodes.length;m++){var g=o.childNodes[m];if(g.id=="SDSLCALL"){b.id("SDSLCALL").innerHTML=g.innerHTML}else{if(g.id=="AVAILABLEHOTELDEALS"){b.id("AVAILABLEHOTELDEALS").innerHTML=g.innerHTML}else{if(g.id=="UNAVAILABLEHOTELDEALS"){b.id("UNAVAILABLEHOTELDEALS").innerHTML=g.innerHTML}}}}b.commerce.metajson.unregisterAll();b.servlet.SmartDeals.registerMiniMetaTargets()}else{n.empty().setContent(l)}var f=b.remove("hac.lazy.callback");if(f){f()}}catch(h){b.util.error.record(h,"hacSmartDeals")}if(typeof behavior!="undefined"){behavior.apply(n)}try{b.servlet.HACSearch.hacPostProcessing()}catch(h){b.util.error.record(h,"hacCallback")}if(c.resultsUpdatedCallback){c.resultsUpdatedCallback()}if(c.pageServlet=="VRACSearch"){b.vr.triggerMapUpdate()}c.filterInProgress=true;updateData();if(b.servlet.HACSearch.filter){b.servlet.HACSearch.filter.update()}if(p){b.run("ta.overlays.Factory.showFilterWaitOverlay",{},false)}c.hacXhrInFlight=false};c.updateFilterCount=function(m,f,g,l,n){var h=a.getElementById(m.id+"_count");if(h){h.innerHTML="("+f+")";var k=n||m.checked||(!g&&(f>0||(m.hasClass("default")&&"rad"!=m.name)||m.hasClass("DAODAO")));h.style.display=l||k?"inline":"none";if(k){m.removeProperty("disabled");m.removeClass("disabled")}else{m.disabled=true;m.addClass("disabled")}var o=b.id(m.id+"_lbl");if(o){o[k?"removeClass":"addClass"]("disabled")}var j=b.id(m.id+"_img_lbl");if(j){if(k){j.className=j.className.replace(/-off$/,"")}else{j.className=!j.className.test(/-off$/)?j.className+"-off":j.className}}}};c.updateFilterStyle=function(f,g){var h=a.getElementById(f.id+"_count");h.style.display=g?"inline":"none";if(g){f.removeProperty("disabled");f.removeStyle("disabled")}else{f.disabled="disabled";f.addStyle("disabled")}b.id(f.id+"_lbl")[g?"removeClass":"addClass"]("disabled")};c.createCheckSet=function(o,m,n,k,g){var l=o+"_"+m;var f=new Element("div",{"class":"chkSet"});var j='<input type="checkbox" id="'+l+'" name="'+l+'" value="'+m+'" />\n';if(g){var h="ta.call('ta.servlet.HACSearch.handleCheckSetClickOnCount', event, this, '"+l+"')";j+='<div class="filterLabel">\n  <label for="'+l+'" id="'+l+'_lbl">\n    <span class="filterLabelLeft">'+n+'</span>\n    <span class="filterClickCount hvrIE6" onclick="'+h+'" id="'+l+'_count">\n('+k+")</span>\n  </label></div>"}else{j+='<label for="'+l+'" id="'+l+'_lbl">\n  '+n+' <span id="'+l+'_count">\n('+k+")</span></label>\n"}f.innerHTML=j;return f};c.hideTitlePins=function(){var f=$$("div.nmbrIcon");if(f){f.addClass("suppress")}};c.showTitlePins=function(){var f=$$("div.nmbrIcon");if(f){f.removeClass("suppress")}};c.updateData=function(){try{if(b.isHotelsRedesign2011()||b.isSmartDealsFilters()||(b.hac.filters.style&&b.hac.filters.style.getVersion()>=2)){b.pages.hac.updateHACData();if(b.isMetaHotels2013()){b.servlet.HACSearch.loadAnimatedDateCTA()}}else{if(!b.retrieve("isVR")){if(b.hac.legacy){b.hac.legacy.updateData()}else{var g=b.retrieve("ta.hac_legacy_js");if(g){Asset.javascript(g,{onload:function(){b.hac.legacy.updateData()}})}else{b.util.error.record(null,"No legacy hac js loaded")}}}}}catch(f){b.util.error.record(f,"hac.updateData")}};c.filterSequenceID=-1;c.responseSequenceID=-1;c.filterInProgress=true;c.hacXhrInFlight=false;c.getHACFormURL=function(){var f;var g=c.pageServlet;var h=g=="Hotels";if(b.servlet.Hotel){h=b.servlet.Hotel.isHotelsServlet(h)}if(g=="LastMinute"){f="/LastMinute";return f+"?"}if(h||g=="LianSuo"||g=="Hotel_Review"){f="/HACSearch"}else{if(g=="VacationRentals"||g=="FeaturedVacationRentals"){f="/VRACSearch"}else{if(g=="LocalMapsRedesign"){f="/HACSearch"}else{if(g=="RentalPropertyManager"){f="/RentalPropertyManager"}else{if(g=="DaoDaoCertifiedHotels"){f="/DaoDaoCertifiedHotelsSearch"}else{f="/"+c.pageServlet}}}}}if(b.has("hac.filterOffset")){f+="-oa"+b.remove("hac.filterOffset")}if(b.has("useHotelsFilterState")&&f.contains("/HACSearch")){f=f.replace("/HACSearch","/Hotels")}return f+"?"};c.buildHACFormFromScratch=function(){var f=b.commerce.meta.buildHACSearchData();var g=new Element("form",{id:"HAC_FORM_ORIGINAL"});g.adopt(new Element("input",{name:"geo",value:f.geo}));g.adopt(new Element("input",{"class":"day",name:"inDay",value:f.inDateOfMonth}));g.adopt(new Element("input",{"class":"month",name:"inMonth",value:f.inMonthYear}));g.adopt(new Element("input",{"class":"day",name:"outDay",value:f.outDateOfMonth}));g.adopt(new Element("input",{"class":"month",name:"outMonth",value:f.outMonthYear}));return g};c.getHACFormData=function(p,q){var g;if(q){g=b.id(q)}else{g=b.id("HAC_FORM")}var y=[];if(!p&&b.id("HAC_FORM")==g&&b.id("HAC_FORM_ORIGINAL")){var v=g;g=b.id("HAC_FORM_ORIGINAL");if((v.searchAll.type=="checkbox"&&v.searchAll.checked)||v.searchAll.type!="checkbox"){y.push({searchAll:v.searchAll.value})}}if(!b.retrieve("isDaoDao")){if(!g){g=buildHACFormFromScratch()}}if(g){y.push(g)}if(g==b.id("HAC_FORM")&&b.id("TAB_FILTER_CONTROLS")){y.push(b.id("TAB_FILTER_CONTROLS"))}var k=b.retrieve("neighborhoodOverlayForm");if(k){y.push(k)}if(b.has("sel.category")){var l={};l[b.retrieve("sel.category")]=1;y.push(l)}if(b.has("use_avail_toggle_daodao")&&b.retrieve("use_avail_toggle_daodao")){var o=false;var u=$$("#hacFilterCheckbox")[0];if(typeof u!="undefined"&&u!=null){o=u.checked}y.push({availableOnly:o})}if(b.has("xnear_conditional")){y.push({xnear:b.retrieve("xnear_conditional")})}if(b.has("maps.offersOnly")){y.push({zdl:"1"})}var w=b.id("TAB_CONTAINER");if(w){var t=w.getElements("h2");for(var s=0;s<t.length;s++){if(t[s].hasClass("current")){Cookie.writeSession("TVS",s);break}}}if(b.has("hac.filters.style.options")&&b.retrieve("hac.filters.style.options")!="reset"){y.push(b.retrieve("hac.filters.style.options"))}if(p){if(g&&g.geo.value==modelLocId){y.push(b.id("HOTEL_FILTERS"))}else{if(!g){var h=b.id("HOTEL_FILTERS");if(h.geo.value==modelLocId){y.push(h)}}}return y}y.push(b.id("HOTEL_FILTERS"));var n=b.id("POI_MARKERS");if(n){y.push(n)}var j=b.id("TAB_FILTER_CONTROLS");if(j){y.push(j)}if(b.has("addSponsorship")){y.push({addSponsorship:b.retrieve("addSponsorship")})}if(b.has("addSponsorshipToggle")){y.push({addSponsorshipToggle:b.remove("addSponsorshipToggle")})}if(b.has("maps.sponsors")&&b.retrieve("maps.sponsors").join){y.push({sponsors:b.retrieve("maps.sponsors").join(",")})}filterSequenceID++;y.push({seen:0,sequence:filterSequenceID});var x=b.retrieve("maps.map");if(x&&(x.getMorphIndex||b.has("maps.is_open"))&&!b.retrieve("map.poi.changed")){y.push({mc:x.mapCenter().toUrlValue(),mz:x.getZoom()});if((x.getMorphIndex&&x.getMorphIndex()==1)||b.has("maps.is_open")){y.push({map_open:1})}if(b.retrieve("maps.userMove")){y.push({mup:true})}}if(b.has("hac.sortChanged")){var r=b.retrieve("hac.sortChanged");y.push({sortOrder:r})}if(b.has("map.poi")){y.push({poi:b.retrieve("map.poi")})}if(b.has("map.poi.changed")){y.push({newpoi:1});b.remove("map.poi.changed")}var m=b.retrieve("topvalue.state");if(m){if(m===0){y.push({tvState:"collapsed"})}}if(b.has("zft")){y.push({zft:b.retrieve("zft").join(",")})}if(b.has("lma")){y.push({lma:b.remove("lma")})}if(b.has("sel.nearby")){y.push({selNearby:b.remove("sel.nearby").join(",")})}if(b.has("sel.neighborhood")&&!b.isSmartDealsFilters()){y.push({selNeighborhood:b.remove("sel.neighborhood").join(",")})}if(updateResults.continuation){y.push({timed:true});updateResults.continuation=false}else{c.requestsSinceCompletedChange=0;c.lastCompleted=-1}var f=c.pageServlet;if(f){y.push({requestingServlet:f})}if(b.has("hacform.data")){y.push(b.remove("hacform.data"))}return y};c.updateResults=function(f){var g=b.id("HAC_FORM");if(!g){g=b.id("VRAC_FORM")}updateResultsFromForm(f,g)};c.updateResultsFromForm=function(g,f){try{_updateResultsFromForm(g,f)}catch(h){b.util.error.record(h,"hac.updateResultsFromForm")}};c._updateResultsFromForm=function(r,v){var n=null;if(b.servlet.HACSearch.consumeTrackEvent){n=b.servlet.HACSearch.consumeTrackEvent()}var l=c.pageServlet=="Hotels";if(b.servlet.Hotel){l=b.servlet.Hotel.isHotelsServlet(l)}l=l||c.pageServlet=="VacationRentals";if(c.cookieDomain==".daodao.com"){l=false;r=false}if(l&&c.pageServlet=="LastMinute"){l=false}if(b.isHotelsRedesign2011()&&c.pageServlet!="LastMinute"){var x=b.id("HAC_FORM_ORIGINAL");var f=b.id("HAC_FORM");if(!x||!f||!x.inDay||!f.inDay){return}if(x.inDay.value!=f.inDay.value||x.inMonth.value!=f.inMonth.value||x.outDay.value!=f.outDay.value||x.outMonth.value!=f.outMonth.value){r=true}}if(v&&v.name==="VRAC_FORM"){b.vr.clearUnusedDateFields()}if(b.retrieve("hotels.redesignEnabled")){if(b.retrieve("hotels.datesChanged")){r=true}else{r=false}}var s;if(r||c.updateResultsNewPage||l){if(l||c.pageServlet=="LocalMapsRedesign"){b.run("ta.overlays.Factory.showUpdatingMessage")}if(b.servlet.HACSearch.filter){b.servlet.HACSearch.filter.update()}var k=getHACFormURL(),h;if(k.contains("HACSearch")||k.contains("Hotels")){var m=b.servlet.HACSearch.buildHACUrlParamString();if(b.retrieve("hotels.redesignEnabled")&&b.retrieve("hotels.datesChanged")){m=b.commerce.meta.buildMetaHacParamObj()}if(b.has("useHotelsFilterState")){s=getHACFormData(false,v);new Request({url:"/FilterState",data:s,method:"post",onSuccess:function(C){b.widgets.calendar.redirectToHotelOverview(C)},onFailure:function(){b.widgets.calendar.redirectToHotelOverview(null)}}).send()}else{h=k+m+c.location.hash;if(n&&b.setEvtCookie){n.push(h);b.setEvtCookie.apply(this,n)}c.location=h}}else{k=k+getHACFormData(true,v).toQueryString();var B=b.retrieve("maps.map");var o=[];if(B&&B.getMorphIndex&&B.getMorphIndex()==1){o.push("map:S1")}if((B&&b.retrieve("maps.is_open"))||b.has("hac.showLargeMap")){o.push("map:$1")}if(b.has("maps.keep_filters")&&b.retrieve("maps.moved")===true){o.push("mc:S"+B.mapCenter().lat()+"|"+B.mapCenter().lng());o.push("mz:-"+B.getZoom())}if(b.maps.Sidebar){["hotels","restaurants","attractions","coffee","copy","rail","shipping"].each(function(C){if(b.id("sidebar_"+C)&&b.id("sidebar_"+C).checked){o.push("bc_"+C+":-1")}});if(b.has("thDataObj")){var q=b.retrieve("thDataObj");o.push("th_value:S"+q.value);o.push("th_type:S"+q.type);if(q.url){o.push("th_url:S"+q.url.replace(/,/g,"|"))}if(q.name){o.push("th_name:S"+q.name.replace(/,/g,"|"))}if(q.coords){o.push("th_coords:S"+q.coords.replace(/,/g,"|"))}b.maps.Sidebar._clearLocationError()}else{if(b.has("maps.address")){o.push("bc_address:S"+b.retrieve("maps.address"))}if(b.has("map.poi")){o.push("poi:S"+b.retrieve("map.poi").replace(/,/g,"|"))}}var t;if(b.has("maps.airports")){var A=b.retrieve("maps.airports");t=[];A.each(function(C){t.push(C.locId)});o.push("bc_airports:S"+t.join("|"))}if(b.has("maps.conventionCenters")){var j=b.retrieve("maps.conventionCenters");t=[];j.each(function(C){t.push(C.locId)});if(t.length>0){o.push("bc_convention_centers:S"+t.join("|"))}}}var u=b.retrieve("maps_v2_open")&&b.retrieve("mapsv2.map_is_on_vr");if(u){o.push("MAPVIEW")}var g="";if(o.length>0){g="#";for(var w=0;w<o.length-1;w++){g+=o[w]+","}g+=o[o.length-1]}h=k+g;if(n&&b.setEvtCookie){n.push(h);b.setEvtCookie.apply(this,n)}c.location=h}}else{if(filterInProgress){b.run("ta.overlays.Factory.showUpdatingMessage")}c.hacXhrInFlight=true;if(b.servlet.HACSearch.filter){b.servlet.HACSearch.filter.update()}s=getHACFormData(false,v);if(s[0].searchAll&&c.pageServlet=="LocalMapsRedesign"){s[0].searchAll=true}if(c.pageServlet=="LocalMapsRedesign"){s.push({overrideHotelsRe2011:true})}if(b.has("mapProviderFeature.maps_api")&&c.pageServlet=="LocalMapsRedesign"){var z=b.retrieve("mapProviderFeature.maps_api");s.push({mapProviderFeature:z})}var p=null;try{if(n){p={module:n[0],action:n[1],context:n[2],value:n[3]}}}catch(y){b.util.error.record(y,"hac._updateResultsFromForm.trackEventObj",null,n)}new Request({url:getHACFormURL(),data:s,evalScripts:true,trackEvent:p,onSuccess:c.resultsUpdated,onFailure:function(){b.run("ta.overlays.Factory.showFilterWaitOverlay",{},false);if(c.HACProgress){HACProgress.stop()}var C=b.id("UN_HAC_MESSAGE");if(C&&C.removeClass){C.removeClass("suppress")}var D=b.id("HAC_SMRY");if(D){D.show()}}}).send();b.remove("maps.returnTo")}};c.updateResultsInit=function(){c.slidersReady=true;updateResults.time=10;updateData();updateResults.time=3000};c.filtersChangedTimeout=null;c.filtersChanged=function(k,h){var g=(k?$(new Event(k).target):null);if(g&&g.type=="checkbox"){var r=g.getParent("fieldset");var m=r.getElements(".default");var l=r.getElements("input[type=checkbox]");var n=m.contains(g);var p=g.checked;var j=g.id.match(/^zfb_.+/);var f=false;if(n&&p){l.each(function(s){var t=(m.contains(s)?true:false);b.servlet.HACSearch.setCheckSetChecked(s,t)})}else{if(!n&&p){m.each(function(s){b.servlet.HACSearch.setCheckSetChecked(s,false)})}else{if(!p&&m.length>0){var q=false;l.each(function(s){if(s.checked){q=true}});if(!q){m.each(function(s){b.servlet.HACSearch.setCheckSetChecked(s,true)})}if(n&&!p&&!q){f=true}}}}if(j){var o=brandDup(g);if(o){o.checked=g.checked}}if(f){return}}if(hacXhrInFlight){if(c.filtersChangedTimeout){clearTimeout(filtersChangedTimeout);c.filtersChangedTimeout=null}c.filtersChangedTimeout=filtersChanged.delay(1000,[k,h])}else{clearTimeout(filtersChangedTimeout);c.filtersChangedTimeout=null;updateResults(h)}};c.hacGeoChanged=function(g,f){b.id("HAC_FORM").geo.value=f.value};c.hacSortChanged=function(){var f=b.id("SORT_FORM").sortOrder;b.id("HOTEL_FILTERS").sortOrder.value=f.value;filtersChanged()};c.bestValueChanged=function(){var n=b.id("SORT_FORM"),g=b.id("BEST_VALUE_FORM"),l=b.id("HOTEL_FILTERS"),m,h,k,f=function(p,q){var o=q;o=o.replace(/bv_/,"");if(p){o="bv_"+o}return o};if(g){m=g.sortGroup.checked}else{if(l&&l.sortGroup){m=l.sortGroup.checked}else{m=false}}h=n.getElements("option");for(k=0;k<h.length;k++){var j=h[k];j.value=f(m,j.value)}n.sortOrder.value=f(m,n.sortOrder.value)};c.nonHacBestValueChanged=function(){bestValueChanged();b.id("SORT_FORM").submit()};c.hacBestValueChanged=function(){bestValueChanged();hacSortChanged()};c.dupeNav=function(){var k=b.id("REAL_NAV");var f=b.id("FAKE_NAV").addClass("toggle").setProperty("id","TOGGLEME");var h=f.getElement("span.show");var j=k.getElement(".lhnHigh").clone();h.removeEvent("click",dupeNav);f.adopt(j);var g=k.getElement("span.hide").clone().inject(j,"top");h.addEvent("click",toggle.bind(f));g.addEvent("click",toggle.bind(f))};c.brandDup=function(g){if(!g){return null}var f=g.id;if(f.charAt(f.length-1)=="a"){f=f.substring(0,f.length-1)+"i"}else{f=f.substring(0,f.length-1)+"a"}return b.id(f)};c.subBrandSelected=function(){var h=false;var f=b.id("brand_full");if(!f){return false}var g=f.getElements("input[type=checkbox]");g.each(function(j){if(j.checked&&!brandDup(j)){h=true}});return h};c.brandsFull=function(){b.id("brand_initial").setStyle("display","none");b.id("brand_full").setStyle("display","block")};c.clearFilters=function(f){if(f){f.addEvent("click",doClearFilters)}else{doClearFilters()}};var d=pageServlet&&pageServlet!="Hotels";if(b.servlet.Hotel){d=!b.servlet.Hotel.isHotelsServlet(!d)}if(pageServlet&&!d&&pageServlet!="HACSearch"){if(typeof rules=="undefined"){c.rules={}}rules["#HAC_HOTELS form.lightning div.submit"]=function(g){var f=g.getElement("input");var h=g.getElement("span.hvrIE6");if(f&&h){h.addEvent("click",function(){f.click()})}};rules["#LEFTNAV #TOGGLEME .show"]=function(f){f.addEvent("click",function(){new Request({url:"/ActionRecord?action=LHN_EXPANDED"}).send()})};rules["#FAKE_NAV span.show"]=function(f){f.addEvent("click",dupeNav)};rules["#SPONSOR_LIST"]=function(g){var f=b.id("SPR_HTLS_RHS");if(f){f.innerHTML=g.innerHTML}};rules["#RESULT_COUNT span.clear"]=clearFilters;rules[".orphan span.clear"]=clearFilters;rules["#LARGE_MAP span.clear"]=clearFilters}if(typeof linkMap=="undefined"){c.linkMap={}}linkMap.js_HACpager=function(f,k){new Event(k).preventDefault();filterSequenceID++;var h=null;if(b.has("maps.map")&&b.retrieve("maps.moved")){var j=b.retrieve("maps.map");h={mc:j.mapCenter().toUrlValue(),mz:j.getZoom(),mup:true}}c.scrollTo(0,0);var l=b.id("DD_ARROWBAR");if(typeof l!="undefined"&&l!=null){l.hide()}if(filterInProgress){b.run("ta.overlays.Factory.showFilterWaitOverlay",{},true)}var g=f.href;if(c.isIE&&!c.XMLHttpRequest){g=g.replace("http://"+c.location.host,"");g=escape(g)}g=g.replace(/#ACCOM_OVERVIEW/,"");if($(a.body).hasClass("domn_zh_CN")){g=g.replace("Hotels","HACSearch");if(g.contains("LianSuo")&&b.retrieve("daodao.brandId")!=null){g=g.replace(".html",".-zfb"+b.retrieve("daodao.brandId")+".html")}g=g.replace("LianSuo","HACSearch");g=g.replace("DaoDaoCertifiedHotels","DaoDaoCertifiedHotelsSearch");if(b.has("hotels.mapredesign")){h=h||{};h.mapRD=1}}g=g.replace("LocalMaps","HACSearch");new Request({url:g+"?seen=0&sequence="+filterSequenceID,data:h,evalScripts:true,onSuccess:c.resultsUpdated}).send()};c.doClearFilters=function(v){var l=function(){$$("#HOTEL_FILTERS .amenity input[type=checkbox]").each(function(y){b.servlet.HACSearch.setCheckSetChecked(y,false)})},s=function(){$$("#HOTEL_FILTERS .special_amenity input[type=checkbox]").each(function(y){b.servlet.HACSearch.setCheckSetChecked(y,false)})},w=function(){$$("#HOTEL_FILTERS .suitability input[type=checkbox]").each(function(y){b.servlet.HACSearch.setCheckSetChecked(y,false)})};if(v){new Event(v).preventDefault()}var n=false;$$("#HOTEL_FILTERS input.default[type=checkbox], #HOTEL_FILTERS input.default[type=radio]").each(function(y){if(!/^cat/.test(y.name)&&!y.checked){y.click();n=true}});b.servlet.HACSearch.updateFilterLocation(null);$$("#TAB_FILTER_CONTROLS input.default[type=checkbox]").each(function(y){if(!/^cat/.test(y.name)&&!y.checked){y.click();n=true}});var o=b.retrieve("neighborhoodOverlayForm");if(o){o.getElements("input.default[type=checkbox]").each(function(y){if(!/^cat/.test(y.name)&&!y.checked){y.click();n=true}})}var t=b.retrieve("nearbycities.container");$$(t+" fieldset.nearbyCities input[type=checkbox]").each(function(y){if(y.checked){y.click();n=true}});var r=$$("fieldset.nearbyGeos")[0];if(r){r.getElements("input[type=checkbox]").each(function(y){if(!y.hasClass("master")){b.servlet.HACSearch.setCheckSetChecked(y,true)}})}var f=$$("fieldset.childGeos")[0];if(f){f.getElements("input[type=checkbox]").each(function(y){b.servlet.HACSearch.setCheckSetChecked(y,true)})}var g=b.id("unear");if(g){g.value=""}var m=false;["priceSelect","ratingSelect","sleepsSelect","bedroomsSelect","bathroomsAltSelect"].each(function(z){var y=b.id(z);if(y){if(y.slider&&y.slider.resetKnobs()){m=true}else{if(y.hasClass("slider_redesign")){m=b.widgets.slider.resetHooks(y.getParent())}}}});var u=b.retrieve("vrPriceSlider");if(u){u.resetSlider()}var j=b.id("minStay");if(j){j.selectedIndex=0}var k=b.id("bathrooms");if(k){k.selectedIndex=0}var p=b.id("distance");if(p){p.selectedIndex=0}w();l();s();var h=b.id("nameContains");if(h&&h.value&&h.value.length>0){h.value=""}b.remove("maps.offersOnly");var q=b.id("offersOnly");if(q&&q.checked){q.checked=false}var x=b.id("add_location_input_filter");if(x&&x.value&&x.value.length>0){x.value=""}if(b.hac.filters.style){b.hac.filters.style.v2.filterSelect("reset")}if(b.hac.filters.style.getVersion()>=2&&b.hac.filters.style.resetToDefaultTab){b.hac.filters.style.resetToDefaultTab()}filtersChanged();if(!n&&m){sliderMoved()}};c.toggleAccommodationDetails=function(g){var f="#hotel_"+g+" .collapsible";$$(f).each(function(j){var h=j.getStyle("display");j.setStyle("display",((h=="block")?"none":"block"))})};c.makeCouponLink=function(g,h,k,f,j){c.open(j+h+g+f+"&excludeFromVS=false&odc=BLSpecialOfferUrl&d="+k)};c.checkEmailAction=function(h,k,f,g,j){c.location="mailto:"+h+f+j+"?subject="+g;new Request({url:"/ActionRecord?excludeFromVS=false&action=BusinessListingsEmail&d="+k}).send()};c.loadPageMonikers=function(g){if(b.id("Monikers")===e&&(b.id("HAC_FORM")||b.id("HAC_FORM_ORIGINAL"))){var f={geoId:modelGeoId,locIds:g.join(","),servlet:"HACSearch"};c.setTimeout(function(){b.common.ads.loadMonikers(f)},100)}}}(document,window,ta));ta.util.LocationHash=new Class({Implements:Events,VERSION:"02",_data:{},load:function(){var a=window.location.hash.replace(/^#/,"");this.parse(a);this._loaded=true;if(!this.empty()){this.fireEvent("onLoad",this)}return this},has:function(a){return typeof(this._data[a])!=="undefined"},get:function(a){return this._data[a]},set:function(a,b){this._data[a]=b},erase:function(a){delete this._data[a]},save:function(){var d="#"+this.asString();var a=(""+window.location.hash).split(",");var c=d.split(",");if((a.length==c.length)&&(a.length>1)&&(a[0]==c[0])&&(a.slice(2).join(",")==c.slice(2).join(","))){return this}var b=window.location.href;if(window.location.hash){b=b.slice(0,b.indexOf(window.location.hash))}b+=d;window.location.replace(b);return this},empty:function(){return Object.getLength(this._data)==0},parse:function(d){if(d.length<1){return this}var b=d.split(",");var a=(/^0\d+$/.test(b[0]))?parseInt(b.shift()):false;var c=(/^\d+$/.test(b[0]))?b.shift():false;if(c&&!a){return this}Array.each(b,function(h){var g=h.split(":");if(g.length!=2){return}var f=g[1].charAt(0);var e=unescape(decodeURI(g[1].substring(1)));switch(f){case"B":e=(e=="t");break;case"A":e=e.split("|");break;case"S":e=e.replace(/\|/g,",");break;default:break}this.set(g[0],e)},this);return this},asString:function(){var a=[];Object.each(this._data,function(c,b){var d=b+":";switch(typeOf(c)){case"string":d+="S"+c.replace(/,/g,"|");break;case"array":d+="A"+c.join("|");break;case"boolean":d+="B"+(c?"t":"f");break;default:d+="-"+c;break}a.push(d)});return[this.VERSION,new Date().getTime().toString(),a.join(",")].join(",")},loaded:function(){return this._loaded}});ta._locationHash=new ta.util.LocationHash();ta.queueForLoad(ta._locationHash.load.bind(ta._locationHash),1,"LocationHash");ta.util.Saveable=new Class({registerForLocationHash:function(){var a=this;ta._locationHash.addEvent("onLoad",function(){a.restoreOptions(ta._locationHash)});if(ta._locationHash.loaded()&&!ta._locationHash.empty()){this.restoreOptions(ta._locationHash)}},saveOptions:function(){ta._locationHash.save()},setOption:function(a,b){ta._locationHash.set(a,b)},removeOption:function(a){ta._locationHash.erase(a)}});ta.t4b.emailhotel={submitEmailHotelOverlay:function(){new Request({url:"/EmailHotel",onSuccess:function(a){ta.overlays.showInLightbox(a,{style:"dg s4"});if(ta.has("emailOwnerShowCaptcha")){ta.t4b.emailhotel.showRecaptcha()}},data:$("emailOwnerForm"),evalScripts:true}).send()},trackEmailSubmission:function(a){var h=a.detail.value;var g=a.couponId.value;var d;d=(a.isOfferEmail.value==="true");var c=a.rooms.value;var f=a.guests.value;var e,j;if(d){e="SO_EMAIL_SUBMIT";j=h+"|"+g}else{e="BL_EMAIL_SUBMIT";j=h}var b;b=ta.widgets.calendar.hasPageDates();if(b){e=e+"|yes_dates|"+c+"|"+f}else{e=e+"|no_dates|"+c+"|"+f}if(ta.trackEventOnPage){ta.trackEventOnPage("DESKTOP_HOTELREVIEW",e,j)}},clearDefault:function(c){for(var d in c){var b=ta.id(d);var a=c[d];if(b&&b.value==a){b.value=""}}},showRecaptcha:function(){if(typeof Recaptcha!="undefined"){if($(ta.retrieve("emailOwnerCaptchaReference"))){if($("emailOwnerRecaptcha")){$("emailOwnerRecaptcha").innerHTML=""}Recaptcha.create(ta.retrieve("emailOwnerCaptchaKey"),ta.retrieve("emailOwnerCaptchaReference"),{theme:"custom",lang:ta.retrieve("emailOwnerCaptchaLang"),tabindex:0,callback:ta.t4b.emailhotel.reCaptchaCallback})}}else{var b=new Asset.javascript("http://www.google.com/recaptcha/api/js/recaptcha_ajax.js");var a=setInterval(function(){if(typeof Recaptcha!="undefined"){ta.t4b.emailhotel.showRecaptcha();clearInterval(a)}},1000)}},reCaptchaCallback:function(){$("emailOwnerRecaptcha").innerHTML=$(ta.retrieve("emailOwnerCaptchaReference")).innerHTML}};if(!ta.vr){ta.vr={}}ta.vr.hacutils={ROOT_TAG:"VR_TIP_XS",PROPERTY_LIST:"VR_TIP_PROPERTIES",PROPERTY_COUNT_TOP:"tip_prop_count_top",PROPERTY_COUNT_BOTTOM:"tip_prop_count_bottom",tipProperties:{},pidClick:function(a,b,c){ta.util.cookie.setPIDCookie(a);if(c){window.open(b,"_blank")}else{window.location=b}},requestTIPProperties:function(){var a=ta.commerce.meta.buildHACSearchData();if(!a){ta.util.error.record(new Error("Failed to build HACSearchData"),"ta.vr.hacutils.requestTIPProperties",null,{})}else{if(ta.retrieve("requestingTipProperties")){}else{ta.store("requestingTipProperties",true);new Request({url:"/VacationRentalsXSiteAjax",onSuccess:function(b){if(ta.vr.hacutils.tipProperties.haveProperties){ta.vr.hacutils.populateElements(b,ta.vr.hacutils.tipProperties.geoPropCount);ta.store("tipPropertyList",{hacObjUsed:a,geoProperties:ta.vr.hacutils.tipProperties.geoPropCount,propertyCount:ta.vr.hacutils.tipProperties.propertyCount,html:b});ta.store("requestingTipProperties",false)}else{ta.store("tipPropertyList",{hacObjUsed:a,propertyCount:0});ta.store("requestingTipProperties",false)}},onFailure:function(){ta.id(ta.vr.hacutils.ROOT_TAG).hide();ta.store("requestingTipProperties",false)},data:{a:"GET_TIP_PROPERTIES",geo:a.geo,inquiryAdults:a.adults,inDay:a.inDateOfMonth,inMonth:a.inMonthYear,outDay:a.outDateOfMonth,outMonth:a.outMonthYear},evalScripts:true,method:"get"}).send()}}},loadSavedProperties:function(){var a=ta.commerce.meta.buildHACSearchData();var b=ta.retrieve("tipPropertyList");if(!a){ta.util.error.record(new Error("Failed to build HACSearchData"),"ta.vr.hacutils.requestTIPProperties",null,{})}else{if(ta.retrieve("requestingTipProperties")){}else{if(b){if(JSON.stringify(b.hacObjUsed)===JSON.stringify(a)){if(b.propertyCount>0){ta.vr.hacutils.populateElements(b.html,b.geoProperties)}}else{ta.vr.hacutils.requestTIPProperties()}}}}},populateElements:function(c,f){var e,d,b,a;e=ta.id(ta.vr.hacutils.PROPERTY_LIST);d=ta.id(ta.vr.hacutils.PROPERTY_COUNT_TOP);b=ta.id(ta.vr.hacutils.PROPERTY_COUNT_BOTTOM);a=ta.id(ta.vr.hacutils.ROOT_TAG);e.set("html",c);d.set("html",f);b.set("html",f);a.show();ta.vr.hacutils.adjustPriceText()},adjustPriceText:function(){ta.util.element.makeTextFitOneLine(".vr_listing_info .vrPriceInfo .priceBlock .fromPriceData,.vr_listing_info .vrPriceInfo .providerLogo .text")},handleNewDates:function(a){ta.widgets.calendar.justUpdateSessionDates(a)},longStayVrTreatment:function(){if(!ta.vr.hacutils.longStayFeatureEnabled){return}var a=ta.commerce.meta.buildHACSearchData();if(!a){ta.util.error.record(new Error("Failed to build HACSearchData"),"ta.vr.hacutils.longStayVrTreatment",null,{})}else{if(ta.retrieve("requestingLongStayProperties")){}else{var b="longStayHtml";for(var c in a){b+=a[c]}if(ta.has(b)){ta.vr.hacutils.insertLongStayHtml(ta.retrieve(b))}else{ta.vr.hacutils.fetchAndInsertLongStayHtml(a,b)}}}},fetchAndInsertLongStayHtml:function(a,b){ta.store("requestingLongStayProperties",true);new Request({url:"/VacationRentalsXSiteAjax",onSuccess:function(c){if(ta.vr.hacutils.hasLongStayProperty){ta.vr.hacutils.insertLongStayHtml(c)}ta.store(b,c);ta.store("requestingLongStayProperties",false)},onFailure:function(){ta.store("requestingTipProperties",false)},data:{a:"GET_HAC_LONG_STAY_PROPERTIES",geo:a.geo,inquiryAdults:a.adults,inDay:a.inDateOfMonth,inMonth:a.inMonthYear,outDay:a.outDateOfMonth,outMonth:a.outMonthYear},evalScripts:true,method:"get"}).send()},insertLongStayHtml:function(a){var b="VR_LONG_STAY";var d=ta.id(b);if(d){d.set("html",a);ta.vr.hacutils.adjustPriceText();return}var c=ta.select(".listing");var e=null;if(!c||c.length===0){e=ta.id("count_and_sort_div_id")}else{e=c.length>2?c[2]:c[c.length-1]}if(e){new Element("div",{id:b,html:a}).inject(e,"after");ta.vr.hacutils.adjustPriceText()}},swapChildClass:function(b,c,a){if(!b||!b.getChildren()){return}b.getChildren().forEach(function(d){if(d.hasClass(c)){d.removeClass(c);d.addClass(a)}})},photoDataObj:{},fetchingVRPhotos:false,changePhoto:function(b,a){if(ta.vr.hacutils.photoDataObj[b]){ta.vr.hacutils._changePhoto(b,a,ta.vr.hacutils.photoDataObj[b])}else{if(!ta.vr.hacutils.fetchingVRPhotos){ta.vr.hacutils.fetchingVRPhotos=true;new Request.JSON({url:"/VacationRentalsXSiteAjax",data:{a:"GET_PHOTOS",locationId:b},onFailure:function(){ta.vr.hacutils.fetchingVRPhotos=false},onSuccess:function(c){if(c){c.currentIndex=0;ta.vr.hacutils.photoDataObj[b]=c;Asset.images(c.photoUrls);ta.vr.hacutils._changePhoto(b,a,c)}ta.vr.hacutils.fetchingVRPhotos=false}}).send()}}},_changePhoto:function(f,d,b){var a=b.currentIndex+(d?-1:1);if(a>=b.photoUrls.length){a=0}else{if(a<0){a=b.photoUrls.length-1}}b.currentIndex=a;var c=ta.id("vr_img_"+f);if(c){c.src=b.photoUrls[a]}var e=ta.id("overview-photo-count_"+f);if(e){e.innerHTML=a+1}},togglePhotoCountShown:function(c,a){var b=ta.id("photo-count_"+c);if(b){if(a){b.show()}else{b.hide()}}},showPomOverlay:function(b){if(ta.has("vr_pom_overlay")){ta.retrieve("vr_pom_overlay").show()}else{var a={innerDivClass:"vrPomFlyout",content:ta.id("VR_POM_FLYOUT").innerHTML,showCloseButton:false};ta.store("vr_pom_overlay",new ta.overlays.RelativeOverlayLeft(a,b))}},hidePomOverlay:function(){if(ta.has("vr_pom_overlay")){ta.retrieve("vr_pom_overlay").hide()}},actionRecord:function(a){new Request({url:"/ActionRecord?action="+a}).send()}};ta.widgets.ProgressBar=new Class({Implements:[Options,Events],options:{overload:20,delay:100,distance:1,speed:1500,text:".text b",bar:".bar .pcnt",limit:100},initialize:function(b,a){this.setOptions(a);this.ctnr=b;this.text=this.ctnr.getElement(this.options.text);this.bar=this.ctnr.getElement(this.options.bar);this.options.limit=this.options.limit*1;this.overload=this.options.overload/100*this.options.limit},start:function(){this.ctnr.show();if(!this.width){this.bar.setStyle("width","auto");this.width=this.bar.getSize().x;this.bar.setStyle("width",0)}this.current=0;this.max=this.overload;this.timer=this.tick.periodical(this.options.delay,this);return this},stop:function(){clearTimeout(this.timer);this.ctnr.hide();return this},isShowing:function(){return this.ctnr&&this.ctnr.style.display!="none"},update:function(a){this.max=Math.min(this.options.limit,a+this.overload);return this},tick:function(){var b=(this.max-this.current)*this.options.distance;this.current+=(b/this.options.speed)*this.options.delay;var a=this.current/this.options.limit;this.text.set("html",Math.round(a*100));this.bar.setStyle("width",Math.round(this.width*a));return this}});ta.util.Timer=new Class({Implements:[Options,Events],Binds:["start","timerCheck","secondsFromStartTime","stop"],options:{onStop:function(){},startOnInit:true,intervalTiming:1000,timeListeners:{}},oneSecond:1000,initialize:function(a){this.setOptions(a)},start:function(){var a=this;this.timerInterval=window.setInterval(a.timerCheck.bind(a),a.options.intervalTiming);this.startTime=new Date();this.fireEvent("start")},timerCheck:function(){var d=this.secondsFromStartTime();var b=this.options.timeListeners[d+""];if(b&&typeof b[0]!=="undefined"&&b[0]!==null){for(var c=0;c<b.length;c++){var a=b[c];if(a&&typeof a==="function"){a.call(this)}}}},addTimeListener:function(b,c){var a=this.options.timeListeners[c+""];if(!a){a=[]}a.push(b);this.options.timeListeners[c+""]=a},secondsFromStartTime:function(){var a=new Date();return Math.round(Math.abs(this.startTime.getTime()-a.getTime())/this.oneSecond)},stop:function(){if(this.timerInterval){window.clearInterval(this.timerInterval);this.timerInterval=false}this.fireEvent("stop")}});ta.hac.RequestTimer=new Class({Extends:ta.util.Timer,Binds:["startProgressBar","stopTimer","getProgressBar","showLoadingState","addLoadingWhiteBox","removeLoadingLightBox","hacResultsFired","moveNextPriceUp","trackProgress"],options:{progBarOptions:{},progBarContainerSelector:".metaDatePicker",loadingImg:window.CDNHOST+"/img2/generic/site/loading_anim_gry_sml.gif",hourglassImg:window.CDNHOST+"/img2/meta_sprites/iconVisitSite.gif",showProgressBar:false,triggerLoadingState:false,triggerListingsLoadState:false,trackProgress:false,forceResults:true,coverAreaId:"HAC_RESULTS"},initialize:function(a){if(!this.options.onStart){if(!a){a={}}a.onStart=this.startProgressBar}this.parent(a);this.progBarContainers=document.getElements(this.options.progBarContainerSelector);if(this.options.forceResults){this.addTimeListener(this.closeProgressBar,6);this.addTimeListener(this.showHACResults,9);if(ta.retrieve("hotels_urgency_gauge")||ta.retrieve("hotels_urgency_gauge_tracking")){this.addTimeListener(function(){ta.store("showHACResults.broadcastProgress",true);ta.run(ta.commerce.urgencygauge.init)},6)}}this.addTimeListener(this.stopTimer,20);this.start()},startProgressBar:function(){this.showLoadingState();if(this.options.showProgressBar){if(!this.progBars){this.progBars=[]}this.progBarContainers.each(function(a){this.progBars.push(new ta.hac.MetaProgressBar(this.options.progBarOptions,a))}.bind(this))}},stopProgressBar:function(){if(this.progBars&&this.progBars.length){this.progBars.each(function(b){b&&b.stopProgress&&b.stopProgress()})}if(ta.retrieve("hotels_urgency_gauge")){var a=document.getElement(".urgency_gauge .availability");if(a&&a.isDisplayed()){a.addClass("transparent")}}},timerCheck:function(){this.parent();if(!this.stopped){this.trackProgress()}},trackProgress:function(){if(!this.options.trackProgress){return}var a=ta.retrieve("hac.update.complete");var c=ta.retrieve("hac.update.total");if(a&&c){var b=a/c;if(b&&!isNaN(b)){b=b*100;if(!this.trackAttempt&&b==100){return}this.trackAttempt=true;if(b>=70&&!this.seventyPercentTracked){ta.trackEventOnPage("Meta_HAC_Loading","70_percent","progress_bar",this.secondsFromStartTime());this.seventyPercentTracked=true}if(b==100&&!this.oneHundredPercentTracked){ta.trackEventOnPage("Meta_HAC_Loading","100_percent","progress_bar",this.secondsFromStartTime());this.oneHundredPercentTracked=true}}}},getProgressBar:function(){if(!this.progBarContainers.length){return}return this.progBarContainers[0]},closeProgressBar:function(){var a=ta.retrieve("filters.waitDialog");if(a&&a.visible){a.hide()}if(ta.has("hac.progressBar")){ta.retrieve("hac.progressBar").stop()}this.stopProgressBar()},showLoadingState:function(){var b,c,a,e,d;ta.fireEvent("onPageHACLoading");if(!ta.id("HAC_RESULTS")){return}if(this.options.triggerListingsLoadState){b=document.getElements(".js_buildProviderRHS");if(b&&b.length>0){c=this.options.loadingImg;b.each(function(f){f.innerHTML="";a=new Element("img",{src:c,"class":"loading_bubbles_gry",styles:{"padding-top":"3px"}});a.inject(f)})}e=document.getElements(".metaPriceInfo .header:not(.second)");if(e&&e.length>0){e.each(function(f){(new Element("div",{html:'<span class="note">'+ta.retrieve("hotels.loadingPrices")+"</span>","class":"header no_cpu"})).replaces(f)})}e=document.getElements(".metaPriceInfo .header.second");e.each(function(f){f.setStyle("display","none")});if(ta.retrieve("metaUI.isMetaSeeAllDropdown")){d=document.getElements(".metaPriceInfo .seeAll .taLnk");if(d&&d.length>0){d.each(function(f){f.onclick="";f.addClass("disabled")})}}}if(this.options.triggerLoadingState){this.addLoadingWhiteBox()}this.showLoadingStateFired=true},addLoadingWhiteBox:function(){var g=ta.id(this.options.coverAreaId);if(!g){return}var f=g.getCoordinates(ta.id("MAIN"));if(!f){return}var a=ta.id("HAC_FRIEND_SUMMARY_BUBBLE");var e=a&&a.getCoordinates();var d;var h;if(e){d=f.top+e.height+2;h=f.height-e.height-2}else{d=f.top+2;h=f.height-2}this.loadingWhiteBox=new Element("div",{"class":"loadingWhiteBox",styles:{top:d,left:f.left,width:f.width,height:h}});var c=d+50;this.loadingBox=new Element("div",{"class":"hacLoadingBox",html:ta.retrieve("hotels.updatingList")+"<br/>",styles:{top:c,left:f.left+(this.options.calculateCenter?f.width/2-62:250)}});var b=new Element("img",{"class":"hacLoadingBoxImg",src:this.options.loadingImg});if(g.getElement(".hacLoadingBox")){g.getElement(".hacLoadingBox").destroy()}if(g.getElement(".loadingWhiteBox")){g.getElement(".loadingWhiteBox").destroy()}b.inject(this.loadingBox);this.loadingBox.inject(g);this.loadingWhiteBox.inject(g)},removeLoadingLightBox:function(){if(this.loadingWhiteBox){if(this.loadingWhiteBox.destroy){this.loadingWhiteBox.destroy()}else{ta.id(this.loadingWhiteBox).destroy()}this.loadingWhiteBox=false;if(this.loadingBox){if(this.loadingBox.destroy){this.loadingBox.destroy()}else{ta.id(this.loadingBox).destroy()}this.loadingBox=false}}},moveNextPriceUp:function(l,k){var f=l.getElements(".provider");var h=".lowestPrice";var g=k-1;var a=f[g];var j=f[g+1];var b=false;if(j){b=j.hasClass("hidden")}if(a&&a.getElement(h)){return}var e=false;for(var d=g+1;d<f.length;d++){var c=f[d];if(c.getElement(h)){e=c;break}}if(e){e.inject(a,"before");e.removeClass("hidden");if(b){a.addClass("hidden")}}},showHACResults:function(){ta.fireEvent("onPageHACDone");if(!ta.id("HAC_RESULTS")){return}var b=document.getElements(".js_buildProviderRHS .loading_bubbles_gry");if(b){var c=this.options.loadingImg;var a=this.options.hourglassImg;b.each(function(g){var h=ta.id(g);h.src=h.src.replace(c,a)})}var e=document.getElements(".metaPriceInfo .body");if(e&&e.length>0){var f=this.moveNextPriceUp;e.each(function(j){var h=j.getElements(".provider:not(.hidden)").length;for(var g=1;g<=h;g++){f(j,g)}})}var d=document.getElements(".metaPriceInfo .header");if(d&&d.length>0){d.each(function(g){if(g.getElement(".loadingHeader")){new Element("span",{html:ta.retrieve("hotels.checkSites"),"class":"note",styles:{"margin-bottom":"7px"}}).replaces(g)}})}if(this.loadingWhiteBox&&ta.widgets.calendar.hasPageDates()){this.removeLoadingLightBox()}this.showHACResultsFired=true},hacResultsFired:function(){return this.showHACResultsFired},stopTimer:function(){this.stop();this.trackProgress();this.stopProgressBar();this.progBars=[];this.seventyPercentTracked=false;this.oneHundredPercentTracked=false}});ta.hac.MetaProgressBar=new Class({Implements:[Options],Binds:["initProgressBarElement","startProgress","setSearchingDatesText","removeProgressBar"],options:{duration:5,startWidth:1,endWidth:100},initialize:function(a,b){this.setOptions(a);if(!b){if(IS_DEBUG){alert("You must pass progressBarContainer.\n\nUsage:\nnew ta.hac.MetaProgressBar(options, progressBarContainer);")}return}this.progContainer=b;this.initProgressBarElement();this.startProgress()},initProgressBarElement:function(){if(ta.retrieve("progress_bar_full_width")){this.progBar=new Element("div",{"class":"metaProgressBar full_width"});this.progBarWrapper=new Element("div",{"class":"metaProgressBarWrapper full_width"});this.progBarSliderWrapper=new Element("span",{"class":"metaProgressBarSliderWrapper full_width"});this.progBarLabel=new Element("span",{"class":"metaProgressBarLabel full_width",html:this.setSearchingDatesText()});this.progBarSlider=new Element("span",{"class":"metaProgressBarSlider full_width"})}else{this.progBar=new Element("div",{"class":"metaProgressBar"});this.progBarWrapper=new Element("div",{"class":"metaProgressBarWrapper"});this.progBarSliderWrapper=new Element("span",{"class":"metaProgressBarSliderWrapper"});this.progBarLabel=new Element("span",{"class":"metaProgressBarLabel",html:this.setSearchingDatesText()});this.progBarSlider=new Element("span",{"class":"metaProgressBarSlider"})}this.progBarSlider.inject(this.progBarSliderWrapper);this.progBarLabel.inject(this.progBarWrapper);this.progBarSliderWrapper.inject(this.progBarWrapper);this.progBarWrapper.inject(this.progBar);this.progBar.inject(this.progContainer)},startProgress:function(){if(ta.has("guests_rooms_picker_3.enabled")){document.getElements(".stayInfoHeader.inDateTrigger.hotels").setStyle("visibility","hidden")}var a=ta.id("DATE_PICKER_BAR_DECORATIONS");if(a){a.hide()}this.progEffect=new Fx.Tween(this.progBarSlider,{duration:(this.options.duration*1000),unit:"%"});this.progEffect.start("width",this.options.startWidth,this.options.endWidth)},stopProgress:function(){if(this.progEffect){this.progEffect.cancel()}if(this.progBar){if(ta.id(this.progBar).destroy){ta.id(this.progBar).destroy()}else{if(this.progBar.innerHTML){this.progBar.innerHTML=""}}this.progBar=false}if(ta.has("guests_rooms_picker_3.enabled")){document.getElements(".stayInfoHeader.inDateTrigger.hotels").setStyle("visibility","visible")}var a=ta.id("DATE_PICKER_BAR_DECORATIONS");if(a){a.show()}},removeProgressBar:function(){this.stopProgress()},setSearchingDatesText:function(){if(ta.widgets.calendar.hasPageDates()){var b=ta.widgets.calendar.getSingleDateFieldDatesText(ta.widgets.calendar.getPageInDate(),ta.widgets.calendar.getPageOutDate(),ta.widgets.calendar.getDatePickerFormat("meta"));var a=ta.retrieve("multiDP.dateRangeEllipsis");return a.replace("%%%",b)}if(typeof JS_UpdatingYourResults!="undefined"&&JS_UpdatingYourResults){return JS_UpdatingYourResults}return""}});ta.servlet.HACSearch={trackEvent:function(b,d,a,c){if(ta.servlet.HACSearch&&ta.servlet.HACSearch.filter&&ta.servlet.HACSearch.filter._restoringOptions){return}ta.servlet.HACSearch._trackEventData=[b,d,a,c]},consumeTrackEvent:function(){if(!ta.has("hacFilterSaveable")){if(ta.servlet.HACSearch&&ta.servlet.HACSearch.filter&&ta.servlet.HACSearch.filter._restoringOptions){return null}}if(!ta.servlet.HACSearch._trackEventData){return null}var a=ta.servlet.HACSearch._trackEventData;delete ta.servlet.HACSearch._trackEventData;return a},mapMorphed:function(a,d){var f=ta.id(ta.retrieve("maps.container"));if(a==0){if(!d.thumbnailClickHandler){d.thumbnailClickHandler=d.morph.bind(d,1)}f.onclick=d.thumbnailClickHandler;ta.servlet.HACSearch.hideMapSponsor();ta.store("maps.returnTo",{center:d.mapCenter(),zoom:d.getZoom()});ta.id("RESULT_COUNT").setStyle("display","block");ta.id("RESET_MAP").setStyle("display","none");var c=ta.id("IN_RESET_MAP");if(c){c.setStyle("display","none")}d._reset();ta.id("MPZM_ERR").hide();ta.store("maps.moved",false)}else{if(a==1){if(!ta.has("maps.suppressHACActionRecord")){ta.store("lma",ta.servlet.HACSearch.getLoggingName()+"open")}ta.util.pending.lock("maps.nearbyStarted",function(){new Request({url:getHACFormURL(),data:getHACFormData(false).include({nearbyHac:true})}).send()});ta.id("RESULT_COUNT").setStyle("display","none");ta.servlet.HACSearch.showMapSponsor();f.onclick=null;if(ta.has("maps.returnTo")){ta.store("maps.moved",true);var b=ta.remove("maps.returnTo");d.move(b.center.lat(),b.center.lng(),b.zoom);ta.id("RESET_MAP").setStyle("display","block");var c=ta.id("IN_RESET_MAP");if(c){c.setStyle("display","block")}}var e=$$("#LEFTNAV .toggle");if(e&&e[0]){e[0].addClass("off")}}}},hideMapSponsor:function(){var b=ta.id("MAP_SPONSOR");if(b){var a=b.getElement("input[type=checkbox]");if(a&&a.checked){a.click()}b.hide()}},showMapSponsor:function(){var a=ta.id("MAP_SPONSOR");if(a){a.show()}},showMoreMapSponsor:function(f,d){var b=/sponsor_(\w+)/.exec(d.className)[1];var e=ta.id("SPR_HTLS_RHS");var c=ta.id("SPR_HTL_MORE_"+b);var a=ta.id("SPR_HTL_LESS_"+b);if(e){new Request({url:"/ActionRecord?action=sponsor_see_more"}).send();e.getElements(".list_"+b).each(function(g){g.removeClass("hide")})}if(c&&a){c.hide();a.show()}},showLessMapSponsor:function(f,d){var b=/sponsor_(\w+)/.exec(d.className)[1];var e=ta.id("SPR_HTLS_RHS");var c=ta.id("SPR_HTL_MORE_"+b);var a=ta.id("SPR_HTL_LESS_"+b);if(e){e.getElements(".list_"+b).each(function(g){g.addClass("hide")})}if(c&&a){c.show();a.hide()}},getLoggingName:function(){var a=ta.retrieve("maps.overrideLoggingName");if(a){return a}return"HACMap_"},morphBig:function(c,a){if(c){c.stop()}var b=ta.retrieve("maps.map");if(b){b.morph(1)}},mapMoved:function(a,c){var b=function(){if(ta.retrieve("map.poi.changed")){return false}return true};if(!ta.retrieve("map.multipartMove")&&ta.retrieve("maps.map")){var e=ta.retrieve("maps.map").options.minZoom;if(c<e){return}ta.store("lma",ta.servlet.HACSearch.getLoggingName()+"move");ta.store("filter.map",true);ta.id("RESET_MAP").setStyle("display","block");var d=ta.id("IN_RESET_MAP");if(d){d.setStyle("display","block")}if(b()){ta.util.pending.lock("maps.firstMove",function(){var f=$$("#HOTEL_FILTERS fieldset.nearbyCities");if(f){f.show()}ta.store("maps.userMove",true)})}ta.servlet.HACSearch.filtersChanged();ta.servlet.HACSearch.showNearbyCities()}},showNearbyCities:function(){var a=ta.id("SIDEBAR");if(a){var b=a.getElement("#nearbyCities");if(b){if(b.hasClass("hidden")){b.removeClass("hidden");ta.maps.Sidebar.openNearbyCities(null,b.getElement("#toggle_nearby_cities"))}}}},isNearbyCitiesHidden:function(){var e=document.getElement("#HOTEL_FILTERS fieldset.radius");if(e){return false}if(ta.has("hotels_auto_broaden.enabled")){return false}var c=ta.id("SIDEBAR");if(c){var f=c.getElement(".nearbyCities");if(f){if(!f.hasClass("hidden")){return false}}}var d=document.getElements("#HOTEL_FILTERS fieldset.nearbyCities input[type=checkbox]");if(!d||!(d.length)||d.length==0){d=document.getElements("#NEARBY_CITIES_BOX fieldset.nearbyCities input[type=checkbox]")}if(d){var b=false;d.each(function(g){b=b||g.checked});if(!b&&ta.has("maps.nearby")){var a=ta.retrieve("maps.nearby");b=a&&a.length>0}if(b){return false}}return true},mapReset:function(){ta.id("RESET_MAP").setStyle("display","none");var c=ta.id("IN_RESET_MAP");if(c){c.setStyle("display","none")}if(!ta.retrieve("map.leavenc")){var b=ta.retrieve("nearbycities.container");$$(b+" fieldset.nearbyCities input[type=checkbox]").each(function(d){if(d.checked){ta.servlet.HACSearch.setCheckSetChecked(d,false);checked=true}});var a=ta.id("unear");if(a){a.value=""}ta.store("lma",ta.servlet.HACSearch.getLoggingName()+"reset")}ta.servlet.HACSearch.filtersChanged()},mapZoomed:function(f,a){var e=ta.retrieve("maps.map");var g=e.options.minZoom;if(!a){a=e.getZoom()}if(a<g){var c=ta.id("MPZM_ERR");if(!c.hasClass("rdy")){ta.id(document.body).adopt(c.addClass("rdy"))}c.setStyles({left:-9999,top:-9999}).show();var d=ta.id(ta.retrieve("maps.container")).getCoordinates();var b=c.getCoordinates();c.setStyles({left:d.left+(d.width-b.width)/2,top:d.top+(d.height-b.height)/2});e.hideAllPins()}else{ta.id("MPZM_ERR").hide();e.showAllPins()}},filtersChanged:function(b,a){filtersChanged(b,a)},filtersChangedPreventDefault:function(b,a){if(b){b.preventDefault()}filtersChanged(b,a)},nameFilterChanged:function(d){d.preventDefault();var a=ta.retrieve("ta.servlet.HACSearch.nameFilterChanged.lastValue");var e=ta.id("nameContains");var b=(e&&e.value)?e.value:"";ta.servlet.HACSearch.trackEvent("Filters","PropertyNameSearch",b,0);if(e&&((e.value&&e.value!=a)||(!e.value&&a))){ta.store("ta.servlet.HACSearch.nameFilterChanged.lastValue",e.value);var c=window.pageServlet=="LocalMapsRedesign";filtersChanged(null,c)}},nameFilterReset:function(a){if(a){a.preventDefault()}ta.servlet.HACSearch.trackEvent("Filters","PropertyNameReset");var b=ta.id("nameContains");if(b&&b.value&&b.value.length>0){b.value="";ta.store("ta.servlet.HACSearch.nameFilterChanged.lastValue","");ta.servlet.HACSearch.filtersChanged()}},toggleFilter:function(n,a){var f=true;var b=window.pageServlet=="LocalMapsRedesign";ta.servlet.HACSearch.trackFilterOnClick(n,a);if(a.getParent("fieldset.hotelBrand")){var m=brandDup(a);if(m){m.checked=a.checked}}if(a.getParent("fieldset.nearbyCities")){var d=ta.id("unear");var g=ta.id("snear");var e=d&&d.value.length>0?d.value.split(","):[];var h=g&&g.value.length>0?g.value.split(","):[];if(a.checked){e.erase(a.id);h.include(a.id)}else{e.include(a.id);h.erase(a.id)}if(d){d.value=e.join(",")}if(g){g.value=h.join(",")}ta.store("lma",ta.servlet.HACSearch.getLoggingName()+"nearby");var l=a.getParent("fieldset");if(a.hasClass("default")){ta.remove("sel.nearby");l.getElements("input[type=checkbox]").each(function(o){if(!o.hasClass("default")){ta.servlet.HACSearch.setCheckSetChecked(o,false);e.include(o.id);h.erase(o.id)}})}else{var c=ta.retrieve("sel.nearby")||[];if(a.checked){c.push(a.id)}else{c.erase(a.id)}ta.store("sel.nearby",c);var k=l.getElements("input.default");if(k){if(a.checked){k.each(function(o){ta.servlet.HACSearch.setCheckSetChecked(o,false);e.include(o.id);h.erase(o.id)})}}}}else{var l=a.getParent("fieldset");if(a.hasClass("default")){l.getElements("input[type=checkbox]").each(function(o){if(!o.hasClass("default")){ta.servlet.HACSearch.setCheckSetChecked(o,false)}})}else{var k=l.getElements("input.default");if(k){if(a.checked){k.each(function(o){ta.servlet.HACSearch.setCheckSetChecked(o,false)})}else{if(!l.getElements("input[type=checkbox]").some(function(o){return o.checked})){k.each(function(o){ta.servlet.HACSearch.setCheckSetChecked(o,true)})}}}}if(l.hasClass("neibrhd")){if(a.hasClass("default")){ta.store("sel.neighborhood",[a.id])}else{var j=ta.retrieve("sel.neighborhood")||[];if(a.checked){j.push(a.id)}else{j.erase(a.id)}ta.store("sel.neighborhood",j)}if(window.pageServlet=="LocalMapsRedesign"){ta.remove("maps.keep_filters")}}if(l.hasClass("lockout")){f=false;ta.store("filter.lockout",true)}}ta.servlet.HACSearch.adjustTopValueState();if(f){ta.util.pending.waitForMore("filters",ta.servlet.HACSearch.filtersChanged,1000,[null,b])}else{ta.servlet.HACSearch.filtersChanged(null,b)}},toggleAllAvailability:function(c,a){ta.id("HOTEL_FILTERS").availability.value=a.value;ta.store("lma",ta.servlet.HACSearch.getLoggingName()+"avail");if(ta.id("HAC_FORM")!=null){ta.id("HAC_FORM").searchAll.value=(a.value=="1")}ta.servlet.HACSearch.filtersChanged();$$("input.avail_"+a.value).each(function(d){d.checked=true});var b=a.value=="1"?"0":"1";$$("input.avail_"+b).each(function(d){d.checked=false})},toggleAvailabilityAlt:function(b,a){if(/.*_(\d)$/.test(a.id)){ta.id("availability_"+RegExp.$1).click()}},updateData:function(){try{ta.servlet.HACSearch._updateData()}catch(a){ta.util.error.record(a,"ta.servlet.HACSearch.updateData")}},_updateData:function(){if(ta.has("maps.nearby")){var r=ta.remove("maps.nearby");var n=ta.retrieve("nearbycities.container");$$(n+" fieldset.nearbyCities input[type=checkbox]").each(function(u){var v=r.contains(u.id);ta.servlet.HACSearch.setCheckSetChecked(u,v);if(n==="#SIDEBAR"){updateFilterStyle(u,v)}})}var c=ta.id("map_pager");var a=ta.id("pager_top2");if(c){if(a){c=c.getElement("div.pgLinks");if(c){c.innerHTML=a.innerHTML;if(typeof behavior!="undefined"){behavior.apply(c)}}}else{c.innerHTML='<div class="pgLinks"></div>'}}var k=ta.id("mapSG");var e=ta.id("BEST_VALUE_FORM");if(k&&e){k.checked=e.sortGroup.checked;k.disabled=e.sortGroup.disabled;k.getParent().getElement("span").innerHTML=e.getElement("label.bv span").innerHTML;if(k.disabled){k.getParent().addClass("disabled")}else{k.getParent().removeClass("disabled")}}var q=ta.id("SORT_FORM");var t=ta.id("mapSortForm");if(q&&t){t.set("html",q.innerHTML)}var b=ta.id("mapRedesignSG");if(b&&e){var m=b.sortGroup;m.checked=e.sortGroup.checked;m.disabled=e.sortGroup.disabled;var g=b.getElement("span");g.innerHTML=e.getElement("label.bv span").innerHTML;if(b.sortGroup.disabled){g.addClass("disabled")}else{g.removeClass("disabled")}}var p=ta.id("resultsDateBar");var s=ta.id("mapDateBar");if(p&&s){p.getChildren("radio").each(function(v){var u=s.getElement(".avail_"+v.value);if(u){u.checked=v.checked}})}var d=ta.id("LARGE_MAP");if(d){var h=d.getElement(".showing");var j=d.getElement(".srtTools");var l=true;if(h){var f=ta.id("ACCOM_OVERVIEW");var o=h.getElement("span");if(f){f=f.getElement(".pagination .pgCount");if(f){o.innerHTML=f.innerHTML}else{o.innerHTML="0";l=false}}else{o.innerHTML="0";l=false}}if(j){if(l){j.show()}else{j.hide()}}}},updateSponsorAds:function(b,a){if(a==null){a=ta.retrieve("sponsor.active")}if(a==ta.retrieve("sponsor.ad."+b)){return}ta.store("sponsor.ad."+b,a);new Request({url:"/MapAdAjax?fromServlet="+window.pageServlet+"&t="+b+"&sponsor="+a+"&ac="+getIncrementedAdsAjaxCount(),method:"get",evalScripts:true,onSuccess:function(c,d){var e;if(b=="leader"){e=ta.id("PAGE").getElement(".iab_leaBoa");if(!e){e=new Element("div",{"class":"ad iab_leaBoa"});e.inject("MAIN","before")}if(ta.has("ads.gptEnabled")){ta.common.ads.injectAjaxAds("mapadajax",".iab_leaBoa .gptAd",true)}else{e.set("html",c);ta.common.ads.injectAdsTargeted(e)}}else{if(b=="180X150"){e=ta.id("HACMAP_AD_PARENT");if(e){e.removeClass("hidden")}if(ta.has("ads.gptEnabled")){ta.common.ads.injectAjaxAds("mapadajax","#HACMAP_AD_PARENT .gptAd",true)}else{e.set("html",c);ta.common.ads.injectAdsTargeted(e)}}}}}).send()},toggleTypeByValue:function(c,a){if(!["checkbox","radio"].contains(a.type)){return}if(!ta.has("maps.map")){return}var b=ta.retrieve("maps.map");if(a.checked){b.showType(a.value)}else{b.removeMarkersByType(a.value)}},toggleSponsor:function(f,b){ta.servlet.HACSearch.toggleTypeByValue(f,b);var e=b&&b.get("tag")=="input";if(e){var d=ta.id(b.id.replace("sidebar","thumb"));var a=ta._locationHash;if(b.checked){ta.store("addSponsorship",1);ta.store("addSponsorshipToggle","turnOn "+b.value);ta.store("addSponsorshipValue",b.value);if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","sidebar_sponsor_check",b.value)}if(d){d.checked=true}ta.servlet.HACSearch.updateSponsorStore(b.value,true)}else{ta.store("addSponsorship",0);ta.store("addSponsorshipToggle","turnOff "+b.value);ta.store("addSponsorshipValue",null);if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","sidebar_sponsor_uncheck",b.value)}if(d){d.checked=false;ta.id("STMAP_OVERLAYS").empty()}ta.servlet.HACSearch.updateSponsorStore(b.value,false)}}ta.servlet.HACSearch.filtersChanged();if(b.checked){ta.servlet.HACSearch.updateSponsorAds("leader",b.value);if(ta.retrieve("maps.is_open")){ta.servlet.HACSearch.updateSponsorAds("180X150",b.value)}ta.store("sponsor.active",b.value)}else{var c=ta.id("SPR_HTLS_RHS");if(c){c.empty()}}},updateSponsorStore:function(b,a){var c=ta.retrieve("maps.sponsors");var d=[];if(c&&c.length){c.each(function(e){if(e!=b){d.push(e)}})}if(a){d.push(b)}ta.store("maps.sponsors",d)},toggleTopValue:function(b,a){ta.id("BEST_VALUE_FORM").sortGroup.click()},updateCheckedIndices:function(e){if(isNaN(e.value)){return}var a=e.getParent("fieldset").getElement("input.checkedIndices");var d=e.getParent("fieldset").getElement("input.uncheckedIndices");var b=e.checked?d:a;if(b){b.value=b.value.split(",").erase(e.value).erase("").join(",")}var c=e.checked?a:d;if(c){c.value=c.value.split(",").include(e.value).erase("").join(",")}},setCheckSetChecked:function(b,a){if(b){b.checked=a;ta.servlet.HACSearch.updateCheckedIndices(b)}},_filterClassToTrackingLabel:function(a){if(!(a&&a.hasClass)){return null}var c={ptype:"PropertyType",radius:"SearchNearby",priceRangeList:"PricePerNight",neibrhd:"Neighborhood",travelerRatingList:"TravelerRating",hotCls:"HotelClass",amenities:"Amenities",hotelName:"PropertyName",hotelBrand:"HotelBrand",suitability:"Suitability",nearbyGeos:"NearbyGeos"};for(var b in c){if(a.hasClass(b)){return c[b]}}return null},toggleFilterExpansion:function(f,d){try{ta.call("ta.util.Toggle.siblings",f);var c=ta.id(d);var g=(c.hasClass("closed"))?"Collapse":"Expand";var a=c.getParent("fieldset");var b=ta.servlet.HACSearch._filterClassToTrackingLabel(a);ta.trackEventOnPage("Filters",g,b,0)}catch(h){ta.util.error.record(h,"ta.servlet.HACSearch.toggleFilterExpansion")}},trackFilterOnClick:function(a,f){try{if(!a||!f){return}var l=f.getParent("fieldset");var d=ta.servlet.HACSearch._filterClassToTrackingLabel(l);d=d+((f.checked)?"Checked":"Unchecked");var h=f.getSiblings("label[for="+f.id+"]");var b="";if(h){var k=h.get("text");if(k){var c=/^[^(]+/.exec(k);if(c&&c[0]){b=c[0].trim()}}}var j=(isNaN(f.value))?0:f.value;ta.servlet.HACSearch.trackEvent("Filters",d,b,f.value)}catch(g){ta.util.error.record(g,"ta.servlet.HACSearch.trackFilterOnClick")}},handleCheckSetOnClick:function(a,b){ta.servlet.HACSearch.trackFilterOnClick(a,b);ta.servlet.HACSearch.updateCheckedIndices(b);ta.servlet.HACSearch.toggleFilter(a,b)},setDealsFilter:function(){ta.store("maps.offersOnly",true);this.filtersChanged()},showAndUpdateLargeMap:function(a){if(a){a.preventDefault()}ta.servlet.HACSearch.showLargeMap();ta.servlet.HACSearch.filter.update();this.filtersChanged()},currencyOnChange:function(e,c){var a=ta.id(c);var d=a.getSelected();var b=(d&&d[0]&&d[0].text)?d[0].text:"";ta.servlet.HACSearch.trackEvent("Filters","PPNCurrency",b,a.selectedIndex);filtersChanged(e)},updateSpecialOffers:function(c){var a=ta.id("VR_SPECIAL_OFFERS_HEADER");var b=ta.select(".hotels_special_offers")[0];if(a&&b){if(c===6){ta.util.element.makeTextFitOneLine(".vrSoHeaderText");a.show();b.hide()}else{a.hide();b.show()}}},catRadioClicked:function(g,d,f){ta.remove("keep_users_on_hotels_v2.id");var a;if(d.className.match(/cat_(\d+)/)){a=ta.id(d)}else{a=ta.id(d.getParent("div"))}if(a.className.match(/current/)){return}var c=a.className.match(/cat_(\d+)/);var e=a.hasClass("disabled")||a.getElement("label.disabled");if(f){c=f}if(c){if(!e){ta.store("sel.category",c[0]);var h=c[0];ta.servlet.HACSearch.selectPropertyTypeTab("PROPTYPE_BOX",h);ta.servlet.HACSearch.selectPropertyTypeTab("PROPTYPE_BOX_LEFTNAV",h);var b={cat_1:"HOTELS",cat_2:"BB",cat_3:"OTHER",cat_6:"VR"};ta.servlet.HACSearch.trackEvent("Filters","PropertyType",b[h],0);if(ta.hac.filters.style.getVersion()>=2){ta.hac.filters.style.reset();if(a.hasClass("chkSet")){ta.hac.filters.style.visualClickTab(h)}}if(ta.hac.filters&&ta.hac.filters.changeCategory){ta.hac.filters.changeCategory(c[1])}else{filtersChanged()}}else{if(g){g.preventDefault()}}}ta.hac.filters.style.showOrHideStyleButtons()},selectPropertyTypeTab:function(d,f){try{if(!ta.id(d)){return}var b=$$("#"+d+" .tab");Array.each(b,function(e){ta.id(e).removeClass("current")});var a=$$("#"+d+" ."+f)[0];a.addClass("current");var c=a.getElement("input");if(c){c.checked=true}}catch(g){}},handleCheckSetClickOnCount:function(d,c,f){new Event(d).stop();var e=ta.id(f);ta.servlet.HACSearch.trackFilterOnClick(d,e);var a=e.getParent("fieldset").getElements("div.chkSet input");for(var b=0;b<a.length;++b){ta.servlet.HACSearch.setCheckSetChecked(ta.id(a[b]),ta.id(a[b]).id==f)}ta.servlet.HACSearch.toggleFilter(d,ta.id(f))},doMetaDateSearch:function(a,d){if(!ta.widgets.calendar.hasPageDates()){var c=document.getElement(".metaDatePicker .date_picker_calendar_wrap");c.fireEvent("click")}else{if(ta.has("hac.filter.changed")||ta.has("meta.mini_meta_on_accommodations")){ta.servlet.HACSearch.displayPostDatesLinks();var e=(window.pageServlet==="Hotels"||window.pageServlet==="HotelsList")&&window.modelLocId&&window.modelLocId!==a;if(e){ta.trackEventOnPage("INLINEDATEPICKER","SELECT","",a)}if(e&&!ta.retrieve("enteredDatesInPreDates")&&ta.retrieve("keep_users_on_hotels_v2.id")!=a){ta.remove("keep_users_on_hotels_v2.id")}window.fireEvent("hotels.datesUpdate");if(e&&!ta.retrieve("keep_users_on_hotels_v3")&&ta.retrieve("enteredDatesInPreDates")){ta.store("keep_users_on_hotels_v2.id",a);ta.servlet.HACSearch.scrollToHighlightHotel();ta.id("highlightHotelContent")&&ta.id("highlightHotelContent").addClass("hidden");ta.widgets.calendar.justUpdateSessionDates(function(){ta.hac.filters.updateResultsFromDateSearch();ta.store("datesChanged",true)},false,true);var b=ta.id("property_"+a);if(b&&b.href){ta.popups.PopUtil.attemptOpenUrlNewTab(b.href)}}else{ta.widgets.calendar.justUpdateSessionDates(function(){ta.hac.filters.updateResultsFromDateSearch();ta.store("datesChanged",true)})}}else{if(ta.retrieve("hotels.datesChanged")){updateResults(true);ta.servlet.HACSearch.destroyAnimatedDateCTA()}else{ta.widgets.calendar.justUpdateSessionDates(function(){window.location=ta.commerce.meta.buildMetaHACUrl()},true)}}}if(ta.retrieve("meta.trackShowPriceButton")){ta.trackEventOnPage("DATEPICKER","SearchButton","");ta.store("meta.trackShowPriceButton",false)}},scrollToHighlightHotel:function(){var c=ta.id("highlightHotelContentWrap");if(c){var b=c.getPosition().y;if(ta.retrieve("hotels_placements_short_cells")){var d=ta.id("ACCOM_OVERVIEW");if(d){b-=d.getStyle("padding-top").toInt()}}var a=ta.id("PERSISTENT_DATE_PICKER");if(a){b-=a.getHeight()}window.scrollTo(0,b)}},openMetaLBAndUpdateMiniMetaOnPage:function(){},doDateSearch:function(c,a){if(ta.servlet.HACSearch.areDateFieldsSet()){if(ta.id("HOTEL_FILTERS")!=null){ta.id("HOTEL_FILTERS").availability.value="0"}ta.id("searchAll").value="false";ta.servlet.HACSearch.filter.update()}ta.servlet.HACSearch.adjustTopValueState();var d=ta.id("xnear_conditional");if(d){ta.store("xnear_conditional",d.value)}ta.remove("maps.keep_filters");updateResults(true);var b=ta.id("findFlights");if(b&&b.checked){if(ta.popups.FlightSearch){try{ta.popups.FlightSearch.popFlightSearch()}catch(f){}}}},areDateFieldsSet:function(){var a=ta.id("HAC_FORM");var b=false;if(a){a.getElements(".cal input[type=text]").each(function(c){if(c.value==JS_DateFormat){b|=true}})}return !b},showLargeMap:function(b,a){try{if(b){b.preventDefault()}if(ta.has("sponsor.active")&&a&&(a.get("tag")=="a"||a.get("tag")=="span"||a.get("tag")=="img")){ta.store("sponsor.record_map_open")}$$(".hacMapAdPixelHolder").each(function(d){ta.servlet.HACSearch._downloadTrackPixel(d)});if(ta.has("sponsor.active")){ta.servlet.HACSearch.updateSponsorAds("180X150")}ta.servlet.HACSearch.loadOrShowLargeMap(true);if(typeof autoCloseWindowShade!="undefined"){autoCloseWindowShade()}}catch(c){ta.util.error.record(c,"ta.servlet.HACSearch.showLargeMap")}},_isMapLoaded:function(){return ta.has("maps.map")||ta.has("maps.create_called")},loadOrShowLargeMap:function(e){window.windowShade=false;ta.store("maps.is_open",true);if(ta.retrieve("moveResultSummary")){var b=ta.id("HAC_SMRY");var d=ta.id("LARGE_MAP");if(b&&d){b.inject(d,"before")}}if(e){ta.servlet.HACSearch.filter.update()}if(ta.id("SMALL_MAP")){ta.id("SMALL_MAP").setStyle("display","none")}if(ta.id("SPR_HTLS_RHS")){ta.id("SPR_HTLS_RHS").setStyle("display","block")}$$("#LARGE_MAP .sponsorTrkHolder").each(function(g){ta.servlet.HACSearch._downloadTrackPixel(g)});var c=ta.id("LARGE_MAP");if(ta.retrieve("maps.is_open")){showTitlePins()}if(!ta.servlet.HACSearch._isMapLoaded()){ta.store("maps.create_called",true);ta.store("maps.landmarks",[]);if(ta.has("sponsor.record_map_open")){ta.remove("sponsor.record_map_open");new Request({url:"/ActionRecord?action=sponsor_hacmap_open"}).send()}if(!ta.has("maps.suppressHACActionRecord")){ta.store("lma",ta.servlet.HACSearch.getLoggingName()+"open")}ta.util.load.LocalSearch();var a=function(){ta.store("maps.callback","ta.servlet.HACSearch.createMapCaller");ta.util.load.maps();c.setStyle("display","block");ta.servlet.HACSearch.showMapSponsor();ta.servlet.HACSearch.updateSponsorAds("180X150")};if(ta.maps.Map){a()}else{ta.load("ta-maps.js",a)}}else{if(!ta.has("maps.landmarks")){ta.store("maps.landmarks",[])}if(ta.has("map.delayedLoc")){ta.maps.Sidebar._addLocationCallback(ta.retrieve("map.delayedLoc.point"),ta.retrieve("map.delayedLoc.data"))}c.setStyle("display","block");ta.servlet.HACSearch.showMapSponsor();ta.servlet.HACSearch.updateSponsorAds("180X150")}var f=ta.retrieve("maps.map");if(f){f.checkResize()}},sidebarType:{attractions:2,restaurants:3},updateMapsSidebarInput:function(b){if(isNaN(b)){return}var a=ta.retrieve("zft")||[];if(!a.contains(b)){a.push(b);ta.store("zft",a)}},createMapCaller:function(){ta.store("maps.postcreate",function(s){try{var d=ta._locationHash;var g=false;if(d.has("bc_restaurants")||ta.has("maps.restaurants")){ta.remove("maps.restaurants");var h=ta.id("sidebar_restaurants");if(h){h.checked=true;ta.servlet.HACSearch.updateMapsSidebarInput(ta.servlet.HACSearch.sidebarType.restaurants);g=true}}if(d.has("bc_attractions")||ta.has("maps.attractions")){ta.remove("maps.attractions");var j=ta.id("sidebar_attractions");if(j){j.checked=true;ta.servlet.HACSearch.updateMapsSidebarInput(ta.servlet.HACSearch.sidebarType.attractions);g=true}}try{var b=ta.retrieve("thDataObj");if(b){var m;if(b.coords){var a=b.coords.split(",");m=new ta.maps.Location(a[0],a[1])}ta.servlet.HACSearch.reconcileLocations(true);ta.maps.Sidebar.addLocation(null,null,m,b,false)}}catch(q){ta.util.error.record(q,"maps post create - type ahead")}var k=ta.id("offersOnly");if(k&&ta.has("maps.offersOnly")){k.checked=true;g=true}try{if(d.has("airports")||ta.has("hac.map.airports")){var o=d.get("airports")?d.has("airports"):ta.retrieve("hac.map.airports");var l=ta.id("toggle_airports");if(l&&!l.hasClass("on")){ta.maps.Sidebar.toggleAirports(null,ta.id("toggle_airports"),true)}if(o){o.each(function(e){var u=ta.id("airport_"+e);if(u){u.checked=true;ta.maps.Sidebar.togglePOI(null,u,true)}})}g=true}}catch(q){ta.util.error.record(q,"maps post create - load airports")}var p=ta.remove("maps.address_search_deferred");if(p){p()}else{var r=ta.remove("maps.poi_search_deferred");if(r&&r.length&&r.length>3){r[0](r[1],r[2],r[3])}}if(ta.has("maps.actionrecord")){var f=ta.remove("maps.actionrecord");new Request({url:f}).send()}if(ta.has("map.delayedLoc")){ta.maps.Sidebar._addLocationCallback(ta.retrieve("map.delayedLoc.point"),ta.retrieve("map.delayedLoc.data"))}if(d.has("mt")){s.setMapType(d.get("mt"))}if(window.pageServlet=="LocalMapsRedesign"){if(!ta.has("maps.sponsors")){var c=[];var n=document.getElements("input[id*=sidebar_sponsor_]");if(n&&n.length){n.each(function(e){if(e.checked){c.push(e.value)}})}ta.store("maps.sponsors",c)}}else{ta.servlet.HACSearch.updateMapSponsors()}if(d.has("mc")&&d.has("mz")){var t=d.get("mc").split(",");s.move(parseFloat(t[0]),parseFloat(t[1]),parseInt(d.get("mz")));s.checkResize();ta.servlet.HACSearch.mapZoomed();ta.store("maps.moved",true)}else{if(g){ta.servlet.HACSearch.filtersChanged()}}}catch(q){ta.util.error.record(q,"hac map postcreate")}});ta.util.pending.waitForFn("mapfactory","ta.maps.Factory.createMap");return},hideLargeMap:function(g,f,e){var c=ta.id("LARGE_MAP");var d=ta.id("SMALL_MAP");if(c&&d){c.setStyle("display","none");d.setStyle("display","block");if(ta.id("SPR_HTLS_RHS")){ta.id("SPR_HTLS_RHS").setStyle("display","none")}ta.servlet.HACSearch.hideMapSponsor();if(ta.retrieve("addSponsorship")==1){ta.servlet.HACSearch.updateSponsorAds("180X150",ta.retrieve("addSponsorshipValue"))}if(!e){ta.servlet.HACSearch.filter.update()}hideTitlePins();if(ta.retrieve("moveResultSummary")){var a=ta.id("HAC_SMRY");var b=ta.id("HAC_RESULTS");if(a&&b){a.inject(b,"before")}}}},clearDates:function(c,b){var a=ta.id("searchAll").value;ta.id("searchAll").value=true;if(a=="trueButShow"){ta.servlet.HACSearch.clearDateFields()}else{ta.run("ta.overlays.Factory.showUpdatingMessage");updateResults(true)}},clearDateFields:function(){var a=ta.id("checkIn").form;if(a.calendar){a.calendar.clearFields()}ta.servlet.HACSearch.hideClearDates()},restoreDateFields:function(){var a=ta.id("checkIn").form;if(!a.calendar){new ta.overlays.PairedCalendar(a)}a.calendar.updateFields();ta.servlet.HACSearch.showClearDates()},hideClearDates:function(){$$("#HAC_SMRY .smry .hvrIE6").each(function(a){a.setStyle("display","none")});$$("#HAC_DATES .smry .hvrIE6").each(function(a){a.setStyle("display","none")})},showClearDates:function(){$$("#HAC_SMRY .smry .hvrIE6").each(function(a){a.setStyle("display","inline")});$$("#HAC_DATES .smry .hvrIE6").each(function(a){a.setStyle("display","inline")})},showAllTopValue:function(b,a){b.preventDefault();if(ta.id("BEST_VALUE_FORM")){ta.id("BEST_VALUE_FORM").sortGroup.checked=true;bestValueChanged()}ta.servlet.HACSearch.filtersChanged()},adjustTopValueState:function(){var a=ta.remove("topvalue.state");if(a){if(ta.id("BEST_VALUE_FORM")){ta.id("BEST_VALUE_FORM").sortGroup.checked=true;bestValueChanged()}}},tabClicked:function(d,b){if(b.tagName!="H2"){b=b.getParent("H2")}if(b.className.match(/current/)){return}var a=b.className.match(/cat_(\d+)/);var c=b.hasClass("disabled");if(a){d.preventDefault();if(!c){ta.store("sel.category",a[0]);filtersChanged();ta.id(b.getParent()).getElements(".tab").each(function(e){e.removeClass("current")});b.addClass("current")}}},changeOffset:function(b,a,c){new Event(b).preventDefault();ta.store("hacform.data",{o:"a"+c});filtersChanged()},_getMiniMapAddress:function(){if(ta.id("add_location_input_filter")){return ta.id("add_location_input_filter").value}return ta.id("SMALL_MAP_ADDRESS").getFirst().address.value},_setMiniMapAddress:function(a){if(ta.id("add_location_input_filter")){if(a!=map_enteraddress){ta.id("add_location_input_filter").value=a}}ta.id("SMALL_MAP_ADDRESS").getFirst().address.value=a},updateFilterLocation:function(a){ta.store("locationfilter.locval",a)},focusLocationFilter:function(c,a){var b=ta.id("add_location_input_filter");if(b){b.value=""}},_doBlurLocationFilter:function(){if(!ta.remove("locationfilter.skipblur")){var a=ta.id("add_location_input_filter");if(a&&ta.has("locationfilter.locval")){ta.store("locationfilter.oldlocval",a.value);a.value=ta.retrieve("locationfilter.locval")}}},blurLocationFilter:function(b,a){ta.servlet.HACSearch._doBlurLocationFilter.delay(200)},onFilterSubmit:function(b,a){ta.store("locationfilter.skipblur",true);ta.servlet.HACSearch.onMiniMapAddressSubmit(b,a,true)},onMiniMapAddressSubmit:function(c,b,a){new Event(c).stop();ta.run("ta.overlays.Factory.showFilterWaitOverlay",{},true);if(a){ta.store("filter_address_lookup.callback",ta.servlet.HACSearch._onMiniMapAddressSubmitReady);ta.servlet.HACSearch.onMiniMapAddressSearch(c,b,true)}else{ta.servlet.HACSearch._onMiniMapAddressSubmitReady(true)}},_onMiniMapAddressSubmitReady:function(f){var b=!f;var e=ta.id("SMALL_MAP_ADDRESS").getFirst();var d=e.action;ta.servlet.HACSearch.reconcileLocations(false);var a=ta.servlet.HACSearch._getMiniMapAddress();if(a!=""&&a!=map_enteraddress){ta.servlet.HACSearch.filter.setOption("bc_address",a)}if(b){ta.servlet.HACSearch.filter.setOption("poi",ta.retrieve("map.poi"));ta.servlet.HACSearch.filter.setOption("newPoi",ta.retrieve("map.poi.changed"));var c=ta.id("distance");if(c){ta.servlet.HACSearch.filter.setOption("distance",c.options[c.selectedIndex].value)}}ta.setEvtCookie("static_map","poi_search_go_click","","",getHACFormURL()+ta.servlet.HACSearch.buildHACUrlParamString());updateResultsFromForm();return false},onSelectLocationTypeAhead:function(a,j,d,l){var c=j?j.name:null;var k=j?j.type:null;var g=j?j.value:null;var m=j?j.coords:null;var b=j?j.url:null;var n;if(m){var h=m.split(",");n=new ta.maps.Location(h[0],h[1])}if(g){var e={name:c,type:k,url:b,value:g,coords:m};ta.store("thDataObj",e)}if(a.hasClass("vrAddress")){var f="VR_TAB_MAP_SEARCH";var o="&geo="+modelGeoId+"&detail="+modelLocId}else{f="LocTypeAhead_sel_"+k;o=""}new Request({url:"/ActionRecord?action="+f+o}).send();ta.servlet.HACSearch.reconcileLocations(!l);return ta.maps.Sidebar.addLocation(null,d,n,j,l)},onSelectLocationTypeAheadFilter:function(a,c,b){ta.servlet.HACSearch.reconcileFilterLocation();ta.servlet.HACSearch.onSelectLocationTypeAheadSmallMap(a,c,b,true)},onSelectLocationTypeAheadSmallMap:function(a,j,e,m){var c=j?j.name:null;var k=j?j.type:null;var g=j?j.value:null;var l=j?j.coords:null;var b=j?j.url:null;var d=ta.id("SMALL_MAP_ADDRESS").getFirst();var f=ta.servlet.HACSearch.buildHACUrlParamString();if(g){ta.servlet.HACSearch.filter.setOption("th_name",c);ta.servlet.HACSearch.filter.setOption("th_type",k);ta.servlet.HACSearch.filter.setOption("th_value",g);ta.servlet.HACSearch.filter.setOption("th_coords",l);ta.servlet.HACSearch.filter.setOption("th_url",b);ta.servlet.HACSearch.filter.setOption("poi",l);ta.servlet.HACSearch.filter.setOption("newPoi",1);if(m){var h=ta.id("distance");if(h){ta.servlet.HACSearch.filter.setOption("distance",h.options[h.selectedIndex].value)}}}if(ta.setEvtCookie){ta.setEvtCookie("static_map","poi_search","","",getHACFormURL()+f)}ta.servlet.HACSearch.reconcileLocations(false);new Request({url:"/ActionRecord?action=LocTypeAhead_sel_"+k}).send();document.location.href=getHACFormURL()+f+"#"+ta._locationHash.asString()},_doAddressSearch:function(){try{var a=ta.servlet.HACSearch._getMiniMapAddress();var b=ta.id("add_location_input");if(b){b.value=a}var c=ta.id("add_location_input_filter");if(c){c.value=a}ta.maps.Sidebar.addLocation();ta.servlet.HACSearch._setMiniMapAddress(map_enteraddress)}catch(d){ta.util.error.record(d,"ta.servlet.HACSearch.doAddressSearch")}},reconcileLocations:function(a){var d=ta.id("add_location_input");var c=ta.id("small_location_input");var b=ta.id("add_location_input_filter");if(a&&d&&b){b.value=d.value}else{if(c&&b){b.value=c.value}}},clearLocation:function(b,a){var c=ta.id("IN_RESET_MAP");if(c){c.setStyle("display","none")}ta.maps.Sidebar.clearLocation()},reconcileFilterLocation:function(d,a){var b=ta.id("add_location_input_filter");var c=ta.id("small_location_input");var e=ta.id("add_location_input");if(b&&c){c.value=b.value}if(b&&e){e.value=b.value}},onFilterLocation:function(b,a){ta.store("locationfilter.skipblur",true);ta.servlet.HACSearch.reconcileFilterLocation();ta.store("filter_address_lookup.callback",ta.servlet.HACSearch.filtersChanged);ta.servlet.HACSearch.onMiniMapAddressSearch(b,a,true)},onMiniMapAddressSearch:function(c,b,a){ta.servlet.HACSearch.reconcileLocations(false);if(!a){if(!ta.servlet.HACSearch._isMapLoaded()){ta.store("maps.address_search_deferred",ta.servlet.HACSearch._doAddressSearch)}else{ta.servlet.HACSearch._doAddressSearch()}ta.servlet.HACSearch.showLargeMap(c,b)}else{ta.remove("map.delayedLoc");if(!ta.servlet.HACSearch._isMapLoaded()){ta.store("maps.address_search_deferred",ta.servlet.HACSearch._doFilterAddressLookup);ta.util.pending.waitForFile("createmap","ta-maps.js",function(){ta.store("maps.callback","ta.servlet.HACSearch.createMapCaller");ta.util.load.maps()})}else{ta.servlet.HACSearch._doFilterAddressLookup()}}},_doFilterAddressLookup:function(){var d=ta.retrieve("maps.map");var b=ta.id("add_location_input_filter").value;if(!d||!b||b==""){ta.servlet.HACSearch._onFilterAddressLookup(null)}ta.store("maps.address",b);var c=new ta.maps.Geocoder();var a=d.mapBounds();c.setViewport(a);c.getLatLng(b,ta.servlet.HACSearch._onFilterAddressLookup,null)},_onFilterAddressLookup:function(b,c){if(b==null){ta.servlet.HACSearch._addressLookupError(map_addressnotfound);return}ta.remove("thDataObj");ta.store("map.delayedLoc",true);ta.store("map.delayedLoc.point",b);ta.store("map.delayedLoc.data",null);ta.store("map.poi.changed",true);ta.store("map.poi",b.toUrlValue());var d=ta.retrieve("maps.map");if(!d){return}var a=d.mapCenter();var f=new ta.maps.Location(a.lat(),a.lng());var e=f.distanceFrom(b)/1609.344;if(e>100){ta.servlet.HACSearch._addressLookupError(map_addressnotfound);return}ta.servlet.HACSearch.updateFilterLocation(ta.id("add_location_input_filter").value);ta.servlet.HACSearch._clearLookupError();var g=ta.remove("filter_address_lookup.callback");if(g){g()}},_clearLookupError:function(){var a=ta.id("SMALL_MAP_ADDRESS_FILTER");if(a){a.removeClass("hlLookupErr")}},_addressLookupError:function(d){if(ta.retrieve("isDaoDao")){var b=ta.retrieve("daodao.showAddressLookupErr");if(ta.retrieve("daodao.showAddressLookupErr")){b();return}}var a=ta.id("SMALL_MAP_ADDRESS_FILTER");if(a){a.addClass("hlLookupErr")}var c=ta.retrieve("addresslookupoverlay");if(!c){overly=new ta.overlays.RelativeOverlayBelow({showCloseButton:true,zIndex:"996",activate:ta.overlays.ACTIVATE_NEVER,style:"errOverlay"},"LOCATION_FILTER");ta.store("addresslookupoverlay",overly)}var e=ta.id("LOCATION_FILTER_ERR");if(e){e.set("html",d)}overly.show()},showMapTeaser:function(){var b=ta.id("LOC_SEARCH_MAP_TEASER");var a=ta.id("SMALL_MAP");if(b&&a&&a.style.display!="none"){b.removeClass("hidden")}},hideMapTeaser:function(){var b=ta.id("LOC_SEARCH_MAP_TEASER");var a=ta.id("LARGE_MAP");if(b&&a&&a.style.display!="none"){b.addClass("hidden")}},onMapAddressFocus:function(c,b,a){try{if(a&&b.value.trim()==b.defaultValue.trim()){b.value="";ta.id(b).removeClass("unfocused")}else{if(!a&&b.value==""){b.value=b.defaultValue;ta.id(b).addClass("unfocused")}}}catch(d){}},onLargeMapAddressFocus:function(d,b){var a=ta.id("add_location_input");if(a){a.value="";a.removeClass("unfocused")}var c=ta.id("add_location_input_filter");if(c){c.value="";c.removeClass("unfocused")}},onLargeMapAddressBlur:function(d,b){var a=ta.id("add_location_input");if(a&&a.value.length==0){a.value=map_enteraddress;a.addClass("unfocused")}var c=ta.id("add_location_input_filter");if(c&&a.value.length==0){c.value="";c.addClass("unfocused")}},_downloadTrackPixel:function(a){if(a){var c="http://"+a.get("text").trim();var b=ta.id(document.createElement("img")).inject(a.empty());b.src=c;a.className=""}},changeCategory:function(e,c,d,b){var g=[];var f=ta.id("PROPTYPE_BOX");if(!f){f=document.getElement("#HOTEL_FILTERS .ptype")}if(f){g.push(f)}var a=ta.id("PROPTYPE_BOX_LEFTNAV");if(a){g.push(a)}g.each(function(n){var l=n.getElements(".tab");for(var m=0;m<l.length;++m){var j=l[m];var h=j.getElement("input");var k=j.hasClass("cat_"+d);if(h){h.checked=k}if(k){j.addClass("current")}else{j.removeClass("current")}}});ta.store("sel.category","cat_"+d);if(ta.hac.filters.style.getVersion()>=2){ta.hac.filters.style.visualClickTab("cat_"+d)}if(!b){filtersChanged()}},clearFilters:function(b,a){clearFilters();ta.servlet.HACSearch.selectNearby(b,a,false,false)},selectNearby:function(e,c,b,a){var d=ta.retrieve("nearbycities.container");$$(d+" fieldset.nearbyCities input[type=checkbox]").each(function(f){if(f.checked!=b){if(b&&f.id=="near_0"||!b){ta.servlet.HACSearch.setCheckSetChecked(f,b)}else{if(b){ta.servlet.HACSearch.setCheckSetChecked(f,false)}}}});if(!a){filtersChanged()}},handleAddressDistanceChanged:function(c,a){var b=ta.id("TAB_FILTER_CONTROLS");var d=ta.id("add_location_input_filter");if(b&&d&&d.value!=""){ta.servlet.HACSearch.filtersChanged()}},buildCurrencyHash:function(h,f,b,e,a,c,g){var d=ta.retrieve("ta.currencyHash");if(!d){d={}}d[h]={min:f,max:b,selMin:e,selMax:a,steps:c,maxAllInclusive:g};ta.store("ta.currencyHash")},buildWeeklyCurrencyHash:function(g,e,b,d,a,c,f){var h=ta.retrieve("ta.weekCurrencyHash");if(!h){h={}}h[g]={min:e,max:b,selMin:d,selMax:a,steps:c,maxAllInclusive:f};ta.store("ta.weekCurrencyHash")},updateSponsoredPins:function(){var a=ta.id("STMAP_DATA");var b=ta.id("STMAP_OVERLAYS");if(a&&b){b.empty();b.innerHTML=a.innerHTML;a.empty()}},updateMapSponsorList:function(){var b=ta.id("SPONSOR_LIST");var a=ta.id("SPR_HTLS_RHS");if(b&&a){a.innerHTML=b.innerHTML;b.destroy()}},hacPostProcessing:function(){ta.servlet.HACSearch.updateSponsoredPins();ta.servlet.HACSearch.updateMapSponsorList()},hacPageLoad:function(){ta.servlet.HACSearch.updateSponsoredPins();ta.servlet.HACSearch.updateMapSponsorList();var a=$$("#TAB_FILTER_CONTROLS .scrollable");a.each(function(d){var c=null;d.getElements("input[type=checkbox]").each(function(h){if(c==null&&h.checked){c=h}});if(c!=null){var g=c.getPosition();var f=d.getSize();var e=d.getPosition();var b=g.y-e.y;if(b>(f.y-5)){d.scrollTo(0,b)}}})},mapOnHotelReview:function(a){try{var b="ta.maps.Factory.createFloatMap";if(!a){a=5196}ta.util.cookie.setPIDCookie(a);Cookie.write("ajaxAction",b,{domain:cookieDomain,path:"/"})}catch(c){ta.util.error.record(c,"hac.mapOnHotelReview",null,{pid:a})}},buildHACUrlParamObj:function(){var c={};try{var a=document.getElement("#HAC_FORM input[name=geo]");if(a&&a.value){c.geo=a.value}if(!c.geo){var d=document.getElement("#SEARCH_LHN input[name=geo]");if(d){c.geo=d.value}}var b=document.getElementById("searchAll");if(b&&b.value!="true"){var k=document.getElementById("inDay");if(k&&k.value){c.inDay=k.value}var l=document.getElementById("inMonth");if(l&&l.value){c.inMonth=l.value}var f=document.getElementById("outDay");if(f&&f.value){c.outDay=f.value}var h=document.getElementById("outMonth");if(h&&h.value){c.outMonth=h.value}var j=document.getElementById("adults");if(j&&j.value&&j.value!="2"){c.adults=j.value}c.searchAll="false"}if(ta.has("useHotelsFilterState")){Array.each(ta.select("#HOTEL_FILTERS input[type=checkbox]"),function(e){if(e.checked){c[e.name]=e.value}})}}catch(g){ta.util.error.record(g,"buildHACUrlParams")}return c},buildHACUrlParamString:function(){var a=ta.servlet.HACSearch.buildHACUrlParamObj();return Object.toQueryString(a)},updateMapSponsors:function(e){var c=ta.retrieve("maps.sponsors");[["#POI_MARKERS","*[id*=sidebar_sponsor_]"],["#SMALL_MAP .sprChecks",".chkSet input"]].each(function(f){var g=document.getElement(f[0]);if(g){var h=g.getElements(f[1]);h.each(function(j){j.checked=false});if(c&&c.length&&ta.pages&&ta.pages.hac){c.each(function(j){var m=ta.pages.hac.sponsors[j];if(m){var l=ta.id(m);if(l){l.checked=true}var k=ta.id(m.replace("sidebar","thumb"));if(k){k.checked=true}}})}}});if(e){var b=ta.retrieve("sponsor.active");var d=true;if(!c||!c.length){return}if(b){c.each(function(f){if(f==b){d=false}})}if(d){var a=c[0];if(a){ta.servlet.HACSearch.updateSponsorAds("leader",a);if(ta.retrieve("maps.is_open")){ta.servlet.HACSearch.updateSponsorAds("180X150",a)}else{ta.servlet.HACSearch.updateSponsorAds("234X60",a)}ta.store("sponsor.active",a)}}}},click:function(b){var c=b;if(Browser.ie){c.click()}else{if(document.createEvent){var a=document.createEvent("MouseEvents");a.initEvent("click",true,false);c.dispatchEvent(a)}else{if(document.createEventObject){c.fireEvent("onClick")}}}},loadAnimatedDateCTA:function(){var j=ta.id("ANIMATED_DATE_CTA");var e=null;if(ta.retrieve("animate_date_reformat")){j=ta.id("ANIMATED_DATE_CTA_REFORMAT")}if(j){ta.util.element.makeTextFitOneLine("#ANIMATED_DATE_CTA_REFORMAT .msg");var b=j.getPrevious(".date_picker_calendar_wrap")||j.getPrevious(".meta_date_wrapper");if(ta.retrieve("animate_date_reformat")){e=j.getPrevious(".show_prices_button")}if(b){var l=ta.util.i18n.isRtl()?"right":"left";var g=20;var h=-20;var d=b.getSize().x+g;var a=b.getSize().x+h;if(e){d=d+e.getSize().x;a=a+e.getSize().x}}var c=new Fx.Morph(j,{duration:"short",transition:"linear",display:"inline-block"});var k={};k.opacity=[0,1];k[l]=[d,a];j.show();var f=b.isVisible()&&b.getSize().x>0;setTimeout(function(){if(f){c.start(k)}else{ta.servlet.HACSearch.loadAnimatedDateCTA()}},1000)}var m=ta.id("CLEAR_DATES");if(m){m.addClass("hidden")}},destroyAnimatedDateCTA:function(a,n){var j=ta.id("ANIMATED_DATE_CTA");var f=null;if(ta.retrieve("animate_date_reformat")){j=ta.id("ANIMATED_DATE_CTA_REFORMAT")}if(j){var c=j.getPrevious(".date_picker_calendar_wrap")||j.getPrevious(".meta_date_wrapper");if(ta.retrieve("animate_date_reformat")){f=j.getPrevious(".show_prices_button")}if(c){var l=ta.util.i18n.isRtl()?"right":"left";var h=20;var g=-20;var b=c.getSize().x+h;var e=c.getSize().x+g;if(f){b=b+f.getSize().x;e=e+f.getSize().x}var d=new Fx.Morph(j,{duration:(a!=false?0:"short"),transition:"linear",onComplete:function(){if(typeof n=="function"){n()}}});var k={};k.opacity=[1,0];k[l]=[e,b];d.start(k)}var m=ta.id("CLEAR_DATES");if(m){m.removeClass("hidden")}}},displayPostDatesLinks:function(){var a=document.getElement(".clearDates");var j=document.getElement(".clearDatesWrapper");var f=document.getElement(".show_prices_button");var b=document.getElement(".change_dates_button");var g=document.getElement(".date_picker_post_dates");var e=document.getElement(".date_picker_pre_dates");var h=ta.id("ANIMATED_DATE_CTA");var k=ta.id("PRICE_MSG_HOTELS");var c=ta.id("LOWEST_PRICE_ACCOMMODATION_CATEGORIES");var l=document.getElement(".jfy_sort_bar");if(ta.retrieve("animate_date_reformat")){h=ta.id("ANIMATED_DATE_CTA_REFORMAT")}if(e){e.hide()}if(g){g.show()}if(b){b.show()}if(a){a.show()}if(j){j.show()}if(f){f.hide()}if(h){ta.servlet.HACSearch.destroyAnimatedDateCTA()}if(k){k.hide()}if(c){c.hide()}if(l&&ta.p13n&&ta.p13n.wizard&&ta.p13n.wizard.showAvailabilitySort){ta.p13n.wizard.showAvailabilitySort(this,null)}if(ta.retrieve("meta.mini_meta_on_accommodations")){var d=document.getElement(".rgba_flyout.gray.overlay .roundOuterClose");if(d){d.fireEvent("click")}}},showPersistentFilters:function(){var c=ta.retrieve("persistentFiltersOverlay");if(!c){return}var a=ta.retrieve("ta.filters.overlaySet");var b=window.getScroll().y>=window.getSize().y;var f=300;var e=new Fx.Tween(c.container,{duration:f,transition:"bounce:out"});var d=function(){Object.each(a,function(h){if(c.visible&&h.visible){h.hide()}});ta.store("ta.filters.overlaySet",{});ta.widgets.calendar.closeCalendarWidgets()};if(!c.visible&&b){d();c.show();e.start("top",0);ta.store("persistentFilters.showing",true);if(!ta.has("persistentFilters.tracked")){var g="";if(!ta.widgets.calendar.hasPageDates()){g="no_dates"}else{if(ta.has("hacFilterSaveable")){if(ta.retrieve("hacFilterSaveable").isSelected()){g="selected_filter"}else{g="filters_displayed"}}}ta.trackEventOnPage("Meta_HAC_Filter_Persistent_Bar","display",g);ta.store("persistentFilters.tracked",true)}}else{if(c.visible&&!b){d();e.start("top",-60);setTimeout(function(){c.hide()},f);ta.remove("persistentFilters.showing")}}if(c.visible){Object.each(a,function(h){if(c.visible&&h.visible){h.position()}})}},selectOffersTab:function(){var b=ta.retrieve("sel.category");var a=1;if(typeof b!="undefined"){a=parseInt(b.match(/\d+$/)[0])}var c="/Offers-g"+modelGeoId;if(a!=1){c+="-c"+a}window.location.href=c},trackQuickLookHover:function(a){if(!ta.has("hoveredOverHotelIcon")){ta.trackEventOnPage("QuickLook","displayed","QuickLookIdle");ta.store("hoveredOverHotelIcon",true)}if(a&&!ta.has("hoveredOverQuickLook")){ta.trackEventOnPage("QuickLook","displayed","QuickLookHover");ta.store("hoveredOverQuickLook",true)}},trackQuickLookClickBypass:function(b,a){if(!ta.has("clickedOnHotelIcon")){ta.setEvtCookie("QuickLook","clicked","QuickLookBypass",0,a);ta.store("clickedOnHotelIcon",true)}b.stopPropagation();return false},trackQuickLookClickView:function(b,a){if(!ta.has("clickedOnQuickLook")){ta.setEvtCookie("QuickLook","clicked","QuickLookView",0,a);ta.store("clickedOnQuickLook",true)}b.stopPropagation();return false},trackQuickLookClickWrapper:function(b,c,d){var a=document.getElement(".photo_booking #"+c);if(a){if(a.containsEvent(new Event(d))){ta.servlet.HACSearch.trackQuickLookClickView(d,b)}else{ta.servlet.HACSearch.trackQuickLookClickBypass(d,b)}d.stopPropagation();return false}},trackWhenVisible:function(h,c,f,b,e,d){if(!h){return}var g=ta.retrieve("hacsearch.visTrackStats");if(!g){g={};ta.store("hacsearch.visTrackStats",{});window.addEvent("scroll",ta.servlet.HACSearch.checkTrackedVisibility);ta.queueForLoad(ta.servlet.HACSearch.checkTrackedVisibility,"HACSearch Visibility Tracking")}if(g[h]!=="done"){var a=ta.retrieveOrStore("hacsearch.visTrackActions",{});a[h]=function(){ta.trackEventOnPage(c,f,b,e,d)}}},checkTrackedVisibility:function(){var b=ta.retrieve("hacsearch.visTrackStats");if(!b){return}var f=ta.retrieveOrStore("hacsearch.visTrackActions",{});for(var e in f){var d=f[e];if(b[e]==="done"||typeof(d)!="function"){delete f[e];continue}if(!document.getElementById(e)){continue}var a=ta.id(e);if(!a||!a.isVisible()){continue}var g=a.offsetTop;var j=a.offsetHeight;while(a.offsetParent){a=a.offsetParent;g+=a.offsetTop}var h=window.pageYOffset||document.documentElement.scrollTop;var c=window.innerHeight||document.documentElement.clientHeight;if(g>=h&&(g+j)<=(h+c)){delete f[e];b[e]="done";d()}}},scrollIntoView:function(b,a,c){ta.util.element.scrollIntoView(ta.id(c))},datesBumped:function(a){ta.store("hac.dateBumped",a);var b=document.getElementById("HAC_DATES_MOVED_FORWARD");if(a=="NONE"){ta.servlet.HACSearch.clearDateFieldHighlighting()}else{if(a=="IN"&&b){ta.servlet.HACSearch.highlightInDateField(true)}else{if(a=="OUT"&&b){ta.servlet.HACSearch.highlightOutDateField(true)}else{if(b){ta.servlet.HACSearch.highlightInDateField(true);ta.servlet.HACSearch.highlightOutDateField(true)}}}}},clearDateFieldHighlighting:function(){ta.servlet.HACSearch.highlightInDateField(false);ta.servlet.HACSearch.highlightOutDateField(false)},highlightInDateField:function(a){var b=document.getElement(".filterControls .metaDatePicker .check_in .date_picker_calendar_wrap.dual_date.no_cpu.moreProminent");if(!b){b=document.getElement("#CHECK_RATES_CONT .meta_date_wrapper .date_picker_calendar_wrap.dual_date.no_cpu")}ta.servlet.HACSearch.highlightDateFieldHelper(b,a)},highlightOutDateField:function(b){var a=document.getElement(".filterControls .metaDatePicker .check_out .date_picker_calendar_wrap.dual_date.no_cpu.moreProminent");if(!a){a=document.getElement("#CHECK_RATES_CONT .meta_date_wrapper .date_picker_calendar_wrap.dual_date.no_cpu.out_date")}ta.servlet.HACSearch.highlightDateFieldHelper(a,b)},highlightDateFieldHelper:function(b,a){if(b){if(a){b.addClass("attention")}else{b.removeClass("attention")}}}};if(!ta.meta.treeTrack){ta.meta.treeTrack={}}if(!ta.meta.treeTrack.hotels){ta.meta.treeTrack.hotels={}}(function(c){var b={};c.init=function(e,f,d){if(!e||!f||!d){ta.util.error.record(null,"Failed to initialize HotelTreeTracking due to invalid parameter")}b={hotelListSelector:e,singleHotelSelector:f,placementName:d,getImpressionString:a};ta.meta.treeTrack.init(b);window.addEvent("HotelsHacComplete",ta.meta.treeTrack.logTreeImpression)};function a(f){if(f<=0){return}var e=$$(".impressionTrackingTree"),g="\\\\\\\\",k=[],d,h=f;e.each(function(o){var p=o.innerHTML||"",q=ta.analytics.stripCommentsFromTree(p),l=q.split(g,h),m,n;if(k.length>0&&l.length>0){n=k.join("");k.empty();k.push(ta.analytics.appendAscendTokens(n))}for(m=0;m<l.length;m++){k.push(l[m]);k.push(g);h--}});d=k.join("");if(d){var j=d.indexOf(b.placementName);if(j>=0){d=d.substring(j)}}return d}})(ta.meta.treeTrack.hotels);ta.maps.sidebar=ta.maps.Sidebar={icons:{hotel:"/img2/maps/icons/pinHotel.gif",restaurant:"/img2/maps/icons/pinRestaurant.gif",attraction:"/img2/maps/icons/pinThingToDo.gif"},_addHotelRestaurantAttraction:function(a,c){var d=ta.retrieve("maps.map");var b=ta.retrieve("zft")||[];if(!b.contains(c)){b.push(c);ta.store("zft",b)}ta.servlet.HACSearch.filtersChanged();if(d){d.showType(a)}},hotels:function(c,a){var d=ta.retrieve("maps.map");var b=ta.retrieve("zft")||[];if($(a).checked){ta.maps.Sidebar._addHotelRestaurantAttraction("hotel",1)}else{b.erase(1);ta.store("zft",b);d.hideType("hotel")}ta.servlet.HACSearch.filter.update();return true},restaurants:function(c,a){var d=ta.retrieve("maps.map");var b=ta.retrieve("zft")||[];if(ta.id(a).checked){if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","sidebar_poi_check","restaurants")}ta.store("lma","BCACMap_Restaurants");ta.maps.Sidebar._addHotelRestaurantAttraction("restaurant",3)}else{if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","sidebar_poi_uncheck","restaurants")}b.erase(3);ta.store("zft",b);d.hideType("restaurant")}ta.servlet.HACSearch.filter.update();return true},attractions:function(c,a){var d=ta.retrieve("maps.map");var b=ta.retrieve("zft");if(ta.id(a).checked){if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","sidebar_poi_check","attractions")}ta.store("lma","BCACMap_ThingsToDo");ta.maps.Sidebar._addHotelRestaurantAttraction("attraction",2)}else{if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","sidebar_poi_uncheck","attractions")}b.erase(2);ta.store("zft",b);d.hideType("attraction")}ta.servlet.HACSearch.filter.update();return true},offers:function(b,a){if(a&&ta.id(a).checked){if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","sidebar_poi_check","special_offers")}ta.store("maps.offersOnly",true)}else{if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","sidebar_poi_uncheck","special_offers")}ta.remove("maps.offersOnly")}ta.servlet.HACSearch.filtersChanged();return true},disneyMarkerToggle:function(c,a){var b=a.id;var d=ta.retrieve("maps.map");if($(a).checked){d.showType(b)}else{d.hideType(b)}return true},landmarkData:{coffee:{query:"Coffee",iconIndex:4,action:"BCACMap_Coffee"},copy:{query:"Copy Center",iconIndex:5,action:"BCACMap_Copy"},shipping:{query:"Fedex, Shipping",iconIndex:6,action:"BCACMap_Shipping"},rail:{query:"Rail stations",iconIndex:10,action:"BCACMap_Rail"}},_landmarkSearchCallback:function(j,h,m){var b=ta.retrieve("maps.map");var a=b.mapBounds();var f=[];for(var e=0;e<h.results.length;e++){var k=h.results[e];var d=new Element("div");var g=k.titleNoFormatting;if(k.addressLines){k.addressLines.each(function(n){d.adopt(new Element("div").set("text",n))});g=k.addressLines.join(", ")}d.adopt(new Element("a",{href:map_gmaps_address_url+encodeURIComponent(g)}).set("text",map_drivingdirections));var c={lat:k.lat,lng:k.lng,customHover:{title:k.titleNoFormatting,titleUrl:k.url,contents:d}};var l=b.createLocation(k.lat,k.lng);if(a.containsLatLng(l)){f.push(c)}}b.replaceMarkers(f,j,Object.merge({},ta.maps.MARKER_HOTEL,{anchorX:5,anchorY:30,pinIndex:7,iconIndex:ta.maps.Sidebar.landmarkData[j].iconIndex}))},_landmarkSearch:function(b,c){var e=ta.retrieve("maps.map");if(!google.search.LocalSearch){ta.maps.Sidebar._landmarkSearch.delay(1000,this,[b,c]);return}var d=new google.search.LocalSearch();d.setCenterPoint(e.mapCenter());d.setResultSetSize(google.search.Search.LARGE_RESULTSET);d.setSearchCompleteCallback(this,function(){ta.maps.Sidebar._landmarkSearchCallback(b,d,c)});var a=function(){d.execute(ta.maps.Sidebar.landmarkData[b].query)};a.delay(250)},addLandmark:function(a){var c=ta.retrieve("maps.landmarks");var b=ta.retrieve("maps.map");if(b){b.showType(a)}if(!c.contains(a)){c.push(a)}ta.store("maps.landmarks",c);ta.maps.Sidebar._landmarkSearch(a,1)},toggleLandmark:function(c,a){var e=ta.retrieve("maps.map");var d=ta.retrieve("maps.landmarks");var b=a.getProperty("id").substr(8);if($(a).checked){ta.maps.Sidebar.addLandmark(b);ta.trackEventOnPage("dynamic_large_map","sidebar_poi_check",b)}else{d.erase(b);ta.store("maps.landmarks",d);e.hideType(b);ta.trackEventOnPage("dynamic_large_map","sidebar_poi_uncheck",b)}ta.servlet.HACSearch.filter.update();return true},reloadLandmarks:function(){var a=ta.retrieve("maps.landmarks");if(a){a.each(function(b){ta.maps.Sidebar._landmarkSearch(b)})}},togglePOI:function(c,d,g){var b=ta.retrieve("maps.map");var f=d.marker;var h=d.poiType;var e=ta.retrieve("maps."+h);var j=null;var k=-1;var a="";if(h=="airports"){k=9}else{k=8}if(ta.id(d).checked){if(!e.contains(f)){e.push(f);j=b.createLocation(f.lat,f.lng)}if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","sidebar_poi_check",h)}}else{e.erase(f);if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","sidebar_poi_uncheck",h)}}if(b){b.replaceMarkers(e,h,Object.merge({},ta.maps.MARKER_HOTEL,{anchorX:5,anchorY:30,pinIndex:7,iconIndex:k}));if(j!=null){b.zoomAndPanToFit(j.lat(),j.lng())}b.showType(h)}if(!g){ta.servlet.HACSearch.filter.update()}},_openAccordion:function(a,b,d){if(!a){return}if(!a.hasClass("on")){a.toggleClass("on")}var c=a.getNext("div");c.removeClass("hidden");if(!c.init){ta.maps.Sidebar._populatePoiAccordion(c,b,d)}},_populatePoiAccordion:function(c,b,e){if(!ta.retrieve("maps."+b)){ta.store("maps."+b,[])}var d=ta.retrieve("maps.nearbyPOIs")[b];var a=0;if(d!=null){d.markers.each(function(n){var g=(n.customHover.title.match(/[A-Z]{3}/)||++a);var f=e;if(n.locId){f=e+n.locId+"_"+g}else{f=e+g}var j=new Element("input",{type:"checkbox",name:f,id:f}).addEvent("click",function(o){ta.call("ta.maps.Sidebar.togglePOI",o)});var k=new Element("label",{"for":f}).set("text",n.customHover.title);var h=new Element("div",{"class":"poiContainer"});var m=new Element("div",{"class":"checkbox"});var l=new Element("div",{"class":"label"});m.adopt(j);l.adopt(k);j.marker=n;j.poiType=b;h.adopt(m);h.adopt(l);c.adopt(h)})}c.init=true},_closeAccordion:function(a,c){if(!a){return}if(a.hasClass("on")){a.toggleClass("on")}var b=$(a.getNext("div"));b.addClass("hidden")},toggleAirports:function(c,a,b){if(a.get("tag")!="div"){a=a.getParent("div")}if(!a.hasClass("on")){ta.maps.Sidebar._closeAccordion($("toggle_convention_centers"),"conventionCenters");if($("toggle_nearby_cities")){ta.maps.Sidebar._closeAccordion($("toggle_nearby_cities"),"nearbyCities")}ta.maps.Sidebar._openAccordion($("toggle_airports"),"airports","airport_")}else{ta.maps.Sidebar._closeAccordion($("toggle_airports"),"airports")}if(b){ta.servlet.HACSearch.filter.update()}},toggleConventionCenters:function(b,a){if(a.get("tag")!="div"){a=a.getParent("div")}if(!a.hasClass("on")){ta.maps.Sidebar._closeAccordion($("toggle_airports"),"airports");if($("toggle_nearby_cities")){ta.maps.Sidebar._closeAccordion($("toggle_nearby_cities"),"nearbyCities")}ta.maps.Sidebar._openAccordion($("toggle_convention_centers"),"conventionCenters","convention_center_")}else{ta.maps.Sidebar._closeAccordion($("toggle_convention_centers"),"conventionCenters")}ta.servlet.HACSearch.filter.update()},toggleNearbyCities:function(b,a){if(a.get("tag")!="div"){a=a.getParent("div")}if(!a.hasClass("on")){ta.maps.Sidebar.openNearbyCities()}else{ta.maps.Sidebar._closeAccordion($("toggle_nearby_cities"),"nearbyCities")}ta.servlet.HACSearch.filter.update()},openNearbyCities:function(b,a){ta.maps.Sidebar._closeAccordion($("toggle_airports"),"airports");ta.maps.Sidebar._closeAccordion($("toggle_convention_centers"),"conventionCenters");ta.maps.Sidebar._openAccordion($("toggle_nearby_cities"),"nearbyCities","cities_")},mapMorphed:function(a,e){if(a==0){var d=ta.retrieve("maps.landmarks");d.each(function(f){e.hideType(f)});$("MAPPROMO").setStyle("display","block")}else{if(a==1){var d=ta.retrieve("maps.landmarks");d.each(function(f){e.showType(f)});$("MAPPROMO").setStyle("display","none");var c=ta.remove("maps.morphBigSource")||"t";ta.store("lma","BCACMap_"+c+"_open")}}var b=ta.servlet.HACSearch.mapMorphed(a,e);return b},mapMoved:function(a,b){ta.maps.Sidebar.reloadLandmarks();return ta.servlet.HACSearch.mapMoved(a,b)},mapZoomed:function(b,a){ta.maps.Sidebar.reloadLandmarks();return ta.servlet.HACSearch.mapZoomed(b,a)},mapReset:function(){ta.maps.Sidebar.reloadLandmarks();if(pageServlet!="BusinessCenter"){ta.maps.Sidebar._clearLocation()}return ta.servlet.HACSearch.mapReset()},_removeLocation:function(){var a=ta.retrieve("maps.map");if(a){a.hideType("location")}},addLocationPopup:function(b,a){if($("add_location_text").get("text")==map_removeaddress){ta.maps.Sidebar._removeLocation();$("add_location_text").set("text",map_addaddress)}else{$("add_location").removeClass("hidden")}},closeAddLocationPopup:function(d,b){$("add_location").addClass("hidden");var a=$("add_location_input");if(a){a.value=map_addresstemplate;a.addClass("unfocused")}var c=$("add_location_input_filter");if(c){c.value="";c.addClass("unfocused")}if(ta.id("add_location_error")){ta.id("add_location_error").set("text","");ta.id("add_location_error").addClass("hidden")}if(ta.id("add_location_header")){ta.id("add_location_header").removeClass("error")}},clearAddLocationBox:function(b,a){if(a.hasClass("unfocused")){a.value="";a.removeClass("unfocused")}},_addLocation:function(c,a,f){var h=ta.retrieve("maps.map");if(!$("add_location")){var d=$("add_location_input");if(d){d.value=c;d.removeClass("unfocused")}var e=$("add_location_input_filter");if(e){e.value=c;e.removeClass("unfocused")}}var g=ta.id("REST_MAP");var b=ta.id("ATTR_MAP");if(!h&&g){h=g.map;ta.store("maps.map",h)}else{if(!h&&b){h=b.map;ta.store("maps.map",h)}}if(!a){ta.util.load.mapsLazy(function(){var k=new ta.maps.Geocoder();var j;if(h){j=h.mapBounds()}else{j=ta.maps.Sidebar._getStaticMapBounds()}if(j){k.setViewport(j)}k.getLatLng(c,ta.maps.Sidebar._addLocationCallback)})}else{ta.maps.Sidebar._addLocationCallback(a,null,f)}},_getStaticMapBounds:function(){var a=null;if(ta.maps.Bounds){try{var b=ta.id("STATIC_MAP_BOUNDS");if(b){var c=b.className;var k=/n(-?\d*\.\d+)/;var d=parseFloat(k.exec(c)[1]);k=/s(-?\d*\.\d+)/;var g=parseFloat(k.exec(c)[1]);k=/w(-?\d*\.\d+)/;var j=parseFloat(k.exec(c)[1]);k=/e(-?\d*\.\d+)/;var h=parseFloat(k.exec(c)[1]);if(d&&g&&h&&j){a=new ta.maps.Bounds(d,j,g,h)}}}catch(f){ta.util.error.record(f,"Sidebar - _getStaticMapBounds");a=null}}return a},clearLocation:function(b,a){ta.maps.Sidebar._clearLocation()},addLocation:function(f,d,a,g,c){var h="";var b;b=ta.id("add_location_input");if(b){h=b.value}var e=ta.id("add_location_input_filter");if(e){h=e.value}if(!ta.id("add_location")&&(h.length==0||h==map_enteraddress)){ta.maps.Sidebar._clearLocation();if(!(ta.id("REST_MAP")||ta.id("ATTR_MAP"))&&ta.servlet.HACSearch.filter){ta.servlet.HACSearch.filter.update()}return false}if(h!=map_enteraddress){ta.store("maps.address",h);ta.maps.Sidebar._addLocation(h,a,g);if(!(ta.id("REST_MAP")||ta.id("ATTR_MAP"))&&ta.servlet.HACSearch.filter){ta.servlet.HACSearch.filter.update()}}return false},_clearLocation:function(){ta.maps.Sidebar._removeLocation();ta.maps.Sidebar._clearLocationError();var a=$("add_location_input");if(a){a.value=map_enteraddress;a.addClass("unfocused")}var b=$("add_location_input_filter");if(b){b.value="";b.addClass("unfocused")}},_getVRAddressBar:function(){var a=ta.select(".vrAddress");if(a&&a.length==1){return a[0]}return null},_setLocationError:function(c){if(ta.id("add_location_header")&&ta.id("add_location_error")){ta.id("add_location_error").set("text",c).removeClass("hidden")}if($("add_location_header")){$("add_location_header").addClass("error")}else{var a=$("add_location_input");if(a){a.addClass("error")}var b=$("add_location_input_filter");if(b){b.addClass("error")}if($("add_location_text")){$("add_location_text").addClass("error")}}if(ta.id("SEARCH_WRAP")){ta.id("add_location_error").set("html",c).removeClass("hidden")}var d=ta.maps.Sidebar._getVRAddressBar();if(d){d.addClass("error")}},_clearLocationError:function(){if(ta.id("add_location_error")){$("add_location_error").addClass("hidden")}if($("add_location")){if($("add_location_text")){$("add_location_text").set("text",map_removeaddress)}$("add_location").addClass("hidden");$("add_location_header").removeClass("error");var a=$("add_location_input");if(a){a.value=map_addresstemplate}var b=$("add_location_input_filter");if(b){b.value=""}}else{var a=$("add_location_input");if(a){a.removeClass("error")}var b=$("add_location_input_filter");if(b){b.removeClass("error")}if($("add_location_text")){$("add_location_text").removeClass("error")}}var c=ta.maps.Sidebar._getVRAddressBar();if(c){c.removeClass("error")}},_addLocationCallback:function(n,h,g){if(n==null){if(ta.id("SEARCH_WRAP")){ta.maps.Sidebar._setLocationError('<div class="triangle"></div>'+map_addressnotfound3.replace("{0}",geoName));ta.id("add_location_input").blur();ta.trackEventOnPage("Search_Near_Map","submit","err_invalid");return}ta.maps.Sidebar._setLocationError(map_addressnotfound);return}ta.store("map.poi.changed",true);ta.store("map.poi",n.toUrlValue());var b=ta.retrieve("maps.map");if(!b&&!ta.servlet.hotelsMap.isMapOpen()){ta.store("map.delayedLoc",true);ta.store("map.delayedLoc.point",n);ta.store("map.delayedLoc.data",g);ta.servlet.HACSearch.filtersChanged();return}var a={},l={},c="",m=ta.retrieve("maps.address");if(b){a=b.mapCenter();l=new ta.maps.Location(a.lat(),a.lng());c=b.getAddressUrl(m)}else{b=ta.servlet.hotelsMap.map;a=b.getCenter();l=new ta.maps.Location(a.lat,a.lng)}var k=l.distanceFrom(n)/1609.344;if(k>100){if(ta.id("SEARCH_WRAP")){ta.maps.Sidebar._setLocationError('<div class="triangle"></div>'+map_addressnotfound3.replace("{0}",geoName));ta.id("add_location_input").blur();ta.trackEventOnPage("Search_Near_Map","submit","err_out_of_bounds");return}ta.maps.Sidebar._setLocationError(map_addressnotfound2.replace("{0}",geoName));return}ta.maps.Sidebar._clearLocationError();if(g){if(g.type=="AIRPORT"){var j="/BusinessCenter-g"+g.value+"-t4-";var f=[{infoOnLoad:true,lat:n.lat(),lng:n.lng(),locId:g.value,customHover:{title:g.name,contents:new Element("div").adopt(new Element("a",{href:j,target:"_blank",rel:"nofollow"}).set("text",map_findflights)).appendText(" | ").adopt(new Element("a",{href:c,target:"_blank",rel:"nofollow"}).set("text",map_drivingdirections))}}]}else{var e=pageServlet.replace("Redesign","");var f=[{infoOnLoad:true,lat:n.lat(),lng:n.lng(),locId:g.value,customHover:{title:g.name,titleUrl:g.url,url:"GMapsLC:info,g"+g.value+",ext,from="+e+",logAction=HACMap_info"}}]}}else{var f=[{infoOnLoad:true,lat:n.lat(),lng:n.lng(),customHover:{title:map_myaddress,address:m,titleUrl:c,contents:new Element("div").set("text",m).adopt(new Element("br")).adopt(new Element("a",{target:"_blank",rel:"nofollow",href:c}).set("text",map_drivingdirections))}}]}var o={anchorX:5,anchorY:30,pinSize:new ta.support.Size(23,28),pinOffset:102,pinIndex:1,hoverIndex:2,shadowSize:new ta.support.Size(23,28),shadowOffset:102,shadowIndex:0,iconSize:new ta.support.Size(19,23),iconOffset:18,iconIndex:0,iconOffsetX:2,iconOffsetY:2};if(ta.has("storeLocation")){ta.store("map.location.marker",f);ta.store("map.location.options",o)}if(ta.servlet.hotelsMap&&ta.servlet.hotelsMap.isMapOpen()){var d=null;if(h){d=new Element("div").addClass("addressHover").adopt(new Element("b").set("text",h.line1)).adopt(new Element("br")).adopt(new Element("p").set("text",h.line2)).outerHTML;ta.trackEventOnPage("Search_Near_Map","submit","address")}else{ta.trackEventOnPage("Search_Near_Map","submit","poi")}b.addCustomPin(n.x,n.y,d,f[0].locId);return}b.replaceMarkers(f,"location",o);b.showType("location");b.move(n.lat(),n.lng(),b.getZoom());if(ta.id("REST_MAP")||ta.id("ATTR_MAP")){updateList(null,null,ACTION_MAPCHANGED)}ta.store("hac.sortChanged","distLow");ta.servlet.HACSearch.filtersChanged()},morphBigPromo:function(b,a){ta.store("maps.morphBigSource","p");return ta.servlet.HACSearch.morphBig(b,a)},onTypeChange:function(){this.setOption("mt",this.gmap2.getCurrentMapType().getName());this.saveOptions()},clearFieldFocus:function(c,b,a){try{if(a&&b.value.trim()==b.defaultValue.trim()){b.value="";ta.id(b).removeClass("unfocused")}else{if(!a&&b.value==""){b.value=b.defaultValue;ta.id(b).addClass("unfocused")}}}catch(d){ta.util.error.record(d,"clearFieldFocus")}}};(function(a,c,b,d){if(!b.pages){b.pages={}}b.pages.hac=(function(f){var g=function(j){if(j){if(f.pages.hac.startNewSearch()){return}f.widgets.calendar.syncAllDatePickers();f.pages.hac.updateEmptyListWarning();f.pages.hac.updateLastMInuteCopyBlock();f.pages.hac.updateBlenderMapMarkers();var k=f.retrieve("lastminute.style.selected.dr");if(k){f.hac.filters.style.v2.visualUnselectAll();f.hac.filters.style.v2.visualUnselectAllDiv();f.hac.filters.style.v2.visualSelect(k);f.hac.filters.style.v2.visualSelectDiv(k);f.store("lastminute.style.selected.dr")}f.store("hac.progressBar")}c.filterFormUpdates=null},e=function(n){f.remove("maps.is_open");var l=f.id("LARGE_MAP");var m=f.id("SMALL_MAP");if(l&&m){if(f.trackEventOnPage){f.trackEventOnPage("dynamic_large_map","list_view_click")}l.setStyle("display","none");m.setStyle("display","block");f.servlet.HACSearch.updateMapSponsors();if(f.id("SPR_HTLS_RHS")){f.id("SPR_HTLS_RHS").setStyle("display","none")}f.servlet.HACSearch.hideMapSponsor();if(f.retrieve("addSponsorship")==1){f.servlet.HACSearch.updateSponsorAds("180X150",f.retrieve("addSponsorshipValue"))}if(n){filtersChanged()}f.servlet.HACSearch.filter.update();hideTitlePins();if(f.retrieve("moveResultSummary")){var j=f.id("HAC_SMRY");var k=f.id("HAC_RESULTS");if(j&&k){j.inject(k,"before")}}f.pages.hac.setLargeMapToggleActive(false)}},h=function(j){try{if(f.has("sponsor.active")&&j&&(j.get("tag")=="a"||j.get("tag")=="span"||j.get("tag")=="img")){f.store("sponsor.record_map_open")}$$(".hacMapAdPixelHolder").each(function(l){f.servlet.HACSearch._downloadTrackPixel(l)});if(f.has("sponsor.active")){f.servlet.HACSearch.updateSponsorAds("180X150")}if(typeof autoCloseWindowShade!="undefined"){autoCloseWindowShade()}}catch(k){f.util.error.record(k,"ta.servlet.HACSearch._updateMapFeatures")}};return{sponsors:{BEST_WESTERN:"sidebar_sponsor_bstWst",BEST_WESTERN_CA:"sidebar_sponsor_bstWstCa",HAMPTON_INN:"sidebar_sponsor_hampton",COMFORT_INN:"sidebar_sponsor_comfortinn",ECONO_LODGE:"sidebar_sponsor_econolodge",QUALITY_INN:"sidebar_sponsor_qualityinn",SLEEP_INN:"sidebar_sponsor_sleepinn",COMFORT_SUITES:"sidebar_sponsor_comfortsuites",COMFORT_INN_CA:"sidebar_sponsor_comfortinnca",QUALITY_INN_CA:"sidebar_sponsor_qualityinnca",HOLIDAY_INN:"sidebar_sponsor_holidayinn",SUPER_8_CA:"sidebar_sponsor_super8ca",RAMADA_CA:"sidebar_sponsor_ramadaca",COMFORT_FAMILY:"sidebar_sponsor_comfortfamily"},isHotelsRedesign2011:function(){if(f.has("hac.isHotelsRedesign2011")){return f.retrieve("hac.isHotelsRedesign2011")}if(c.pageServlet=="LastMinute"){f.store("hac.isHotelsRedesign2011",true);return true}var k=f.id("HAC_SMRY");var j=k&&k.hasClass("hotels_re_2011");f.store("hac.isHotelsRedesign2011",j);return j},isSearchComplete:function(){var j=f.retrieve("hac.settings.completeProportion")||1;if(c.filterProgress&&typeof(filterProgress.complete)=="number"&&(filterProgress.complete/filterProgress.total)<j&&(1+f.retrieve("hac.update.noChangeRequestCount"))<f.retrieve("hac.update.noChangeRequestLimit")){return false}return true},skipUpdate:function(){if(!f.isHotelsRedesign2011()){return false}return(c.pageServlet=="HACSearch"||f.isMetaHotelsRequest())&&!f.pages.hac.isSearchComplete()},startMetaHACUpdate:function(){if(c.filterProgress){if(f.has("hac.progressBar")){var j=f.retrieve("hac.progressBar");if(j){j.update(filterProgress.complete)}}}},timeoutProgressBar:function(){if(f.has("hac.progressBar")){var j=f.retrieve("hac.progressBar");if(j){j.stop()}}},yyyyMMddToDate:function(k){if(k.length<8){return new Date()}var n=Number(k.substring(0,4));var l=Number(k.substring(4,6));var j=Number(k.substring(6,8));var m=f.util.date.create(n,l,j);return m},startHacUpdateLM:function(n,o,q){var l=f.pages.hac.yyyyMMddToDate(o);f.widgets.calendar.setPageInDate(l);var j=f.pages.hac.yyyyMMddToDate(q);f.widgets.calendar.setPageOutDate(j);var r="lastminute.prog.title_"+n;if(f.has(r)){var m=f.retrieve(r);var p=null;if(f.has("ta.hac.progress.overlay")){p=f.retrieve("ta.hac.progress.overlay").container}else{p=f.id("HAC_PROGRESS_CONTAINER")}if(p){var k=p.getElement(".tipText");if(k){k.innerHTML=m}}}f.store("hac.filters.style.options","reset");f.servlet.HACSearch.changeCategory(null,null,"1",true);c.filterInProgress=false;if(c.filterProgress){filterProgress.complete=0;filterProgress.total=30}else{c.filterProgress={complete:0,totalDisplay:0,shown:0,totalInPrimaryGeo:0,totalIncludingNearbyCities:0,progressAvailableWithoutAutobroaden:0,total:30}}f.store("hac.progressBar");c.filterSequenceID=0;c.responseSequenceID=0;f.pages.hac.startHACUpdate()},startHACUpdate:function(){f.store("hac.update.hacAjaxDelay",10);f.store("hac.update.prevCompleteValue",-1);f.store("hac.update.noChangeRequestCount",0);f.store("hac.update.noChangeRequestLimit",20);f.pages.hac.updateHACData();f.store("hac.update.hacAjaxDelay",f.retrieve("hac.settings.updateDelay")||3000)},updateHACData:function(){try{f.pages.hac._updateHACData()}catch(j){f.util.error.record(j,"ta.pages.hac.updateData")}},startNewSearch:function(){var p,s,j,k,r,l,o,m,n,q;if(f.has("lastminute.onloadsearch")){p=f.id("lm_topline_div");if(p){s=0;j=f.retrieve("lastminute.onloadsearch");if(f.has("lastminute.onloadnextsearch")){s=f.retrieve("lastminute.onloadnextsearch")}else{s=j}s=s+1;if(s>3){s=1}if(j==s){k=j.toString();r=f.retrieve("lastminute.dr.indate_"+k);l=f.retrieve("lastminute.dr.outdate_"+k);o=new Date(r);f.widgets.calendar.setPageInDate(o);m=new Date(l);f.widgets.calendar.setPageOutDate(m);f.store("lastminute.style.selected.dr",k);q=p.getElement(".header");if(q){n=f.retrieve("lastminute.emptylist.msg_"+k);if(n){q.innerHTML=n}}return false}k=s.toString();r=f.retrieve("lastminute.dr.indate_"+k);l=f.retrieve("lastminute.dr.outdate_"+k);f.store("lastminute.onloadnextsearch",s);f.store("lastminute.style.selected.dr",k);f.pages.hac.startHacUpdateLM(k,r,l);return true}}return false},_updateHACData:function(){if(!f.pages.hac.skipUpdate()&&c.pageServlet!="LastMinute"){f.pages.hac.processFilterChanges()}f.pages.hac.updatePagingLinks();var j=true;if(c.filterProgress){if(f.has("hac.progressBar")){var k=f.retrieve("hac.progressBar");if(k){k.update(filterProgress.complete)}}f.pages.hac.updateOrphanCounts();if(filterProgress.complete==f.retrieve("hac.update.prevCompleteValue")){f.store("hac.update.noChangeRequestCount",f.retrieve("hac.update.noChangeRequestCount")+1)}else{f.store("hac.update.prevCompleteValue",filterProgress.complete);f.store("hac.update.noChangeRequestCount",0)}if(!f.pages.hac.isSearchComplete()){j=false;try{if(!f.has("hac.progressBar")){if(f.has("hac.settings.timeout")){var l=f.retrieve("hac.settings.timeout")/2;f.store("hac.progressBar",new f.widgets.ProgressBar(f.overlays.Factory.createHACProgressOverlay().container,{limit:filterProgress.total,overload:100,speed:l}).start());f.pages.hac.timeoutProgressBar.delay(f.retrieve("hac.settings.timeout"))}else{f.store("hac.progressBar",new f.widgets.ProgressBar(f.overlays.Factory.createHACProgressOverlay().container,{limit:filterProgress.total}).start())}}f.store("hac.update.hacAjaxDelay")}catch(m){f.util.error.record(m,"hac progress bar")}f.pages.hac.showDateSearch(false);c.filterInProgress=false;f.store("hac.update.continuation",true);filtersChanged.delay(f.retrieve("hac.update.hacAjaxDelay"))}else{if(f.has("hac.progressBar")){f.retrieve("hac.progressBar").stop()}f.pages.hac.showDateSearch(true);if(c.windowShade){showWindowShade()}if(c.monikerLocs){loadPageMonikers(c.monikerLocs)}}if(c.pageServlet!="LastMinute"){c.filterProgress=null}if(typeof(f.widgets.Saves)!="undefined"&&!f.isMetaHotelsRequest()){f.widgets.Saves.getSavesCall(true)}}if(c.pageServlet=="LastMinute"){g(j);return}f.pages.hac.updateStaticMap();f.pages.hac.updateMapData();f.pages.hac.updateNeighborhoodForm();f.pages.hac.updateRadiusForm();if(!f.has("hotels_auto_broaden.enabled")){f.hac.filters.style.grayOutTabs()}f.hac.filters.style.showOrHideStyleButtons();c.filterFormUpdates=null;f.pages.hac.updateHACRelatedCopy();f.pages.hac.updateTypeAheadAddress();if(f.has("hac.skinsEnabled")&&typeof(f.pages.hac.skin)!="undefined"){f.pages.hac.skin.updateSkin()}},updateTypeAheadAddress:function(){var k=f.id("add_location_input");var m=f.id("add_location_input_filter");var l=f.id("small_location_input");var j=f.retrieve("maps.address");if(j){if(k){k.value=j}if(m){m.value=j}if(l){l.value=j}}},removeBreadcrumb:function(m){var n,j,l,k;try{if(!m||!m.className){return}n=false,k=false;if(m.className.indexOf("name_")!=-1){n=m.className.match(/name_(\w+)/)[1]}if(m.className.indexOf("index_")!=-1){k=m.className.match(/index_(\w+)/)[1]}if(n=="dates"){f.pages.hac.clearDates()}else{if(n=="zfb"){j=a.getElement("#brand_initial .default");f.pages.hac.resetFilterToDefault(j)}else{if(n=="nameContains"){f.servlet.HACSearch.nameFilterReset()}else{if(n=="zff"){if(f.hac.filters.style.getVersion()>=2){f.hac.filters.style.v2.filterSelect("reset");filtersChanged()}}else{if(n=="near"){a.getElements("#nearbyCities input").each(function(p){p.checked=false});filtersChanged()}else{if(n=="offersOnly"){f.remove("maps.offersOnly");l=f.id("offersOnly");if(l&&l.checked){l.checked=false}filtersChanged()}else{if(n&&!isNaN(parseInt(k,10))){j=f.id(n+"_"+k);f.pages.hac.resetFilterToDefault(j)}}}}}}}f.id(m).getParent().dispose()}catch(o){f.util.error.record(o,"hac.removeBreadcrumb")}},resetFilterToDefault:function(j){if(j){j.checked="checked";f.servlet.HACSearch.handleCheckSetOnClick(null,j)}},clearDates:function(){f.run("ta.overlays.toggleOnSearchAll",{},"checkIn");filtersChanged(null,true)},removeAllFilters:function(){if(!f.isSmartDealsFilters()){f.run("ta.overlays.toggleOnSearchAll",{},"checkIn")}doClearFilters()},onMiniMapAddressSearch:function(l,k,j){if(l){new Event(l).stop()}f.servlet.HACSearch.reconcileLocations(false);if(!j){if(!f.servlet.HACSearch._isMapLoaded()){f.store("maps.address_search_deferred",f.servlet.HACSearch._doAddressSearch)}else{f.servlet.HACSearch._doAddressSearch()}f.pages.hac.loadOrShowLargeMap(l,k,true)}else{f.remove("map.delayedLoc");if(!f.servlet.HACSearch._isMapLoaded()){f.store("maps.address_search_deferred",f.servlet.HACSearch._doFilterAddressLookup);f.util.pending.waitForFile("createmap","ta-maps.js",function(){f.store("maps.callback","ta.servlet.HACSearch.createMapCaller");f.util.load.maps()})}else{f.servlet.HACSearch._doFilterAddressLookup()}}},staticMapAddrSearch:function(l){if(l){new Event(l).stop()}var j=f.id("small_location_input");var k="";if(j){k=j.value;f.store("maps.address",k);f.maps.Sidebar._addLocation(k);if(f.trackEventOnPage&&k){f.trackEventOnPage("static_map","poi_search_go_click",k)}}},onSmallMapTypeAheadHACRedesign:function(j,l,k){if(f.trackEventOnPage&&j&&j.value){f.trackEventOnPage("static_map","poi_search",j.value)}f.util.load.mapsLazy(function(){f.servlet.HACSearch.onSelectLocationTypeAhead(j,l,k,true)})},updateHACRelatedCopy:function(){try{var y=f.has("hac.headerCopy");if(f.retrieve("isDaoDao")&&("Hotels"===pageServlet||"HACSearch"===pageServlet||"DaoDaoCertifiedHotels"===pageServlet||"LianSuo"===pageServlet)){y=false}if(y){var w=f.id("RSLTHDR");var q=a.getElement("#HEAD h1");var p=f.id("HEADING");if(w){w.setContent(f.remove("hac.headerCopy"))}if(p&&f.has("hac.h1Copy")){p.setContent(f.remove("hac.h1Copy"))}if(q&&f.has("hac.headingCopy")){q.setContent(f.remove("hac.headingCopy"))}if(f.has("hac.titleCopy")){a.title=f.remove("hac.titleCopy")}}var k=f.id("SMALL_MAP");if(k&&f.has("hac.mapCopy")){var l=k.getElement(".hvrIE6 a");if(l){l.setContent(f.remove("hac.mapCopy"))}}if(f.has("hac.summaryCopy")){var v=f.id("hac_smry_title");if(v){v.setContent(f.remove("hac.summaryCopy"))}}var m=false;var j=f.id("SORT_FORM_LINKS_COPY");if(j){j.getParent().show();var x=f.id("SORT_FORM_LINKS");if(x){j.setStyle("display","block").innerHTML=x.innerHTML}else{j.hide();m=true}}var o=false;var u=f.id("sortGroupCopy");if(u){var n=f.id("sortGroup");if(n){var t=f.id("BEST_VALUE_FORM_COPY").setStyle("display","block").getElement("label");var s=f.id("tvCountCopy");u.checked=n.checked;if(n.disabled){u.disabled="disabled";u.addClass("disabled");t.addClass("disabled")}else{u.removeProperty("disabled");u.removeClass("disabled");t.removeClass("disabled")}s.innerHTML=f.id("tvCount").innerHTML}else{f.id("BEST_VALUE_FORM_COPY").hide();o=true}}if(m&&o){j.getParent().hide()}if(f.isMetaHotelsRequest()){f.pages.hac.updateUnavailableLabels()}}catch(r){f.util.error.record(r,"updateHACRelatedCopy failed to update")}},updatePagingLinks:function(){var j=f.id("map_pager");var k=f.id("pager_top2");if(k&&c.processLinks){processLinks(k)}if(j){if(k){j=j.getElement("div.pgLinks");if(j){j.innerHTML=k.innerHTML;if(typeof behavior!="undefined"){behavior.apply(j)}if(c.processLinks){processLinks(j)}}}else{j.innerHTML='<div class="pgLinks"></div>'}}},updateBlenderMapMarkers:function(){var j=f.retrieve("blender_map_markers");var k=f.id("BLEND_MAP");if(k&&k.map){k.map.replaceMarkers(j,"hotel",Object.merge({pid:1360,titlePID:1360},f.maps.MARKER_HOTEL))}},updateEmptyListWarning:function(){var j=f.id("lm_topline_div");if(j){j.setStyles({display:"block"});if(f.has("lastminute.onloadsearch")){f.setEvtCookie("NoAvailability","Open","Page View",1,null)}}},updateLastMInuteCopyBlock:function(){if(f.has("lastminute.onloadsearch")){f.store("lastminute.onloadsearch");return}var k=f.id("LM_COPY_BLOCK_RELAY").dispose();var j=f.id("LM_COPY_BLOCK");if(k){if(j){j.setContent(k.innerHTML)}k.empty()}},lastMInuteCopyBlockShowMore:function(){var m=f.id("LM_COPY_BLOCK_2L");var k=f.id("LM_COPY_BLOCK_MORE_TEXT");var j=f.id("LM_COPY_BLOCK");if(j&&m&&k){var l=m.innerHTML+k.innerHTML;j.setContent(l)}},updateNeighborhoodForm:function(){var q=f.retrieve("neighborhoodOverlayForm");var o=null;if(q){var m=f.id("LOCATION_FILTER_CONTENTS");if(m){o=q.getParent();q.inject(m)}}if(o&&q){q.inject(o)}if(c.filterFormUpdates){var l=c.filterFormUpdates.neighborhoodCount;var k=f.id("NEIGHBORHOODS_LINK_0");var j=f.id("NEIGHBORHOODS_LINK_1");var n=f.id("NEIGHBORHOODS_LINK_N");if(!c.filterFormUpdates.neighborhoodCount){if(k){k.removeClass("hidden")}if(j){j.addClass("hidden")}if(n){n.addClass("hidden")}}else{if(c.filterFormUpdates.neighborhoodCount==1){if(k){k.addClass("hidden")}if(j){j.removeClass("hidden")}if(n){n.addClass("hidden")}}else{if(k){k.addClass("hidden")}if(j){j.addClass("hidden")}if(n){n.removeClass("hidden");var p=n.getElement("b");if(p){p.set("html",l)}}}}}},updateRadiusForm:function(){try{if(c.filterFormUpdates&&c.filterFormUpdates.radiusNote){var p=a.getElement("#HOTEL_FILTERS fieldset.radius span.note");if(p){p.innerHTML=c.filterFormUpdates.radiusNote}}}catch(s){f.util.error.record(s,"ta.servlet.HACSearch.updateRadiusForm_note")}try{var t=c.filterFormUpdates&&c.filterFormUpdates.radiusPoi;var m=-1;var q=a.getElements("#HOTEL_FILTERS fieldset.radius div.chkSet");if(q&&q.length){for(var k=t?1:0;k<q.length;k++){var u=q[k];var r=u.getElement("label span");var l=false;if(r){var v=r.innerHTML.replace(/\D/g,"");var o=parseInt(v,10);if(o){if(o>m){m=o}else{l=true}}}if(!l){u.show()}}}}catch(s){f.util.error.record(s,"ta.servlet.HACSearch.updateRadiusForm_counts")}try{if(c.filterFormUpdates&&c.filterFormUpdates.radiusAutoSelected){var j=a.getElement("#rad_"+c.filterFormUpdates.radiusAutoSelected);if(j){j.checked=true}}}catch(s){f.util.error.record(s,"ta.servlet.HACSearch.updateRadiusForm_autoselect")}try{if(c.filterFormUpdates&&c.filterFormUpdates.radiusShowIfHidden){var n=$$("#HOTEL_FILTERS fieldset.radius, #HOTEL_FILTERS div.spacerDivRadius");if(n){n.show()}}}catch(s){f.util.error.record(s,"ta.servlet.HACSearch.updateRadiusForm_showradius")}if(f.hac.filters.style.getVersion()>=2){f.hac.filters.style.v2.setHeaderButtons()}},updateMapData:function(){var p,j,s,m,q,r,t,o,l,n,k,u;if(!f.retrieve("maps.is_open")){p=$$("div.nmbrIcon");if(p){p.addClass("suppress")}}if(f.has("maps.map")&&f.has("maps.marker-data")){f.util.pending.waitForFn("update_markers","ta.maps.Factory.updateMapMarkers")}j=f.retrieve("maps.map");if(c.mapOps&&j){j.move(mapOps.lat,mapOps.lng,mapOps.zoom,true)}if(f.has("maps.nearby")){s=f.remove("maps.nearby");m=f.retrieve("nearbycities.container");$$(m+" fieldset.nearbyCities input[type=checkbox]").each(function(v){var w=s.contains(v.id);f.servlet.HACSearch.setCheckSetChecked(v,w);if(m==="#SIDEBAR"){updateFilterStyle(v,w)}})}u=f.id("LARGE_MAP");if(u){q=u.getElement(".showing");if(q){r=f.id("ACCOM_OVERVIEW");t=q.getElement("span");if(r){r=r.getElement(".pagination .pgCount");if(r){t.innerHTML=r.innerHTML}else{t.innerHTML="0";o=false}}else{t.innerHTML="0";o=false}}}l=f.retrieve("maps.marker-data");if(l){Object.each(f.pages.hac.sponsors,function(w,v){n=l[v];k=f.id(w);if(k){k.checked=n}})}},updateStaticMap:function(){if(f.id("STATIC_MAP")){var k=f.retrieve("maps.staticUrl");var l=f.id("STATIC_MAP");var j=f.retrieve("maps.marker-data");if(j&&j.hotel&&j.hotel.markers){if(c.mapOps){l.src=k}}if(!f.retrieve("maps.is_open")&&!f.has("maps.small_map_pxl_load")){$$(".thumbPixelHolder").each(function(m){f.servlet.HACSearch._downloadTrackPixel(m)});f.store("maps.small_map_pxl_load",true)}}},updateOrphanCounts:function(){var j=$$("div.orphan");if(c.filterProgress){j.each(function(o){var p=o.getElement("i");var k=o.getElement("b");var n=o.getElement("span");var m;var l;if(f.servlet.Hotel.isHotelsServlet()&&filterProgress.hasOwnProperty("progressAvailableWithoutAutobroaden")&&filterProgress.progressAvailableWithoutAutobroaden>-1){m=filterProgress.progressAvailableWithoutAutobroaden;l=filterProgress.progressAvailableWithoutAutobroaden}else{m=filterProgress.shown;l=(f.servlet.HACSearch.isNearbyCitiesHidden())?filterProgress.totalInPrimaryGeo:filterProgress.totalIncludingNearbyCities}if(p){p.set("html",m)}if(k){k.set("html",l)}var r;if(l>0){r=a.getElements(".pgCount .orphan");r.each(function(s){s.removeClass("hidden")});r=a.getElements(".hotelsCount.orphan");r.each(function(s){s.removeClass("hidden")})}else{r=a.getElements(".pgCount .orphan");r.each(function(s){s.addClass("hidden")});r=a.getElements(".hotelsCount.orphan");r.each(function(s){s.addClass("hidden")})}var q=(f.servlet.HACSearch.isNearbyCitiesHidden())?filterProgress.totalInPrimaryGeo:filterProgress.totalIncludingNearbyCities;if(n&&filterProgress.shown==q){n.setStyles({display:"none"})}})}},showDateSearch:function(k){var j=f.id("HAC_BTN");if(j){if(k){j.removeProperty("disabled");j.removeClass("disabled")}else{j.setProperty("disabled",true);j.addClass("disabled")}}},updatePropertyTypeFilter:function(j,n){var s,l,y,t,k,o,z,w,r;if(j){s=j.getElement("fieldset."+n.name);l=s&&s.hasClass("itemsMatchCounts");y=s&&s.hasClass("hasClickOnCount");t=s?s.getElement("input.master"):null;k=t&&!t.checked;o=(s&&s.hasClass("hideDisabledCounts"))?false:true;z=s&&s.hasClass("neverDisable");w=f.id(n.name+"Unchecked");r=w?w.value.split(","):null}var q=a.getElement("fieldset.propType");if(n.name=="zfd"&&q){var A=q.getElements("input");var v={};A.each(function(B){if(B.checked){v[B.value]=true}});var m=new StringBuffer();var x=(c.filterFormUpdates&&c.filterFormUpdates.propertyTypeName)?c.filterFormUpdates.propertyTypeName:f.id("zfd_toggle").innerHTML;m.append('<p id="zfd_toggle" class="filterHeading hvrIE6" onclick="ta.call(\'ta.util.Toggle.siblings\', event)">');m.append(x);m.append("</p>");var u=false;n.items.each(function(I){var H=n.name+"_"+I.value;var D=H+"_count";var F=H+"_lbl";var B=v[I.value];if(B){u=true}var G=(I.count<1&&I.value!==0);var C="ta.call('ta.servlet.HACSearch.handleCheckSetOnClick', event);";var E=I.value===0?' id="zfd_default" ':"";m.append("<div");m.append(E);m.append(' class="chkSet">');m.append('<input id="');m.append(H);if(I.value===0){if(B){m.append('" class="default" type="checkbox" onclick="');m.append(C);m.append('" checked="checked" value="')}else{m.append('" class="default" type="checkbox" onclick="');m.append(C);m.append('" value="')}}else{if(B){m.append('" type="checkbox" onclick="');m.append(C);m.append('" checked="checked" value="')}else{m.append('" type="checkbox" onclick="');m.append(C);m.append('" value="')}}m.append(I.value);m.append('" name="');m.append(H);m.append('" id="');m.append(H);m.append('"');if(G){m.append(' disabled="" ')}m.append(" >");m.append('<label id="');m.append(F);m.append('" for="');m.append(H);m.append('" class="');if(G){m.append("disabled")}m.append('">');m.append(I.label);m.append('<span id="');m.append(D);if(!o){m.append('" style="display:none;">&nbsp;(')}else{m.append('" style="display:inline;">&nbsp;(')}m.append(I.count);m.append(")</span>");m.append("</label></div>")});q.set("html",m.toString());if(!u){var p=a.getElementById("zfd_0");if(p){p.checked=true}}}},processFilterChanges:function(){var m=f.id("HOTEL_FILTERS"),l=f.id("PROPTYPE_BOX"),k=f.id("PROPTYPE_BOX_LEFTNAV"),j;if(f.hac.filters.style.getVersion()>=2){f.hac.filters.style.v2.setHeaderButtons()}if(c.filterCounts){filterCounts.each(function(v){var y,n,p,q,o,w,x,s,r;if(!v){return}if(v.name=="zfd"){f.pages.hac.updatePropertyTypeFilter(m,v);return}var u=[];if(m){y=m.getElement("fieldset."+v.name);n=y&&y.hasClass("itemsMatchCounts");p=y&&y.hasClass("hasClickOnCount");q=y?y.getElement("input.master"):null;o=q&&!q.checked;w=(y&&y.hasClass("hideDisabledCounts"))?false:true;x=y&&y.hasClass("neverDisable");s=f.id(v.name+"Unchecked");r=s?s.value.split(","):null}var t=null;v.items.each(function(O){var C,T;if(O==null||v.name=="zfd"){return}if(v.name=="cat"){if(l){var N="."+v.name+"_"+O.value;C=l.getElement(N+" .label span");var A=l.getElement("."+v.name+"_"),J=l.getElement(N+" label"),B=l.getElement(N+" input"),U=l.getElement("."+v.name+"_"+O.value+" span");if(B&&J){if(O.count===0){$$(B).setProperty("disabled",true);$$(B).addClass("disabled");$$(J).addClass("disabled");$$(A).addClass("disabled")}else{$$(B).removeProperty("disabled");$$(B).removeClass("disabled");$$(J).removeClass("disabled");$$(A).removeClass("disabled")}}if(O.value===1){if(f.retrieve("p13n.hotelsJfyEnabled")){filterCounts.each(function(V){if(V){if(V.name=="zff"&&V.items.length>0){O.count=V.items[0].count}}})}}if(C){T=new Element("span");T.set("text",O.count);T.replaces(f.id(C))}else{if(U){T=new Element("span");T.set("class","tab_count");T.set("text","("+O.count+")");T.replaces(U)}}if(k){var D=k.getElement(N+" span"),H=k.getElement(N+" label"),K=k.getElement(N+" input");T=new Element("span");T.set("text",O.count);if(D){T.replaces(D)}if(O.count===0){H.addClass("disabled");K.addClass("disabled");K.disabled=true}else{H.removeClass("disabled");K.removeClass("disabled");K.removeProperty("disabled")}}}else{l=f.id("HAC_TAB_CONTAINER");if(l){l=f.id(l);C=l.getElement("."+v.name+"_"+O.value+" .label span");var G=l.getElement("."+v.name+"_"+O.value);if(G){if(O.count===0){G.addClass("disabled");G.removeClass("hvrIE6")}else{G.removeClass("disabled");G.addClass("hvrIE6")}}if(C){T=new Element("span");T.set("text",O.count);T.replaces(f.id(C))}}}}if(v.name=="zfb"){var z=f.id(v.name+"_"+O.value+"_i");if(z){updateFilterCount(z,O.count,false,w,x)}var F=f.id(v.name+"_"+O.value+"_a");if(F){updateFilterCount(F,O.count,false,w,x)}return}if(v.name=="zff"){if(f.hac.filters.style.getVersion()>=2){var M="narrow-geo-parent"==O.label;var S="all"==O.label&&f.has("hotels_auto_broaden.enabled");var Q=(O.count>0||M||S);f.hac.filters.style.v2.setEnabled(O.value,Q,O.count,M)}}u.push(String(O.value));j=f.id(v.name+"_"+O.value);if(!j){if(n){var P=(r==null)||(!r.contains(String(O.value)));var R=createCheckSet(v.name,O.value,O.label||"undefined",O.count,p);if(t){R.inject(t.getParent("div.chkSet"),"after")}else{if(y.getElement("div.chkSet")){R.inject(y.getElement("div.chkSet"),"before")}else{R.inject(y.getElement("input.checkedIndices"),"before")}}var E=R.getElement("input[type=checkbox]");E.onclick=function(V){f.call("ta.servlet.HACSearch.handleCheckSetOnClick",V,E)};f.servlet.HACSearch.setCheckSetChecked(E,P);j=f.id(v.name+"_"+O.value)}else{return}}if(v.name==="prng"){var L=j.getNext("label");var I=L.getElement("span");if(I){L.innerHTML=O.label+" ";I.inject(L)}}updateFilterCount(j,O.count,o,w,x);if(n&&!y.getElement("p").hasClass("closed")){j.getParent("div.chkSet").style.display="block"}t=j});if(n){y.getElements("div.chkSet").each(function(A){var z=A.getElement("input");if(!u.contains(z.value)){A.style.display="none";if(!x){z.disabled=true;z.addClass("disabled")}}})}})}c.filterCounts=null},loadOrShowLargeMap:function(n,m,l,k){if(floatingMapCSS&&!f.retrieve("ta.floatingMapCSS")){f.store("ta.floatingMapCSS",new Asset.css(floatingMapCSS))}if(n){new Event(n).preventDefault()}c.windowShade=false;f.store("maps.is_open",true);f.servlet.HACSearch.hideMapTeaser();var j=f.pages.hac.showLargeMap(null,m,k);if(j){return}if(l){f.servlet.HACSearch.filter.update()}if(f.id("SMALL_MAP")){f.id("SMALL_MAP").setStyle("display","none")}if(f.id("SPR_HTLS_RHS")){f.id("SPR_HTLS_RHS").setStyle("display","block")}$$("#LARGE_MAP .sponsorTrkHolder").each(function(o){f.servlet.HACSearch._downloadTrackPixel(o)});if(f.retrieve("maps.is_open")){showTitlePins()}if(f.trackEventOnPage&&k){f.trackEventOnPage("static_map","large_map_click",k)}f.pages.hac.activateMap()},activateMap:function(){var j=f.id("LARGE_MAP");if(!j){return}if(!f.pages.hac._isMapLoaded()){f.store("maps.create_called",true);f.store("maps.landmarks",[]);if(f.has("sponsor.record_map_open")){f.remove("sponsor.record_map_open");new Request({url:"/ActionRecord?action=sponsor_hacmap_open"}).send()}if(!f.has("maps.suppressHACActionRecord")){f.store("lma",f.servlet.HACSearch.getLoggingName()+"open")}f.util.load.LocalSearch();f.util.load.mapsLazy(function(){j.setStyle("display","block");f.servlet.HACSearch.showMapSponsor();f.servlet.HACSearch.updateSponsorAds("180X150");f.servlet.HACSearch.createMapCaller()})}else{if(!f.has("maps.landmarks")){f.store("maps.landmarks",[])}if(f.has("map.delayedLoc")){f.maps.Sidebar._addLocationCallback(f.retrieve("map.delayedLoc.point"),f.retrieve("map.delayedLoc.data"))}j.setStyle("display","block");f.servlet.HACSearch.showMapSponsor();f.servlet.HACSearch.updateSponsorAds("180X150")}var k=f.retrieve("maps.map");if(k){k.checkResize()}},showLargeMap:function(m,l,j){if(m){new Event(m).preventDefault()}if(typeof pageServlet!="undefined"&&pageServlet=="HACSearch"){h(l);f.pages.hac.setLargeMapToggleActive(true);if(f.trackEventOnPage&&j){f.trackEventOnPage("static_map",j)}}else{var k=f.servlet.HACSearch.buildHACUrlParamString();if(f.setEvtCookie&&j){f.setEvtCookie("static_map","large_map_click",j,"",getHACFormURL()+k)}f.store("hac.showLargeMap",true);updateResults(true);return true}return false},_isMapLoaded:function(){return f.has("maps.map")||f.has("maps.create_called")},hideLargeMap:function(){e(true)},setLargeMapToggleActive:function(j){$$(".largeMapView").each(function(k){j?k.addClass("activeView"):k.removeClass("activeView")});$$(".staticMapView").each(function(k){j?k.removeClass("activeView"):k.addClass("activeView")})},poiSetup:function(j){var k=f.id("small_location_input");if(typeof j=="string"&&k){k.value=j;k.removeClass("unfocused")}f.servlet.HACSearch.showMapTeaser()},hacSortChangedToValue:function(j){if(f.retrieve("hotels.redesignEnabled")){f.hac.filters.changeSort(j);if(f.common&&f.common.dmp&&f.common.dmp.isEnabled()){f.common.dmp.sendAjaxBehavior("HotelsSortOrder",j)}}else{f.store("hac.sortChanged",j);var k=c.pageServlet&&c.pageServlet=="Hotels";if(f.servlet.Hotel){k=f.servlet.Hotel.isHotelsServlet(k)}filtersChanged(null,k)}},hacSortChangedToValueWithoutUpdateResults:function(j){f.store("hac.sortChanged",j);if(f.common&&f.common.dmp&&f.common.dmp.isEnabled()){f.common.dmp.sendAjaxBehavior("HotelsSortOrder",j)}},hacSortChanged:function(j){if(j&&j.value){$$(".srtOrder").each(function(k){k.value=j.value});f.pages.hac.hacSortChangedToValue(j.value)}},hacSortChangedLP:function(){f.store("hide_price_msg_hotels",true);f.hac.filters.changeSort("priceLow")},teaserYesClick:function(){f.servlet.HACSearch.hideMapTeaser();f.pages.hac.loadOrShowLargeMap(null,null,true,"teaser_yes_click")},updateUnavailableLabels:function(){var j,k;if(c.unavailableLabels){j=a.getElement(".showUnavailable");k=a.getElement(".hideUnavailable");if(j&&k){j.set("text",unavailableLabels.showUnavailableLabel);k.set("text",unavailableLabels.hideUnavailableLabel);if(unavailableLabels.unavailableCount>0){if(unavailableLabels.showingAvailable){j.hide();k.show()}else{k.hide();j.show()}}else{k.hide();j.hide()}}}else{j=a.getElement(".showUnavailable");k=a.getElement(".hideUnavailable");if(j){j.hide()}if(k){k.hide()}}}}}(b))}(document,window,ta));ta.hac.filters.style={getVersion:function(){if(ta.id("STYLE2HEADER")!==null||ta.id("STYLE2HEADER_V3")!==null){return 2}return -1},getTabs:function(){return $$(".filter_header_v3 #PROPTYPE_BOX .tab")},visualClickTab:function(b){var a=ta.hac.filters.style.getTabs();if(!a||!b){return}Array.each(a,function(c){ta.hac.filters.style.visualUnselectTab(c);if(c.hasClass(b)){ta.hac.filters.style.visualSelectTab(c);ta.store("styleButtonCat",b)}});ta.hac.filters.style.showOrHideStyleButtons()},resetToDefaultTab:function(){var a=ta.hac.filters.style.getTabs();if(a){try{ta.hac.filters.style.visualClickTab("cat_1");ta.hac.filters.style.showOrHideStyleButtons()}catch(b){}}},getStyleCategoryInt:function(){var a=ta.retrieve("styleButtonCat")||"cat_1";var b=a.match(/cat_(\d+)$/);return(b!=null&&b.length==2)?Number(b[1]):1},getFilterTable:function(){var a=ta.retrieve("styleButtonCat")||"cat_1";return ta.id("js_filter_table_"+a)||ta.id("js_filter_table")},visualSelectTab:function(a){a.removeClass("sprite-tab-idle");a.addClass("selected");a.addClass("sprite-tab-active")},visualUnselectTab:function(a){a.removeClass("selected");a.removeClass("sprite-tab-active");a.addClass("sprite-tab-idle")},grayOutTabs:function(){var a=ta.hac.filters.style.getTabs();if(!a){return}try{Array.each(a,function(d){d.removeClass("inactive");var f=ta.id(d.id+"_invisible");if(f){d.onclick=f.onclick;d.getElement("a").onclick=f.getElement("a").onclick}var e=d.getElement(".tab_count");if(!e){return}var c=e.innerHTML.match(/\d+/);if(!c||c.length<1){return}if(c[0]<1){d.addClass("inactive");d.onclick="";d.getElement("a").onclick="return false;"}})}catch(b){return}},showOrHideStyleButtons:function(){var f=ta.hac.filters.style.getStyleCategoryInt();var b=ta.id("tab_horizontal_line");var a=ta.hac.filters.style.getVersion();if(!b||!f||a<2){return}function e(h,g){if(!h){return}else{if(h.isVisible()&&!g){h.hide()}else{if(!h.isVisible()&&g){h.show()}}}}var c=true;var d=ta.select(".style_button_container");Array.each(d,function(h){var g=(ta.hac.filters.style.getFilterTable()&&h.hasClass("cat_"+f)&&(f>=1&&f<=3)&&!h.hasClass("jfy_hidden"));if(g||h.hasClass("jfy_hidden")){c=false}e(h,g)});e(b,c)},hover:function(){},innsClick:function(){},click:function(){},clear:function(){},reset:function(){ta.store("hac.filters.style.options","reset")},handleLHN:function(){}};(function(){var f=ta.hac.filters.style.getFilterTable;var l=ta.hac.filters.style;function p(Q){return(Q==="0"||Q==="25")}var G=function(S,T,Q){var R=S.className;var U=R.replace(T,Q);if(R===U){return false}S.className=U;return true};var o=function(R){if(R.get("class").match(/js_filter_name/)){return o(R.getParent())}var Q=R.get("class").match(/js_zff_(\d*)/);if(Q===null){return null}return Q[1]};var z=function(V,T,R){var S=V.getElement(".js_filter_name");if(S){G(S,T,R);var U=V.getElement(".js_filter_count");G(U,T,R);var Q=V.getElement(".js_filter_image");G(Q,T,R)}};var g=function(R){var Q=R.slice(0,4);if(Q==="zff_"){R=R.slice(4)}return R};var C=function(Q){if(Q===null){return}Q.checked=true;u()};var H=function(){var Q;if(!f()){return false}Q=false;f().getElements("td").each(function(R){if(R.hasClass("autobroadening")){Q=true}});return Q};var E=function(){if(!f()){return true}var Q=true;f().getElements("td").each(function(R){if(R.hasClass("filter_on")){Q=false}});return Q};var y=function(){if(!f()){return}f().getElements("td").each(function(Q){Q.removeClass("filter_on");G(Q,"_on","_normal");z(Q,"_on","_normal")})};var F=function(){if(!f()){return}f().getElements("td").each(function(R){var Q=o(R);if(t(Q)){R.removeClass("filter_on");G(R,"_on","_normal");z(R,"_on","_normal")}})};var m=function(R){if(!f()){return false}var Q=false;f().getElements("td").each(function(S){if(o(S)===R){if(G(S,/(_normal|_hover)/,"_on")){z(S,/(_normal|_hover)/,"_on");S.addClass("filter_on");Q=true}}});return Q};var M=function(){if(!f()){return}f().getElements("div").each(function(Q){G(Q,"_on","_normal");z(Q,"_on","_normal")})};var P=function(R){if(!f()){return false}var Q=false;f().getElements("div").each(function(S){if(o(S)===R){if(G(S,/_normal/,"_on")){z(S,/_normal/,"_on");Q=true}}});return Q};var e=function(T){var Q=false,S,R;if(T==="reset"){Q=true;T="0"}else{T=g(T);S={}}y();Q=m(T)||Q;if(Q){R=l.getStyleCategoryInt();switch(T){case"0":ta.store("hac.filters.style.options","reset");if(H()){r(T)}ta.servlet.HACSearch.changeCategory(null,null,"1",true);break;case"1":ta.store("hac.filters.style.options","reset");break;case"2":ta.store("hac.filters.style.options","reset");if(H()){r(T)}ta.servlet.HACSearch.changeCategory(null,null,"2",true);break;case"9":S["zff_"+T]=1;ta.store("hac.filters.style.options",S);ta.servlet.HACSearch.changeCategory(null,null,"2",true);break;case"16":case"17":S["zff_"+T]=1;ta.store("hac.filters.style.options",S);ta.servlet.HACSearch.changeCategory(null,null,"3",true);break;case"18":if(H()){r(T);u()}else{C(K())}Q=false;break;case"19":if(H()){r(T);u()}else{C(h())}Q=false;break;case"20":if(H()){r(T);u()}else{C(A())}Q=false;break;case"25":ta.store("hac.filters.style.options","reset");if(H()){r(T)}ta.servlet.HACSearch.changeCategory(null,null,"3",true);break;case"41":ta.store("hac.filters.style.options","reset");if(H()){r(T)}ta.servlet.HACSearch.changeCategory(null,null,"2",true);break;default:S["zff_"+T]=1;ta.store("hac.filters.style.options",S);ta.servlet.HACSearch.changeCategory(null,null,""+R,true);break}}if(ta.hac.filters.style.getVersion()==2){j()}return Q};var r=function(U){var R,T,Q,V,S;if(ta.has("isUsingMiles")){S=ta.retrieve("isUsingMiles");if(S){V="mi"}else{V="km"}if(U){if(S){switch(U){case"18":Q="5";break;case"19":Q="10";break;case"20":Q="25";break;default:Q="0";break}}else{switch(U){case"18":Q="10";break;case"19":Q="25";break;case"20":Q="50";break;default:Q="0";break}}R=Q+V;T=ta.retrieve("hacFilterSaveable");if(T&&T.filterState&&R){if(Q=="0"){R="0"}T.filterState.rad=R}}}};var c=function(S,R,Q){S=ta.id(S);var T=o(ta.id(S));var U=S.hasClass("filter_on");if(U){return}else{if(ta.has("lastminute.style.selected.dr")){return}if(ta.meta&&ta.meta.treeTrack){ta.meta.treeTrack.logImpressionTreeOnPageLoad()}ta.hac.filters.style.v2.visualUnselectAll();ta.hac.filters.style.v2.visualUnselectAllDiv();ta.hac.filters.style.v2.visualSelect(T);ta.hac.filters.style.v2.visualSelectDiv(T);ta.store("lastminute.style.selected.dr",T);ta.pages.hac.startHacUpdateLM(T,R,Q)}};var u=function(Q){if(ta.hac.filters&&ta.hac.filters.changeStyle){ta.hac.filters.changeStyle(Q)}else{filtersChanged()}};var k=function(){ta.store("hide_price_msg_hotels",true);var Q="6";u(Q)};var L=function(Q){Q=ta.id(Q);var S=o(Q);var R=Q.hasClass("filter_on");ta.retrieve("hacFilterSaveable").removeOption("o");if(S!==1&&!Q.hasClass("filter_disabled")&&!Q.hasClass("filter_on")&&e(S)){u(S)}if(R){if(p(S)){return}if(t(S)){C(ta.id("rad_0"))}else{if(S==="40"){u(S)}else{ta.store("hac.filters.style.options","reset");ta.servlet.HACSearch.changeCategory(null,null,"1",true);u(S)}}}};var I=function(Q){if(!f()){return}f().getElements("td").each(function(R){if(Q!==null&&o(R)===Q){G(R,"_normal","_hover");z(R,"_normal","_hover")}else{G(R,"_hover","_normal");z(R,"_hover","_normal")}})};var b=function(T,S,Q,R){if(!f()){return}T=""+T;f().getElements("td").each(function(V){if(T!==null&&o(V)===T){var U=V.getElement(".js_filter_count");if(S||T==="40"){G(V,"_inactive","_normal");V.removeClass("filter_disabled");z(V,"_inactive","_normal");if(U){if(!R){U.innerHTML="("+Q+")"}else{U.innerHTML=""}}}else{G(V,/(_normal|_hover)/,"_inactive");V.addClass("filter_disabled");z(V,"_normal","_inactive");if(U){U.innerHTML=""}}}})};var K=function(){return ta.id("rad_5mi")||ta.id("rad_10km")};var h=function(){return ta.id("rad_10mi")||ta.id("rad_25km")};var A=function(){return ta.id("rad_25mi")||ta.id("rad_50km")};var t=function(Q){return(Q==="18"||Q==="19"||Q==="20")};var B=function(Q){return(Q&&Q.checked)};var N=function(){var R=-1;var Q=ta.id("PROPTYPE_BOX");if(Q){if(Q.getElement(".cat_1.current")){R=1}if(Q.getElement(".cat_2.current")){R=2}if(Q.getElement(".cat_3.current")){R=3}}return R};var j=function(){var V=""+N();y();var W=ta.retrieve("hac.filters.style.options"),R=function(){V==="2"?m("2"):m("0")},S=false,Q;if(ta.retrieve("hotels_auto_broaden.enabled")){S=x()}if(W){if(W==="reset"){R()}else{Q=true;for(var U in W){if(typeof(U)!=="string"){continue}var T=""+U.match(/\d+/);if(!isFinite(T)){continue}if(!t(T)){Q=false}if(!((T==="0"||T==="41")&&S)){m(T)}}if(Q){R()}}}if(S&&W!="reset"&&!Q){F();m(S)}if(B(ta.id("rad_0"))||B(ta.id("rad_1mi"))){F()}else{if(B(K())){F();m("18")}else{if(B(h())){F();m("19")}else{if(B(A())){F();m("20")}}}}if(f()&&E()&&!w()){R()}};var x=function(){if(ta.retrieve("hacFilterSaveable")&&ta.retrieve("hacFilterSaveable").filterState&&ta.retrieve("hacFilterSaveable").filterState.rad){var Q=ta.retrieve("hacFilterSaveable").filterState.rad;switch(Q){case"5mi":case"10km":return"18";case"10mi":case"25km":return"19";case"25mi":case"50km":return"20"}}};var w=function(){var Q=ta.retrieve("hac.filters.style.options");if(Q){return true}return false};var d=function(Q){L(ta.id(Q))};var O=function(R,S){var Q=""+S;e(Q);u(Q)};var a=function(S,R,Q){c(ta.id(S),R,Q)};var q=function(){I(o(this))};var v=function(){I(null)};var s=function(Q){ta.id(Q).addEvent("mouseenter",q);Q.onmouseover="";I(o(ta.id(Q)))};var D=function(Q){ta.id(Q).addEvent("mouseleave",v);Q.onmouseout="";I(null)};var n=function(S,R){try{y();m("21");var T=ta.id("HAC_FORM");var Q=R;if(T){Q=T.action+"?"+T.toQueryString();Q=Q.replace(/geo=\d+/,"geo="+S);Q=Q+"&cat="+N();Q=Q+"&sortOrder=popularity"}window.location=Q}catch(U){ta.util.error.record(U,"hac - all region filter click")}};var J=function(){y();m("0")};ta.hac.filters.style.v2={bindMouseEnter:s,bindMouseLeave:D,onMouseClick:d,onMouseClickLM:a,applyBestValueStyle:k,filterSelect:e,visualUnselectAll:y,visualUnselectAllDiv:M,visualSelect:m,visualSelectDiv:P,setHeaderButtons:j,doRadiusButtonClick:O,setEnabled:b,regionClick:n,resetToDefaultStyleVisual:J}})();(function(s){var f=function(D){var E=false;switch(D){case"zfn":E="neighborhood";break;case"zfc":E="hotel_class";break;case"zfa":E="amenities";break;case"cat":E="categories";break;case"zfb":E="hotel_brand";break;case"zff":E="styles";break;case"prng":E="price";break;case"trating":E="traveler_rating";break;case"sort":E="sort";break}return E};var q=function(D){ta.store("hac.data.object",D);y();v();j()};var y=function(){var D=ta.retrieve("hac.data.object"),G;if(D.filters&&D.filters.categories&&D.filters.categories.options){var F=ta.retrieve("hacFilterSaveable").getOption("cat");Array.each(D.filters.categories.options,function(H){if(H&&H.value){G=document.getElement(".tab.cat_"+H.value+" .tab_count");if(G&&H.count&&H.count>-1){G.innerHTML="("+H.count+")"}if(F&&F==H.value){ta.hac.filters.style.visualClickTab("cat_"+H.value)}if(H.value=="1"){G=document.getElement(".js_zff_0 .filter_count");if(G&&H.count>-1){G.innerHTML="("+H.count+")"}}}})}if(D.filters&&D.filters.styles&&D.filters.styles.options){var E=ta.retrieve("hacFilterSaveable").getOption("style");Array.each(D.filters.styles.options,function(J){if(J&&J.value){var K=document.getElement(".js_zff_"+J.value+" .filter_count");var H=J.count;if(K&&H>-1){K.innerHTML="("+H+")"}}if(E&&E=="zff_"+J.value){var I=document.getElement(".js_"+E);if(I&&!I.hasClass("filter_on")){ta.hac.filters.style.v2.visualUnselectAll();ta.hac.filters.style.v2.visualSelect(J.value.toString())}}})}};var v=function(){var E=ta.retrieve("hacFilterSaveable");var D=ta.id("CLEAR_FILTERS");if(!D){return}if(E&&E.isSelectedIgnoringCat()){D.setStyle("display","inline")}else{D.setStyle("display","none")}};var g=function(D){var E=false;switch(D){case"price":E=ta.overlays.filters.PriceOverlay;break;case"traveler_rating":E=ta.overlays.filters.RatingOverlay;break;case"hotel_class":E=ta.overlays.filters.ClassOverlay;break;case"neighborhood":E=ta.overlays.filters.NeighborhoodOverlay;break;case"amenities":E=ta.overlays.filters.AmenitiesOverlay;break;case"hotel_brand":E=ta.overlays.filters.BrandOverlay;break;case"more":E=ta.overlays.filters.MoreOverlay;break;case"sort":E=ta.overlays.filters.SortOverlay;break}return E};var B=function(){return["price","traveler_rating","neighborhood","hotel_class","amenities","hotel_brand","more"]};s.clearPriceFilters=function(){var D="prng";var E=ta.retrieve("hac.data.object");if(E&&E.filters&&E.selected){var F=E.selected[D];if(F){E.selected[D]=[];ta.hac.filters.updateFilterHash(D,[])}}window.fireEvent("hotels.priceFiltersCleared")};s.updateMetaHotelsFiltersFromBreadcrumbs=function(E,K){if(!E||!K){return}var D=ta.retrieve("hac.data.object");if(D&&D.filters&&D.selected){var L=D.selected[E];if(L){var J=L.split(",");if(J){var G=false;for(var H=0;H<J.length;H++){if(J[H]==K){J.splice(H,1);G=true;break}}if(G){var I=[];for(var F=0;F<J.length;F++){I.push(E+"_"+J[F])}D.selected[E]=J.toString();ta.hac.filters.updateFilterHash(E,I);q(D);ta.hac.filters.updateResultsFromFilters()}}}}};s.getItemValue=function(D,E){if(E=="currencies"){return D}return D.value};s.closeAllActiveFilters=function(){var E=B();var H=ta.retrieve("ta.filters.overlaySet");if(E&&H){for(var F=0;F<E.length;F++){var D=E[F];if(D){var G=H[D];if(G){G.hide()}}}}};s.getItemDisplayFragment=function(E,F,G){var D="";if(F=="neighborhood"&&typeof neighborhoodMappings!="undefined"){return"<span class='itemLabel'>"+neighborhoodMappings[E.value]+"</span>"}else{if(F=="price"||F=="showUnavailable"||F=="sort"){return"<span class='itemLabel'>"+E.label+"</span>"}else{if(F=="amenities"&&typeof amenityMappings!="undefined"){return"<span class='itemLabel'>"+amenityMappings[E.value]+"</span>"}else{if(F=="hotel_brand"&&typeof brandMappings!="undefined"){return"<span class='itemLabel'>"+brandMappings[E.value]+"</span>"}else{if(F=="hotel_class"){if(E.value=="0"){if(typeof hotelClassMappings!="undefined"){return"<span class='nonImgAll'>"+hotelClassMappings[0]+"</span>"}return""}if(G){D="-off"}return"<span class='rate rate_cl cl"+E.value+"0'><img class='sprite-ratings-ltgrn"+D+"' content='"+E.value+".0' src='"+window.CDNHOST+"/img2/x.gif' alt='"+E.value+"'/></span>"}else{if(F=="traveler_rating"){if(E.value=="0"){if(typeof hotelClassMappings!="undefined"){return"<span class='nonImgAll'>"+hotelClassMappings[0]+"</span>"}return""}if(G){D="-off"}return"<span class='rate rate_bb bb"+E.value+"0'><img class='sprite-bubbles-med"+D+"' content='"+E.value+".0' src='"+window.CDNHOST+"/img2/x.gif' alt='"+E.value+"'/></span>"}else{if(F=="currencies"){return"<span class='itemLabel'>"+E+"</span>"}}}}}}}return""};var h=function(K){var T={},O,Q;T.seen=0;T.sequence=ta.commerce.meta.polling.getPollingAttemptForRequest(K);if(ta.has("hac.sortChanged")){var N=ta.retrieve("hac.sortChanged");T.sortOrder=N}if(!ta.retrieve("ta.p13n.avoidRankingReset")){if(ta.retrieve("hac.filters.isUpdateDatesRequest")){T.sortOrder="availability";ta.store("hac.sortChanged","availability")}}if(ta.has("ta.commerce.MetaHacOverlay.currency")){T.l1currency=ta.retrieve("ta.commerce.MetaHacOverlay.currency")}if(ta.has("hacGeo")){T.geo=ta.retrieve("hacGeo")}var F=ta.widgets.calendar.getCheckRatesData();if(F){T=Object.merge(T,F);T.searchAll=false}var D=window.pageServlet;if(D){T.requestingServlet=D}T.refineForm=true;T.hs="";if(ta.has("guests_rooms_picker.enabled")&&ta.widgets.calendar.getGuestsRoomsPickerData()){var S=ta.widgets.calendar.getGuestsRoomsPickerData();T.adults=S.guests;T.rooms=S.rooms}if(ta.retrieve("ta.commerce.suppress_commerce_impressions.enabled")){C(T)}if(ta.has("hac.filter.changed")){var U=ta.retrieve("hac.filter.changed");var M=ta.hac.filters.getHacFilterTimeoutKey();if(ta.retrieve("meta.isFromFilterChange")&&ta.retrieve(M)){U=ta.retrieve(M)}Array.each(U,function(V){T=Object.merge(T,V)})}else{if(ta.has("hacFilterSaveable")){Q=ta.retrieve("hacFilterSaveable").getOptions();if(Q){var P=Q.cb;if(P){Array.each(P,function(V){T[V]=V.substring(V.indexOf("_")+1)})}O=Q.rad;if(O){T.rad=O}}}if(Q){var J=Q.cat;if(J&&J!="1"){var E="cat_"+J;T[E]="1"}var L=Q.style;if(L&&L!="0"){T.zff=L.substring(L.indexOf("_")+1)}}}if((ta.isMetaHotelsRequest()||ta.has("meta.mini_meta_on_accommodations"))&&ta.has("dates.datesCleared")){T.clearDates=true;ta.remove("dates.datesCleared")}if(ta.isMetaHotelsRequest()&&ta.retrieve("hotels_auto_broaden.enabled")&&ta.retrieve("hacFilterSaveable")){var H=ta.retrieve("hacFilterSaveable").getOptions();if(!T.cat||H.cat==T.cat){O=H.rad;if(O){T.rad=O}}}if(!T.cat&&ta.retrieve("vrTabOnHotels")){T.cat="6"}var I=ta.retrieve("datesChanged");if(I){T.datesChanged=I;ta.remove("datesChanged")}if(ta.has("hac.dateBumped")&&ta.has("hac_timezone_awareness")){var R=ta.remove("hac.dateBumped");if(ta.retrieve("hac.filters.isUpdateDatesRequest")||ta.retrieve("hac.filters.isClearDatesRequest")){T.dateBumped="NONE";ta.servlet.HACSearch.clearDateFieldHighlighting()}else{T.dateBumped=R}}else{ta.remove("hac.dateBumped");T.dateBumped="NONE";ta.servlet.HACSearch.clearDateFieldHighlighting()}var G=ta.retrieve("ta.p13n.tagsWithSave");if(G!==null){T.prodP13nTagsWithSave=G}if(ta.has("keep_users_on_hotels_v2.id")){T.hhid=ta.retrieve("keep_users_on_hotels_v2.id")}return T};var C=function(E){if(!E){return}var F="suppressCommerceImpressionState";var D=w();if(D){if(ta.retrieve("hac.filters.isUpdateDatesRequest")||ta.retrieve("hac.filters.isClearDatesRequest")){ta.store(F,true)}else{if(D===1){ta.remove(F)}}if(ta.retrieve(F)){E.isFirstPageLoad=false}}};var w=function(){if(ta.retrieve(o)){var D=ta.retrieve(o);return ta.commerce.meta.polling.getPollingAttemptForRequest(D)}};var c=function(H){if(window.filterProgress){if(ta.has("hac.progressBar")){var E=ta.retrieve("hac.progressBar");if(E){E.update(filterProgress.complete)}}ta.store("hac.update.complete",filterProgress.complete);ta.store("hac.update.total",filterProgress.total);ta.pages.hac.updateOrphanCounts();if(filterProgress.complete==ta.retrieve("hac.update.prevCompleteValue")){ta.store("hac.update.noChangeRequestCount",ta.retrieve("hac.update.noChangeRequestCount")+1)}else{ta.store("hac.update.prevCompleteValue",filterProgress.complete);ta.store("hac.update.noChangeRequestCount",0)}var D=ta.retrieve("asyncRequestResponse")||(filterProgress.total>filterProgress.complete&&ta.retrieve("hac.update.noChangeRequestCount")<ta.retrieve("hac.update.noChangeRequestLimit"));var G=false;if(ta.widgets&&ta.widgets.HotelsChooseRoomFlyout){G=ta.widgets.HotelsChooseRoomFlyout.anyOpen()}var J=ta.mapsv2&&ta.mapsv2.Factory&&ta.mapsv2.Factory.isMapOpen();if(D&&!J&&!G){ta.store("hac.updates.running",true);try{if(!ta.has("hac.progress.timer")&&!ta.has("hac.progressBar")){if(ta.has("hac.settings.timeout")){var F=ta.retrieve("hac.settings.timeout")/2;ta.store("hac.progressBar",new ta.widgets.ProgressBar(ta.overlays.Factory.createHACProgressOverlay().container,{limit:filterProgress.total,overload:100,speed:F}).start());ta.pages.hac.timeoutProgressBar.delay(ta.retrieve("hac.settings.timeout"))}else{ta.store("hac.progressBar",new ta.widgets.ProgressBar(ta.overlays.Factory.createHACProgressOverlay().container,{limit:filterProgress.total}).start())}}}catch(I){ta.util.error.record(I,"hac progress bar")}window.filterInProgress=false;ta.store("hac.update.continuation",true);ta.commerce.meta.polling.incrementPollingAttemptForRequest(H);n(H);ta.fireEvent("onHACUpdate")}else{ta.remove("hac.updates.running");m();x();ta.fireEvent("onUpdateHACAds");ta.fireEvent("onHACUpdateComplete");if(ta.has("tablet_portrait_mode_inline_ads")&&ta.common.tablet&&ta.common.tablet.isPortrait()&&window.pageServlet==="Hotels"){ta.common.tablet.placeDivs_portrait(0,true)}}window.filterProgress=null}};var e=function(){if(ta.id("LOCATION_OVERVIEW_FRIEND_SUMMARY_CONTENT_PLACEHOLDER")){var D={pre:false};ta.util.partials.requestMorePartials(["LOCATION_OVERVIEW_FRIEND_SUMMARY_CONTENT","LOCATION_OVERVIEW_FRIEND_DETAIL_CONTENT"],Object.merge({},D,ta.retrieve("facebook.data.params")),"facebook",ta.support.Facebook.dataAvailable)}};var x=function(){e();if(ta.has("hac.progressBar")){ta.retrieve("hac.progressBar").stop()}if(ta.has("hac.progress.timer")){var E=ta.remove("hac.progress.timer");if(E){var D=E.progBar;if(D&&D.removeProgressBar){D.removeProgressBar()}E.stopTimer()}}window.fireEvent("HotelsHacComplete");window.fireEvent("hotels.domUpdate");if((ta.retrieve("hotels_urgency_gauge")&&!ta.retrieve("showHACResults.broadcastProgress"))||ta.retrieve("hotels_urgency_gauge_tracking")){ta.on("hotels.domUpdate",ta.run(ta.commerce.urgencygauge.init))}if(window.monikerLocs){loadPageMonikers(window.monikerLocs)}if(typeof(ta.widgets.Saves)!="undefined"){ta.widgets.Saves.getSavesCall(true)}};var r=function(H){if(!ta.pages.hac.skipUpdate()){ta.pages.hac.processFilterChanges()}try{ta.pages.hac.updatePagingLinks();if(!ta.retrieve("maps.is_open")){var J=$$("div.nmbrIcon");if(J){J.addClass("suppress")}}c(H);var G=ta.id("PRICE_MSG_HOTELS");var F="hide_price_msg_hotels";var E="price_msg_hotels_display_tracking";if(G&&!G.hasClass("hidden")){if(ta.retrieve(F)){G.addClass("hidden");ta.store(F,false);ta.store(E,true)}}if(!ta.has("hotels_auto_broaden.enabled")){ta.hac.filters.style.grayOutTabs()}if(ta.has("hac.progress.timer")){var K=ta.retrieve("hac.progress.timer");if(K&&K.hacResultsFired){if(K.hacResultsFired()){K.showHACResults()}var D=document.getElements(".js_buildProviderRHS");if(K.showLoadingStateFired&&D&&D.length>0&&!ta.widgets.calendar.hasPageDates()){K.addLoadingWhiteBox()}}}window.filterFormUpdates=null;ta.pages.hac.updateHACRelatedCopy()}catch(I){ta.util.error.record(I,"_hacPostProcess")}};var u=function(){ta.hac.filters.removeFilterOverlaySet()};var A=function(L,P){var E=P.getElement(".hotels_list_placement .hacTabLIST");var O=L.getElement(".style3_filters");var I=P.getElement(".style3_filters");var G=L.getElement(".style3_filters_add_on");var J=P.getElement(".style3_filters_add_on");var D=!!document.getElement(".single_col_hotels");var F=function(Q){return Q&&Q.match(".hotelFilters")};var M=function(Q){return E&&Q&&Q.match(".hotels_list_placement")};var H=function(Q){return E&&Q&&Q.match(".breadcrumbs")&&D};L.getChildren().each(function(Q){if(!F(Q)&&!M(Q)){Q.destroy()}});P.getChildren().each(function(Q){if(!F(Q)&&!M(Q)&&!H(Q)){L.adopt(Q)}});if(L.getElement(".hotels_list_placement")){L.getElement(".hotels_list_placement").inject(L,"bottom");if(D){var K=P.getElement(".breadcrumbs");var N=document.getElement(".single_col_hotels .filterControls");if(N){if(N.getElement(".breadcrumbs")){N.getElement(".breadcrumbs").destroy()}if(K){K.inject(N,"bottom")}}}}if(E){ta.fireEvent("onHotelsListUpdate",E)}if(O&&I){I.replaces(O)}if(G&&J){if(G.innerHTML!=J.innerHTML){J.replaces(G)}}};var b=function(E,F){var D=new Element("div",{html:F});E.empty().adopt(D)};var l=function(G,I){if(ta.has(I)&&!ta.retrieve(I)){ta.remove("hac.dateBumped");return}var D=ta.id("HAC_RESULTS");var F=null;try{F=new Element("div",{html:G})}catch(K){}if(D&&G){if(ta.has("meta.hotels_filter_exclude_sort.enabled")){A(D,F)}else{b(D,G)}if(ta.has("persistentFilters.showing")){ta.commerce.meta.scrollToId(D.id)}}if(F){F.getChildren().each(function(L){var M=L.getAttribute("data-targetEvent");if(M){ta.fireEvent(M,L)}})}if(ta.widgets.calendar.hasPageDates()){var J=document.getElement(".clearDates");if(J){J.show()}}var H=ta.remove("hac.lazy.callback");if(H){H()}r(I);if(typeof resultsUpdatedCallback==="function"){resultsUpdatedCallback()}u();var E=ta.retrieve("filters.waitDialog");if(E){ta.run("ta.overlays.Factory.showFilterWaitOverlay",{},false)}if(ta.vr&&ta.vr.hacutils&&typeof(ta.vr.hacutils.loadSavedProperties)=="function"){ta.vr.hacutils.loadSavedProperties()}if(ta.vr&&ta.vr.hacutils&&typeof(ta.vr.hacutils.longStayVrTreatment)=="function"){ta.vr.hacutils.longStayVrTreatment()}if(ta.p13n&&ta.p13n.wizard&&typeof(ta.p13n.wizard.updateVrContentIfTagSelected)=="function"){ta.p13n.wizard.updateVrContentIfTagSelected()}if(ta.vr&&ta.vr.rap&&ta.retrieve("vrTabOnHotels")&&ta.widgets.calendar.getCheckRatesData()){ta.vr.rap.getRapDataOnHotels()}ta.servlet.HACSearch.updateMapSponsorList()};ta.on("onAjax_PageHACProgress",function(F){var D=F.getAttribute("data-progressComplete");var E=F.getAttribute("data-progressTotal");if(D&&E){window.filterProgress={complete:parseInt(D,10),total:parseInt(E,10)}}});var j=function(){var G=p();var F=ta.retrieve("hac.data.object");if(!(F&&G)){return}var E=F.selected;if(!E){return}var D=E.cb;if(!D){return}D.each(function(J){var K=/^([a-zA-Z]+)_\d+/.exec(J),H;if(K){H=K[1];if(H){var I=G[f(H)];if(I){I.addClass("selected_filter")}}}})};var p=function(){var E={};var D=document.getElements(".hotel_filter_wrap");D.each(function(F){F.removeClass("selected_filter");var G=F.get("data-filtertype");if(G){var H=G.split(" ");if(H){H.each(function(I){if(I){E[I]=F}})}}});return E};var a=function(){};var d=function(){var D="";if(ta.has("hac.filter.changed")){Array.each(ta.retrieve("hac.filter.changed"),function(F){for(var E in F){if(F[E]===true){D+=(D.length>0?",":"")+E}else{if(E=="showUnavailable"){D+=(D.length>0?",":"")+E+"_false"}}}})}return D};s.buildHACUrlParamString=function(){var D={};var E=ta.widgets.calendar.getCheckRatesData();if(E){D=Object.merge(D,E);D.searchAll=false}if(ta.has("hacGeo")){D.geo=ta.retrieve("hacGeo")}if(ta.has("ta.commerce.MetaHacOverlay.currency")){D.l1currency=ta.remove("ta.commerce.MetaHacOverlay.currency")}if(ta.has("hac.filter.changed")){Array.each(ta.retrieve("hac.filter.changed"),function(F){D=Object.merge(D,F)})}return Object.toQueryString(D)};var t=function(){var E=false;if(!document.getElement(".tab.cat_1.selected")){if(document.getElement(".tab.cat_2.selected")){ta.retrieve("hacFilterSaveable").setOption("cat","2")}else{ta.retrieve("hacFilterSaveable").setOption("cat","3")}E=true}var D=window.location.href.match(/zff(\d+)/);if(D&&D[1]){D=D[1];ta.retrieve("hacFilterSaveable").setOption("style","zff_"+D);E=true}if(E){ta.retrieve("hacFilterSaveable").saveOptions()}};var n=function(F){var K=ta.common&&ta.common.tablet;if(IS_DEBUG&&!F){alert("You must pass a hacRequestPollKey to initiate a hac request.\n\nUsage:\n_initiateHACRequest(hacRequestPollKey);");return}var J=null;if(ta.servlet.HACSearch.consumeTrackEvent){J=ta.servlet.HACSearch.consumeTrackEvent()}var O=ta.retrieve("hac.filter.changed");if(ta.has("hac.filter.changed")){if(!ta.has("hac.pageChanged")&&O&&O.length!==0){if(!(Array.some(O,function(S){return S.hasOwnProperty("o")})&&O.length==1)){ta.keep("hac.filter.changed",{o:"a0"})}}else{ta.remove("hac.pageChanged")}}var P=window.pageServlet;if(!ta.has("meta.mini_meta_on_accommodations")&&(!P||(P!="HACSearch"&&!ta.isMetaHotelsRequest()))){var Q=ta.hac.filters.buildHACUrlParamString();t();var G="/HACSearch?"+Q+window.location.hash;if(J&&ta.setEvtCookie){J.push(G);ta.setEvtCookie.apply(this,J)}window.location.replace(G);return}if(!ta.has("hac.progress.timer")&&(!ta.has("hac.progressBar")||!ta.retrieve("hac.progressBar").isShowing())&&!ta.has("hac.updates.running")){ta.run("ta.overlays.Factory.showUpdatingMessage")}var E=h(F);var R=null;try{if(J){R={module:J[0],action:J[1],context:J[2],value:J[3]}}}catch(M){ta.util.error.record(M,"filters util trackEventObj")}var N=window.location.href;if(ta.has("meta.mini_meta_on_accommodations")){var L=ta.retrieve("meta.mini_meta_on_accommodations.ajaxBasePath");if(L){var D=N.replace(window.pageServlet,L);if(D===N){ta.util.error.record(null,"Cannot generate Ajax URL");return}N=D}}else{if(ta.isMetaHotelsRequest()){N="/Hotels"}}if(!ta.has("meta.mini_meta_on_accommodations")&&N.indexOf("?")!=-1){N=N.substring(0,N.indexOf("?"))}if(!ta.has("hac.filter.changed")){if(ta.has("hacFilterSaveable")){var I=ta.retrieve("hacFilterSaveable").getOptions();if(I&&I.o){var H=I.o;if(H){N=N+"-oa"+H}}}}else{if(!ta.has("meta.mini_meta_on_accommodations")&&N.indexOf("-g")!=-1){N=N.substring(0,N.indexOf("-g"))}}if(K){ta.common.tablet.retryIfTabBecomesInactive("hac",function(){n(F)})}if(ta.p13n&&ta.p13n.wizard&&ta.p13n.wizard.findCurrentSort){E.displayedSortOrder=ta.p13n.wizard.findCurrentSort()}new Request({url:N,data:E,evalScripts:true,trackEvent:R,method:"post",onSuccess:function(S){if(K){ta.common.tablet.cancelRetryOnInactiveTab("hac")}l(S,F);if(E.sequence<2){ta.store("isTrackTreeFresh",true)}if(window.pageServlet=="Hotels"){j()}if(ta.retrieve("changeRankWithoutDate")){ta.hac.filters.clearDatesAndUpdateResults();ta.remove("changeRankWithoutDate")}ta.servlet.HACSearch.checkTrackedVisibility();if(ta.has("ta.p13n.p13n_show_jfy_sort")&&ta.has("ta.p13n.loadedTagHeader")){ta.p13n.wizard.ensureJustForYou()}},onFailure:function(){if(K){ta.common.tablet.cancelRetryOnInactiveTab("hac")}ta.run("ta.overlays.Factory.showFilterWaitOverlay",{},false);x();if(window.pageServlet=="Hotels"){j()}}}).send()};var o="hacCurrentQueryKey";var m=function(){if(ta.has(o)){var D=ta.retrieve(o);ta.store(D,false);ta.commerce.meta.polling.removePollingInfoForRequest(D)}};s.removeProcessingForExistingHACQuery=function(){m()};s.updateFilterHash=function(D,G){var F=false;if(ta.has("hacFilterSaveable")){var E=ta.retrieve("hacFilterSaveable");F=E.updateCheckboxFilter(D,G)}else{ta.util.error.record(null,"Hac filter not saveable")}return F};s.hideUnavailableClicked=function(){s.updateFilterHash("showUnavailable",[]);ta.trackEventOnPage("including_no_prices_alert","hide_hotels","",0);ta.hac.filters.updateResultsFromFilters()};s.updateResultsFromDateSearch=function(){ta.store("hac.filters.isUpdateDatesRequest",true);ta.hac.filters.updateResults();ta.remove("hac.filters.isUpdateDatesRequest")};s.updateResultsFromClearDates=function(){ta.store("hac.filters.isClearDatesRequest",true);ta.hac.filters.updateResults();ta.remove("hac.filters.isClearDatesRequest");ta.fireEvent("clearDates")};s.updateResults=function(){var H=ta.id("PRICE_MSG_HOTELS");if(H&&!ta.retrieve("hide_price_msg_hotels")){var E="price_msg_hotels_display_tracking";ta.store(E,false)}var F=document.getElement(".submit.find_hotels");if(F&&ta.widgets.calendar.hasPageDates()){F.hide()}if(ta.has("hac.progress.timer")){ta.remove("hac.progress.timer").stopTimer()}window.fireEvent("hotels.hacUpdate");if(ta.meta&&ta.meta.treeTrack){ta.meta.treeTrack.logImpressionTreeOnPageLoad()}if(ta.hac.RequestTimer){var D=ta.has("hac.filters.isUpdateDatesRequest");var I=ta.has("hac.filters.isClearDatesRequest");var G={showProgressBar:D,triggerLoadingState:!D,triggerListingsLoadState:D,trackProgress:!I,onStop:function(){this.showHACResults()}};if(window.pageServlet=="WidgetEmbed"){G.coverAreaId="ACCOM_OVERVIEW";G.calculateCenter=true}if(ta.retrieve("hotels_placements_short_cells")){G.calculateCenter=true}ta.store("hac.progress.timer",new ta.hac.RequestTimer(G))}m();if(window.pageServlet=="WidgetEmbed"){ta.widget.hotels.changeFilters(d())}else{n(k())}};var k=function(){var D=new Date().getTime();var E="hacRequest_"+D;if(!ta.has(E)){ta.store(E,true);ta.store(o,E);ta.commerce.meta.polling.setPollingAttemptForRequest(E,1)}return E};s.getModuleString=function(D){if(ta.has("ta.filters.track_sort")&&D=="sort"){return ta.retrieve("ta.filters.track_sort")}else{if(ta.has("ta.filters.track_filter")){return ta.retrieve("ta.filters.track_filter")}}return"Meta_HAC_Filter"};s.removeFilterOverlaySet=function(){var D=ta.retrieve("ta.filters.overlaySet");if(D){Array.each(D,function(E){if(E){E.hide();E.destroy()}})}ta.remove("ta.filters.overlaySet")};s.loadMetaHotelsFilter=function(M,D,H,I){var K;if(M){M.stopPropagation()}var L=s.getModuleString(H);if(H=="price"&&ta.has("ta.filters.priceHandler")){if(!ta.retrieve("ta.filters.priceHandler")()){return}}var G=ta.retrieve("ta.filters.overlaySet");if(!G){G={}}var E=ta.has("persistentFilters.showing")?H+"|persistent_bar":H;if(G[H]){K=G[H];if(K.visible){K.hide();ta.trackEventOnPage(L,"close",E)}else{K.show();ta.trackEventOnPage(L,"open",E)}}else{var F=g(H);var J=["hotelFilterContent"];if(ta.retrieve("tablet_filter_improvements.enabled")){J.push("tablet_filter_improvements")}K=new F({style:"date_picker_calendar "+H,content:'<div class="'+J.join(" ")+'"><img class="spinner" src="'+CDNHOST+'/img2/generic/site/loop.gif"></div>',moreOptions:I},D);if(window.pageServlet=="Hotels"){K.setCloseOnSelect(false)}G[H]=K;ta.store("ta.filters.overlaySet",G);ta.trackEventOnPage(L,"open",E)}};s.buildFiltersDataObject=function(I,E){var D={filters:{}};Array.each(I,function(K){var N=K.name;var M=K.items;var L=f(N);if(L){D.filters[L]={options:M,hacName:N}}});if(ta.has("hacFilterSaveable")){var H=ta.retrieve("hacFilterSaveable");D.selected=H.getOptions();if(E){if(E.radiusAutoSelected){H.setOption("rad",E.radiusAutoSelected)}if(E.sortType&&D.filters){var G=D.filters["sort"];if(G){var F=G.options;var J=document.getElement(".style3_filters_add_on .sort");if(F&&J){F.each(function(K){if(K.value===E.sortType){J.innerHTML=K.filterLabel}})}}}}H.setRestoreOptionsCallback(a)}q(D)};s.paging=function(D,E){new Event(E).preventDefault();if(D){var F;if(D.href){F=D.href.match(/oa(\d+)/)}else{if(D.getAttribute("data-offset")){F=D.getAttribute("data-offset")}else{return}}if(F&&F.constructor===Array&&F[1]){F=F[1]}if(F){F=parseInt(F,10)}if(ta.has("hac.filter.changed")){if(F){ta.keep("hac.filter.changed",{o:"a"+F})}else{ta.keep("hac.filter.changed",{o:"a0"})}ta.store("hac.pageChanged",true)}else{if(F&&F>0){ta.retrieve("hacFilterSaveable").setOption("o",F)}else{ta.retrieve("hacFilterSaveable").removeOption("o")}ta.retrieve("hacFilterSaveable").saveOptions()}ta.store("meta.isFromPaging",true);ta.hac.filters.updateResults();ta.commerce.meta.scrollToId("HAC_RESULTS");ta.remove("meta.isFromPaging")}};s.updateResultsFromFilters=function(){ta.store("meta.isFromFilterChange",true);ta.hac.filters.updateResults();ta.remove("meta.isFromFilterChange")};s.changeCategory=function(D){ta.remove("hac.updates.running");if(ta.has("hac.filter.changed")){ta.keep("hac.filter.changed",{cat:D})}else{if(D!="1"){ta.retrieve("hacFilterSaveable").setOption("cat",D)}else{ta.retrieve("hacFilterSaveable").removeOption("cat")}ta.retrieve("hacFilterSaveable").removeOption("o");ta.retrieve("hacFilterSaveable").saveOptions()}ta.store("meta.isFromChangeCategory",true);ta.hac.filters.updateResults();ta.remove("meta.isFromChangeCategory");window.fireEvent("onChangeCategory")};s.changeStyle=function(D){ta.remove("hac.updates.running");var E=ta.hac.filters.style.getStyleCategoryInt();if(ta.has("hac.filter.changed")){ta.keep("hac.filter.changed",{zff:D});if(E!==1){ta.keep("hac.filter.changed",{cat:(E).toString()})}}else{if(D=="0"){ta.retrieve("hacFilterSaveable").removeOption("style")}else{ta.retrieve("hacFilterSaveable").setOption("style","zff_"+D)}ta.retrieve("hacFilterSaveable").saveOptions()}if(typeof pageServlet!="undefined"&&pageServlet=="Hotels"){var F=D||"0";if(!ta.isMetaHotelsRequest()){ta.setEvtCookie("Meta_Style_Button","click",z(F),0)}if(ta.has("hotels.styleAdsEnabled")){ta.common.ads.refreshAdsWithStyle(z(F))}}ta.store("meta.isFromChangeStyle",true);ta.hac.filters.updateResults();ta.remove("meta.isFromChangeStyle")};var z=function(F){var G="";var E=ta.retrieve("hac.data.object");if(E&&E.filters&&E.filters["styles"]&&E.filters["styles"]["options"]){var D=E.filters["styles"]["options"];if(D){Array.each(D,function(H){if(H.value&&H.value==F){G=H.label}})}}return G};s.trackDisplayPriceDiv=function(E){var D="price_msg_hotels_display_tracking";if(!ta.retrieve(D)){ta.trackEventOnPage("PriceMessage","Displayed",E,0);ta.store(D,true)}};s.clearFilters=function(E){if(E&&ta.retrieve("p13n.hotelsJfyEnabled")){ta.hac.filters.clearDatesAndUpdateResults();return}var D=false;if(E&&ta.widgets.calendar.hasPageDates()){ta.store("datesChanged",true);ta.hac.filters.preClearDates();D=true}ta.remove("hac.updates.running");if(ta.has("hac.filter.changed")){ta.keep("hac.filter.changed",{clearFilters:true})}else{var H=ta.retrieve("hacFilterSaveable");if(H){var I=H.getOption("rad");var G=H.getOption("cat");ta._locationHash._data={};ta.retrieve("hacFilterSaveable").saveOptions();if(I){ta.retrieve("hacFilterSaveable").setOption("rad",I)}if(G){H.setOption("cat",G)}}}if(D){ta.hac.filters.postClearDatesAndUpdateResults()}else{ta.hac.filters.updateResults()}var F=document.getElement(".submit.find_hotels");if(F&&!ta.widgets.calendar.hasPageDates()){F.show()}};s.preClearDates=function(){ta.remove("keep_users_on_hotels_v2.id");if(document.getElement(".stayInfoHeader.inDateTrigger")&&document.getElement(".date_control_wrapper")){document.getElements(".stayInfoHeader.inDateTrigger").addClass("hidden");document.getElements(".date_control_wrapper").removeClass("hidden")}if(ta.isMetaHotelsRequest()||ta.has("meta.mini_meta_on_accommodations")){ta.widgets.calendar.clearDates();var E=document.getElement(".showUnavailable");var D=document.getElement(".hideUnavailable");if(E){E.hide()}if(D){D.hide()}}else{ta.widgets.calendar.clearDatesAndRedirect();return}};s.postClearDatesAndUpdateResults=function(){if(ta.commerce.persistentdatepicker){ta.commerce.persistentdatepicker.update()}ta.hac.filters.updateResultsFromClearDates()};s.clearDatesAndUpdateResults=function(){ta.store("datesChanged",true);ta.hac.filters.cancelAllExistingHAC();ta.hac.filters.preClearDates();ta.hac.filters.clearPriceFilters();ta.hac.filters.postClearDatesAndUpdateResults()};s.cancelAllExistingHAC=function(){if(ta.hac.filters&&ta.hac.filters.removeProcessingForExistingHACQuery){ta.hac.filters.removeProcessingForExistingHACQuery()}if(ta.meta.update&&ta.meta.update.cancelAllMetaCurrentQuery){ta.meta.update.cancelAllMetaCurrentQuery()}if(ta.commerce.metajson&&ta.commerce.metajson.cancelCurrentBulkFetch){ta.commerce.metajson.cancelCurrentBulkFetch()}};s.changeSort=function(D){ta.store("hac.sortChanged",D);ta.hac.filters.updateResults()};s.changeCurrency=function(){ta.hac.filters.updateResults()};s.setShowUnavailable=function(D){if(ta.has("hac.filter.changed")&&typeof(D)!="undefined"){ta.keep("hac.filter.changed",{showUnavailable:D})}ta.hac.filters.updateResults()};s.dealsFilter=function(){ta.store("meta.isFromDealsFilter",true);if(ta.has("hac.filter.changed")){ta.keep("hac.filter.changed",{offersOnly:"1"});ta.hac.filters.updateResults()}else{ta.servlet.HACSearch.setDealsFilter()}ta.remove("meta.isFromDealsFilter")};s.getHacFilterTimeoutKey=function(){var E="hac.filter.changed";var D=ta.retrieve("hac.filter.click.timeout");return E.concat("_",D)};s.notPollingOnPageLoad=function(){e()};s.reportUserPageReload=function(){if(!ta.retrieve("canUseLocalStorage")){return}var G="hotels_sort_changed_by_user.reported";var D=localStorage.getItem(G);if(D){return}if(!ta.retrieve("hotels_sort_interaction_tracking.enabled")){return}var E="hotels_sort_changed_by_user";var F=localStorage.getItem(E);if(F){ta.trackEventOnPage("user_selected_sort_reloaded_hotels","manual_click","user_selected_sort_reloaded_hotels");localStorage.setItem(G,true);localStorage.removeItem(E)}}})(ta.hac.filters);ta.hac.filters.Saveable=new Class({initialize:function(){this.registerForLocationHash()},registerForLocationHash:function(){var a=this;ta._locationHash.addEvent("onLoad",function(){a.restoreOptions(ta._locationHash);ta.store("ta.locationHash.loaded",true)});if(ta._locationHash.loaded()&&!ta._locationHash.empty()){this.restoreOptions(ta._locationHash)}},saveOptions:function(){ta._locationHash.save()},setOption:function(a,b){ta._locationHash.set(a,b)},removeOption:function(a){ta._locationHash.erase(a)},getOption:function(a){return ta._locationHash.get(a)},getOptions:function(){return ta._locationHash._data},restoreOptions:function(a){if(this.restoreOptionsCallback){this.restoreOptionsCallback.call(this,a)}},setRestoreOptionsCallback:function(a){this.restoreOptionsCallback=a},isSelected:function(){var a=this.getOptions();return a&&Object.getLength(a)>0&&!(Object.getLength(a)==1&&a.cat)&&!(Object.getLength(a)==1&&a.rad)},isSelectedIgnoringCat:function(){var a=this.getOptions();if(!a){return false}if(Object.getLength(a)===0){return false}if(Object.getLength(a)===1&&a.cat){return false}return true},updateCheckboxFilter:function(b,f){var a=this.getOption("cb");var d=[];var c={};if(a){Array.each(a,function(g){if(g.indexOf(b+"_")==-1){d.push(g)}else{c[g]=true}})}d.append(f);if(d.length){this.setOption("cb",d)}else{this.removeOption("cb")}this.removeOption("o");this.saveOptions();var e=false;if(Object.getLength(c)!=f.length){e=true}else{f.each(function(g){if(!c[g]){e=true}})}return e}});ta.hac.filters.ServerSaveable=new Class({initialize:function(a){this.filterState=a},registerForLocationHash:function(){},saveOptions:function(){},setOption:function(){},removeOption:function(){},getOption:function(a){return this.filterState[a]},getOptions:function(){return this.filterState},isSelected:function(){var a=this.getOptions();return a&&Object.keys(a).some(function(c){if(c=="cat"||c=="cb"){return false}var b=a[c];return b&&b!==""&&b!=="0"})},restoreOptions:function(a){if(this.restoreOptionsCallback){this.restoreOptionsCallback.call(this,a)}},setRestoreOptionsCallback:function(a){this.restoreOptionsCallback=a},updateCheckboxFilter:function(a,c){var b={};if(a=="showUnavailable"){b[a]=c.length>0;ta.keep("hac.filter.changed",b);ta.store("hac.filter.showUnavailableState",b);return true}ta.remove("hac.filter.changed");if(ta.retrieve("hac.filter.showUnavailableState")){ta.keep("hac.filter.changed",ta.retrieve("hac.filter.showUnavailableState"))}if(c&&c.length>0){Array.each(c,function(d){var e={};e[d]=true;ta.keep("hac.filter.changed",e)})}else{b[a+"_0"]=true;ta.keep("hac.filter.changed",b)}return true},isSelectedIgnoringCat:function(){var a=this.getOptions();return a&&Object.keys(a).some(function(c){if(c=="cat"||c=="cb"||c=="near"||c=="rad"||c=="showUnavailable"){return false}var b=a[c];return b&&b!==""&&b!=="0"})}});ta.popups.FlightSearch={popFlightSearch:function(c,b){var f=$("findFlights");var a=$("HAC_FORM");var g=$("pidTarget");if(f&&f.checked){try{setPID("3384");ta.popups.FlightSearch.openWindow()}catch(d){}}return true},openWindow:function(){var c=ta.popups.FlightSearch.getChpFltsUrl();var a=780;var b=580;if(window.screen){a=(screen.availWidth>1000)?1000:780;b=parseInt(0.8*screen.availHeight)}var e="width="+a+",height="+b+",screenX=25,screenY=25,left=25,top=25,toolbar=1,location=1,directories=1,status=1,menubar=1,resizable=1,copyhistory=1,scrollbars=1";var d=window.open(c,"FlightSearch",e);if(d!=null){d.opener=self;d.blur()}},flightsDate:function(d,b){var a=d.split("/");if(!a.length){return d}for(var c=0;c<a.length;c++){if(a[c].length<2){a[c]="0"+a[c]}}return(b)?a[2]+a[0]+a[1]:a[2]+a[1]+a[0]},getChpFltsUrl:function(){var c="CheapFlights?travelers=1&cos=0&nonstop=no&nearby0=no&nearby1=no&time0=anytime&time1=anytime&";var a="FareCalendar?adults=1&";var g=$("checkIn").value;var d=$("checkOut").value;var f=g+d;var e=[];e.push("date0="+ta.popups.FlightSearch.flightsDate(g,gIS_US));e.push("date1="+ta.popups.FlightSearch.flightsDate(d,gIS_US));e.push("airport0="+gHomeAirport);if(typeof(gAirportFromPageLoc)!="undefined"){e.push("airport1="+gAirportFromPageLoc)}else{var b=$("geoAirport");if(b){e.push("airport1="+b.value)}}if(parseInt(f)){return c+e.join("&")}else{return a+e.join("&")}}};ta.servlet.blcoupons={};ta.servlet.blcoupons.error=false;ta.servlet.blcoupons.translate=function(f,h,a,g,d,c){ta.util.cookie.setPIDCookie(16008);var b="/MachineTranslation?page=offer";if(d=="coupon"){b+="&couponId="+f}else{if(d=="announcement"){b+="&announcementId="+h}else{if(d="both"){b+="&couponId="+f+"&announcementId="+h}}}b+="&sl="+a;b+="&tl="+g;if(c){b+="&d="+c}var e=$("GT_LINK");e.style.color="gray";e.onclick=function(){};ta.servlet.blcoupons.error=false;new Request({url:b,onSuccess:function(k){var l=document.createElement("script");l.text=k;var j=document.getElementsByTagName("body")[0];j.appendChild(l)},evalScripts:true}).send()};ta.servlet.blcoupons.printIfDone=function(){if(ta.servlet.blcoupons.toTranslateCount==0){window.print()}};ta.servlet.blcoupons.logErrorIfDone=function(){if(ta.servlet.blcoupons.toTranslateCount==0&&ta.servlet.blcoupons.error){ta.servlet.blcoupons.logTranslateError()}};ta.servlet.blcoupons.initLink=function(){var a=ta.id("GT_LINK");if((typeof a!="undefined")&&a){a.style.display="block";new Request({url:"/ActionRecord?action=BLCoupons_showTranslateLink"}).send()}};ta.servlet.blcoupons.couponAnnouncementViewWithOpen=function(b,g,a,e,f,c,k,h,d,l){var j="ta.overlays.Factory.createCouponAnnouncementOverlayRedirect|"+b+"|"+g+"|"+a+"|"+e+"|"+f+"|"+((k!=null)?k:"")+"|"+pageServlet+"|"+h+"|"+((d!=null)?d:"");if(c==null||c==""){c=ta.servlet.blcoupons.pid}ta.util.cookie.setPIDCookie(c);if(l){j="target:"+l+"|"+j}Cookie.write("ajaxAction",j,{domain:cookieDomain,path:"/"})};ta.servlet.blcoupons.fillBoxMore=function(a,c){var b=$(a).getParent();var d=document.createElement("div");d.setAttribute("class","moreInfo");d.innerHTML=c;b.appendChild(d);$(a).toggle()};ta.servlet.blcoupons.contractBox=function(c){var b=$(c).getParent();var a=$(b).getParent().getElement(".lessInfo");a.toggle();b.toggle();new Request({url:"/ActionRecord?action=BLCoupons_ViewLess"}).send()};ta.servlet.blcoupons.expandMore=function(d,e,c,b){if(b!=null){ta.servlet.blcoupons.pid=b}var f=$(c);var a=f.getParent().getElement(".moreInfo");if(a==null){new Request({url:"/BusinessListingsCouponsAjax-g"+e+"?viewed="+d,onSuccess:function(g){ta.servlet.blcoupons.fillBoxMore(f,g)}}).send()}else{f.toggle();a.toggle()}new Request({url:"/ActionRecord?action=BLCoupons_ViewMore"}).send()};ta.servlet.blcoupons.logTranslateError=function(){new Request({url:"/ActionRecord?action=BLCoupons_GTError"}).send()};ta.servlet.blcoupons.closeHandler=function(){new Request({url:"/ActionRecord?action=BLCoupons_Close"}).send()};ta.servlet.blcoupons.loadOffer=function(b,a){ta.select('[name="OFFER_'+b+'"]').hide();ta.select('[name="OFFER_SPINNER_'+b+'"]').show();new Request.JSON({url:"/CouponAjax?act=LoadToCard&partnercode="+b+"&externalmemberid="+a,onSuccess:function(c){ta.select('[name="OFFER_SPINNER_'+b+'"]').hide();if(c.success){ta.select('[name="OFFER_ERROR_TEXT_NOT_AVAIL_'+b+'"]').hide();ta.select('[name="OFFER_ERROR_TEXT_TRY_AGAIN_'+b+'"]').hide();ta.select('[name="OFFER_ERROR_TEXT_CUSTOMER_SERVICE_'+b+'"]').hide();ta.select('[name="OFFER_SAVED_'+b+'"]').show();ta.select('[name="OFFER_REDEMPTION_'+b+'"]').show();if(ta.id("SAVED_OFFER_COUNT")){ta.id("LINK_LOADED").className="taLnk";ta.id("LINK_LOADED").onclick=function(){ta.trackEventOnPage("AMEXHUB","viewAmexCouponLoaded","",1);ta.t4b.amex.amexSyncProgram.showOfferDiv(ta.id("OFFERS_LOADED"),ta.id("LINK_LOADED"))};var d=ta.id("SAVED_OFFER_COUNT").innerHTML;d++;ta.id("SAVED_OFFER_COUNT").innerHTML=d;ta.t4b.amex.amexSyncProgram.updateLoadedOffers()}}else{if(c.error=="RCCMA035"){ta.select('[name="OFFER_'+b+'"]').show();ta.select('[name="OFFER_ERROR_TEXT_NOT_AVAIL_'+b+'"]').show()}else{if(c.error=="RCAPI900"||c.error=="RCAPI008"||c.error=="RCAPI022"){ta.select('[name="OFFER_'+b+'"]').show();ta.select('[name="OFFER_ERROR_TEXT_TRY_AGAIN_'+b+'"]').show()}else{ta.select('[name="OFFER_'+b+'"]').show();ta.select('[name="OFFER_ERROR_TEXT_CUSTOMER_SERVICE_'+b+'"]').show()}}}},onFailure:function(){ta.select('[name="OFFER_SPINNER_'+b+'"]').hide();ta.select('[name="OFFER_'+b+'"]').show();ta.select('[name="OFFER_ERROR_TEXT_TRY_AGAIN_'+b+'"]').show()}}).send()};ta.servlet.blcoupons.setBranding=function(){ta.servlet.blcoupons.initLink();var a=ta.id("GT_BRANDING");if(a&&!a.innerHTML){google.language.getBranding("GT_BRANDING")}};(function(){if(typeof console=="undefined"){console={}}var a=["log","error","warn"];for(var b=0;b<a.length;b++){if(console[a[b]]==undefined){console[a[b]]=function(){}}}})();function StringBuffer(a){this.strings=new Array;if(a){this.append(a)}}StringBuffer.prototype.append=function(a){this.strings.push(a);return this};StringBuffer.prototype.toString=function(){return this.strings.join("")};StringBuffer.prototype.isEmpty=function(){return this.strings.length==0};function UrlParams(){this.params=new StringBuffer()}UrlParams.prototype.add=function(a,b){if(!this.params.isEmpty()){this.params.append("&")}this.params.append(encodeURIComponent(a));this.params.append("=");this.params.append(encodeURIComponent(b))};UrlParams.prototype.toString=function(){return this.params.toString()};var ERROR_PREFIX="ERROR:";function HttpRpc(a,e,b,c,f,d){if(a.slice(0,4)=="http"){this.url=a}else{if(a.charAt(0)!="/"){a="/"+a}this.url="http://"+window.location.host+a}if(f){this.method=f}else{this.method="POST"}if(b){this.responseFunc=b}else{this.responseFunc=function(g){}}if(e){this.errorFunc=e}else{this.errorFunc=function(g){}}if(c){this.finalizerFunc=c}else{this.finalizerFunc=function(g){}}this.bSync=d}HttpRpc.prototype.getTransport=function(){var a=null;if(window.XMLHttpRequest){a=new XMLHttpRequest()}else{if(window.ActiveXObject){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){a=new ActiveXObject("Microsoft.XMLHTTP")}}}return a};HttpRpc.prototype.sendRequest=function(b){if(!b){b=""}this.req=this.getTransport();this.req.open(this.method,this.url,!this.bSync);this.req.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8");var a=this;this.req.onreadystatechange=function(){a.handleAjaxResponse()};this.req.send(b)};HttpRpc.prototype.handleAjaxResponse=function(){try{if(this.req.readyState==4){if(this.isSuccess(this.req)){this.responseFunc(this.req)}else{this.errorFunc(this.req)}}}finally{if(this.req.readyState==4){this.finalizerFunc(this.req)}}if(this.req.readyState==4){delete this.req;return}};HttpRpc.prototype.isSuccess=function(b){try{if(b==null||b.status==undefined){return true}return((b.status>=200&&b.status<300))&&((b.responseText==null)||b.responseText.slice(0,ERROR_PREFIX.length)!=ERROR_PREFIX)}catch(a){return false}};var sUserAgent=navigator.userAgent;var fAppVersion=parseFloat(navigator.appVersion);function compareVersions(e,c){var a=e.split(".");var d=c.split(".");if(a.length>d.length){for(var b=0;b<a.length-d.length;b++){d.push("0")}}else{if(a.length<d.length){for(var b=0;b<d.length-a.length;b++){a.push("0")}}}for(var b=0;b<a.length;b++){if(a[b]<d[b]){return -1}else{if(a[b]>d[b]){return 1}}}return 0}var isSafari=false;if(navigator&&navigator.vendor){isSafari=navigator.vendor.indexOf("Apple")!=-1}var isOpera=sUserAgent.indexOf("Opera")>-1;var isMinOpera4=isMinOpera5=isMinOpera6=isMinOpera7=isMinOpera7_5=isMinOpera8=false;if(isOpera){var fOperaVersion;if(navigator.appName=="Opera"){fOperaVersion=fAppVersion}else{var reOperaVersion=new RegExp("Opera (\\d+\\.\\d+)");reOperaVersion.test(sUserAgent);fOperaVersion=parseFloat(RegExp["$1"])}isMinOpera4=fOperaVersion>=4;isMinOpera5=fOperaVersion>=5;isMinOpera6=fOperaVersion>=6;isMinOpera7=fOperaVersion>=7;isMinOpera7_5=fOperaVersion>=7.5;isMinOpera8=fOperaVersion>=8}var isKHTML=sUserAgent.indexOf("KHTML")>-1||sUserAgent.indexOf("Konqueror")>-1||sUserAgent.indexOf("AppleWebKit")>-1;var isMinSafari1=isMinSafari1_2=false;var isMinKonq2_2=isMinKonq3=isMinKonq3_1=isMinKonq3_2=false;if(isKHTML){isSafari=sUserAgent.indexOf("AppleWebKit")>-1;isKonq=sUserAgent.indexOf("Konqueror")>-1;if(isSafari){var reAppleWebKit=new RegExp("AppleWebKit\\/(\\d+(?:\\.\\d*)?)");reAppleWebKit.test(sUserAgent);var fAppleWebKitVersion=parseFloat(RegExp["$1"]);isMinSafari1=fAppleWebKitVersion>=85;isMinSafari1_2=fAppleWebKitVersion>=124}else{if(isKonq){var reKonq=new RegExp("Konqueror\\/(\\d+(?:\\.\\d+(?:\\.\\d)?)?)");reKonq.test(sUserAgent);isMinKonq2_2=compareVersions(RegExp["$1"],"2.2")>=0;isMinKonq3=compareVersions(RegExp["$1"],"3.0")>=0;isMinKonq3_1=compareVersions(RegExp["$1"],"3.1")>=0;isMinKonq3_2=compareVersions(RegExp["$1"],"3.2")>=0}}}var isIE=sUserAgent.indexOf("compatible")>-1&&sUserAgent.indexOf("MSIE")>-1&&!isOpera;var isMinIE4=isMinIE5=isMinIE5_5=isMinIE6=false;if(isIE){var reIE=new RegExp("MSIE (\\d+\\.\\d+);");reIE.test(sUserAgent);var fIEVersion=parseFloat(RegExp["$1"]);isMinIE4=fIEVersion>=4;isMinIE5=fIEVersion>=5;isMinIE5_5=fIEVersion>=5.5;isMinIE6=fIEVersion>=6}var isMoz=sUserAgent.indexOf("Gecko")>-1&&!isKHTML;var isMinMoz1=false;if(isMoz){var reMoz=new RegExp("rv:(\\d+\\.\\d+(?:\\.\\d+)?)");reMoz.test(sUserAgent);isMinMoz1=compareVersions(RegExp["$1"],"1.0")>=0}var isFF=sUserAgent.indexOf("Firefox")>-1;if(isFF){var reFF=new RegExp("Firefox/(\\d+\\.\\d+(?:\\.\\d+)?)");reFF.test(sUserAgent);isMinFF1_5=compareVersions(RegExp["$1"],"1.5")>=0}var isNS4=!isIE&&!isOpera&&!isMoz&&!isKHTML&&(sUserAgent.indexOf("Mozilla")==0)&&(navigator.appName=="Netscape")&&(fAppVersion>=4&&fAppVersion<5);var isMinNS4=isMinNS4_5=isMinNS4_7=isMinNS4_8=false;if(isNS4){isMinNS4=true;isMinNS4_5=fAppVersion>=4.5;isMinNS4_7=fAppVersion>=4.7;isMinNS4_8=fAppVersion>=4.8}var isWin=(navigator.platform=="Win32")||(navigator.platform=="Windows");var isMac=(navigator.platform=="Mac68K")||(navigator.platform=="MacPPC")||(navigator.platform=="Macintosh");var isUnix=(navigator.platform=="X11")&&!isWin&&!isMac;var isWin95=isWin98=isWinNT4=isWin2K=isWinME=isWinXP=false;var isMac68K=isMacPPC=false;var isSunOS=isMinSunOS4=isMinSunOS5=isMinSunOS5_5=false;if(isWin){isWin95=sUserAgent.indexOf("Win95")>-1||sUserAgent.indexOf("Windows 95")>-1;isWin98=sUserAgent.indexOf("Win98")>-1||sUserAgent.indexOf("Windows 98")>-1;isWinME=sUserAgent.indexOf("Win 9x 4.90")>-1||sUserAgent.indexOf("Windows ME")>-1;isWin2K=sUserAgent.indexOf("Windows NT 5.0")>-1||sUserAgent.indexOf("Windows 2000")>-1;isWinXP=sUserAgent.indexOf("Windows NT 5.1")>-1||sUserAgent.indexOf("Windows XP")>-1;isWinNT4=sUserAgent.indexOf("WinNT")>-1||sUserAgent.indexOf("Windows NT")>-1||sUserAgent.indexOf("WinNT4.0")>-1||sUserAgent.indexOf("Windows NT 4.0")>-1&&(!isWinME&&!isWin2K&&!isWinXP)}if(isMac){isMac68K=sUserAgent.indexOf("Mac_68000")>-1||sUserAgent.indexOf("68K")>-1;isMacPPC=sUserAgent.indexOf("Mac_PowerPC")>-1||sUserAgent.indexOf("PPC")>-1}if(isUnix){isSunOS=sUserAgent.indexOf("SunOS")>-1;if(isSunOS){var reSunOS=new RegExp("SunOS (\\d+\\.\\d+(?:\\.\\d+)?)");reSunOS.test(sUserAgent);isMinSunOS4=compareVersions(RegExp["$1"],"4.0")>=0;isMinSunOS5=compareVersions(RegExp["$1"],"5.0")>=0;isMinSunOS5_5=compareVersions(RegExp["$1"],"5.5")>=0}}function getIFrameHeight(b){var a=0;if(b.height){a=b.height-20}else{if(b.body.scrollHeight){a=Math.max(a,b.body.scrollHeight)}if(b.body.offsetHeight){a=Math.max(a,b.body.offsetHeight)}}return a}function getIFrameWidth(b){var a=0;if(b.width){a=b.width}else{if(b.body.scrollWidth){a=Math.max(a,b.body.scrollWidth)}if(b.body.offsetWidth){a=Math.max(a,b.body.offsetWidth)}}return a}function setIFrameHeight(c){var b=document.getElementById("loginframe");b.style.height="auto";var a=getIFrameHeight(c);b.style.height=a+"px";return a}function setIFrameWidth(c){var b=document.getElementById("loginframe");b.style.width="auto";var a=getIFrameWidth(c);b.style.width=a+"px";return a}function getIFrameDoc(){var a=document.getElementById("loginframe");var b;if(a){if(a.contentDocument){b=a.contentDocument}else{if(a.contentWindow){b=a.contentWindow.document}else{if(a.document){b=a.document}}}}return b}function centerIFrame(b,e,j,c){var f=document.getElementById("loginframe");var g=getIFrameDoc();if(f&&g){setIFrameHeight(g);setIFrameWidth(g);var a=f.style.width.replace(/px/,"");var d=f.style.height.replace(/px/,"");if(b&&a<b){a=b;f.style.width=a+"px"}if(e&&d<e){d=e;f.style.height=d+"px"}if(j&&a>j){a=j;f.style.width=a+"px"}if(c&&d>c){d=c;f.style.height=d+"px"}recenterIFrame()}}function recenterIFrame(){var d=document.getElementById("loginframe");var g=getIFrameDoc();var b=getScrollOffset();var j=d.style.width.replace(/px/,"");var e=d.style.height.replace(/px/,"");var a=window.innerWidth?window.innerWidth:(document.documentElement.clientWidth?document.documentElement.clientWidth:document.body.offsetWidth);var k=window.innerHeight?window.innerHeight:(document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.offsetHeight);var c=Math.max(5,Math.round(a/2-j/2+b[0]));var f=Math.max(5,Math.round(k/2-e/2+b[1]));d.style.left=c+"px";d.style.top=f+"px"}function adjustIFrame(e,d,b,a){var c=document.getElementById("loginframe");c.style.top=e+"px";c.style.left=d+"px";c.style.width=b+"px";c.style.height=a+"px"}function centerAndDisplayIFrame(c,a,e,b){centerIFrame(c,a,e,b);var d=document.getElementById("loginframe");d.style.display="inline"}function loadIFrame(b,a){if((isMinIE5_5&&isWin)||isMinMoz1||isMinSafari1_2||isMinOpera8||isMinKonq3_2){if(!b||b==""){b="/MemberSignIn"}var e=new UrlParams();e.add("skin","iframe");if(a){for(var c=0;c<a.length-1;c+=2){e.add(a[c],a[c+1])}}if(b.match(/\?/)){b+="&"}else{b+="?"}b=b+e.toString();var f=document.getElementById("iframediv");var d=document.getElementById("loginframe");if(d){d.src=b;d.style.display="inline"}else{f.innerHTML+='<iframe id="loginframe" name="loginframe" src="'+b+'" frameborder="0" scrolling="no" width="590" height="600" style="position: absolute; z-index: 130;"></iframe>'}window.onresize=recenterIFrame;if(f){f.style.display="block"}return false}return true}function getLoginUrl(a){var b=getUrlPrefix()+"/MemberSignIn";var d=new UrlParams();if(a){for(var c=0;c<a.length-1;c+=2){d.add(a[c],a[c+1])}}if(b.match(/\?/)){b+="&"}else{b+="?"}b=b+d.toString();return b}function getUrlPrefix(){var b=document.location;var a=b.protocol+"//"+b.host;if(b.port){a+=":"+b.port}return a}function login(b){var a=getUrlPrefix();if(a.indexOf("https")==0){return loadIFrame(a+"/RegistrationPage",b)}else{window.location=getLoginUrl(b)}}function migrate(a){return loadIFrame(getUrlPrefix()+"/MemberScreenName",a)}function hideIFrame(){var a=parent.document.getElementById("loginframe");if(a){a.style.display="none";a.src=""}a=document.getElementById("iframediv");if(a){a.style.display="none"}if(parent.loginCancel){parent.loginCancel()}}ta.servlet.GeoCheckRates={checkBoxToggle:function(b,c){var a=$(c.parentNode);if(c.checked){a.addClass("checked")}else{a.removeClass("checked")}}};ta.maps=ta.maps||{};ta.maps.trackpixel=(function(a,d,b,e){var c=[];return{storeTrackPixleSrc:function(f){if(f){c.push(f)}},loadSponsorTrackingPixel:function(f){c.each(function(g){var h=g.trim();var j=new Element("img",{"class":"tracking"});j.src=h});if(!f){c=[]}}}}(document,window,ta));ta.module=function(b){var a={};b(a);return a};ta.servlet.hotelsMap=ta.module(function(A){var v=false;var f=false;var l=-1;var x="";var h="";var c=false;var t=1;var w={centerLat:false,centerLng:false,northLat:false,eastLng:false,southLat:false,westLng:false};var z="#MAPVIEW";var e=true;function d(){var E=ta.id("MAIN");if(!E){return}ta.remove("maps.marker-data");if(hotelsMapCSS&&!ta.has("ta.hotelsMapCSS")){ta.store("ta.hotelsMapCSS",new Asset.css(hotelsMapCSS))}var D=g();var C=r();new Request({url:"/HotelsMapAjax",data:{geo:ta.retrieve("page.geo"),cat:D,rad:C,sponsors:b(),mapProviderFeature:ta.retrieve("mapProviderFeature.maps_api"),page:1},evalScripts:true,onSuccess:function(F){document.getElement("body").addClass("fluid");new Element("div",{html:F,id:"HOTELS_MAP_WRAPPER"}).inject(E,"after");v=true;l=D;t=1;if(l!=g()){A.fetchPage(1)}else{if(ta.isHacMap()){if(!F.contains("HAC_COMPLETE")){setTimeout(function(){A.fetchPage(1)},1000)}else{var G=ta.id("MAP_SIDEBAR");if(G){ta.servlet.hotelsMap.addPlaceListEventHandlers(G)}}}}j();y()}}).send()}function j(){var C=a();$$(".locationDisplay").each(function(E){var D=E.get("data-sponsor");if(D&&C.indexOf(D)>-1){E.addClass("sponsored")}else{E.removeClass("sponsored")}})}function r(){if(ta.retrieve("hotels_auto_broaden.enabled")){if(ta.retrieve("hacFilterSaveable")&&ta.retrieve("hacFilterSaveable").filterState&&ta.retrieve("hacFilterSaveable").filterState.rad){return ta.retrieve("hacFilterSaveable").filterState.rad}}}function g(){var C=ta.retrieve("hac.data.object");if(C&&C.selected&&C.selected.cat){return C.selected.cat}}function k(C,D){var E=ta.id("MAP_BOTTOM_AD");if(!E){return}if(x!==C){x=C;new Request({url:"/MapAdAjax?fromServlet=HotelsMapAjax&t=468X60&sponsor="+C+"&ac="+getIncrementedAdsAjaxCount(),method:"get",evalScripts:true,onSuccess:function(F,G){if(ta.has("ads.gptEnabled")){ta.common.ads.injectAjaxAds("mapadajax","#gpt-ad-468x60-hotels_mapadajax",true)}else{E.set("html",F);ta.common.ads.injectAdsTargeted(E)}if(D){E.setStyle("height",0);A.toggleMapAd.delay(1000)}var H=ta.id("SHOW_HIDE_SPONSORS");if(H){H.removeClass("hidden")}}}).send()}}function u(C){var D=C.getPosition().y;var E=window.getSize().y;if(E-D>0){C.setStyle("height",E-D)}}function p(){$$("#SHOW_HIDE_SPONSORS img").toggleClass("suppress")}function m(){var E=ta.id("PLACE_LIST");var D=document.getElement("#PLACE_LIST .placeList");var C=ta.id("MAPS_PAGINATION");if(E&&D&&C){u(E);D.setStyle("height",E.getSize().y-C.getSize().y)}}function B(){if(ta.isHacMap()){n();return}var D=ta.servlet.hotelsMap.map.mapBounds();var C=new Request({url:"/HotelsMapSponsorsAjax",data:{sponsors:b(),geo:ta.retrieve("page.geo"),minLat:D.south,maxLat:D.north,minLng:D.west,maxLng:D.east,mapProviderFeature:ta.retrieve("mapProviderFeature.maps_api")}});C.onSuccess=function(F){var H=document.getElement("#PLACE_LIST .placeList");var E=new Element("div",{"class":"additionalSponsored",html:F,styles:{display:"none"}});if(H){var G=H.getElement(".additionalSponsored");if(G){E.replaces(G)}else{E.inject(H)}(function(){ta.servlet.hotelsMap.map.refreshPins(true)}).delay(5)}};C.send()}A.loadSponsoredLocations=function(){B()};function n(H,F){var I="HotelsMapSponsorsAjax_curCancelKey";var G=13;H=H||new Date().getTime();var E="HotelsMapSponsorsAjax_"+H+"_cancel";var J=false;if(!F){J=true;F=1}else{if(ta.retrieve(E)===true){return}}if(ta.has(I)){var K=ta.retrieve(I);if(K!=E){ta.store(K,true);ta.commerce.meta.polling.removePollingInfoForRequest(K)}}if(!ta.has(E)){ta.store(E,false);ta.store(I,E)}if(!ta.commerce.meta.polling.isRequestBeingPolled(E)){ta.commerce.meta.polling.setPollingAttemptForRequest(E,0)}var C=ta.servlet.hotelsMap.map.mapBounds();var D=new Request({url:"/HotelsMapSponsorsAjax",data:{sponsors:b(),geo:ta.retrieve("page.geo"),minLat:C.south,maxLat:C.north,minLng:C.west,maxLng:C.east,INITIAL_REQUEST:J}});D.onSuccess=function(M){if(ta.retrieve(E)===true){return}var P=document.getElement("#PLACE_LIST .placeList");var L=new Element("div",{"class":"additionalSponsored",html:M,styles:{display:"none"}});var O;var N=ta.id("SPONSOR_LISTINGS");var Q=ta.id("HOTELS_MAP_WRAPPER");if(!N){if(Q){O=new Element("div",{id:"SPONSOR_LISTINGS",html:L.innerHTML,styles:{display:"none"}});O.inject(Q)}}else{O=new Element("div",{id:"SPONSOR_LISTINGS",html:L.innerHTML,styles:{display:"none"}});N.innerHTML=O.innerHTML}(function(){ta.servlet.hotelsMap.map.refreshPins(true);j()}).delay(5);if(M.contains("HAC_COMPLETE")){ta.commerce.meta.polling.removePollingInfoForRequest(E);ta.store("hotelmap.sponsorsfetch.complete",true)}else{if(F<G){ta.commerce.meta.polling.incrementPollingAttemptForRequest(E);setTimeout(function(){n(H,F+1)},ta.commerce.meta.polling.getPollingWaitTimeForRequest(E))}else{if(F>=G){ta.store("hotelmap.sponsorsfetch.complete",true)}}}};D.send()}function s(){return $$("#SPONSORS input").filter(function(C){return C.getProperty("checked")})}function b(){return s().map(function(C){return C.getProperty("value")}).join()}function a(){return s().map(function(C){return C.getProperty("name").replace("map_sponsor_","")}).join()}function y(){var D,C;if(ta.isHacMap()){D=ta.id("HOTELS_HEADING_CAT_"+g());C=document.getElement("#HOTELS_MAP_WRAPPER .heading");if(D&&C){C.set("html",D.get("html"))}return}D=ta.id("HEADING");C=document.getElement("#HOTELS_MAP_WRAPPER .heading");if(D&&C){C.set("html",D.get("html"))}}function q(C){if(C){ta.trackEventOnPage("HACMap","sponsor_cr_sent",C)}}A.toggleMap=function(){f=(window.location.hash===z);if(f){if(ta.retrieve("hotels_map_search.enabled")){document.getElement("#PAGE .secondaryNavBar").hide()}if(!v){d()}else{A.fetchPage(1)}}else{if(ta.retrieve("hotels_map_search.enabled")){document.getElement("#PAGE .secondaryNavBar").show()}}document.getElement("body").toggleClass("fluid",f);if(f){window.scrollTo(0,0)}};A.isMapOpen=function(){return f};A.fetchBannerAd=function(C){k(C,true)};A.setInitialSponsor=function(C){h=C};A.toggleMapAd=function(){var F=ta.id("MAP_BOTTOM_AD");if(!F){return}var D=new Fx.Tween(F,{duration:"short",property:"height",onComplete:p});var E=F.getSize().y;var C=0;if(E===0){C=60}D.start(E,C)};A.searchKeyup=function(E){var F=ta.id(E);var D=ta.id("CLEAR_SEARCH");if(F&&D){var C=F.value;if(C){D.show()}else{D.hide()}}};A.clearSearch=function(){var C=ta.id("MAP_SEARCH_BAR");var D=ta.id("CLEAR_SEARCH");if(C&&D){C.value="";D.hide();C.focus()}};A.windowResize=function(){u(ta.id("NEARBY_MAP"));m();ta.servlet.hotelsMap.map.notifyOfResize()};A.mapCreate=function(){ta.store("maps.postcreate",ta.servlet.hotelsMap.map.initializationCallback);ta.util.pending.waitForFn("mapfactory",ta.maps.Factory.createPrivateMap)};A.toggleSponsor=function(F,D){var E=false;var C=ta.id("SHOW_HIDE_SPONSORS");if(C&&C.hasClass("hidden")){C.removeClass("hidden");E=true}if(D.get("checked")){k(D.get("value"),E)}j();B();if(ta.isHacMap()){o(t)}};A.sponsorCRClick=function(E,D){if(D&&D.hasAttribute("data-sponsor")){var C=D.getAttribute("data-sponsor");if(ta.maps.mapsponsor.isSponsorDisplayed(C)){ta.trackEventOnPage("HACMap","sponsor_info_checkrates",C)}}};A.fetchPage=function(F){if(ta.isHacMap()){A.showLoadingGifs();B();o(F);return}var E=g();var D=r();var C={page:F,geo:ta.retrieve("page.geo"),cat:E,rad:D};new Request.HTML({url:"/HotelsMapUpdateAjax",data:C,update:ta.id("MAP_SIDEBAR"),onSuccess:function(){l=E;A.windowResize();ta.servlet.hotelsMap.map.refreshPins(true);ta.servlet.hotelsMap.map.rezoom();j();y();B()}}).send()};function o(J,F,H){var L="HotelsMapUpdateAjax_curCancelKey";var G=13;H=H||new Date().getTime();var E="HotelsMapUpdateAjax_"+H+"_cancel";var M=false;if(!F){M=true;F=1}else{if(ta.retrieve(E)===true){return}}if(F>1){c=true}if(ta.has(L)){var N=ta.retrieve(L);if(N!=E){ta.store(N,true);ta.commerce.meta.polling.removePollingInfoForRequest(N)}}if(!ta.has(E)){ta.store(E,false);ta.store(L,E)}if(!ta.commerce.meta.polling.isRequestBeingPolled(E)){ta.commerce.meta.polling.setPollingAttemptForRequest(E,0)}var C=g();var D=r();var K={page:J,geo:ta.retrieve("page.geo"),cat:C,rad:D,INITIAL_REQUEST:M,sponsors:b()};var I=ta.servlet.hotelsMap.map.getCustomPinId();if(I){K.customPin="true";K.pinLocId=I}if(w.centerLat&&w.centerLng){K.CENTER_LAT=w.centerLat;K.CENTER_LNG=w.centerLng;K.NORTH_LAT=w.northLat;K.EAST_LNG=w.eastLng;K.SOUTH_LAT=w.southLat;K.WEST_LNG=w.westLng}new Request.HTML({url:"/HotelsMapUpdateAjax",data:K,onSuccess:function(T,P,U,Q){var S=document.getElement("#PLACE_LIST .placeList");var O=S?S.getScrollTop():0;var R=ta.id("MAP_SIDEBAR");ta.servlet.hotelsMap.redrawSidebarPersistent(R,U);ta.servlet.hotelsMap.addPlaceListEventHandlers(R);A.clearLoadingGifs();if(ta.retrieve(E)===true||!e){if(!e){ta.servlet.hotelsMap.showOutsideBoundaryErrMsg()}return}l=C;t=J;A.windowResize();if(F!=1){S=document.getElement("#PLACE_LIST .placeList");if(S){S.scrollTop=O}}ta.servlet.hotelsMap.map.refreshPins(true);if(!c&&F==1){ta.servlet.hotelsMap.map.rezoom()}j();y();if(U.contains("HAC_COMPLETE")){ta.commerce.meta.polling.removePollingInfoForRequest(E)}else{if(F<G){ta.commerce.meta.polling.incrementPollingAttemptForRequest(E);setTimeout(function(){o(J,F+1,H)},ta.commerce.meta.polling.getPollingWaitTimeForRequest(E))}}}}).send()}A.truncatePlaceListProviderNames=function(D){var E=4;if(D){var C=D.getElements(".offer");Array.each(C,function(I){var F=I.getElement(".offer_name");var H=I.getElement(".offer_price");if(H&&F){var G=I.getComputedSize().width-H.getWidth()-E;if(G>0){F.setStyle("width",G+"px")}}})}};A.addPlaceListEventHandlers=function(F){try{var E=F.getElements(".locationDisplay");Array.each(E,function(H){var G=H.get("data-location-id");H.addEvent("mouseover",function(I){ta.servlet.hotelsMap.toggleSeeMore(I,H,G);ta.servlet.hotelsMap.map.focusOnPin(I,H,G)});H.addEvent("mouseout",function(I){ta.servlet.hotelsMap.toggleSeeMore(I,H,G);ta.servlet.hotelsMap.map.blurPins(I,H)})});var D=F.getElements(".locationDisplay .noTopOffer, .locationDisplay .see_more, .locationDisplay .toggleOffersList");Array.each(D,function(G){G.addEvent("click",function(H){ta.servlet.hotelsMap.togglePlacelistOffers(H,G)})})}catch(C){ta.util.error.record(null,"PlaceListEventHandlers error - hotelsHACMap")}};A.toggleSeeMore=function(E,D,G){var C=ta.id(D);var F=C.getElement(".see");if(F){F.toggleClass("novis")}};A.togglePlacelistOffers=function(F,D){var C=ta.id(D);var G=C.getParent(".mainInfo");if(G){var E=G.getElement(".other_offers");if(E){E.toggleClass("hidden");if(!E.hasClass("hidden")){ta.servlet.hotelsMap.truncatePlaceListProviderNames(E)}}}};A.redrawSidebarPersistent=function(F,E){if(F){var D=F.getElements("#PLACE_LIST .placeList .other_offers:not(.hidden)").getParent(".locationDisplay").get("id");var C=F.getElement("#HAC_WRAP");var G=Elements.from(E).filter("#HAC_WRAP")[0];if(C&&G){C.innerHTML=G.innerHTML}else{F.innerHTML=E}Array.each(D,function(I){var H=document.getElement("#"+I+" .see_more");if(H){ta.servlet.hotelsMap.togglePlacelistOffers(null,H)}})}};A.clearErrorMsgs=function(){var C=ta.select("#MAP_SIDEBAR .mapErrorMsg");if(C){C.dispose()}};A.clearLoadingGifs=function(){var C=ta.select("#MAP_SIDEBAR .searchingMsg, #NEARBY_MAP .mapUpdatingMsg");if(C){C.dispose()}};A.showLoadingGifs=function(){A.clearErrorMsgs();var D=ta.retrieve("maps.searchingMsg");var C=ta.retrieve("maps.updatingMapMsg");if(D&&C){D.inject(ta.id("MAP_SIDEBAR"));C.inject(ta.id("NEARBY_MAP"))}};A.cleanupPinInfoWindows=function(){Array.each(document.getElements(".js_hvrNfo"),function(C){C.dispose()});ta.servlet.hotelsMap.cleanupPinCloseAndOfferList()};A.cleanupPinCloseAndOfferList=function(){Array.each(document.getElements("#NEARBY_MAP .pinInfoClose"),function(C){C.dispose()});Array.each(document.getElements("#NEARBY_MAP .other_offers"),function(C){C.dispose()})};A.showOutsideBoundaryErrMsg=function(){var D=ta.id("PLACE_LIST");if(D){var C=new Element("div",{"class":"mapErrorMsg",html:ta.retrieve("modules.maps.str_outside_radius")});D.empty();D.adopt(C);ta.servlet.hotelsMap.map.refreshPins(true)}};A.commerceClick=function(){};A.hacMapDateChange=function(){ta.widgets.calendar.syncAllDatePickers();ta.store("maps.hacMapDateChanged",true);ta.widgets.calendar.justUpdateSessionDates(function(){ta.servlet.hotelsMap.fetchPage(1)})};A.backToListViewOnClick=function(){if(ta.remove("maps.hacMapDateChanged")){ta.servlet.HACSearch.doMetaDateSearch()}};A.isMarkerInfoWindowPersistent=function(C){var E=document.getElement(".js_hvrNfo");if(E&&C&&C.options&&C.options.locationId){var D=E.getElement(".locationDisplay");var F=D?D.get("data-location-id"):"";if(F==C.options.locationId){var G=document.getElement("#NEARBY_MAP .other_offers");if(G&&!G.hasClass("hidden")){return true}}}return false};A.isAnyInfoWindowPersistent=function(){var C=document.getElement(".js_hvrNfo");var D=document.getElement("#NEARBY_MAP .other_offers");if(C&&D&&!D.hasClass("hidden")){return true}return false};A.map=ta.module(function(af){var ac;var I;var N;var Y;var K;var ag=null;var ae=null;var D=13;var S=12;var ab={};var U={};var Z=false;var O=null;var R=-9999;var J=-9999;var H=80.4672;af.initializationCallback=function(ah){ag={pinSize:new ta.support.Size(21,25),iconWidth:17,iconHeight:21,anchorX:1,anchorY:14,supportsIcon:false,iconPath:"/img2/maps/icons/locationsNear/",iconPrefix:"pin",iconHover:"Over",iconExt:".png"};CUSTOM_BASE_PIN={pinSize:new ta.support.Size(27,31),iconWidth:23,iconHeight:27,anchorX:1,anchorY:14,supportsIcon:false,iconPath:"/img2/maps/icons/locationsNear/",iconPrefix:"pinV2",iconHover:"Over",iconExt:".png"};ae=Object.merge({},ag,{iconWidth:28,iconHeight:31,anchorX:14,anchorY:31,iconHover:""});ac=ah;ac.addEvent("markerClick",function(ai){if(!U[ai.options.locationId]){T();ac.markerOver(ai);U[ai.options.locationId]=ai}else{T()}});ac.addEvent("mouseDown",function(ai){T()});I=new ta.api.maps.Location(ta.retrieve("maps.latitude"),ta.retrieve("maps.longitude"));N=ta.id(ta.retrieve("maps.container"));ta.servlet.hotelsMap.windowResize();X("Hotel",ag);X("Restaurant",ag);X("Attraction",ag);if(ta.retrieve("hotels_map_search.enabled")){X("Custom",CUSTOM_BASE_PIN,1000)}else{X("Custom",ag,1000)}F();if(ta.isHacMap()){ac.addEvent("beforeMove",function(){af.onBeforeMove()});ac.addEvent("onViewChangeStart",function(){af.onViewChangeStart()});if(ta.has("maps.latitude")&&ta.has("maps.longitude")){R=ta.retrieve("maps.latitude");J=ta.retrieve("maps.longitude")}ta.store("maps.updatingMapMsg",new Element("div",{"class":"loadingMsg mapUpdatingMsg",html:'<span class="msg">'+ta.retrieve("hotels.updatingMap")+"</span>"}).grab(new Asset.image(CDNHOST+"/img2/generic/site/loading_anim_gry_sml.gif")));ta.store("maps.searchingMsg",new Element("div",{"class":"searchingMsg",html:'<span class="msg">'+ta.retrieve("hotels.searching")+"</span>"}).grab(new Asset.image(CDNHOST+"/img2/generic/site/ajax-loader.gif"),"top"))}ta.servlet.hotelsMap.map.rezoom();if(ta.isHacMap()){B()}ta.servlet.hotelsMap.map.refreshPins(true);if(h){ta.servlet.hotelsMap.fetchBannerAd(h)}G()};var aa=null;function G(ak){var ah=5;if(!ak){ak=0}if(ak>ah&&aa){window.clearTimeout(aa);return}if(ta.retrieve("hotelmap.sponsorsfetch.complete")){if(aa){window.clearTimeout(aa)}var aj=a();var ai=0;if(aj.length>0){ai=$$(".locationDisplay").filter(function(am){var al=am.get("data-sponsor");return al&&aj.indexOf(al)>-1}).length;ta.maps.mapsponsor.trackSponsorPinCountOnMap(aj,ai)}}else{ak+=1;aa=window.setTimeout(function(){G(ak)},300)}}function X(ah,ai,aj){ac.addIcon(ah,Object.merge({},ai,{name:ah,zIndex:aj}))}function F(){X("bstWst",ae);X("bstWstCa",ae);X("hampton",ae);X("comfortinn",ae);X("comfortsuites",ae);X("econolodge",ae);X("qualityinn",ae);X("sleepinn",ae);X("comfortinnca",ae);X("qualityinnca",ae);X("holidayinn",ae);X("super8",ae);X("super8ca",ae);X("ramadaca",ae);X("comfortfamily",ae)}af.rezoom=function(){var at=$$("#PLACE_LIST .placeList.visible .locationDisplay");var ak=1000;var am=1000;var an=-1000;var ap=-1000;var ar=ta.retrieve("maps.autoZoomLocationCount");for(var ao=0;ao<ar;ao++){if(at[ao]){var aq=at[ao];var au=parseFloat(aq.get("data-lat"));var av=parseFloat(aq.get("data-lng"));ak=(au<ak)?au:ak;an=(au>an)?au:an;am=(av<am)?av:am;ap=(av>ap)?av:ap}}var ai=(an-ak)*0.05;var ah=(ap-am)*0.05;ak-=ai;am-=ah;an+=ai;ap+=ah;var al=new ta.maps.Location(ak,am);var aj=new ta.maps.Location(an,ap);setTimeout(function(){ac.zoomToFitLocations(al,aj)},800);animationInProgress=true;setTimeout(function(){animationInProgress=false},2000)};af.notifyOfResize=function(){var ah=ta.id(ta.retrieve("maps.container"));if(ah&&ac){if(ac.bingmap){ac.bingmap.setOptions({width:ah.getSize().x,height:ah.getSize().y})}else{if(ac.yandexmap){ac.yandexmap.container.fitToViewport()}}}};af.addCustomPin=function(ao,ak,aj,an){var ai={lat:ao,lng:ak};if(an&&ab[an]){ai.customHover=ab[an].options.customHover;ac.panTo(ao,ak,false);P()}else{var am=ta.servlet.hotelsMap.map.mapBounds(),al=g();new Request.HTML({url:"/HotelsMapUpdateAjax",data:{pinLocId:an,CENTER_LAT:ao,CENTER_LNG:ak,NORTH_LAT:am.north,EAST_LNG:am.east,SOUTH_LAT:am.south,WEST_LNG:am.west,geo:ta.retrieve("page.geo"),cat:al,customPin:"true"},update:ta.id("MAP_SIDEBAR"),onSuccess:function(ar,ap,at,aq){l=al;ta.servlet.hotelsMap.windowResize();ta.servlet.hotelsMap.map.refreshPins(true);j();y();B();ac.panTo(ao,ak,false);P()}}).send();if(!an){ai.customHover={contents:aj}}else{ai.customHover={contentElemId:"LOC_"+an,onClick:af.pinInfoClickHandler}}}if(ta.isHacMap()){ai.persistInfoWindow=true}var ah=ac.createMarker(ai,"Custom");ac.addMarker(ah,"Custom");if(Y){ac.removeMarker(Y)}K=an;Y=ah};af.refreshPins=function(aj){T();var ai="Hotel";var ah=ad(ai);var al=W(ah);var ak=[];if(aj){ak=ah;currentPins={}}else{ak=al}Array.each(ak,function(am){E(am)})};function ad(al){var aj=$$("#PLACE_LIST .placeList.visible .locationDisplay");var ak=[];var ai=a();Array.each(aj.reverse(),function(at){var ap={};ap.lat=at.get("data-lat");ap.lng=at.get("data-lng");ap.locationId=at.get("data-location-id");var an=ta.retrieve("close_button_image_path");var aq=at.clone();var ao=at.get("data-sponsor");if(ao&&ai.indexOf(ao)>-1){ap.type=ao;ap.sponsorInfo={mapSource:"HACMap",name:ao};aq.addClass("sponsored")}else{ap.type=al}var ar=aq.outerHTML;if(M()){ar+="<img class='closeButton' onclick='ta.servlet.hotelsMap.map.blurPins()' src='"+an+"'>"}if(ta.isHacMap()){var am="LOC_"+at.get("data-location-id");ap.customHover={contentElemId:am,onClick:af.pinInfoClickHandler};ap.persistInfoWindow=true}else{ap.customHover={contents:ar}}ak.push(ap)});if(ta.isHacMap()){var ah=$$("#SPONSOR_LISTINGS .locationDisplay");Array.each(ah.reverse(),function(at){var ap={};ap.lat=at.get("data-lat");ap.lng=at.get("data-lng");ap.locationId=at.get("data-location-id");var an=ta.retrieve("close_button_image_path");var aq=at.clone();var ao=at.get("data-sponsor");if(ao&&ai.indexOf(ao)>-1){ap.type=ao;ap.sponsorInfo={mapSource:"HACMap",name:ao};aq.addClass("sponsored")}else{ap.type=al}var ar=aq.outerHTML;if(M()){ar+="<img class='closeButton' onclick='ta.servlet.hotelsMap.map.blurPins()' src='"+an+"'>"}var am="SPONS_LOC_"+at.get("data-location-id");ap.customHover={contentElemId:am,onClick:af.pinInfoClickHandler};ap.persistInfoWindow=true;ak.push(ap)})}return ak}function M(){return(!!("ontouchstart" in window)||!!("onmsgesturechange" in window))}function W(ah){var ai={};var aj=[];Array.each(ah,function(ak){var al=ak.locationId;if(ab[al]&&ab[al].type==ak.type){ai[al]=ab[al];delete ab[al]}else{aj.push(ak)}});Object.each(ab,function(ak){ac.removeMarker(ak)});ab=ai;return aj}function E(ai){if(!ab[ai.locationId]){var aj=ai.type;var ah=ac.createMarker(ai,aj);ac.addMarker(ah,aj);ab[ai.locationId]=ah}}af.focusOnPin=function(aj,ai,am){if(!ac){return}var al=ai;var ak=aj.relatedTarget;if(!ak||(ak!==al&&!ta.id(al).contains(ak))){var ah=ab[am];if(ah){ac.markerOver(ah);U[am]=ah}}};af.blurPins=function(ai,ah){if(!ac){return}if(!(ai&&ah)){T()}var ak=ah;var aj=ai.relatedTarget;if(!aj||(aj!==ak&&!ta.id(ak).contains(aj))){T()}};function T(){Object.each(U,function(ah){ac.markerOut(ah)});U={}}af.mapBounds=function(){if(ac){return ac.mapBounds()}return null};af.getCenter=function(){return ac.getCenter()};af.fetchPage=function(ah){ta.servlet.hotelsMap.fetchPage(ah)};function P(){try{if(c){var aj;if(L()){e=true;aj=ta.servlet.hotelsMap.map.mapBounds();var ah=ta.servlet.hotelsMap.map.getCenter();w.centerLat=ah.lat;w.centerLng=ah.lng;w.northLat=aj.north;w.eastLng=aj.east;w.southLat=aj.south;w.westLng=aj.west;ta.servlet.hotelsMap.cleanupPinInfoWindows();af.fetchPage(1)}else{if(C()){e=true;aj=ta.servlet.hotelsMap.map.mapBounds();w.centerLat=R;w.centerLng=J;w.northLat=aj.north;w.eastLng=aj.east;w.southLat=aj.south;w.westLng=aj.west;ta.servlet.hotelsMap.cleanupPinInfoWindows();af.fetchPage(1)}else{e=false;ta.servlet.hotelsMap.clearErrorMsgs();ta.servlet.hotelsMap.clearLoadingGifs();ta.servlet.hotelsMap.cleanupPinInfoWindows();ta.servlet.hotelsMap.showOutsideBoundaryErrMsg();B()}}}}catch(ai){ta.util.error.record(ai,"mapMoved error - hotelsHACMap",null,{geo:ta.retrieve("page.geo"),origLat:R,origLng:J})}}function L(){if(c){var ah=ta.servlet.hotelsMap.map.getCenter();var ai=Q(ah.lat,ah.lng);return(ai<H)}return false}function Q(ak,am){if(!ak||!am){return -1}var ah=(R-ak)/(180/3.14159);var ai=(J-am)/(180/3.14159);var aj=((ak+R)/2)/(180/3.14159);var al=Math.pow(ah,2)+Math.pow((Math.cos(aj)*ai),2);al=3963.1676*Math.sqrt(al);return al*1.61}function C(){var ai=ta.servlet.hotelsMap.map.mapBounds();if(ai){var ah=ac.createLocation(R,J);return ai.containsLatLng(ah)}return false}af.onMove=function(){if(ta.isHacMap()){P()}else{B()}};function V(){c=true}af.onBeforeMove=function(){V()};af.onViewChangeStart=function(){if(af.isPinInfoPersistent()){af.cleanupActiveMarker();document.removeEvent("click",af.disposePinInfoWindow)}};af.isPinInfoPersistent=function(){var ah=document.getElement("#NEARBY_MAP .other_offers");return ah&&!ah.hasClass("hidden")};af.pinInfoClickHandler=function(ak,aj,ah){try{var al=ak.target;while(al!==null){if(al.hasClass("see_more")||al.hasClass("noTopOffer")||al.hasClass("toggleOffersList")){af.togglePinOfferList(ak,al,aj,ah);break}al=al.getParent()}}catch(ai){ta.util.error.record(ai,"pinInfoClickHandler - Error handling pin info window click",ak,{marker:ah})}};af.togglePinOfferList=function(ah,am,ai,ak){try{var ap=document.getElement(".js_hvrNfo");var ao=document.getElement("#NEARBY_MAP .pinInfoClose");var aj=document.getElement("#NEARBY_MAP .other_offers");if(!aj||!ao||!ap){return}if(aj.hasClass("hidden")){O=ak;aj.removeClass("hidden");var al=document.getElement(".js_hvrNfo .see_more");if(al){aj.position({relativeTo:al,position:"bottomRight",edge:"upperRight"})}ao.removeClass("hidden");ao.position({relativeTo:ap,position:"upperRight",edge:"upperRight",offset:{x:7,y:-10}});af.removePinInfoWindowMouseEvents(ap);ah.stopPropagation();document.removeEvent("click",af.disposePinInfoWindow);document.addEvent("click",af.disposePinInfoWindow)}else{O=null;aj.addClass("hidden");ao.addClass("hidden");document.removeEvent("click",af.disposePinInfoWindow);if(ai&&ak&&ai.customHoverOver&&ai.customHoverOut){ap.addEvent("mouseenter",ai.customHoverOver.bind(ai,ak));ap.addEvent("mouseleave",ai.customHoverOut.bind(ai,ak))}}}catch(an){ta.util.error.record(an,"togglePinOfferList - hotels_map",ah,{marker:ak})}};af.disposePinInfoWindow=function(ai){if(ai.target.hasClass("pinInfoClose")){af.cleanupActiveMarker()}else{var ah=document.getElement(".js_hvrNfo");var aj=document.getElement("#NEARBY_MAP .other_offers");if(ah&&!ah.containsEvent(ai)&&aj&&!aj.containsEvent(ai)){af.cleanupActiveMarker()}}};af.cleanupActiveMarker=function(){if(O){ac.markerOut(O);ac.customHoverOut(O);O=null;document.removeEvent("click",af.disposePinInfoWindow)}};af.removePinInfoWindowMouseEvents=function(ah){ah=ah||document.getElement(".js_hvrNfo");if(ah){ah.removeEvents("mouseenter");ah.removeEvents("mouseleave")}};af.cleanupOverlays=function(){var ai=document.getElement(".overlayBG");var ah=document.getElement(".gray.overlay");if(ai&&ah){ai.dispose();ah.dispose()}};af.getCustomPinId=function(){if(Y&&K){return K}return null}})});(function(a){a.util.sessionStorage={};a.util.sessionStorage.canUseSessionStore=function(){try{if(window.sessionStorage){var c="taLsTest";sessionStorage.setItem(c,"1");var b=sessionStorage.getItem(c);return(b=="1")}}catch(d){return false}}}(ta));ta.common.gutterAd=(function(v,j,k,f){var w=1193,e=1324,x=w,d=true,q=300,s=null,A=true,u=1,m=1,l=1192,p=1645,y=k.id("PAGE"),n=function(){try{var C=z(),B=k.id("MAIN"),D=false;if(!(C&&B&&r())){g();return}if(k.util.i18n.isRtl()){D=B.getCoordinates().left-u;C.setStyles({right:(j.getSize().x-D),left:"auto"})}else{D=B.getCoordinates().right+u;C.setStyles({left:D})}}catch(E){g();k.util.error.record(E,"gutterAd: unable to set left position")}},t=function(){try{var F=z();if(!F||F.hasClass("taEmpty")){g();return}if(!r()){F.hide();return}var J=j.getScroll().y;var H=s.getCoordinates().bottom-F.offsetHeight;var I=o().getCoordinates();var C=(A)?I.bottom:I.top;var K;var G=k.id("PERSISTENT_DATE_PICKER");var B=0;if(G&&!G.hasClass("hidden")){B+=G.getHeight()}if(J>=(C-B)&&J<=H){if(!F.style.cssText.match(":\\s*fixed")){K={position:"fixed",top:m,"padding-top":B}}}else{var D=F.style.cssText;if(!D.match("top")||D.match("top\\s*:\\s*"+m)){K={position:"absolute",top:(C+m),"padding-top":0};F.setStyles({position:"absolute",top:(C+m),"padding-top":0})}}if(K){F.setStyles(K)}}catch(E){g();k.util.error.record(E,"gutterAd: unable to set top position")}},o=function(){var B=k.id("p13n_tag_header");A=true;if(!B){B=k.id("MAINWRAP");A=false}return B},z=function(){return v.getElement("#PAGE ."+k.common.gutterAd.adElemClass)},g=function(){var B=z();if(B){B.destroy()}j.removeEvent("scroll",n);j.removeEvent("resize",h);if(y){y.removeClass("gutterAd")}},r=function(){return j.getSize().x>=x},c=function(){return Browser.ie6||Browser.ie7||Browser.ie8},a=function(){var B=j.getSize().x;return l<=B&&B<=p},h=function(){if(r()){var B=z();if(B&&B.getStyle("display")=="none"){t()}}n();b()},b=function(){var C=d?"160":"300";var D=a()?"offset_true":"offset_false";var B="ads.gutter."+C+"."+D;if(k.localStorage.enabled&&!k.localStorage.hasSessionKey(B)){k.trackEventOnPage("hotels_gutter_ad",C,D);k.localStorage.setSessionKey(B,true)}};return{adElemClass:"scrollingGutterAd",init:function(){var C="gpt-ad-160x600",D=j.getSize().x;if(D<w||c()){g();return}else{if(D>=e){d=false;C="gpt-ad-300x250-300x600-160x600"}}if(k.id("hotels_one_col_bottom")&&!k.id("right_hand_rail")){s=k.id("hotels_one_col_bottom");var B=new Element("div",{"class":"gptAd "+k.common.gutterAd.adElemClass,id:C,style:"position:absolute"});if(y){y.appendChild(B);(function(){var E=k.common.ads.getAd(B.id);if(E){n();t();E.inject();j.addEvent("scroll",t);j.addEvent("resize",h)}}).delay(q)}}b()},init_justTracking:function(){var B=j.getSize().x;if(B>=e){d=false}b();j.addEvent("resize",b)},shouldDisplay:function(){return r()}}}(document,window,ta));(function(o,h,s,e){var f=100;var k=false,g=false,t=null,d=false,m={useBookingMask:false,focusAreaId:"CHECK_RATES_CONT"};function j(){if(t===null){t=ta&&ta.localStorage&&ta.localStorage.enabled}return t}function a(v){var u="SeenMetaFocus";if(v){u=u+v}return u}function b(u,v){k=u;if(j()){ta.localStorage.setSessionKey(a(v),u)}}function n(u){if(ta.retrieve("post_meta_ib_cross_sell")&&h.pageServlet==="Hotel_Review"){return false}if(!k&&j()&&ta.localStorage.getSessionKey(a(u))===true){k=true}return k}function l(u){u=ta.id(u);return u&&u.isVisible()&&u.getPosition().y>=h.getScrollTop()&&(u.getPosition().y+u.getSize().y<=h.getScrollTop()+h.getSize().y)}function c(v){var u=ta.id(o.body),w;m=Object.merge({useBookingMask:false,focusAreaId:"CHECK_RATES_CONT"},v);w=ta.id(m.focusArea)||ta.id(m.focusAreaId);if(!w||!o.getElement(".metaFocusMessaging")||(w.hasClass("bookingOpen")&&!ta.retrieve("post_meta_ib_cross_sell")&&!ta.retrieve("IN_ABC"))||(ta.overlays&&ta.overlays.getCurrent&&ta.overlays.getCurrent())){ta.fireEvent("openMetaFocusBlocked");return}d=true;b(true,m.servlet);w.addClass("focusArea");g=o.createElement("div");g.className="metaFocusMask";u.appendChild(g);w.addClass("hideFocusArrow");u.addClass("prepMetaFocus");if(m.useBookingMask){u.addClass("useBookingMask");if(ta.retrieve("post_meta_ib_cross_sell")){u.addClass("useBookingFlyoutMask")}}ta.fireEvent("preMetaFocusShow");u.offsetLeft;u.removeClass("prepMetaFocus").addClass("metaFocus");setTimeout(function(){w.removeClass("hideFocusArrow")},f);if(ta.retrieve("post_meta_ib_cross_sell")&&m.useBookingMask&&h.pageServlet==="Hotel_Review"){u.click();ta.id(o.getElement(".metaFocusMask")).addEvent("click",p);ta.id(o.getElement(".metaFocusMessaging")).addEvent("click",p)}else{u.addEvent("click",p);u.addEvent("mousedown",p);u.addEvent("touchstart",p)}ta.fireEvent("metaFocusShow");h.addEvent("onCalendarRangeSelect",p)}function p(x){var w=ta.id(m.focusArea)||ta.id(m.focusAreaId),u=ta.id(o.body),v;if(!w||!g||!d){return}x=x||h.event;if(x){v=x.target?ta.id(x.target):ta.id(x.srcElement)}if(ta.has("hr_meta_focus_email_signup")&&v&&v.getParent(".emailSignup")){return}d=false;u.removeClass("metaFocus").addClass("prepMetaFocus");ta.store("non_booking_offer_click",false);setTimeout(function(){u.removeClass("prepMetaFocus");u.removeClass("useBookingMask");u.removeClass("useBookingFlyoutMask");u.removeChild(g);g=false;w.removeClass("focusArea")},f);ta.fireEvent("metaFocusHide",{target:v});u.removeEvent("mousedown",p);u.removeEvent("touchstart",p);h.removeEvent("onCalendarRangeSelect",p)}function r(){return ta.widgets.calendar&&ta.widgets.calendar.hasPageDates()}function q(){return !!ta.retrieve("isFirstSessionPageView")}s.metaFocus=s.metaFocus||{};s.metaFocus.utils={show:c,hide:p,beenSeen:n,hasDates:r,setSeen:b,useLocalStorage:j,focusAreaVisible:l,firstPageView:q,isShowing:function(){return d},fadeTime:f}})(document,window,ta);(function(m,h,s,f){var o=0,j=null,a=null,d="",k="",e=true,c=false;var g=680;function p(){o=ta.retrieve("hotels_meta_focus");if(!o){return}if(o>=1&&o<=4){a=(o===1||o===2)?null:"Hotels";if(!s.metaFocus.utils.beenSeen(a)){d="HotelsMetaFocusDated";k=s.metaFocus.utils.hasDates()?"datesOther":"datesOnHotels";ta.on("onHACUpdateComplete",l)}}else{if(!s.metaFocus.utils.hasDates()&&o>=5&&o<=12){if(o===8||o===12){if(ta.localStorage&&(ta.localStorage.getSessionKey("SeenMetaFocusHotels")||ta.localStorage.getSessionKey("SeenMetaFocusExclTracking"))){return}var t=new Date();o=(t.getTime()%2===0)?o:o-2}a=(o===5||o===6||o===9||o===10)?null:"Hotels";j=ta.id("STATIC_DATE_PICKER_BAR");if(!s.metaFocus.utils.beenSeen(a)&&j){m.getElements(".single_col_hotels .metaFocusMessaging").addClass("metaFocus_dp");d="HotelsMetaFocusPreDates";c=true;if(o===6||o===10){a="ExclTracking"}if(s.metaFocus.utils.firstPageView()){if(o>=5&&o<=8){h.addEvent("scroll",b);ta.on("onHACUpdateComplete",n)}else{if(o>=9&&o<=12){k="timer";h.setTimeout(r,2000)}}}else{k="second_pv";r()}}}}}function l(){if(s.metaFocus.utils.beenSeen(a)||!s.metaFocus.utils.hasDates()){return}j=m.getElement("#ACCOM_OVERVIEW .listing .metaPriceInfo");var t=m.getElement(".single_col_hotels .metaFocusMessaging");if(j&&!j.hasClass("no_avail")&&!j.hasClass("vr_date_fields")&&t){if(!ta.retrieve("hotels_meta_focus_speedup")){j.appendChild(t)}r()}}function r(){if(s.metaFocus.utils.beenSeen(a)||(c&&s.metaFocus.utils.hasDates())){h.removeEvent("scroll",r);return}if(j&&s.metaFocus.utils.focusAreaVisible(j)){if(o%2===1){s.metaFocus.utils.show({focusArea:j,servlet:a})}else{s.metaFocus.utils.setSeen(true,a)}q();h.removeEvent("scroll",r)}else{if(e){e=false;h.addEvent("scroll",r)}}}function n(){if(!s.metaFocus.utils.hasDates()){k="sort_other";var t=ta.overlays?ta.overlays.getCurrent():null;if(t&&t.container.hasClass("jfy_filter_bar_top")){t.hideNow()}var v=m.getElement("#HAC_RESULTS .jfy_sort_bar .JFY_sort_type.display");if(v&&(v.hasClass("priceLow")||v.hasClass("priceHigh"))){var u=m.getElement(".metaFocusMessaging .subText.hidden");if(u){u.removeClass("hidden");k="price_sort"}}r()}}function b(){if(h.getScrollTop()>g){h.removeEvent("scroll",b);k="scroll";r()}}function q(){ta.trackEventOnPage(d,a==="Hotels"?"inclusive":"exclusive",k)}ta.queueForLoad(p,"Hotels Focus trigger");ta.on("onCalendarRangeSelect",function(){s.metaFocus.utils.hide()});ta.on("hotels_top_hotel_fixed",l);ta.on("preMetaFocusShow",function(){if(ta.retrieve("keep_users_on_hotels_v2.id")&&ta.retrieve("hotels_meta_focus_speedup")){ta.id(m.body).addClass("hotelsMetaFocusSpeedup");m.getElement(".metaFocusMessaging").addClass("hideFocusArrow");setTimeout(function(){m.getElement(".metaFocusMessaging").removeClass("hideFocusArrow")},s.metaFocus.utils.fadeTime)}});ta.on("metaFocusHide",function(){if(ta.retrieve("keep_users_on_hotels_v2.id")&&ta.retrieve("hotels_meta_focus_speedup")){ta.id(m.body).removeClass("hotelsMetaFocusSpeedup")}})})(document,window,ta);