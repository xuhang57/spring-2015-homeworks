ta.overlays.BACKDROP_NEVER=0;ta.overlays.BACKDROP_ALWAYS=1;ta.overlays.Overlay=new Class({Implements:[Options,Events],Binds:["_hide","show","hide","destroy","hideByClickOnDocument"],options:{requestData:null,showCloseButton:false,noPadding:false,noCpu:false,closeButtonClass:"close",closeLink:"",showArrow:false,arrowClassLeft:null,arrowClassRight:null,arrowClass:"ttarrow",style:"typeO",innerDivClass:"inner",backdrop:ta.overlays.BACKDROP_NEVER,backdropZIndex:"default",permanent:false,permanent_except_same:false,type:"",isChild:false,remoteContent:null,maintainCrPageServlet:false,keepElementInDocument:false,requestMethod:"get",zIndex:1001,positionType:"absolute",draggable:false,draggingClass:"dragging",title:null,onscroll:null,noScroll:false,noScrollY:false,backdropClickClose:false,backdropColor:"#000",backdropOpacity:0.6,offsetRight:0,offsetLeft:0,offsetTop:0,offsetBottom:0,closeOnDocumentClick:false,track:false,positionByOffsets:false,useTransparentOverlayPadding:false,transparentOverlayPaddingValue:0},initialize:function(a,b){this.noScroll=a.noScroll||a.noScrollY;if(a.noScroll){this.overflowToHide="overflow"}else{if(a.noScrollY){this.overflowToHide="overflow-Y"}}if(this.noScroll){var g=a.onShow;a.onShow=function(){if(g){g()}ta.find("body").setStyle(this.overflowToHide,"hidden")};var c=a.onClose;a.onClose=function(){if(c){c()}ta.find("body").setStyle(this.overflowToHide,"")}}this.setOptions(a);this.source=ta.id(b);this.visible=false;this.backdropOn=false;this.closedByDocClick=false;this.container=new Element("div",{styles:{position:this.options.positionType,left:"-999em",top:"-999em",fontSize:this.options.fontSize||".75em",zIndex:this.options.zIndex},"class":this.options.style+" overlay"});this.container.store("overlay",this);this.container.overlay=this;ta.store("overlays.current",this);this._useIframeShim=Browser.ie6;if(this.options.title){this.header=new Element("h1",{"class":"title",html:this.options.title}).inject(this.container);if(this.options.draggable){var h=this.options.draggingClass;var f=function(){};if(this._useIframeShim){f=this.positionShim.bind(this)}if(this.options.useTransparentOverlayPadding){f=this.transparentOverlayPadding.bind(this)}this.drag=new Drag(this.container,{handle:this.header,preventDefault:true,stopPropagation:true,onSnap:function(i){i.addClass(h)},onDrag:f,onComplete:function(i){i.removeClass(h)}})}}this.inner=new Element("div",{"class":this.options.innerDivClass}).inject(this.container);this.inner.id="overlayInnerDiv";var e=this;if(e.options.onscroll){e.inner.addEvent("scroll",function(){e.options.onscroll(e.inner)})}if(this._useIframeShim){this.shim=new IframeShim(this.container,{browsers:true})}if(this.options.useTransparentOverlayPadding){this.transparentOverlayPadding=new Element("div",{"class":"overlayPadding",styles:{position:"absolute","z-index":this.options.zIndex-1}});this.transparentOverlayPaddingValue=this.options.transparentOverlayPaddingValue}var d;if(this.options.content){this.inner.setContent(this.options.content)}else{if(this.options.remoteContent){this.loadRemoteContent(this.options.remoteContent)}else{if(this.source&&(d=this.source.getElement(".overlayContents"))){if(d){this.inner.set("html",d.innerHTML);d.dispose();this.runBehaviorOnFirstShow=true}}}}if(this.options.showCloseButton){this.addCloseButton()}else{if(this.options.setCloseButton){this.setCloseButton()}}if(this.options.showArrow){this.arrow=new Element("div",{styles:{position:"absolute"},"class":this.options.arrowClass}).inject(this.container);if(this.header){this.container.addClass("withClose")}else{this.inner.addClass("withClose")}}if(this.options.noPadding){if(this.header){this.container.addClass("noPad")}else{this.inner.addClass("noPad")}}if(this.options.noCpu){if(this.header){this.container.addClass("no_cpu")}else{this.inner.addClass("no_cpu")}}this.container.addEvent("trash",this.destroy)},addCloseButton:function(){var a=this.options.closeButtonClass;if(ta.has("checkrates.add_holding_windows")){a+=" no_cpu"}this.closeBtn=new Element("div",{styles:{position:"absolute",fontSize:"92.5%",cursor:"pointer"},html:this.options.closeLink,"class":a,events:{click:(function(){this.fireEvent("onClose",this)}).bind(this)}}).inject(this.container);if(this.header){this.container.addClass("withClose")}else{this.inner.addClass("withClose")}},setCloseButton:function(){if(this.options.closeButtonClass){this.closeBtn=this.container.getElement("."+this.options.closeButtonClass);if(this.closeBtn){this.closeBtn.addEvents({click:(function(){this.fireEvent("onClose",this);this.hide()}).bind(this)})}}},destroy:function(){this.container.overlay=null;if(this.shim){this.shim.destroy();this.shim=null}if(this.transparentOverlayPadding){this.transparentOverlayPadding.destroy();this.transparentOverlayPadding=null}},position:function(){if(this.shim){(function(){this.positionShim()}).delay(10,this)}if(this.transparentOverlayPadding){(function(){this.positionTransparentOverlayPadding()}).delay(10,this)}},positionTransparentOverlayPadding:function(){var b=this.container.getCoordinates();if(!b||!b.left){return}var a=this.transparentOverlayPaddingValue;this.transparentOverlayPadding.setStyles({left:b.left-a,top:b.top-a})},positionShim:function(){var a=this.container.getCoordinates();if(!a||!a.left){return}this.shim.shim.setStyles({left:a.left,top:a.top})},show:function(a){if(typeof(overlayCss)!="undefined"&&!ta.retrieve("ta.overlayCssAsset")){if(this.options.waitForCss){ta.store("ta.overlayCssAsset",ta.css(overlayCss,{onLoad:function(){this._show(a)}.bind(this)}))}else{ta.store("ta.overlayCssAsset",ta.css(overlayCss));this._show(a)}}else{this._show(a)}},_show:function(f){if(this.visible){return}if(f){new Event(f).preventDefault()}this.closedByDocClick=false;var a=ta.util.URL.parse(this.options.remoteContent);if(!this.options.maintainCrPageServlet&&typeof crPageServlet!=="undefined"&&a&&a.test(/\/{1}(\w*)$/)){ta.store("crPageServlet_orig",crPageServlet);crPageServlet=RegExp.$1}$$(".overlay").each(function(c){if(c.overlay){if(c.overlay==this){return}if(this.parentOverlay&&c.overlay==this.parentOverlay){return}if(c.overlay.options.permanent){return}if(c.overlay.options.permanent_except_same&&c.overlay.options.type!=this.options.type){return}c.overlay.hide(f)}},this);var d=ta.id(this.options.parentContainer||document.body);d.adopt(this.container);if(this.shim&&this.shim.shim){d.adopt(this.shim.shim);var e=this.container.getCoordinates();if(e){this.shim.shim.setStyles({display:"block",width:e.width,height:e.height})}}if(this.transparentOverlayPadding){d.adopt(this.transparentOverlayPadding);var e=this.container.getCoordinates();if(e){var b=this.transparentOverlayPaddingValue*2;this.transparentOverlayPadding.setStyles({display:"block",width:e.width+b,height:e.height+b})}}if(this.options.backdrop==ta.overlays.BACKDROP_ALWAYS){this.enableBackdrop()}this.position();if(this.options.closeOnDocumentClick){document.addEvent("click",this._hide)}this.visible=true;this.fireEvent("onShow",this);window.fireEvent("onOverlayShow",this);if(ta.has("overlay.onShow")){ta.remove("overlay.onShow").each(function(c){c.call(this)},this)}return this},_setPosition:function(a){if(this.options.parentContainer){var c=Math.abs(this.container.getPosition().x-this.container.offsetLeft);var d=Math.abs(this.container.getPosition().y-this.container.offsetTop);var b={};if(a.left!==undefined){b.left=Math.abs(a.left-c)}if(a.top!==undefined){b.top=Math.abs(a.top-d)}if(a.bottom!==undefined){b.right=Math.abs(a.right-c)}if(a.right!==undefined){b.bottom=Math.abs(a.bottom-d)}this.container.setStyles(Object.merge(a,b))}else{this.container.setStyles(a)}},_hide:function(b){if(this.noScroll){ta.find("body").setStyle(this.overflowToHide,"")}if(!b||this.container.containsEvent(b)){return}if(this.options.pinnable==ta.overlays.PINNABLE_HOVER||this.options.pinnable==ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE){var a=b.target;while(a){if(a==this.source){return}else{a=a.parentElement}}}document.removeEvent("click",this._hide);this.hide(b)},hideByClickOnDocument:function(a){if(ta.retrieve("overlay.dontCloseOnClick")||this.options.dontCloseOnClick){return}this.closedByDocClick=true;this.hide(a)},hide:function(a){if(window.flyout){window.flyout.hide()}if(this.backdropOn){this.disableBackdrop()}if((this.options.keepElementInDocument&&this.container.style.left=="-999em")||(!this.options.keepElementInDocument&&!this.container.inDocument())){return this}if(this.shim){this.shim.hide().dispose()}if(this.transparentOverlayPadding){this.transparentOverlayPadding.hide().dispose()}this.container.setStyles({left:"-999em",top:"-999em"});if(!this.options.keepElementInDocument){this.container.dispose()}this.visible=false;this.fireEvent("onHide",!a);window.fireEvent("onOverlayClose",this);if(!this.options.maintainCrPageServlet&&ta.has("crPageServlet_orig")){ta.run("ta.meta.linkTracking.restoreCRPageServlet")}if(this.noScroll){ta.find("body").setStyle(this.overflowToHide,"")}return this},calculateBackdropHeight:function(){return Math.max(window.innerHeight?window.innerHeight:(document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.offsetHeight),document.body.scrollHeight)},configureBackdrop:function(){var b={"class":"overlayBG"};var a;if(this.options.backdropZIndex==="behindOverlay"){a=this.options.zIndex-1}else{if(ta.retrieve("tablet_calendar_update.enabled")){b.events={click:function(d){this.fireEvent("backdropClick",d)}.bind(this)};if(document.getElement(".overlayBG")){this.options.backdropOpacity=0.01}var c=document.getElements(".overlay").length;a+=c*2}else{a=this.options.isChild?10000:9997}}this.backdrop=new Element("div",b);this.backdrop.setStyles({position:"fixed",left:0,top:0,width:"100%",height:this.calculateBackdropHeight(),backgroundColor:this.options.backdropColor,zIndex:a,opacity:this.options.backdropOpacity,filter:"alpha(opacity="+Math.floor(this.options.backdropOpacity*100)+")"});if(this.options.backdropClickClose){this.backdrop.addEvent("click",function(){this.fireEvent("onClose",this);this.hide()}.bind(this))}},updateBackdrop:function(){this.backdrop.setStyles({width:"100%",height:this.calculateBackdropHeight()})},enableBackdrop:function(){try{if(this.backdropOn){return}if(!this.backdrop){this.configureBackdrop()}if(Browser.ie6){var a=this.container;$$("select").each(function(d){if(!a.contains(d)){d.setStyle("visibility","hidden")}else{d.setStyle("visibility","visible")}})}ta.store("overlays.current",this);this.updateBackdrop();if(this.container.inDocument()){this.backdrop.inject(this.container,"before")}else{this.backdrop.inject(document.body)}this.backdropOn=true;if(this.options.backdropZIndex==="behindOverlay"){}else{if(ta.retrieve("tablet_calendar_update.enabled")){var b=document.getElements(".overlay").length;this.container.setStyle("z-index",parseInt(this.backdrop.getStyle("z-index"))+1)}else{this.container.setStyle("z-index",this.options.isChild?"10002":"9998")}}if(ta.isDHTMLCRRedesign2012()&&this.container.getElement(".check_availability")){if(Browser.ie7||Browser.ie8){this.container.setStyle("border","5px solid #424242")}else{this.container.setStyle("border","5px solid rgba(64,64,64,0.8)")}}}catch(c){ta.util.error.record(c,"Error setting the border property - enableBackdrop")}},disableBackdrop:function(){try{if(!this.backdropOn){return}this.backdrop.dispose();if(ta.retrieve("overlays.current")==this){ta.remove("overlays.current");if(Browser.ie6){$$("select").setStyle("visibility","visible")}}else{if(Browser.ie6&&ta.retrieve("overlays.current")&&!ta.retrieve("overlays.current").backdropOn){$$("select").setStyle("visibility","visible")}}this.backdropOn=false;this.container.setStyle("z-index","1001");if(ta.isDHTMLCRRedesign2012()&&this.container.getElement(".check_availability")){if(Browser.ie7||Browser.ie8){this.container.setStyle("border","5px solid #b2b2b2")}else{this.container.setStyle("border","5px solid rgba(128,128,128,0.6)")}}}catch(a){ta.util.error.record(a,"Error unsetting the border property - disableBackdrop")}},loadRemoteContent:function(c,a){var b={url:ta.util.URL.parse(c),method:this.options.requestMethod,data:this.options.requestData,onSuccess:this.loadRemoteSuccess.bind(this),onFailure:this.loadRemoteFailure.bind(this),evalScripts:true};this.options.track&&(b.trackEvent=this.options.track);if(!a&&!this.options.hideSpinner){new Asset.image(CDNHOST+"/img2/generic/site/loop.gif",{onload:this.position.bind(this),"class":"anim_loop"}).inject(this.inner)}new Request(b).send();return this},loadRemoteSuccess:function(a){this.cachedWidth=null;this.inner.setContent(a);this.position();if(typeof behavior!="undefined"&&behavior&&behavior.apply){behavior.apply(this.inner)}this.fireEvent("onLoad",this);this.cachedWidth=this.container.getSize().x;if(this.backdropOn){this.updateBackdrop()}return this},loadRemoteFailure:function(a){this.inner.addClass("ajax_failed");this.inner.setStyle("width","383px");this.inner.setStyle("padding","14px 24px 14px 14px");this.inner.set("text",JS_Ajax_failed);this.fireEvent("onLoadRemoteFailure",a)}});ta.overlays.getCurrent=function(){var a=$$(".overlay").shift();return a&&a.retrieve("overlay")};ta.overlays.safeCloseCurrent=function(){var a=ta.overlays.getCurrent();return a&&a.hide()};ta.overlays.safeCloseFromDom=function(c){c=ta.id(c);var a=c&&c.getParent(".overlay");var b=a&&a.retrieve("overlay");return b&&b.hide()};ta.overlays.AbsoluteOverlay=new Class({Extends:ta.overlays.Overlay,options:{xOffset:0,yOffset:0,toWindow:true,repositionOnScroll:false,autoShow:true,stayOpen:false,hideOnDocumentClick:false},initialize:function(a,b){a=a||{};a.showCloseButton=[a.showCloseButton,true].pick();this.parent(a,b);if(this.options.showCloseButton&&!this.options.stayOpen){this.closeBtn.addEvent("click",this.hide)}if(this.options.hideOnDocumentClick){document.addEvent("click",this.hideByClickOnDocument.bind(this))}if(this.options.autoShow){this.show()}},show:function(a){this.parent(a);if(this.options.repositionOnScroll){window.addEvent("scroll",this.delayedScroll.bind(this))}},hide:function(a){this.parent(a);if(this.options.repositionOnScroll){window.removeEvent("scroll",this.delayedScroll.bind(this))}if(this.options.hideOnDocumentClick){document.removeEvent("click",this.hideByClickOnDocument.bind(this))}},hideByClickOnDocument:function(d){if(!d||!d.page){return false}d=new Event(d);var c=d.page;var b=this.inner.getCoordinates();var a=c.y>=b.top&&c.y<=b.bottom&&c.x>=b.left&&c.x<=b.right;if(!a){this.parent(d)}},delayedScroll:function(){this.position.delay(500,this)},position:function(){this.container.setStyles({left:this.options.xOffset,top:this.options.yOffset+(this.options.toWindow?window.getScrollTop():0)});this.parent()}});ta.overlays.AbsoluteBottomOverlay=new Class({Extends:ta.overlays.Overlay,initialize:function(a,b){this.parent(Object.merge({positionType:"fixed"},a),b);if(this.options.showCloseButton&&!this.options.stayOpen){this.closeBtn.addEvent("click",this.hide)}thisOverlay=this;if(this.options.horizontalScroll){window.addEvent("scroll",function(){var c=window.getScroll().x*-1;thisOverlay.container.setStyle("left",(c))})}},position:function(){this.parent();this.reposition();this.flyIn()},reposition:function(){this.container.setStyles({top:null,left:null});if(!this.options.flyFromRight){if(this.options.horizontalScroll){leftValue=window.getScroll().x*-1}else{leftValue=window.getCoordinates().width/2-this.container.getWidth()/2}this.container.setStyles({bottom:0,left:leftValue})}else{this.container.setStyles({bottom:10,right:10})}},flyIn:function(){if(this.options.flyFromRight){this.container.setStyle("right",-window.getCoordinates().width)}else{this.container.setStyle("bottom",-this.container.getHeight())}var a=new Fx.Tween(this.container,{duration:"1000",transition:"quad:out"});if(this.options.flyFromRight){a.start("right",10)}else{a.start("bottom",0)}},show:function(a){this.parent(a);if(!this.options.flyFromRight){window.addEvent("resize",this.reposition.bind(this))}this.container.removeClass("overlay");this.reposition()}});ta.overlays.CenteredOverlay=new Class({Extends:ta.overlays.Overlay,Binds:["hideByClickOnDocument","position","hide","show"],options:{delayedPosition:false,autoShow:true,attachCloseEvent:true,xOffset:-1,yOffset:-1,absoluteOffset:false,fixed:false},initialize:function(b,c){b=b||{};b.showCloseButton=[b.showCloseButton,true].pick();b.fixed&&(this.options.positionType="fixed");this.parent(b,c);if(this.source){var a=this.source.getParentBySelector(".overlay");if(a){this.container.setStyle("z-index",a.getStyle("z-index")+1);this.parentOverlay=a.overlay}}if(this.options.showCloseButton&&this.options.attachCloseEvent){this.closeBtn.addEvent("click",this.hide)}this.options.autoShow&&this.show()},position:function(d){var b=ta.retrieve("ta.overlays.CenteredOverlay.position.iters");if(!b){b=0}var f=this.container.getCoordinates();if(f.height<=14&&b<10){ta.store("ta.overlays.CenteredOverlay.position.iters",b+1);this.position.delay(100,this,true);return}var a=this.options.xOffset;var e=this.options.yOffset;if(a===-1){a=Math.max(5,(window.tabletOnFullSite?window.innerWidth:window.getWidth())-f.width)/2;!this.options.fixed&&(a+=window.getScrollLeft())}else{!this.options.absoluteOffset&&(a-=f.width/2)}if(e===-1){e=Math.max(20,(window.tabletOnFullSite?window.innerHeight:window.getHeight())-f.height)/2;!this.options.fixed&&(e+=window.getScrollTop())}else{!this.options.absoluteOffset&&(e-=f.height/2)}this.container.setStyles({left:a,top:e});this.parent()},positionShim:function(){var a=this.container.getCoordinates();if(!a||!a.left){return}this.shim.shim.setStyles({left:a.left,top:a.top,width:a.width,height:a.height})},positionTransparentOverlayPadding:function(){var d=this.container.getCoordinates();if(!d||!d.left){return}var b=this.transparentOverlayPaddingValue;var a=this.transparentOverlayPaddingValue*2;this.transparentOverlayPadding.setStyles({left:d.left-b,top:d.top-b,width:d.width+a,height:d.height+a})}});ta.overlays.showInLightbox=function(a,b){return new ta.overlays.CenteredOverlay(Object.merge({backdrop:ta.overlays.BACKDROP_ALWAYS},b)).loadRemoteSuccess(a)};ta.overlays.loadInLightbox=function(b,a){return new ta.overlays.CenteredOverlay(Object.merge({backdrop:ta.overlays.BACKDROP_ALWAYS},a)).loadRemoteContent(b)};var lightbox={deactivate:function(){var a=ta.retrieve("overlays.current");a&&a.hide()}};ta.overlays.CouponOverlay=new Class({Extends:ta.overlays.CenteredOverlay,initialize:function(a,b){this.parent(Object.merge({backdrop:ta.overlays.BACKDROP_ALWAYS,fixed:true,waitForCss:true},a),b);this._opaqueBG=null;this._opaqueImg=null;if(Browser.name==="ie"){this._enableOpaqueBG()}window.addEvent("resize",this.position.bind(this))},hide:function(a){if(this._opaqueBG){this._opaqueBG.dispose();this._opaqueBG=null;this._opaqueImg=null}this.parent(a);return this},position:function(){this.parent();if(this._opaqueBG){var a=this.container.getCoordinates();this._opaqueBG.setStyles({top:Math.max(20,window.getHeight()-a.height)/2+window.getScrollTop(),left:Math.max(5,window.getWidth()-a.width)/2,width:a.width,height:a.height});this._opaqueImg.setStyles({width:a.width,height:a.height})}},_enableOpaqueBG:function(){if(this._opaqueBG){return}var a=this.options.isChild?9999:9996;this._opaqueBG=new Element("div",{"class":"printCouponBackground"});this._opaqueImg=new Element("img",{src:"/img2/generic/site/white_1x1.png"});var b=this.container.getCoordinates();this._opaqueBG.setStyles({top:Math.max(20,window.getHeight()-b.height)/2+window.getScrollTop(),left:Math.max(5,window.getWidth()-b.width)/2,width:b.width,height:b.height,zIndex:a,position:"fixed"});this._opaqueImg.setStyles({width:b.width,height:b.height});this._opaqueImg.inject(this._opaqueBG);if(this.container.inDocument()){this._opaqueBG.inject(this.container,"before")}else{this._opaqueBG.inject(document.body)}}});ta.overlays.showCouponInLightbox=function(b,d){var c=new ta.overlays.CouponOverlay(d);var a=c.loadRemoteSuccess(b);c.show();return a};ta.overlays.ACTIVATE_NEVER=0;ta.overlays.ACTIVATE_CLICK=1;ta.overlays.ACTIVATE_HOVER=2;ta.overlays.ACTIVATE_FOCUS=3;ta.overlays.ACTIVATE_HOVER_DELAY=4;ta.overlays.ACTIVATE_BOTH=5;ta.overlays.ACTIVATE_CLICK_ALTERNATE=6;ta.overlays.ACTIVATE_BOTH_DELAY=7;ta.overlays.ACTIVATE_CLICK_TOGGLE=8;ta.overlays.PINNABLE_NEVER=0;ta.overlays.PINNABLE_ALWAYS=1;ta.overlays.PINNABLE_CLICK=2;ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE=3;ta.overlays.PINNABLE_HOVER=4;ta.overlays.BACKDROP_PINNED=2;ta.overlays.RelativeOverlay=new Class({Extends:ta.overlays.Overlay,Binds:["overrideHoverDelayOnce","overridePinnableOption","_hide","show","hide","disable","destroy","hideNow","showWithDelay","hideWithDelay","_pin","prolongVisibility","showOrHide","_bothEnter","_bothEnterWithDelay","_bothClick"],options:{activate:ta.overlays.ACTIVATE_NEVER,pinnable:ta.overlays.PINNABLE_NEVER,activateHoverDelayTime:300,hoverDelayTime:250,pointArrowToSource:false,autoShow:true,ignoreFirstClickAfterHover:false,ignoreFirstClick:false,closeFunction:false,closeButtonFunction:false},initialize:function(b,c){this.parent(b,c);this.debug_sticky=ta.retrieve("debug.stickyOverlays");this.container.addClass("relative");var a=this.source.getParentBySelector(".overlay");if(a){this.container.setStyle("z-index",a.getStyle("z-index")+1);this.parentOverlay=a.overlay}this.enabled=true;if(this.options.showCloseButton&&this.closeBtn){this.closeBtn.addEvent("click",(function(){try{if(this.options.closeButtonFunction&&typeof this.options.closeButtonFunction==="function"){this.options.closeButtonFunction()}}catch(f){}this.hideNow()}).bind(this));if(this.options.smartCloseButton){this.closeBtn.hide()}}switch(this.options.activate){case ta.overlays.ACTIVATE_CLICK:this.source.addEvent("click",this.show);break;case ta.overlays.ACTIVATE_CLICK_TOGGLE:this.source.addEvent("click",this.showOrHide);break;case ta.overlays.ACTIVATE_HOVER:this.source.addEvent("mouseenter",this.show);this.container.addEvent("mouseenter",this.show);this.source.addEvent("mouseleave",this.hide);this.container.addEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_HOVER_DELAY:this.source.addEvent("mouseenter",this.showWithDelay);this.source.addEvent("mouseleave",this.hideWithDelay);this.container.addEvent("mouseenter",this.show);this.container.addEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_FOCUS:this.source.addEvent("focus",this.show);break;case ta.overlays.ACTIVATE_CLICK_ALTERNATE:this.source.addEvent("mouseenter",this.prolongVisibility);this.container.addEvent("mouseenter",this.prolongVisibility);this.source.addEvent("mouseleave",this.hide);this.container.addEvent("mouseleave",this.hide);this.source.addEvent("click",this.showOrHide);break;case ta.overlays.ACTIVATE_BOTH:this.source.addEvent("mouseenter",this._bothEnter);this.container.addEvent("mouseenter",this._bothEnter);this.source.addEvent("mouseleave",this.hide);this.container.addEvent("mouseleave",this.hide);this.source.addEvent("click",this._bothClick);this.ignoreNextClick=b.ignoreFirstClickAfterHover&&b.ignoreFirstClick;break;case ta.overlays.ACTIVATE_BOTH_DELAY:this.source.addEvent("mouseenter",this._bothEnterWithDelay);this.container.addEvent("mouseenter",this._bothEnter);this.source.addEvent("mouseleave",this.hideWithDelay);this.container.addEvent("mouseleave",this.hide);this.source.addEvent("click",this._bothClick);this.ignoreNextClick=b.ignoreFirstClickAfterHover&&b.ignoreFirstClick;break}switch(this.options.pinnable){case ta.overlays.PINNABLE_CLICK:case ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE:this.source.addEvent("click",this._pin);break}if(typeof this.options.remoteLink!="undefined"&&this.options.remoteLink!=null){this.loadRemoteContent(this.options.remoteLink)}else{var e=this.source.getElement(".overlaySrc");if(e){if(e.get("tag")=="a"){this.loadRemoteContent(e.href)}else{this.loadRemoteContent(e.get("text"));e.dispose()}}else{if(!this.options.content&&this.source.get("tag")=="a"){this.loadRemoteContent(this.source.href)}}}var d=ta.id(this.source.id+"_CONTENTS");if(d){this.inner.set("html",d.innerHTML);d.dispose();this.runBehaviorOnFirstShow=true}if(this.options.autoShow){this.show()}else{if(this.options.delayShow){this.showWithDelay()}}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},overrideHoverDelayOnce:function(a){this.overriddenHoverDelayTime=a},overridePinnableOption:function(a){if(a===true){this.source.addEvent("click",this._pin);this.container.addEvent("click",this._pin)}else{if(a===false){this.source.removeEvent("click",this._pin);this.container.removeEvent("click",this._pin);this.unpin()}}},show:function(b){b=b||window.event;if(b){new Event(b).stop()}if(!this.enabled){return}var a=this.visible;this.parent(b);clearTimeout(this.showTimeout);if((this.options.activate==ta.overlays.ACTIVATE_HOVER||this.options.activate==ta.overlays.ACTIVATE_HOVER_DELAY||this.options.activate==ta.overlays.ACTIVATE_BOTH||this.options.activate==ta.overlays.ACTIVATE_BOTH_DELAY)&&this.hideTimer){clearTimeout(this.hideTimer);this.hideTimer=null}if(a){return}if(this.runBehaviorOnFirstShow){this.runBehaviorOnFirstShow=false;if(typeof behavior!="undefined"&&behavior&&behavior.apply){behavior.apply(this.inner)}}this.cachedWidth=this.container.getSize().x;switch(this.options.pinnable){case ta.overlays.PINNABLE_HOVER:this._pin();break}switch(this.options.activate){case ta.overlays.ACTIVATE_HOVER:case ta.overlays.ACTIVATE_HOVER_DELAY:break;case ta.overlays.ACTIVATE_CLICK:case ta.overlays.ACTIVATE_CLICK_TOGGLE:case ta.overlays.ACTIVATE_FOCUS:if(this.options.pinnable==ta.overlays.PINNABLE_NEVER){document.addEvent("click",this.hideByClickOnDocument.bind(this))}break}return this},hide:function(c){if(this.debug_sticky){return this}c=c||window.event;if(!this.visible){return}if(window.flyout){window.flyout.hide()}if(c){var b=new Event(c);if(b.target&&b.target.tagName=="option"){return}if(Browser.ie&&b.target&&b.target.tagName=="select"&&this.container.getElements("select").contains(b.target)){return}}switch(this.options.activate){case ta.overlays.ACTIVATE_HOVER:case ta.overlays.ACTIVATE_HOVER_DELAY:case ta.overlays.ACTIVATE_CLICK_ALTERNATE:case ta.overlays.ACTIVATE_BOTH:case ta.overlays.ACTIVATE_BOTH_DELAY:if(!this.hideTimer){var a=this.options.hoverDelayTime;if(this.overriddenHoverDelayTime!==undefined){a=this.overriddenHoverDelayTime;delete this.overriddenHoverDelayTime}this.hideTimer=this.hide.delay(a,this);return}else{clearTimeout(this.hideTimer);this.hideTimer=null}break;case ta.overlays.ACTIVATE_CLICK:case ta.overlays.ACTIVATE_CLICK_TOGGLE:case ta.overlays.ACTIVATE_FOCUS:if(c&&this.container.containsEvent(c)){return}if(this.options.pinnable==ta.overlays.PINNABLE_NEVER){document.removeEvent("click",this.hide)}break}return this.hideNow()},hideNow:function(a){if(!this.visible){return this}if(this.backdropOn){this.disableBackdrop()}if(this.shim){this.shim.hide().dispose()}if(this.transparentOverlayPadding){this.transparentOverlayPadding.hide().dispose()}if(!this.options.positionByOffsets){this.container.setStyles({left:"-999em",top:"-999em"}).dispose()}else{this.container.dispose()}this.visible=false;if(this.options.pinnable==ta.overlays.PINNABLE_CLICK||this.options.pinnable==ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE||this.options.pinnable==ta.overlays.PINNABLE_HOVER){this.unpin()}this.fireEvent("onHide",!a);if(this.options.closeFunction){this.options.closeFunction()}return this},_pin:function(a){this.pin();this.toggleBackdrop(true)},pin:function(){this.source=ta.id(this.source);switch(this.options.activate){case ta.overlays.ACTIVATE_HOVER:this.source.removeEvent("mouseenter",this.show);this.source.removeEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_BOTH:this.source.removeEvent("mouseenter",this._bothEnter);this.source.removeEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_HOVER_DELAY:this.source.removeEvent("mouseenter",this.showWithDelay);this.source.removeEvent("mouseleave",this.hideWithDelay);break;case ta.overlays.ACTIVATE_BOTH_DELAY:this.source.removeEvent("mouseenter",this._bothEnterWithDelay);this.source.removeEvent("mouseleave",this.hideWithDelay);break}this.container.removeEvent("mouseenter",this.show);this.container.removeEvent("mouseleave",this.hide);this.pinned=true;if(this.options.smartCloseButton&&this.closeBtn){this.closeBtn.show()}return this},toggleBackdrop:function(a){if(this.options.backdrop==ta.overlays.BACKDROP_PINNED){this.enableBackdrop()}},unpin:function(){this.source=ta.id(this.source);switch(this.options.activate){case ta.overlays.ACTIVATE_HOVER:this.source.addEvent("mouseenter",this.show);this.source.addEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_BOTH:this.source.addEvent("mouseenter",this._bothEnter);this.source.addEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_HOVER_DELAY:this.source.addEvent("mouseenter",this.showWithDelay);this.source.addEvent("mouseleave",this.hideWithDelay);break;case ta.overlays.ACTIVATE_BOTH_DELAY:this.source.addEvent("mouseenter",this._bothEnterWithDelay);this.source.addEvent("mouseleave",this.hideWithDelay);break}this.container.addEvent("mouseenter",this.show);this.container.addEvent("mouseleave",this.hide);if(this.options.backdrop==ta.overlays.BACKDROP_PINNED){this.disableBackdrop()}this.pinned=false;if(this.options.smartCloseButton&&this.closeBtn){this.closeBtn.hide()}return this},showWithDelay:function(a){a=a||window.event;clearTimeout(this.showTimeout);if(this.visible){return this.show(a)}else{this.showTimeout=this.show.delay(this.options.activateHoverDelayTime,this)}},hideWithDelay:function(a){a=a||window.event;if(!this.visible){clearTimeout(this.showTimeout)}else{return this.hide(a)}},prolongVisibility:function(){if(this.visible&&this.hideTimer){clearTimeout(this.hideTimer);this.hideTimer=null}},showOrHide:function(a){if(this.blockShowOrHide){return}if(this.visible){return this.hideNow(a)}else{return this.show(a)}},_bothEnter:function(a){this.ignoreNextClick=this.options.ignoreFirstClickAfterHover;return this.show(a)},_bothEnterWithDelay:function(a){this.ignoreNextClick=this.options.ignoreFirstClickAfterHover;return this.showWithDelay(a)},_bothClick:function(a){if(this.ignoreNextClick){a=a||window.event;if(a){new Event(a).stop()}this.ignoreNextClick=false;return this}else{return this.showOrHide(a)}}});ta.overlays.RelativeOverlayHorizontal=new Class({Extends:ta.overlays.RelativeOverlay,options:{arrowHeight:0,arrowLeftForce:0,arrowTopForce:0,allowRightArrowPos:false,allowBelowBottomEdge:false},initialize:function(a,b){if(a.onRight==null){if(IS_DEBUG){alert("ERROR: Attempting to create Horizontal Overlay without specifying direction.")}return}this.parent(a,b)},position:function(){if(this.options.onRight){this.positionRight()}else{this.positionLeft()}this.parent()},adjustTop:function(f,i){try{this.source=ta.id(this.source);var k=f+this.options.offsetTop;if(!this.options.allowBelowBottomEdge){var g=window.getScrollTop()+window.getHeight();var j=document.getElementById("tamgFooter");if(j){if(j.offsetHeight){g=g-j.offsetHeight}else{if(j.clientHeight){g=g-j.clientHeight}}}if(k+i.height>=g){k=g-i.height-1;if((this.crDHTML_BASIC||this.crDHTML_PNG24)&&this.options.showArrow){var b=this.container.getElement(".check_availability");var d=this.container.getElement(".username");if(b||d){var a=b?b:d;var c=a.getCoordinates().height}k=g-i.height+c-9}}}return k}catch(h){ta.util.error.record(h,"adjustTop: RelativeOverlayHorizontal")}},positionLeft:function(){try{this.source=ta.id(this.source);var d=this.source.getCoordinates();var b=this.container.getStyle("margin-top").toInt();var a=ta.id("PAGE").getCoordinates();var h=this.container.getCoordinates();if(!this.flipped&&d.left-a.left-(this.cachedWidth||h.width)<0){this.flipped=true;this.options.onRight=true;if(this.arrow){this.arrow.className=this.options.arrowClassLeft}this.positionRight();return}if(ta.isDHTMLCRRedesign2012()&&this.container.getElement(".check_availability")){this.positionLeftOrRight(d,b,a,h,"left")}else{var f=this.adjustTop(d.top,h)-b;d.left=d.left-this.options.offsetLeft;this._setPosition({left:null,right:window.getWidth()-d.left+(this.options.xoffset||0),top:f});if(this.options.pointArrowToSource&&this.options.arrowHeight){this.setArrowPosition(d,b,a,h,"left",f)}}}catch(g){ta.util.error.record(g,"positionRight: RelativeOverlayHorizontal")}},positionRight:function(){try{this.source=ta.id(this.source);var d=this.source.getCoordinates();var b=this.container.getStyle("margin-top").toInt();var h=this.container.getStyle("margin-bottom").toInt();var a=ta.id("PAGE").getCoordinates();var i=this.container.getCoordinates();if(!this.flipped&&a.right-d.right-(this.cachedWidth||i.width)<0){this.flipped=true;this.options.onRight=false;if(this.arrow){this.arrow.className=this.options.arrowClassRight}this.positionLeft();return}d.right=d.right-this.options.offsetRight;if(ta.isDHTMLCRRedesign2012()&&(this.container.getElement(".check_availability")||this.container.getElement(".username"))){this.positionLeftOrRight(d,b,a,i,"right")}else{var f=this.adjustTop(d.top,i)-b;this.container.setStyles({right:null,left:d.right+(this.options.xoffset||0),top:f});if(this.options.pointArrowToSource&&this.options.arrowHeight){this.setArrowPosition(d,b+h,a,i,"right",f)}}}catch(g){ta.util.error.record(g,"positionRight: RelativeOverlayHorizontal")}},setArrowPosition:function(j,e,h,g,a,d){if(a==="left"){this.arrow.setStyle("left",this.options.arrowLeftForce);var i=(d<j.top?j.top-d:0);var b=Math.max(-1,i+(j.height/2).toInt()-(this.options.arrowHeight/2));var f=g.height-this.options.arrowHeight-e-3;this.arrow.setStyle("top",Math.min(b,f))}else{if((a==="right")&&(this.options.allowRightArrowPos)){if(this.options.arrowTopForce){this.arrow.setStyle("top",this.options.arrowTopForce)}else{if(this.options.arrowRightForce){this.arrow.setStyle("right",this.options.arrowRightForce)}var i=(d<j.top?j.top-d:0);var b=Math.max(-1,i+(j.height/2).toInt()-(this.options.arrowHeight/2));var f=g.height-this.options.arrowHeight-e-3;this.arrow.setStyle("top",Math.min(b,f))}}else{if(a==="right"){ta.util.error.record("setArrowPosition with dir === right is only supported with options.allowRightArrowPos set")}}}},positionLeftOrRight:function(q,l,y,x,r){try{var d=this.container.getElement(".check_availability");var g=this.container.getElement(".username");if(!ta.retrieve("isDaoDao")){var i=this.adjustTop(q.top,x)}else{var i=q.top}var v=d?d:g;var t=v.getCoordinates().height;var m=16;var k=i-t+m/2;var n=false;if(d){var f=window.getScrollTop();var h=ta.id("PERSISTENT_CHECK_RATES");if(h){f+=h.getCoordinates().height}if((i-0.5*x.height)<f){k=f;if((q.bottom-f)>32){k=f}else{if((q.bottom-f)<=32){k=q.bottom-32}}n=true}}var p=d?k:k+5;if(typeof(dhtml_cr_redesign_basic)!="undefined"&&!this.crDHTML_BASIC){this.crDHTML_BASIC=Asset.css(dhtml_cr_redesign_basic,{onLoad:function(){this.position()}.bind(this)})}if(typeof(dhtml_cr_redesign_png24)!="undefined"&&!this.crDHTML_PNG24){this.crDHTML_PNG24=Asset.css(dhtml_cr_redesign_png24,{onLoad:function(){this.position()}.bind(this)})}if(this.crDHTML_BASIC){var b=d?(q.right+13):(q.right-45);if(r=="left"){b=q.left+13}var a=-16}if(this.crDHTML_PNG24){var b=d?(q.right+20):(q.right-45);if(r=="left"){var b=window.getWidth()-q.left+20}var a=d?-21:-24}if(r=="left"){this._setPosition({right:b,left:null,top:p})}else{this._setPosition({right:null,left:b,top:p})}if(this.arrow){this.arrow.setStyle("display","block");var j=d?16:0;if(n){this.arrow.setStyle("top",(q.bottom-p-32))}else{this.arrow.setStyle("top",t-j)}if(r=="left"){this.arrow.setStyle("left",(x.width-13))}else{this.arrow.setStyle("left",a)}try{q=this.source.getCoordinates();x=this.container.getCoordinates();var u=window.getScrollTop()+window.getHeight();var o=q.top-x.top-m/2;var j=d?0:20;if(i+x.height>=u&&o>0){this.arrow.setStyle("top",o+j);if(q.bottom+m/2>=x.bottom){this.container.setStyle("top",p+m*2);this.arrow.setStyle("top",o-m*2+j)}}else{if(o<=0&&!n){this.container.setStyle("top",p-t+m)}}}catch(w){ta.util.error.record(w,"bottomEdge - Reposition arrow and container: RelativeOverlayHorizontal")}}}catch(w){ta.util.error.record(w,"positionLeftOrRight: RelativeOverlayHorizontal")}}});ta.overlays.RelativeOverlayRight=new Class({Extends:ta.overlays.RelativeOverlayHorizontal,initialize:function(a,b){this.parent(Object.merge({onRight:true},a),b)}});ta.overlays.RelativeOverlayLeft=new Class({Extends:ta.overlays.RelativeOverlayHorizontal,initialize:function(a,b){this.parent(Object.merge({onRight:false},a),b)}});ta.overlays.RelativeOverlayVertical=new Class({Extends:ta.overlays.RelativeOverlay,options:{flipPadding:0,allowFlip:true,arrowWidth:0},initialize:function(a,b){if(a.below==null){if(IS_DEBUG){alert("ERROR: Attempting to create Vertical Overlay without specifying direction.")}return}this.parent(a,b)},position:function(){this.options.below?this.positionBelow():this.positionAbove();this.parent()},positionBelow:function(){if(this.options.positionType=="fixed"){var p=this.source.getBoundingClientRect();var f=p.left;var q=p.bottom;if(this.options.positionAsPercent){f=(f/window.innerWidth*100)+"%";q=(q/window.innerHeight*100)+"%"}this._setPosition({left:f,top:q});return}var r=this.options.positionSource?this.options.positionSource.getCoordinates():this.source.getCoordinates();var m=this.container.getCoordinates();var n=this._styleValueToPixel(this.container.getStyle("margin-left"));var j=this._styleValueToPixel(this.container.getStyle("margin-right"));var d=this.container;var b;if(this.options.leftEdge){b=this.options.leftEdge}else{if(this.options.justify=="right"){b=r.left+r.width-m.width}else{b=this.options.centered?r.left+(r.width/2)-(m.width/2):r.left}}var k=window.getHeight()+window.getScrollTop();var i=r.bottom;if(this.options.offsetTop){i-=this.options.offsetTop}if(this.options.scrollContainer){i-=this.options.scrollContainer.scrollTop}if(this.options.allowFlip&&!this.flipped&&k-m.height-i<0&&r.top-m.height>0){this.options.below=false;this.flipped=true;d.addClass("relAbove").removeClass("relBelow");i=r.top-m.height-this.options.flipPadding;if(this.options.scrollContainer){i-=this.options.scrollContainer.scrollTop}}else{d.addClass("relBelow").removeClass("relAbove")}b-=this.options.offsetLeft;var e=this.adjustEdge(b-n,m.width);this._setPosition({left:e,top:i+(this.options.yoffset||0)});if(this.options.pointArrowToSource&&this.options.arrowWidth){var o=(e<r.left?r.left-e:0);var g=(r.width/2).toInt()-(this.options.arrowWidth/2);var h=o+g;var a=m.width-this.options.arrowWidth-n-j;this.arrow.setStyles({right:"",left:Math.min(h,a)})}},_styleValueToPixel:function(a){var b=a&&a.toInt();return !b?0:b},positionAbove:function(){var n=this.options.positionSource?this.options.positionSource.getCoordinates():this.source.getCoordinates();var j=this.container.getCoordinates();var k=this._styleValueToPixel(this.container.getStyle("margin-left"));var i=this._styleValueToPixel(this.container.getStyle("margin-right"));var d=this.container;var b;if(this.options.justify=="right"){b=n.left+n.width-j.width}else{b=this.options.centered?n.left+(n.width/2)-(j.width/2):n.left}var l=window.getScrollTop();var h=n.top-j.height-this.options.flipPadding;if(this.options.offsetTop){h-=this.options.offsetTop}if(this.options.scrollContainer){h-=this.options.scrollContainer.scrollTop}if(this.options.allowFlip&&!this.flipped&&h-l<0){this.options.below=true;this.flipped=true;d.addClass("relBelow").removeClass("relAbove");h=n.bottom;if(this.options.scrollContainer){h-=this.options.scrollContainer.scrollTop}}else{d.addClass("relAbove").removeClass("relBelow")}b-=this.options.offsetLeft;if(this.options.positionByOffsets){this._setPosition({position:this.options.positionType,top:this.options.offsetTop,right:this.options.offsetRight,bottom:this.options.offsetBottom,left:this.options.offsetLeft})}else{var e=this.adjustEdge(b-k,j.width);this._setPosition({left:e,top:h+(this.options.yoffset||0)});if(this.options.pointArrowToSource&&this.options.arrowWidth){var m=(e<n.left?n.left-e:0);var f=(n.width/2).toInt()-(this.options.arrowWidth/2);var g=m+f;var a=j.width-this.options.arrowWidth-k-i;this.arrow.setStyles({right:"",left:Math.min(g,a)})}}},adjustEdge:function(d,c){var a=ta.id("PAGE").getCoordinates();if(d+c>=a.right){var b=this._styleValueToPixel(this.container.getStyle("margin-right"));d=a.right-c-b-1}else{if(d<0){d=0}}return d},hideNow:function(a){this.parent(a);if(this.flipped){this.flipped=false;this.options.below=!this.options.below}}});ta.overlays.RelativeOverlayBelow=new Class({Extends:ta.overlays.RelativeOverlayVertical,initialize:function(a,b){this.parent(Object.merge({below:true},a),b)}});ta.overlays.RelativeOverlayAbove=new Class({Extends:ta.overlays.RelativeOverlayVertical,initialize:function(a,b){this.parent(Object.merge({below:false},a),b)}});ta.overlays.RelativeOverlayIn=(function(a){return new Class({Extends:a.overlays.RelativeOverlay,options:{xOffset:0,yOffset:0,center:false},initialize:function(b,c){this.parent(b,c)},position:function(){if(this.options.center){var d=this.source.getCoordinates();var e=this.container.getCoordinates();this._setPosition({left:d.left+(d.width/2)-(e.width/2)+this.options.xOffset,top:d.top+(d.height/2)-(e.height/2)+this.options.yOffset})}else{var b=this.source.getPosition();this._setPosition({left:b.x+this.options.xOffset,top:b.y+this.options.yOffset})}this.parent()}})}(ta));(function(){function c(e){if(!e){return null}if(e.get("tag")=="a"){return e.href}var d=e.getElement("a");if(d){return d.href}d=e.getElement(".overlaySrc");if(d){return d.get("text")}return null}var b={left:ta.overlays.RelativeOverlayLeft,right:ta.overlays.RelativeOverlayRight,above:ta.overlays.RelativeOverlayAbove,below:ta.overlays.RelativeOverlayBelow};function a(k,n,g,o){if(n||window.event){new Event(n||window.event).preventDefault()}var m=k.hyphenate().split("-"),i=m.indexOf("h")>=0,f=m.indexOf("lb")>=0,d=m.indexOf("remote")>=0,l=m.indexOf("click")>=0,e=Object.merge({showCloseButton:true},o),j=null,h;switch(m.shift()){case"rel":j=b[m.shift().toLowerCase()];if(f){e.pinnable=ta.overlays.PINNABLE_ALWAYS}break;case"center":j=ta.overlays.CenteredOverlay;break}if(j===null){return null}if(i){e.activate=ta.overlays.ACTIVATE_HOVER}else{if(l){e.activate=ta.overlays.ACTIVATE_CLICK}}if(f){e.backdrop=ta.overlays.BACKDROP_ALWAYS}if(d){e.remoteContent=c(g)}h=new j(e,g);if(g){g.store("overlay",h)}return h}ta.overlays.Factory={_magic:a,relRightRemoteHLB:function(d,e){e=ta.id(e);if(e.get("tag")!="div"){e=e.getParent()}var f=c(e);if(f==null){return}new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_HOVER,pinnable:ta.overlays.PINNABLE_CLICK,backdrop:ta.overlays.BACKDROP_PINNED,style:"commerceOverlay rgba_flyout",showCloseButton:true},e)},relRightRemoteHLB_Commerce:function(f,d){if(f||window.event){new Event(f||window.event).preventDefault()}d=ta.id(d);var e=c(d);if(e==null){return}d.onmouseover=null;new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"commerceOverlay rgba_flyout",showCloseButton:true},d)},relBelowRemoteHLB_Commerce:function(f,d){d=ta.id(d);if(f||window.event){new Event(f||window.event).preventDefault()}var e=c(d);if(e==null){return}d.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"commerceOverlay rgba_flyout",showCloseButton:true},d)},relBelowRemoteHLB_CommCopy:function(f,d){d=ta.id(d);if(f||window.event){new Event(f||window.event).preventDefault()}var e=c(d);if(e==null){return}d.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"commerceOverlay rgba_flyout",showCloseButton:true,onLoad:function(){if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop")}}},d)},relBelowS4Dg:function(e,d){if(e){e.stop()}d.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,style:"s4 dg",activate:ta.overlays.ACTIVATE_CLICK},d)},relBelowRGBA:function(h,e){if(h){h.stop()}var f="rgba_flyout";var g=true;var d="rgba_arrow";d=d+" rgba_arrow_png24";e.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,style:f,showArrow:g,arrowClass:d,showCloseButton:true},e)},relBelow_Disclaimer:function(e,d){d=ta.id(d);e.stop();d.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,pointArrowToSource:true,justify:"right",showArrow:true,style:"typeLD",arrowClass:"ldarrow",arrowWidth:20,yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},d)},relBelow_Disclaimer_left:function(e,d){d=ta.id(d);e.stop();d.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,pointArrowToSource:true,justify:"left",showArrow:true,style:"typeLD",arrowClass:"ldarrow",arrowWidth:20,yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},d)},relAboveH_PriceSaverRibbon:function(e,d){d=ta.id(d);e.stop();d.onmouseover=null;new ta.overlays.RelativeOverlayAbove({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,centered:true,showArrow:true,style:"typePS aboveRibbon",arrowClass:"ldarrow",arrowWidth:20,yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},d)},relBelowH_PriceSaverRibbon:function(e,d){d=ta.id(d);e.stop();d.onmouseover=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,centered:true,style:"typePS belowRibbon",yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},d)},relAboveH_PriceSaver:function(e,d){d=ta.id(d);e.stop();d.onmouseover=null;new ta.overlays.RelativeOverlayAbove({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,centered:true,showArrow:true,style:"typePS",arrowClass:"ldarrow",arrowWidth:20,yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},d)},relRight_SavingsAlert:function(f,e){e=ta.id(e);f.stop();e.onclick=null;var d={showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,showArrow:true,arrowClass:"arrow",style:"typeSA",waitForCss:true,fontSize:".7em",allowBelowBottomEdge:true};if(ta.util.i18n.isRtl()){new ta.overlays.RelativeOverlayLeft(d,e)}else{new ta.overlays.RelativeOverlayRight(d,e)}},relRightH_SavingsAlert:function(f,e){e=ta.id(e);f.stop();e.onmouseover=null;var d={showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,showArrow:true,arrowClass:"arrow",style:"typeSA",waitForCss:true,fontSize:".7em",allowBelowBottomEdge:true};if(ta.util.i18n.isRtl()){new ta.overlays.RelativeOverlayLeft(d,e)}else{new ta.overlays.RelativeOverlayRight(d,e)}},relBelow:function(e,d){if(e){e.stop()}d.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},d)},relAbove:function(e,d){if(e){e.stop()}d.onclick=null;new ta.overlays.RelativeOverlayAbove({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},d)},relRight:function(e,d){if(e){e.stop()}d.onclick=null;new ta.overlays.RelativeOverlayRight({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},d)},relLeft:function(e,d){if(e){e.stop()}d.onclick=null;new ta.overlays.RelativeOverlayLeft({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},d)},relBelowH_Media:function(e,d){if(e){e.stop()}d.onmouseover=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"typeO mediaBox"},d)},relAboveH_Media:function(e,d){if(e){e.stop()}d.onmouseover=null;new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_HOVER,style:"typeO mediaBox"},d)},relAboveH:function(e,d){d.onmouseover=null;new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_HOVER},d)},relAboveTAMGFooter:function(f,d){d.onmouseover=null;var e=ta.id("PAGE");if(e){new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_HOVER,style:"s3 vdg ovrFooter "+d.className},d)}},relRightH:function(e,d){d.onmouseover=null;new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_HOVER},d)},relLeftH:function(e,d){d.onmouseover=null;new ta.overlays.RelativeOverlayLeft({activate:ta.overlays.ACTIVATE_HOVER},d)},imageLightbox:function(g,d){d.onclick=null;var e="<div><img src="+d.getAttribute("href")+"></div>";var f=new ta.overlays.CenteredOverlay({showCloseButton:true,backdrop:ta.overlays.BACKDROP_ALWAYS}).loadRemoteSuccess(e);d.addEvent("click",f.show)},microMetaOverlay:function(r,h,l,g,o,t,i,s){try{h.onmouseover=null;h.onclick=null;if(r){r.stop()}var d="";if(ta.meta&&ta.meta.update){d=ta.meta.update.buildUrl("MicroMetaAjax",l,true,false,"QC_Meta_Micro|Button")}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){d=dd.commerce.checkrates.getMicroMetaUrl(r,l)}else{ta.util.error.record(null,"microMetaOverlay : no meta js");return}}d+="&lowContentID="+g;if(i){d+="&xSellPlacement="+i}var n=h.className.match(/noDelayFirst/);var q=h.className.match(/delayOpen/);var m=ta.retrieve("delayedFirst");var f=!q||(n&&!m);var j="Above Fold Also Viewed";if(ta.id(h).getParent("#similarHotelBetweenReview")){j="prodp13n_between_reviews_cross_sell"}else{if(ta.id(h).getParent("#MMXS_LIST")){j="State Opt Also Viewed"}else{if(ta.id(h).getParent("#HORIZONTAL_CROSS_SELL_LIST")){j="HorizXSell"}else{if(ta.id(h).getParent("#hotel_flyout")){j="Scooter"}else{if(ta.id(h).getParent("#HSCS_ROW1")){j="prodp13n_hr_similar_xsell_row1"}else{if(ta.id(h).getParent("#HSCS_ROW2")){j="prodp13n_hr_similar_xsell_row2"}else{if(window.mapDivId&&ta.id(h).getParent("#"+window.mapDivId)){j="Maps"}}}}}}}if(j=="Scooter"){d+="&from="+j}var u={activate:(t)?ta.overlays.ACTIVATE_CLICK:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:(t)?ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE:ta.overlays.PINNABLE_CLICK,backdrop:(t)?ta.overlays.BACKDROP_NEVER:ta.overlays.BACKDROP_PINNED,showCloseButton:!t,closeOnDocumentClick:t,positionByOffsets:false,positionType:"absolute",offsetTop:0,offsetRight:"",offsetBottom:"",offsetLeft:155};Object.merge(u,s);var k=new ta.overlays.RelativeOverlayBelow({style:"micro_meta_flyout gray",activate:u.activate,pinnable:u.pinnable,backdrop:u.backdrop,autoShow:f,delayShow:q,showCloseButton:u.showCloseButton,closeOnDocumentClick:u.closeOnDocumentClick,closeButtonClass:"roundOuterClose",onShow:function(){if(ta.util&&ta.util.element){ta.util.element.makeTextFitOneLine(".micro_meta_price_with_fee",true)}if(t){ta.trk("Meta_Micro_Providers_Displayed")}else{ta.trackEventOnPage("Meta_Micro_Providers_Displayed",j,o)}ta.overlays.Factory.logTrackingTree();if(u.onshow){u.onshow()}},onHide:u.onhide,positionByOffsets:u.positionByOffsets,positionType:u.positionType,offsetTop:u.offsetTop,offsetRight:u.offsetRight,offsetBottom:u.offsetBottom,offsetLeft:u.offsetLeft,trigger:h,onLoad:function(){window.fireEvent("MicroMetaHacComplete");if(u.onload){u.onload()}}},h);k.loadRemoteContent(d,false);ta.store("delayedFirst",true)}catch(p){ta.util.error.record(p,"micro meta overlay")}},microMetaExpandedSize:0,microMetaMore:function(j,k,f){try{var g=ta.id("micro_meta_remaining_"+k);if(!g){return}g.removeClass("hidden");function i(){var e=ta.id("micro_meta_more");if(!e){return}e.addClass("invisible")}if(f){i()}else{ta.meta.linkTracking.actionRecord("MICRO_META_EXPAND_MORE");if(g.getSize().y!=ta.overlays.Factory.microMetaExpandedSize){g.addClass("expanding");ta.overlays.Factory.microMetaExpandedSize=g.getSize().y;g.removeClass("expanding")}g.addClass("show");new Fx.Tween(g,{duration:"long",property:"height"}).start(0,ta.overlays.Factory.microMetaExpandedSize);window.setTimeout(i,1000);if(ta.retrieve("ibdm_impression_tracking")){var d=document.getElement(".micro_meta_first_block");if(d&&ta.meta&&ta.meta.treeTrack&&ta.meta.treeTrack.hasTrackingTree(d)){ta.trk("n_more_sites",false,d)}}}}catch(h){ta.util.error.record(h,"Micro meta expand failed.")}},isOverlayCreatedAlready:function(e,d){if(typeof d!="undefined"){var f=e.getElement(".overlaySrc");if(f){f.dispose();return false}else{return true}}return false},relRightRemoteHLB_optionalDelay_showArrow:function(q,o,u,t){try{o=ta.id(o);if(o.get("tag")!="div"){o=o.getParent()}var i=null;if(typeof u!="undefined"){i=u}if(null==i){i=c(o)}if(i==null&&ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.clearCalendarFlyouts();i=c(o)}if(i==null){return}var p=o.getElement(".overlaySrc");var s=i.match(/-d(\d+)\?/);if(s){s=s[1]}if(ta.has("meta.session_dates")||ta.widgets.calendar.hasPageDates()){try{if(!ta.retrieve("date.picker.calendarflyout.allCleared")){ta.widgets.calendar.clearCalendarFlyouts()}if(q&&q.type=="mouseover"&&o){if(!o.hasClass("datedClickAdded")){o.addEvent("click",ta.overlays.Factory.relRightRemoteHLB_optionalDelay_showArrow.bind(this,null,o,i));o.addClass("datedClickAdded")}return}var l=ta.retrieve("scooterObj");if(l){l.slideOut()}if(s){ta.overlays.Factory.metaCheckRatesOverlay_allProviders(s,o)}return}catch(y){ta.util.error.record(y,"meta session dates parse issue")}}if(ta.overlays.Factory.isOverlayCreatedAlready(o,u)){return}var g=o.className.match(/noDelayFirst/),k=o.className.match(/delayOpen/),f=ta.retrieve("delayedFirst"),v=!k||(g&&!f),j="rgba_flyout",m=true,d="rgba_arrow",n="close",h;if(ta.has("hotels.redesignEnabled")&&(pageServlet==="Hotels"||pageServlet==="HACSearch")){j+=" gray";d="rgba_arrow_gray_lft_png24";n="roundOuterClose"}if(ta.has("daodao_noPop_single_cr_button")){j+=" no_cpu"}if(typeof(dhtml_cr_redesign_basic)!="undefined"&&!this.crDHTML_BASIC){this.crDHTML_BASIC=Asset.css(dhtml_cr_redesign_basic)}if(typeof(dhtml_cr_redesign_png24)!="undefined"&&!this.crDHTML_PNG24){this.crDHTML_PNG24=Asset.css(dhtml_cr_redesign_png24)}if(this.crDHTML_PNG24){h=d+" rgba_arrow_png24_right";d=d+" rgba_arrow_png24"}var w=ta.overlays.BACKDROP_PINNED;if(ta.has("daodao_ror_backdrop_type")){w=ta.retrieve("daodao_ror_backdrop_type")}var z=(k?ta.overlays.ACTIVATE_HOVER_DELAY:ta.overlays.ACTIVATE_HOVER);if(ta.retrieve("daodao_show_cr_flyout_only_on_click")){z=ta.overlays.ACTIVATE_CLICK}var r={};if(ta.meta&&ta.meta.update){r=ta.commerce.meta.getMetaParams()}var x=new ta.overlays.RelativeOverlayRight({activate:z,pinnable:ta.overlays.PINNABLE_CLICK,backdrop:w,style:j,showArrow:m,arrowClass:d,arrowClassLeft:d,arrowClassRight:h,closeButtonClass:n,showCloseButton:true,autoShow:v,delayShow:!v,smartCloseButton:ta.isMetaHotels2013(),remoteLink:u,requestData:r,onLoad:function(){if(s&&t){var e=this.inner.getElementById("CHECK_RATE_FLYOUT");if(e){var A=e.get("onclick");e.set("onclick",t+";"+A)}}if(!ta.has("metaDatePickerEnabled")){if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop")}}},onShow:function(){if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}else{if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop");ta.commerce.checkrates.checkCRLimitsHelper(x)}}if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.updateAdultsText()}ta.store("ta.hlb_el",o)},onHide:function(){ta.widgets.calendar.closeCalendarWidgets();if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.disableAdultsPicker(this)}ta.store("ta.hlb_el",null)}},o);ta.store("delayedFirst",true);ta.widgets.calendar.trackCalendarFlyout(o,x,p)}catch(y){ta.util.error.record(y,"relRightRemoteHLB_optionalDelay_showArrow: Factory")}},relLeftRemoteHLB_optionalDelay_helper:function(s,g,o,t){try{g=ta.id(g);if(g.get("tag")!="div"){g=g.getParent()}var h=null;if(typeof t!="undefined"){h=t}if(null==h){h=c(g)}if(h==null&&ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.clearCalendarFlyouts();h=c(g)}if(h==null){return}var r=g.getElement(".overlaySrc");var l=h.match(/-d(\d+)\?/);if(l){l=l[1]}if(ta.has("meta.session_dates")||ta.widgets.calendar.hasPageDates()){try{if(!ta.retrieve("date.picker.calendarflyout.allCleared")){ta.widgets.calendar.clearCalendarFlyouts()}if(s&&s.type=="mouseover"){if(!g.hasClass("datedClickAdded")){g.addEvent("click",ta.overlays.Factory.relLeftRemoteHLB_optionalDelay_helper.bind(this,null,g,o,h));g.addClass("datedClickAdded")}return}var f=ta.retrieve("scooterObj");if(f){f.slideOut()}if(l){ta.overlays.Factory.metaCheckRatesOverlay_allProviders(l,g)}return}catch(p){ta.util.error.record(p,"meta session dates parse issue")}}if(ta.overlays.Factory.isOverlayCreatedAlready(g,t)){return}var n=g.className.match(/noDelayFirst/);var q=g.className.match(/delayOpen/);var m=ta.retrieve("delayedFirst");var d=!q||(n&&!m);var j=ta.has("daodao_ror_backdrop_type")?ta.retrieve("daodao_ror_backdrop_type"):ta.overlays.BACKDROP_PINNED;var i=(q?ta.overlays.ACTIVATE_HOVER_DELAY:ta.overlays.ACTIVATE_HOVER);if(ta.retrieve("daodao_show_cr_flyout_only_on_click")){i=ta.overlays.ACTIVATE_CLICK}var k=new ta.overlays.RelativeOverlayLeft({activate:i,pinnable:ta.overlays.PINNABLE_CLICK,backdrop:j,style:"rgba_flyout gray",showArrow:o,arrowClass:"rgba_arrow_gray_rgt_png24",arrowClassLeft:"rgba_arrow_gray_lft_png24",showCloseButton:true,closeButtonClass:"roundOuterClose",autoShow:d,delayShow:!d,smartCloseButton:ta.isMetaHotels2013(),remoteLink:t,onLoad:function(){if(!ta.has("metaDatePickerEnabled")){if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop")}}},onShow:function(){ta.store("overlay.lastElmt.className",g.className);if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}else{if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop");ta.commerce.checkrates.checkCRLimitsHelper(k)}}if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.updateAdultsText()}},onHide:function(){ta.widgets.calendar.closeCalendarWidgets();if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.disableAdultsPicker(this)}}},g);ta.store("delayedFirst",true);ta.widgets.calendar.trackCalendarFlyout(g,k,r)}catch(p){ta.util.error.record(p,"relLeftRemoteHLB_optionalDelay_showArrow: Factory")}},relLeftRemoteHLB_optionalDelay_showArrow:function(e,f,d){ta.overlays.Factory.relLeftRemoteHLB_optionalDelay_helper(e,f,true,d)},hotelsMapCROverlay:function(e,f,d){ta.overlays.Factory.relLeftRemoteHLB_optionalDelay_helper(e,f,false,d)},fbFriendOverlay:function(d){d.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:true,style:"s2 mg"},d)},albumsLB:function(r,p,u,w,q,C,B,D,m,d,n){if(r||window.event){new Event(r||window.event).preventDefault()}p=ta.id(p);var o=ta.util.sessionStorage.canUseSessionStore();try{var g="";var l="/LocationPhotoAlbum?";if(!w||!u){ta.util.error.record(null,"LocationPhotoAlbum request missing arguments",null,{geoId:w,locId:u});return}var s={detail:u,geo:w};if(D){s.showProPhotos=true}if(typeof m!=="undefined"){s.defaultToOysterTab=m}if(q){s.filter=q}if(C){s.ff=C;s.albumid=101;s.albumViewMode="hero";s.albumPartialsToUpdate="full";s.thumbnailMinWidth=50;s.cnt=30;s.offset=-5;s.baseMediaId=C;s.extraAlbumCoverCount=2}if(B){s.albumid=B;s.albumViewMode="images";s.albumPartialsToUpdate="full";s.extraAlbumCoverCount=4}if(n){s.lbShowRac=true}g="QC_Meta_Mini|Photo_Lightbox";s.area=g;if(ta.meta&&ta.meta.update&&window.pageServlet){Object.merge(s,ta.commerce.meta.getMetaParams())}l=l+Object.toQueryString(s);var v=l;try{l=ta.commerce.meta.tracking.updateUrlWithTiming(l,g)}catch(z){ta.util.error.record(z,"problem updating url with timing in Factory.photosLB");l=v}function k(){if(ta.photos.albumViewer){ta.photos.albumViewer.onResize(x)}if(d&&d.onResize){d.onResize()}}function f(){ta.store("photo.viewer.albumsLB",x);ta.photos.albumViewer.onResize(x);ta.photos.albumViewer.init(w,u,ta.retrieve("album.mediaId"),ta.retrieve("album.tracking"),ta.retrieve("album.view"),ta.retrieve("album.showTabCat"),ta.retrieve("album.showProPhotos"));ta.photos.albumViewer.tracking.recordImpressionIfDmo();if(o){window.sessionStorage.isAlbumViewerLbOpen=true}this.position();window.addEvent("resize",k);if(ta.isTabletAlbumViewer()&&ta.photos&&ta.photos.albumViewer){window.addEvent("orientationchange",ta.photos.albumViewer.onOrientationChange)}k();if(ta.photos.albumViewer){ta.photos.albumViewer.resetNumHeroPhotosClicked()}var E=ta.id("meta_on_photo_viewer");if(E){window.fireEvent("photoLightBoxLoad",E)}ta.store("locationPhotoAlbumOverlayResizeHack",function(){var J=document.getElement(".overlay.metaCheckRatesOverlay");if(!J){return}var F=document.getElement(".overlay.metaCheckRatesOverlay #overlayInnerDiv");var G=parseInt(J.getStyle("top").replace("px",""),10)-window.getScrollTop();var I=window.getSize().y;var H=I-(G+90);if(!F){return}F.setStyle("overflow","auto");F.setStyle("max-height",H+"px")});if(d&&d.onLoad){d.onLoad()}var e=ta.retrieve("oyster_location_data");if(e&&e.hasOyster&&e.hasOyster[u]){ta.run("ta.photos.oysterTracking.trackCandidateSession",null,null,null,"LB_OPEN")}else{if(!e||!e.hasOyster||!(u in e.hasOyster)){ta.util.error.record(null,"no oyster data for this location",null,{locationId:u},"WARN")}}}var y="";function t(){if(ta.retrieve("checkrates.meta_ui_post_click_prices")&&ta.retrieve("meta.baseLocationId")){ta.commerce.meta.updateProvAreaFromLightBox(ta.retrieve("meta.baseLocationId"))}if(o){window.sessionStorage.isAlbumViewerLbOpen=true}if(d&&d.onShow){d.onShow()}if(ta.isTabletAlbumViewer()){document.body.addClass("stop-scrolling");if(ta.retrieve("tabletRacOnPhotoViewer")){ta.remove("RASCalendar");if(ta.restaurantAvailabilitySearch){y=ta.restaurantAvailabilitySearch.getContainerSelector()}}}}function j(){if(ta.isTabletAlbumViewer()){document.body.removeClass("stop-scrolling")}var e=ta.retrieve("metaCheckRatesOverlay");if(e){e.hide();ta.remove("metaCheckRatesOverlay")}x.hide();if(o){window.sessionStorage.removeItem("isAlbumViewerLbOpen")}ta.photos.albumViewer.tracking.recordTimeInLB();ta.photos.albumViewer.saveVisitedAlbumsToSession();ta.meta.linkTracking.restoreCRPageServlet();document.removeEvent("keydown",ta.remove("photo.viewer.keydownListener"));if(ta.retrieve("photo.viewer.refreshOnClose")){window.location=window.location}if(ta.has("translationOverlay")){ta.retrieve("translationOverlay").hide()}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")&&ta.isMetaHotelsRequest&&ta.isMetaHotelsRequest()){ta.commerce.minimeta.doMetaDateSearch();ta.remove("hotels.datesChanged")}else{if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")){ta.commerce.minimeta.ajax.resetAjaxCall();ta.commerce.minimeta.ajax.send(false,true);ta.remove("hotels.datesChanged")}}ta.widgets.calendar.closeCalendarWidgets();window.removeEvent("resize",k);if(ta.isTabletAlbumViewer()){if(ta.photos&&ta.photos.albumViewer){window.removeEvent("orientationchange",ta.photos.albumViewer.onOrientationChange)}if(ta.retrieve("tabletRacOnPhotoViewer")){ta.remove("RASCalendar");if(ta.restaurantAvailabilitySearch){ta.restaurantAvailabilitySearch.setContainerSelector(y)}}}ta.remove("locationPhotoAlbumOverlayResizeHack");if(d&&d.onHide){d.onHide()}if(ta.isTabletAlbumViewerCTA()&&ta.photos.tabletAlbumViewer){ta.photos.tabletAlbumViewer.removeAlbumViewerCTAEvents()}window.fireEvent("photoLightBoxHidden")}function i(){if(d&&d.onClose){d.onClose()}ta.remove("meta.requestFromArea");document.removeEvent("keyup",ta.retrieve("photo.viewer.albumsLB.keyupPhotoChangeHandle"));ta.overlays.Factory.albumsLBHandleHashLocation();if(ta.retrieve("tabletAlbumPhotolbSwiping.enabled")){window.removeEvent("orientationchange",ta.photos.tabletAlbumViewer.updateHiddenHeroPhotos)}}var x;ta.overlays.Factory._albumsLBLoadAssets();var A=1;function h(){if(A>16){A=1;try{(function(){x.hide()}).delay(2000,this)}catch(F){}}else{if(!ta.retrieve("album.viewer_extended.jsAssetsLoaded")){A++;h.delay(500)}else{var E={backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s3 dg albumLightbox",backdropClickClose:true,noScrollY:false,innerDivClass:"inner",content:'<div class="js_footerPocket"></div>',onLoad:f,onShow:t,onHide:j,backdropOpacity:0.6,permanent:true,onClose:i};x=new ta.overlays.FooterPocketWithInsertOverlay(E,null,ta.isTabletAlbumViewer()?0:20);x.loadRemoteContent(l);ta.commerce.meta.tracking.resetTimingLockForNavArea(g);A=1}}}h()}catch(z){ta.util.error.record(z,"photo gallery overlay",null,{photoUrl:l});ta.commerce.meta.tracking.resetTimingLockForNavArea(g)}return false},addAlbumsLBHashHandler:function(){if(this._isHistorySupported()&&!ta.isTabletAlbumViewer()){var d={state:true};history.pushState(d,"title","#photos");window.onpopstate=function(){ta.overlays.Factory.albumsLBHandleHashLocation()}}},albumsLBHandleHashLocation:function(){if(this._isHistorySupported()&&!ta.isTabletAlbumViewer()){var e=ta.retrieve("photo.viewer.albumsLB");var d=ta.retrieve("albumsLBAutoOpen");ta.store("albumsLBAutoOpen",false);if(window.sessionStorage.isAlbumViewerLbOpen&&window.location.hash=="#photos"&&e&&!d){window.history.back()}else{if(window.sessionStorage.isAlbumViewerLbOpen&&window.location.hash==""&&e){e.hide()}}}},_isHistorySupported:function(){return !!(window.history&&window.history.pushState)},photosLB:function(d,i){try{if(d||window.event){new Event(d||window.event).preventDefault()}i=ta.id(i);if(i.get("tag")!="a"){if(i.hasClass("fkASDF")&&(i.get("tag")=="span"||i.get("tag")=="div"||i.get("tag")=="li")){i=ta.id(i)}else{i=i.getParent("a")}}var h="";if(i.className){h=i.className.match(/u_([^ ]*)/)[1]}else{if(i.href.match(/\/?LocationPhoto.*/)){h=i.href}}ta.overlays.Factory._mediaLBLoadAssets();var f="QC_Meta_Mini";if(ta.has("photo.viewer.jsAssetsLoaded")){h=h.replace(/\/LocationPhotos\-/,"/LocationPhotosLightbox-");h=h.replace(/\/LocationPhotoDirectLink\-/,"/LocationPhotosLightbox-");h=h.replace(/\#/,"?ff=");if(screen.availHeight<768||screen.availWidth<1024){if(h.match(/\?/)){h=h+"&small=true"}else{h=h+"?small=true"}}h=h+"&area="+f;var j=h;try{h=ta.commerce.meta.tracking.updateUrlWithTiming(h,f)}catch(k){ta.util.error.record(k,"problem updating url with timing in Factory.photosLB");h=j}if(ta.meta&&ta.meta.update&&window.pageServlet){h=h+"&metaReferer="+window.pageServlet}var g=ta.overlays.Factory._mediaLBCreateOverlay(ta.overlays.Factory.photoLBHelper,i);g.loadRemoteContent(h);ta.store("photo.viewer.lightbox",g);ta.commerce.meta.tracking.resetTimingLockForNavArea(f)}else{ta.util.error.record(null,"photo gallery - no assets to load");ta.overlays.Factory.viewerFallback.delay(2000,this,[null,i])}}catch(k){ta.util.error.record(k,"photo gallery overlay",null,{photoUrl:h});ta.commerce.meta.tracking.resetTimingLockForNavArea(f)}return false},viewerFallback:function(e){var d=ta.remove("photo.viewer.lightbox");if(d){d.hide()}if(e&&e.href&&e.href.match(/LocationPhotos/)){window.location=e.href}else{return ta.servlet.Popup.photoGallery(null,e)}},photoLBCounter:1,photoLBHelper:function(f){var d=ta.retrieve("photo.viewer.initData");if(ta.overlays.Factory.photoLBCounter>16){ta.overlays.Factory.photoLBCounter=1;try{ta.overlays.Factory.viewerFallback.delay(2000,this,f)}catch(g){}return}if(!d||!ta.photos.viewer){ta.overlays.Factory.photoLBCounter++;ta.overlays.Factory.photoLBHelper.delay(500)}else{ta.overlays.Factory.photoLBCounter=1;if(ta.retrieve("ta.photos.viewer.initializeOnSecondTab")){ta.store("photo.viewer.secondaryView",true);ta.photos.viewer.photoViewerInit(ta.retrieve("photo.viewer.secondaryViewer.data"))}else{ta.photos.viewer.photoViewerInit(d)}}},mediaLBAutoOpen:function(f){try{ta.overlays.Factory._mediaLBLoadAssets();if(!ta.has("photo.viewer.jsAssetsLoaded")){ta.util.error.record(null,"auto-open media lightbox - no assets to load")}else{f=f.replace(/\/LocationPhotos\-/,"/LocationPhotosLightbox-");f=f.replace(/\/LocationPhotoDirectLink\-/,"/LocationPhotosLightbox-");f=f.replace(/\#/,"?ff=");if(screen.availHeight<768||screen.availWidth<1024){if(f.match(/\?/)){f=f+"&small=true"}else{f=f+"?small=true"}}var d=ta.overlays.Factory._mediaLBCreateOverlay(ta.overlays.Factory.mediaLBAutoOpenHelper,f);d.loadRemoteContent(f);ta.store("photo.viewer.lightbox",d)}}catch(g){ta.util.error.record(g,"ta.overlays.factory.autoOpenMediaLB failed",null,{photoUrl:f})}return false},mediaLBAutoOpenHelper:function(f){var d=ta.retrieve("photo.viewer.initData");var e=16;if(ta.overlays.Factory.photoLBCounter>e){ta.overlays.Factory.photoLBCounter=1;ta.util.error.record(null,"ta.overlays.factory.autoOpenMediaLBHelper is giving up after "+e+" attempts.",null,{photoUrl:f});return}if(!d||!ta.photos.viewer){ta.overlays.Factory.photoLBCounter++;ta.overlays.Factory.mediaLBAutoOpenHelper.delay(500,this,f)}else{ta.overlays.Factory.photoLBCounter=1;ta.photos.viewer.photoViewerInit(d)}},_mediaLBLoadAssets:function(){if(!ta.has("photo.viewer.jsAssetsLoaded")&&typeof cssPhotoViewerAsset!="undefined"&&typeof jsPhotoViewerAsset!="undefined"){ta.store("photo.viewer.jsAssetsLoaded",true);Asset.css(cssPhotoViewerAsset,{media:"screen, print"});if(!ta.photos.viewer){Asset.javascript(jsPhotoViewerAsset)}if(typeof TALSO=="undefined"){Asset.javascript(jsPhotoViewerTALSOAsset)}if(typeof jsPhotosAsset!="undefined"&&!ta.servlet.Photos){Asset.javascript(jsPhotosAsset)}if(!ta.media.JWPlayer){Asset.javascript(jsJWPlayerHelperAsset)}}},_albumsLBLoadAssets:function(){if(!ta.has("album.viewer_extended.jsAssetsLoaded")){if(!ta.has("album.viewer.cssAssetsLoaded")&&window.cssAlbumViewerAsset){Asset.css(cssAlbumViewerAsset,{media:"screen, print"});if(ta.isTabletAlbumViewer()&&getCssAlbumPhotoLBIconAsset){var d=getCssAlbumPhotoLBIconAsset();if(d){Asset.css(d,{media:"screen, print"})}}ta.store("album.viewer.cssAssetsLoaded",true)}if(typeof cssAlbumViewerAssetHotels!="undefined"){Asset.css(cssAlbumViewerAssetHotels,{media:"screen, print"})}if(typeof jsAlbumViewerExtendedAsset!="undefined"&&!ta.retrieve("album.viewer_extended.jsAssetsLoaded")){Asset.javascript(jsAlbumViewerExtendedAsset,{onLoad:function(){ta.store("album.viewer_extended.jsAssetsLoaded",true)}})}}},_mediaLBCreateOverlay:function(e,g){var f={backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s3 dg",backdropClickClose:true,onLoad:function(){this.position();if(e){e(g)}},onHide:function(){var h=ta.remove("photo.viewer.lightbox");if(h){h.hide()}ta.meta.linkTracking.restoreCRPageServlet();document.removeEvent("keydown",ta.remove("photo.viewer.keydownListener"));if(ta.retrieve("photo.viewer.refreshOnClose")){window.location=window.location}if(ta.has("translationOverlay")){ta.retrieve("translationOverlay").hide()}if(ta.retrieve("hotels.datesChanged")&&(ta.has("meta.mini_meta_on_accommodations")||(ta.retrieve("hotels.redesignEnabled")&&ta.isMetaHotelsRequest&&ta.isMetaHotelsRequest()))){ta.commerce.minimeta.doMetaDateSearch();ta.remove("hotels.datesChanged")}else{if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")){ta.commerce.minimeta.ajax.resetAjaxCall();ta.commerce.minimeta.ajax.send(false,true);ta.remove("hotels.datesChanged")}}ta.widgets.calendar.closeCalendarWidgets()},permanent:true};if(ta.retrieve("checkrates.meta_ui_post_click_prices")){f.onShow=function(){var h=ta.retrieve("meta.baseLocationId");if(h){ta.commerce.meta.updateProvAreaFromLightBox(h)}}}var d=new ta.overlays.CenteredOverlay(f);return d},AccDetail:function(k,g,d){if(k){k.stop()}g=g.getParent();var h="http://"+document.domain;var j=location.pathname;if(j.length>0){if(j.charAt(0)=="/"){j=j.substring(1)}var i=j.indexOf("-");if(i>=0){j=j.substring(0,i)}}var f=d;var e=function(){var l=ta.id("overlay_description").get("text");if(l.length>1000){ta.id("overlay_description").setStyle("height",210)}};if(memoverlayCSS&&!ta.retrieve("ta.memoverlayCSS")){ta.store("ta.memoverlayCSS",new Asset.css(memoverlayCSS))}new ta.overlays.CoverOverlay({yOff:35,onLoad:e,style:"s3 dg rgba_gry",activate:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:ta.overlays.PINNABLE_CLICK,showCloseButton:true,delayShow:true,requestData:{d:f,tab:"descript",from:j},remoteContent:h+"/LocationTab"},g);return false},memberOverlay:function(f,e,d){ta.overlays.Factory.memberOverlayWOffset(f,e,d,0,0);return false},memberOverlayWOffset:function(t,g,r,p,q){if(t){t.stop()}g.onclick=null;g.onmouseover=null;var o="";var d="";var l="";var m=false;var f=false;var e=true;var n="rgba_arrow_png24";if(g.id&&g.id!=""){var j=g.id.split("-");for(var k=0;k<j.length;k++){var h=j[k];if(h.match(/\bUID_([0-9A-F]+)\b/)){o=RegExp.$1}else{if(h.match(/\bSRC_(\d+)\b/)){d=RegExp.$1}else{if(h.match(/\bCATID_(\d+)\b/)){l=RegExp.$1}else{if(h.match("FUS")){m=true}else{if(h.match("PATT")){f=true}}}}}}}else{ta.util.error.record(null,"memberOverlay - elmt.id check",null,{passedElement:ta.util.error.getSelectorString(g)})}var s="";if(typeof(footprintGet)!="undefined"){s=footprintGet()}if(memoverlayCSS&&!ta.retrieve("ta.memoverlayCSS")){ta.store("ta.memoverlayCSS",new Asset.css(memoverlayCSS))}new ta.overlays.RelativeOverlayRight({style:r||"typeO",activate:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:e,arrowClass:n,showCloseButton:true,autoShow:false,delayShow:true,offsetRight:q,offsetTop:p,remoteContent:"/MemberOverlay?uid="+o+"&c="+l+"&src="+d+"&fus="+m+"&partner="+f+"&LsoId="+s},g);return false},memberOverlayBelow:function(t,g,r,p,q){if(t){t.stop()}g.onclick=null;g.onmouseover=null;var o="";var d="";var l="";var m=false;var f=false;var e=true;var n="rgba_arrow_up_png24";if(g.id&&g.id!=""){var j=g.id.split("-");for(var k=0;k<j.length;k++){var h=j[k];if(h.match(/\bUID_([0-9A-F]+)\b/)){o=RegExp.$1}else{if(h.match(/\bSRC_(\d+)\b/)){d=RegExp.$1}else{if(h.match(/\bCATID_(\d+)\b/)){l=RegExp.$1}else{if(h.match("FUS")){m=true}else{if(h.match("PATT")){f=true}}}}}}}else{ta.util.error.record(null,"memberOverlay - elmt.id check",null,{passedElement:ta.util.error.getSelectorString(g)})}var s="";if(typeof(footprintGet)!="undefined"){s=footprintGet()}if(memoverlayCSS&&!ta.retrieve("ta.memoverlayCSS")){ta.store("ta.memoverlayCSS",new Asset.css(memoverlayCSS))}new ta.overlays.RelativeOverlayBelow({style:r||"typeO",activate:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:e,arrowClass:n,allowFlip:false,showCloseButton:true,autoShow:false,delayShow:true,offsetRight:q,offsetTop:p,remoteContent:"/MemberOverlay?uid="+o+"&c="+l+"&src="+d+"&fus="+m+"&partner="+f+"&LsoId="+s},g);return false},dropdownMiniMetaOverlayHotel:function(d,f,l,h){var k="hotel_"+h;var g=ta.id(k);if(g){var i=g.getElement(".chevron");if(i){f=i}var j=g.getElement(".dropdownMiniMeta");if(j){j=j.clone();j.set("class","dropdownMiniMeta");var e={offsetLeft:260,trigger:f};if(ta.util.i18n.isRtl()){e={offsetLeft:4}}ta.store("meta.dropdownHotelsActive",k);ta.overlays.Factory.dropdownMiniMetaOverlay(d,f,l,j,e)}}},dropdownMiniMetaOverlayHotelReview:function(e,d,i,h){var j=document.getElement(".skv3 .dropdownMiniMeta");if(!j){j=document.getElement(".dropdownMiniMeta")}if(!j){ta.trackEventOnPage("LP_Chevron_Dropdown_No_Data","0");var g=document.getElement(".LowestPrice.minOffer");if(g){g.click();return false}}j=j.clone();j.set("class","dropdownMiniMeta");if(!h){h=22}var f={offsetLeft:h};ta.overlays.Factory.dropdownMiniMetaOverlay(e,d,i,j,f)},dropdownMiniMetaOverlay:function(e,d,g,h,f){if(dropdownMetaCSS&&!ta.retrieve("ta.dropdownMetaCSS")){ta.store("ta.dropdownMetaCSS",new Asset.css(dropdownMetaCSS))}if(e){e.stop()}if(h){ta.overlays.Factory.createDropdownMiniMetaOverlay(e,d,g,h,f);ta.store("pcr.disabled",true);return true}return false},loadDropdownCSS:function(){if(window.dropdownMetaCSS&&!ta.retrieve("ta.dropdownMetaCSS")){ta.store("ta.dropdownMetaCSS",new Asset.css(dropdownMetaCSS))}},createDropdownMiniMetaOverlay:function(d,h,l,k,f){var e="rgba_flyout gray dropdownMiniMeta";var j=true;var g=-5;switch(ta.commerce.meta.getNavAreaContextFromDom(h)){case"PCR":j=false;e+=" pcrLightBox";g=-45;break;case"Photo_Lightbox":j=false;e+=" photoAmenitiesLightBox";break;case"Amenities_Lightbox":j=false;break;default:e+=" miniMetaLightBox"}var i=0;if(f){if(f.offsetLeft){i=f.offsetLeft}if(f.offsetTop){g=f.offsetTop}}new ta.overlays.RelativeOverlayBelow(Object.merge(f,{style:e,activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:j,showCloseButton:l,closeButtonClass:"roundOuterClose",arrowClass:"rgba_gray_arrow_up",offsetTop:g,offsetLeft:i,allowFlip:false,closeOnDocumentClick:true,content:k}),h)},createFacebookCTACallout:function(l,f,k,j,h,g){try{f.removePropertyEvent("mouseover","ta.overlays.Factory.createFacebookCTACallout")}catch(i){f.onmouseover=function(){}}var m=(Browser.ie7||Browser.ie8)?" ie78":"";var d={activate:ta.overlays.ACTIVATE_HOVER_DELAY,style:"s4 dg rgba_gry update2012 facebookCTAFlyout"+m,showArrow:true,centered:true,pointArrowToSource:true,showCloseButton:false,delayShow:true,innerDivClass:"inner",hoverDelayTime:0,noPadding:true,content:"<div class='onsite_cta_overlay_content'><b>"+k+"</b><br />"+h+"<br /><br /><b>"+j+"</b><br />"+g+"</div>"};new ta.overlays.RelativeOverlayBelow(d,f)},tcNavDetailOverlay:function(f,e,d){if(f){f.stop()}new ta.overlays.RelativeOverlayBelow({style:d||"typeO",activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:true,content:ta.id("INLINE_NAV_DETAIL").innerHTML},e);return false},amexHotSpotOverlay:function(i,h,d,e,g){if(i){i.stop()}var f;if(ta.has(g)){f=ta.retrieve(g);f.inner.setContent(ta.id(e).innerHTML);f.show()}else{f=new ta.overlays.RelativeOverlayBelow({style:d,activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:false,content:ta.id(e).innerHTML},h);ta.store(g,f)}return false},amexSettingsOverlay:function(k,i,d,e,g,h,j){if(k){k.stop()}var f;if(ta.has(g)){f=ta.retrieve(g);f.inner.setContent(ta.id(e).innerHTML);f.show()}else{f=new ta.overlays.RelativeOverlayBelow({style:d,activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:false,content:ta.id(e).innerHTML,offsetLeft:h,offsetTop:j,allowFlip:false},i);ta.store(g,f)}return false},createPairedCalendar:function(f,e,d){return ta.overlays.createPairedCalendar(f,e,d)},createPairedCalendarGeo:function(){},_injectAd:function(d){if(ta.has("ads.gptEnabled")){return}var f=ta.id(d);try{if(f){injectAdsTargeted(f)}}catch(g){ta.util.error.record(g,"AlsoViewedLB: error injecting ad into elemId="+d)}},createDatedPairedCalendar:function(g,e,d){if(!d){d={}}if(g){new Event(g).preventDefault()}e=ta.id(e);var f=e.getParent("form");d.validate=true;d.overlayOptions={onShow:function(){ta.overlays.toggleOffSearchAll(f)}};new ta.overlays.PairedCalendar(e,d);ta.overlays.toggleOffSearchAll(f)},recordVRCrossSell:function(){try{var f=ta.id("VR_CROSS_SELL");if(f){var d=f.innerHTML.indexOf("setPID");var h=f.innerHTML.substr(d+7,5);new Request({url:"/ActionRecord?action=VR_CROSS_SELL_"+h}).send()}}catch(g){ta.util.error.record(g,"VR Cross Sell - ActionRecord failed")}},launchAVLBCompleteFn:function(e){ta.overlays.Factory._loadAVCSS();var d=function(){ta.overlays.Factory._injectAd("ALSO_VIEWED_AD")};var f=function(i){var g="alsoViewedTest avStandalone";if(ta.has("ta.avlb_hero_photos")){g="avlb_hero_photos"}var h;h=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:g,onShow:d.delay(100),onLoad:ta.overlays.Factory.recordVRCrossSell}).loadRemoteSuccess(i);var k=false;if(h.inner){var j=ta.id("emptyAlsoViewed");if(j){k=true}else{ta.store("alsoViewedLB",true)}}else{k=true}if(k){h.hide();ta.store("commerce.pwrOverlay",h)}if(ta.meta&&ta.meta.cr){ta.meta.cr.removePCR()}else{ta.commerce.checkrates.removePCR()}};new Request({url:e,onSuccess:f,evalScripts:true}).send()},_loadAVCSS:function(){if(typeof(avlbCss)!="undefined"&&!ta.retrieve("ta.avlbCss")){ta.store("ta.avlbCss",Asset.css(avlbCss))}if(typeof(avlbTestCss)!="undefined"&&!ta.retrieve("ta.avlbTestCss")){ta.store("ta.avlbTestCss",Asset.css(avlbTestCss))}if(typeof(VRCrossSellCss)!="undefined"&&!ta.retrieve("ta.VRCrossSellCss")){ta.store("ta.VRCrossSellCss",Asset.css(VRCrossSellCss))}if(typeof(avlb_hero_photos)!="undefined"&&!ta.retrieve("ta.avlb_hero_photos")){ta.store("ta.avlb_hero_photos",Asset.css(avlb_hero_photos))}},_loadChkMoreCSS:function(){ta.overlays.Factory._loadAVCSS();if(typeof(chkMoreCss)!="undefined"&&!ta.retrieve("ta.chkMoreCss")){ta.store("ta.chkMoreCss",Asset.css(chkMoreCss))}if(typeof(chkMoreSpritesCss)!="undefined"&&!ta.retrieve("ta.chkMoreSpriteCss")){ta.store("ta.chkMoreSpriteCss",Asset.css(chkMoreSpritesCss))}},loadGeoCrAutoBroadenOverlay:function(d,g){var f=ta.retrieve("gcrab.cssPath");if(f&&!ta.retrieve("gcrab.css")){ta.store("gcrab.css",Asset.css(f))}var e=new ta.overlays.CenteredOverlay({permanent:true,style:"gcrabLb",noPadding:true,absoluteOffset:true,yOffset:(Math.max(20,window.getHeight()-540)/2)+window.getScrollTop(),xOffset:Math.max(5,window.getWidth()-965)/2,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:"roundOuterClose",content:'<div style="background-color:#EEE;"><img style="padding:150px;display:block;width:79px;margin:auto;" src="'+ta.util.imageServer("/img2/meta_sprites/loadingAnim.gif")+'"></div>',onClose:function(){ta.trackEventOnPage("MetaGeoLightBox","unload","CloseButton",0,false)}},d);ta.commerce.meta.loadGeoCrAutoBroadenContents(e,g)},loadCheckRatesLBOverlay:function(q,g,j){try{var m={};if(ta.meta&&ta.meta.update){m=ta.commerce.meta.getMetaParams()}var h=Object.merge({d:j.detail,s:crPageServlet,a:j.area},m);if(ta.retrieve("checkrates.meta_ui_post_click_prices")){var k="QC_Meta_Mini|Photo_LB";var n;try{n=ta.commerce.meta.tracking.setTimingForNavArea(k);h.metaRequestTiming=n}catch(l){ta.util.error.record(l,"problem locking timing for QC_Meta_Mini|Photo_LB")}}var o="CalendarLightbox";if(j&&j.gaContext){o=j.gaContext}var d=ta.widgets.calendar.getCheckRatesData();if(d){h=Object.merge(h,d)}var p="s3 dg cr_lb_overlay lb_overlay_post_date_close";var f={backdrop:ta.overlays.BACKDROP_ALWAYS,style:p,requestData:h,remoteContent:"http://"+document.domain+"/CheckRatesLB",showCloseButton:true,permanent:true,onLoad:function(){if(!d){ta.overlays.Factory.loadDatePicker(q,this,j.detail,"_cro",ta.widgets.calendar.launchCRLBUpdate)}},onHide:function(){ta.remove("meta.prof_photo_lb.post_date_close.overlay")}};f.closeButtonClass="roundOuterClose";f.onClose=function(){ta.trackEventOnPage("CalendarLightbox","unload","CloseButton")};ta.store("meta.prof_photo_lb.post_date_close.overlay",new ta.overlays.CenteredOverlay(f,g));if(typeof(checkRatesLBCss)!="undefined"&&!ta.retrieve("ta.checkRatesLBCss")){ta.store("ta.checkRatesLBCss",Asset.css(checkRatesLBCss))}}catch(i){ta.util.error.record(i,"check rates leave behind")}},tryToHideCROverlayPostDatesClose:function(){var d=ta.retrieve("meta.prof_photo_lb.post_date_close.overlay");if(d){d.hide()}},tamgShowLightbox:function(f,e,g){var d="tripadvisor.com";if(typeof cookieDomain!="undefined"){d=cookieDomain.substring(1,cookieDomain.length)}new Asset.css(g);new Request({url:"/TAMGFooterAjax",onSuccess:function(h){ta.overlays.showInLightbox(h,{style:"s0 TAMG_All"})},data:{a:"SHOW_GROUP_OVERLAY",dom:d},evalScripts:true,method:"get"}).send()},currencyPickerPopup:function(g,e,d){if(g){g.stop()}e.onclick=null;var f="/StaticVelocityPage?t=currency_picker.vm";new Asset.css(globalCurrencyPickerCSS);new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:f,style:"global_currency_picker_overlay dropMenu_refresh"},e);ta.trackEventOnPage("CurrencyPicker","Open",d);return false},intlPopup:function(i,f){if(i){i.stop()}f.onclick=null;flagsUrl=document.location.pathname;var g="/StaticVelocityPage?t=intSitesFly.vm&lt=evt&footerFlagFormat="+footerFlagFormat+"&flagsURL="+encodeURIComponent(flagsUrl);if(document.location.search!=""){g+=encodeURIComponent(document.location.search)}if(document.location.hash!=""){g+=encodeURIComponent(document.location.hash)}if(window.modelGeoId){g+="&geo="+modelGeoId}if(window.flagsSettings){for(var d=0;d<flagsSettings.length;d++){g+="&"+flagsSettings[d]+"=true"}}if(window.pageFeature){g+="&pageFeature="+pageFeature}new Asset.css(flagsFlyoutCSS);var e=ta.isFall2013MastheadRefresh()?"dropMenu_refresh":"typeO";var h=ta.overlays.ACTIVATE_CLICK;new Request({url:g,onSuccess:function(j){var k=new Element("div",{html:j});ta.overlays.Factory.fixFlagsFlyout(k);new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:h,content:k,style:e},f)}}).send();return false},fixFlagsFlyout:function(e){if(ta.retrieve("flag_flyout_link_fixing.featureEnabled")=="true"){var d=e.getElements("a.flag_link");d.forEach(function(g){var i=document.getElement("link[hreflang="+(g.get("hreflang"))+"]");if(i!=null){var h=i.get("href");if(typeof(h)=="string"){g.href=h}else{g.parentNode.style.display="none"}}else{g.parentNode.style.display="none"}});var f=e.getElements("li.region");f.forEach(function(g){var h=g.getElements("li.flag_item");var i=g.style.display;g.style.display="none";h.forEach(function(j){if(j.style.display!="none"){g.style.display=i}})})}},showRecentLocationEmailOverlay:function(){setPID(3833);if(typeof(recentViewedCSS)!="undefined"&&!ta.retrieve("ta.recentViewedCssAsset")){ta.store("ta.recentViewedCssAsset",Asset.css(recentViewedCSS))}new Request({url:"/RecentlyViewedAjax",onSuccess:function(d){if(!d.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(d,{style:"dg s4 RecentlyViewedOverlay"})}},data:{a:"share_overlay"},evalScripts:true,method:"get"}).send()},expandRecentlyViewed:function(){for(var d=4;d<7;d++){var f=ta.id("recently_viewed_"+d);if(f&&f.hasClass("hidden")){f.removeClass("hidden")}}var e=ta.id("RECENTLY_VIEWED_MORE");if(e){e.addClass("hidden")}},showRecentlyViewedCompareOverLay:function(){ta.util.cookie.setPIDCookie(4898);var e=window.location.protocol+"//"+window.location.hostname+"/CompareHotels?detail=",d=0,f;for(d=0;d<7;d++){f=ta.id("recently_viewed_"+d);if(f){e=e+f.get("locid");d+=1;break}}for(;d<7;d++){f=ta.id("recently_viewed_"+d);if(f){e=e+"&compareHotelId="+f.get("locid")}}if(typeof(compareHotelCSS)!="undefined"&&!ta.retrieve("ta.compareHotelCssAsset")){ta.store("ta.compareHotelCssAsset",Asset.css(compareHotelCSS))}new Request({url:e,onSuccess:function(g){new ta.overlays.CenteredOverlay({activate:ta.overlays.ACTIVATE_CLICK,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"compareHotel",content:g})}}).send()},clearRecentLocations:function(){var e=ta.id("RECENTLY_VIEWED_LIST");if(e){var d=e.getNext(".bxDivider");e.dispose();if(d){d.dispose()}}new Request({url:"/RecentlyViewedAjax?a=clear"}).send()},removeParticularLocation:function(d,e,o){var g=ta.id("recently_viewed_"+o);if(g){var n=g.get("locid");g.dispose();new Request({url:"/RecentlyViewedAjax?a=remove&locID="+n}).send();for(;o<7;++o){g=ta.id("recently_viewed_"+o);if(g&&g.hasClass("hidden")){g.removeClass("hidden");break}}for(;o<7;++o){g=ta.id("recently_viewed_"+o);if(g&&g.hasClass("hidden")){return}}var h=ta.id("RECENTLY_VIEWED_MORE");if(h&&!h.hasClass("hidden")){h.addClass("hidden")}var m=$$("li.rv_item");var l=0;var f=false;if(m){l=m.length;for(var j=0;j<l;j++){if(!m[j].hasClass("geoItem")){f=true}}}if(!f){var k=ta.id("RV_SAVE");if(k){k.dispose()}}if(l===0){g=ta.id("RECENTLY_VIEWED_LIST");if(g){g.dispose()}}else{if(l===1){g=ta.id("COMPARE_HOTELS");if(g){g.getParent().addClass("hidden")}}}}},showSendMessage:function(j,e){var d;if(j){j.preventDefault()}if(e){e=ta.id(e)}if(e){if(ta.has("overlays.sendmessage.loading")){return}else{ta.store("overlays.sendmessage.loading",true);ta.remove.delay(500,null,"overlays.sendmessage.loading")}if(typeof(privateMsgCSS)!="undefined"&&!ta.retrieve("ta.privateMsgCssAsset")){ta.store("ta.privateMsgCssAsset",Asset.css(privateMsgCSS))}var f;if(e.get("tag")=="span"&&e.hasClass("fkASDF")){f=e.className.match(/u_([^ ]*)/)[1]}else{f=e.href}if(f){var g=ta.retrieve("overlays.sendmessage");if(g&&f.match(/notyou=1/)){window.location="/NewsletterSignOut-e__2F__MemberSignIn"}else{if(g){return}}var i=parseInt(d,10)==1?"cc":"cm";var k=i=="cm"&&typeof(footprintGet)!="undefined"?footprintGet():null;if(k){f+="&LsoId="+k}var l={popup:true,product:"SEND_MESSAGE"};d=e.get("id");if(d){l.successAction="ta.overlays.Factory.showSendMessage||"+d}if(ta.registration.register(l)){var h;if(e.hasClass("callback_ShowRecaptcha")){new Asset.javascript("http://www.google.com/recaptcha/api/js/recaptcha_ajax.js");h="callback_ShowRecaptcha"}ta.common.sendmessage.communityLightbox(f,h)}}}},showConnectOverlay:function(f,d,e,h,g){ta.overlays.registration.connect(e,h,g)},showLoginOverlay:function(f,e,g,h,d){if(typeof(regflowCss)!="undefined"&&!ta.retrieve("ta.regflowCssAsset")){ta.store("ta.regflowCssAsset",Asset.css(regflowCss))}ta.overlays.registration.request(g,h,d)},showRoomTipsOverlay:function(h,g,k){try{ta.util.cookie.setPIDCookie(4840);var f="http://"+window.location.hostname+"/AccommodationTips?d="+modelLocId;if(k){f=f+"&filterLang="+k}var i=false;var d=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_NEVER,style:"s3 dg nopadding",permanent:true,zIndex:"9997",showCloseButton:true,remoteContent:f,onLoad:function(){if(d.inner){var e=ta.id("emptyTips");if(e){i=true}}else{i=true}if(i){d.hide()}}},g)}catch(j){ta.util.error.record(j,"showRoomTipsOverlay")}},_loadSummaryCss:function(){if(typeof(conceptsCss)!="undefined"&&!ta.retrieve("ta.conceptsCssAsset")){ta.store("ta.conceptsCssAsset",Asset.css(conceptsCss))}},showReviewSummary:function(j,g,i,e){if(i&&e){ta.overlays.Factory.showSummaryTranslation(j,g,i);return}var h=null;var f=null;var d=null;if(j){j.stop()}if(g.id&&g.id!=""){h=g.id.replace("concept_","").replace(/_/g," ");ta.store("topconcepts.lastconcept",h);d="/HotelSummary?d="+modelLocId+"&geo="+modelGeoId+"&concept="+h;if(i){d+="&autotrans=true"}}else{ta.util.error.record(null,"showReviewSummary - elmt.id check");return}ta.overlays.Factory._loadSummaryCss();f=new ta.overlays.CenteredOverlay({style:"s3 dg nopadding",autoShow:false,permanent:true,showCloseButton:true,remoteContent:d,onLoad:function(){ta.store("topconcepts.overlay."+h,this);this.show()}},g);g.onclick=f.show;return false},showSummaryTranslation:function(k,g,j){ta.util.cookie.setPIDCookie(16007);if(k){k.stop()}var e="s3 dg nopadding";ta.overlays.Factory._loadSummaryCss();var i="/MachineTranslation?";var h;if(g.id&&g.id!=""){if(g.id.indexOf("trans_")!=-1){h=g.id.replace("trans_","").replace(/_/g," ")}else{h=g.id.replace("concept_","").replace(/_/g," ")}ta.store("topconcepts.lastconcept",h);i+="page=summary&";i+="d="+modelLocId+"&";i+="concept="+h;i+="&sl=en&tl="+j}var d="topconcepts.overlay."+h;var f=ta.retrieve(d);if(f){f.hide()}f=new ta.overlays.CenteredOverlay({style:e,showCloseButton:true,remoteContent:i,onLoad:function(){ta.store(d,this);this.show()}},g)},toggleConceptSnippetTranslation:function(l,f){var k=null;var h=null;var j=null;var g=null;var d=null;if(l){l.stop()}if(f){ta.util.cookie.setPIDCookie(4111);j=f.id.replace(/[^_]*_(.*)/,"$1");k=ta.id("SUMMARYOVERLAY_"+j);if(k){h=k.getElements(".snippetText");for(var e=0;e<h.length;e++){if(h[e].isDisplayed()){h[e].hide()}else{h[e].show("inline")}}}g=ta.id("trans_"+j);d=ta.id("en_"+j);if(g.hasClass("activeButton")){g.removeClass("activeButton");g.addClass("inactiveButton")}else{g.removeClass("inactiveButton");g.addClass("activeButton")}if(d.hasClass("activeButton")){d.removeClass("activeButton");d.addClass("inactiveButton")}else{d.removeClass("inactiveButton");d.addClass("activeButton")}if(ta.overlays.Factory.storeReviewSummaryContent){ta.overlays.Factory.storeReviewSummaryContent(j.replace(/_/g," "),k.getParent().get("html"))}}},confirmGetVerified:function(f,e,d){ta.load("travel-answers-unverified.js",null);ta.trackEventOnPage("answers_faq_owner_get_verified","answer_form_click",d);if(f){f.stop()}ta.load("travel-answers-unverified.js",null);new ta.overlays.CenteredOverlay({style:"typeO",isOverlay:true,backdrop:ta.overlays.BACKDROP_ALWAYS,remoteContent:"/AnswersAjax?act=sgv&detail="+d},e);return false},questionToolTip:function(f,e,d){if(f){f.stop()}if(ta.has("questionTTShown")){return false}ta.store("questionTTShown",true);new Request({url:"/AnswersAjax",data:{act:"sqtt"},onSuccess:function(g){if(g==="true"){e.onclick=null;e.onmouseover=null;var h={style:"s3 dg rgba_gry update2012",activate:ta.overlays.ACTIVATE_NEVER,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,allowRightArrowPos:true,pointArrowToSource:true,arrowHeight:32,arrowTopForce:40,arrowClass:"rgba_arrow_png24",showCloseButton:false,autoShow:false,delayShow:true,offsetRight:0,offsetTop:11,remoteContent:"/AnswersAjax?act=fqtt&geoId="+d};var i=new ta.overlays.RelativeOverlayRight(h,e);document.addEvent("click",i.hideByClickOnDocument.bind(i))}}}).send();return false},answersGuidelines:function(f,e,d){if(f){f.stop()}new ta.overlays.RelativeOverlayAbove({style:"typeO",isOverlay:true,showCloseButton:true,centered:true,backdrop:ta.overlays.BACKDROP_ALWAYS,remoteContent:"/AnswersAjax",requestData:{act:"sp",detail:d}},e);return false},questionForm:function(h,f,g,e){if(h){h.stop}if(!e){ta.util.error.record(new TypeError("pid required for questionForm overlay"),"Question and Answers - questionForm",null,null,"WARN")}ta.store("answers.pid.overlayType",e);var d=ta.overlays.getCurrent();if(d){d.hide()}new ta.overlays.CenteredOverlay({style:"answersOverlay verywide s7trans",closeButtonClass:"roundOuterClose",showCloseButton:true,remoteContent:"/AnswersAjax",requestData:{act:"saqo",lcid:g,altsessid:ta.retrieve("altsessid")||""},waitForCss:true,onLoad:function(){this.show()},onClose:function(){ta.remove("answers.pid.overlayType")}})},askReviewerIntercept:function(d,g,i,n,m,f,e,l,h){if(d){d.stop()}if(ta.registration.isAuthorized("SAVE_QUESTION")&&ta.registration.isAuthorized("SEND_MESSAGE")){ta.store("answers.pid.overlayType",h);new ta.overlays.CenteredOverlay({style:"answersOverlay verywide s7trans",closeButtonClass:"roundOuterClose",showCloseButton:true,remoteContent:"/AnswersAjax",requestData:{act:"ari",lcid:i,altsessid:ta.retrieve("altsessid")||"",screenname:n,reviewid:e,memberid:m,lang:f,subject:l},waitForCss:true,onLoad:function(){this.show()},onClose:function(){ta.remove("answers.messageTabLoaded");ta.remove("answers.pid.overlayType")}})}else{if(!g){ta.registration.getSuccessActionCookie();return false}var k=window.fullScreen||(window.screenTop===0&&window.screenY===0);var j={popup:!k,product:"SAVE_QUESTION",successAction:["ta.overlays.Factory.askReviewerIntercept",null,null,i,n,m,f,e,l].join("|")};ta.registration.register(j)}},showConfirmation:function(f){var d=ta.overlays.safeCloseCurrent();if(d){ta.store("confirmation.current",d)}var h=f.data;var g="answers."+h.type+".confirm";if(ta.has(g)){var e=ta.retrieve(g);e.onConfirm=f.onConfirm;e.onCancel=f.onCancel;e.show()}else{new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s4 dg confirmationPrompt medium",showCloseButton:false,remoteContent:"/AnswersAjax",requestData:h,onLoad:function(){var i=this;ta.retrieveOrStore(g,this);this.onConfirm=f.onConfirm;this.onCancel=f.onCancel;this.inner.getElement(".cancelBtn").addEvent("click",function(){if(i.onCancel&&typeof i.onCancel==="function"){i.onCancel()}ta.overlays.safeCloseFromDom(this);if(ta.has("confirmation.current")){ta.retrieve("confirmation.current").show();ta.remove("confirmation.current")}return false});this.inner.getElement(".confirmBtn").addEvent("click",function(){if(i.onConfirm&&typeof i.onConfirm==="function"){i.onConfirm()}ta.overlays.safeCloseFromDom(this);return true})},onHide:function(){this.onConfirm=null;this.onCancel=null}})}},reviewTranslate:function(i,g,e){ta.util.cookie.setPIDCookie(16009);ta.overlays.Factory._loadSummaryCss();var f=ta.has("photo.viewer.lightbox");var h=1001;if(f){h=10001}var d=new ta.overlays.CenteredOverlay({style:"s4 dg",zIndex:h,showCloseButton:true,remoteContent:e,onLoad:function(){this.show()}});ta.store("translationOverlay",d)},reviewTranslateEdit:function(g,e,f){var d=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:"mtedit_overlay",fontSize:".9em",noPadding:true,showCloseButton:true,closeButtonClass:"roundOuterClose",remoteContent:"/MachineTranslationEdit?r="+f,onLoad:function(){try{var h=ta.id("mtedit_mt").getElements(".mtedit_text")[0];h.style.height=ta.id("mtedit_english").clientHeight+ta.id("mtedit_mt").offsetTop-h.offsetTop+"px"}catch(i){ta.util.error.record(i,"reviewTranslateEdit:onLoad")}}});ta.store("translationEditOverlay",d)},reviewTranslateEditGuidelines:function(e,d){new ta.overlays.RelativeOverlayAbove({content:d.getParent().getElement(".overlayContents").innerHTML,activate:ta.overlays.ACTIVATE_HOVER,style:"mtedit_guidelines_overlay"},d)},showRecentLocationSaveOverlay:function(){setPID(3832);if(typeof(recentViewedCSS)!="undefined"&&!ta.retrieve("ta.recentViewedCssAsset")){ta.store("ta.recentViewedCssAsset",Asset.css(recentViewedCSS))}new Request({url:"/RecentlyViewedAjax",onSuccess:function(d){if(!d.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(d,{style:"dg s4 RecentlyViewedOverlay"})}},data:{a:"save_overlay"},evalScripts:true,method:"get"}).send()},createIPPinOverlay:function(e,f){var d;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"s2 mg",onShow:function(){if(typeof(friendStripMouseoverPageAction)=="undefined"||!friendStripMouseoverPageAction){return}d=setTimeout(function(){new Request({url:"/ActionRecord?action="+friendStripMouseoverPageAction}).send();friendStripMouseoverPageAction=null},400)},onHide:function(){clearTimeout(d)},content:f},e)},createFriendActivityOverlay:function(e,f,g){var d;return new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"s2 mg",onShow:function(){g&&ta.util.pending.lock("friendActivityOverlay.pageAction",function(){d=setTimeout(function(){new Request({url:"/ActionRecord?action="+g}).send()},400)})},onHide:function(){clearTimeout(d)},content:f},e)},createFriendActivityLightbox:function(d){return new ta.overlays.CenteredOverlay({activate:ta.overlays.ACTIVATE_CLICK,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s4 mg friendActivity",content:d})},createCouponAnnouncementOverlayRedirect:function(e,j,d,l,i,f,g,k,h){ta.overlays.Factory.createCouponAnnouncementOverlay(null,null,e,j,d,l,i,f,g,k,h)},createCouponAnnouncementOverlay:function(e,h,i,p,f,r,o,l,k,q,n,g){ta.util.cookie.setPIDCookie(l);ta.css(o);var d={};d.act=i;if(k){d.act+="-"+k}else{if(window.pageServlet){d.act+="-"+pageServlet}}var m;if(n&&n!="false"){m="amex"}else{m="couponDetail"}ta.trackEventOnPage("SpecialOffer","click",window.pageServlet);var j="/CouponAjax?"+(p?"couponId="+p+"&":"")+(f?"announcementId="+f+"&":"")+(q?"locale="+q+"&":"")+(n?"isAmex="+n+"&":"")+(g?"showLocs="+g+"&":"")+"locationId="+r+"&listing=true";new Request({url:j,data:d,onSuccess:function(t){var s=ta.overlays.showCouponInLightbox(t,{closeButtonClass:"roundOuterClose",style:m,delayedPosition:true});s.closeBtn.addEvent("click",ta.servlet.blcoupons.closeHandler)},evalScripts:true}).send()},newCreateCouponAnnouncementOverlay:function(j,i,d,g,f){ta.util.cookie.setPIDCookie(g);ta.css(d);var e="couponDetail";var k=ta.id(f);var h=ta.overlays.showCouponInLightbox(k.innerHTML,{closeButtonClass:"roundOuterClose",style:e,delayedPosition:true});h.closeBtn.addEvent("click",ta.servlet.blcoupons.closeHandler)},postVideoLogin:function(e,d,f){if(f){ta.util.cookie.setPIDCookie(f)}ta.overlays.registration.connect({flow:"POST_VIDEO"},"SIGNIN")},fbLogin:function(){ta.support.Facebook.login()},createAmenitiesLightbox:function(f){var j=location.pathname;if(j.length>0){if(j.charAt(0)=="/"){j=j.substring(1)}var i=j.indexOf("-");if(i>=0){j=j.substring(0,i)}}var d=f.id,e;if(d.indexOf("amenity_")==0){e=d.substring(8)}var g="http://"+document.domain;var h=false;if(ta.remove("amenities.suppressLinks")){h=true}new ta.overlays.RelativeOverlayBelow({autoShow:true,style:"s3 dg",showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,requestData:{d:e,tab:"amenities",from:j,suppressLinks:h},remoteContent:g+"/LocationTab"},f)},createAmenitiesLightboxFull:function(r,f,j,g){var q,l;if(r){r.stop()}if(typeof(amenityLightboxCss)!="undefined"&&!ta.retrieve("ta.amenityLightboxCss")){ta.store("ta.amenityLightboxCss",Asset.css(amenityLightboxCss))}if(j&&j>0){setPID(j)}var i=f.id;if(i.indexOf("amenity_")==0){q=i.substring(8)}ta.setEvtCookie("HotelContactInfo","Amenities",q,1,"/LocationTab");var k="http://"+document.domain;var p={};if(ta.meta&&ta.meta.update){p=ta.commerce.meta.getMetaParams()}var n=Object.merge({d:q,tab:"amenities_lightbox",from:window.pageServlet},p);var d={backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s3 dg",onLoad:function(){this.position();if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_amo")}else{ta.commerce.checkrates.updateCRForm("_amo")}if(ta.has("ads.gptEnabled")){ta.common.ads.injectAjaxAds("locationtab","#gpt-ad-728x90-locationtab",true)}else{injectAdsTargeted(ta.id("AMENITY_LIGHTBOX"))}var e=ta.id("AMENITY_LIGHTBOX");if(g){var s=ta.select(".amenities_balance")[0];var t=ta.select(e,".bottom_margin")[1];var v=ta.select(".amenitiesRDV1")[0];if(s&&t&&v){var u=v.cloneNode(true);s.insertBefore(u,t)}}this.position()},showCloseButton:true,permanent:cookieDomain!==".daodao.com",requestData:n,remoteContent:k+"/LocationTab",maintainCrPageServlet:true,onClose:function(){ta.remove("meta.requestFromArea")}};if(ta.retrieve("checkrates.meta_ui_post_click_prices")){l="QC_Meta_Mini|Amenities_Lightbox";var o;try{o=ta.commerce.meta.tracking.setTimingForNavArea(l)}catch(m){ta.util.error.record(m,"problem locking timing in ta.commerce.meta.loadBestPriceXsell")}d.onShow=function(){var s=ta.retrieve("meta.baseLocationId");if(s){try{ta.commerce.meta.tracking.setTimingForNavArea(l)}catch(t){ta.util.error.record(t,"problem locking timing in ta.commerce.meta.loadBestPriceXsell")}ta.commerce.meta.updateProvAreaFromLightBox(s)}};if(o){d.requestData=Object.merge(d.requestData,{area:l,metaRequestTiming:o})}else{d.requestData=Object.merge(d.requestData,{area:l})}}var h=new ta.overlays.CenteredOverlay(d,f);h.show();f.onclick=function(){h.show();if(ta.has("ads.gptEnabled")){ta.common.ads.injectAjaxAds("locationtab","#gpt-ad-728x90-locationtab",true)}else{ta.common.ads.injectAdsTargeted(ta.id("AMENITY_LIGHTBOX"))}if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_amo")}else{ta.commerce.checkrates.updateCRForm("_amo")}};ta.commerce.meta.tracking.resetTimingLockForNavArea(l);ta.store("ta.amenityLightboxOverlay",h);return false},iapFlyout:function(g,f,e){e.elmt=f;ta.store("iapFlyoutOptions",e);var d=f.get("id")+","+e.contentId+","+e.voteContentType;if(ta.registration.register({popup:true,product:"IAP_VOTE",successAction:"ta.overlays.Factory.iapFlyoutHelper|"+d})){ta.overlays.Factory.iapFlyoutHelper(d)}},iapAlbumFlyout:function(g,f,e){e.elmt=f;ta.store("iapFlyoutOptions",e);var d=f.get("id")+","+e.contentId+","+e.voteContentType;if(ta.registration.register({popup:true,product:"IAP_VOTE",successAction:"ta.overlays.Factory.iapAlbumFlyoutHelper|"+d})){ta.overlays.Factory.iapAlbumFlyoutHelper(d)}},iapAlbumFlyoutHelper:function(h,l){var g=h.split(",");var k=g[0];var d=parseInt(g[1],10);var f=g[2];var i=ta.retrieve("iapFlyout");if(i){i.hide()}var e=ta.id(k);if(e){if(l){window.scrollTo(0,e.getPosition().y)}var j=new ta.overlays.CenteredOverlay({showCloseButton:true,permanent:true,remoteContent:"/ReportIAP?action=reportIAP&step=START&contentId="+d+"&voteContentType="+f,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s3 dg iapFlyout"});ta.store("iapFlyout",j)}},iapFlyoutHelper:function(h,l){var g=h.split(",");var k=g[0];var d=parseInt(g[1],10);var f=g[2];var i=ta.retrieve("iapFlyout");if(i){i.hide()}var e=ta.id(k);if(e){if(l){window.scrollTo(0,e.getPosition().y)}var j=new ta.overlays.RelativeOverlayBelow({showCloseButton:true,permanent:true,remoteContent:"/ReportIAP?action=reportIAP&step=START&contentId="+d+"&voteContentType="+f,style:"s3 dg iapFlyout"},e);ta.store("iapFlyout",j)}},iapOwnerFlyout:function(g,f,e){var d=f.get("id")+","+e.reviewid+","+e.isGeo+","+e.locationid;if(ta.registration.register({popup:true,product:"IAP_VOTE",successAction:"ta.overlays.Factory.iapOwnerFlyoutHelper|"+d})){ta.overlays.Factory.iapOwnerFlyoutHelper(d)}},iapOwnerFlyoutHelper:function(g,l){var e=g.split(",");var j=e[0];var m=parseInt(e[1],10);var f=e[2];var k=parseInt(e[3],10);var h=ta.retrieve("iapOwnerFlyout");if(h){h.hide()}var d=ta.id(j);if(d){if(l){window.scrollTo(0,d.getPosition().y)}var i=new ta.overlays.RelativeOverlayBelow({showCloseButton:true,permanent:true,remoteContent:"/ReportIAP?action=explain&reason=21&reviewid="+m+"&isGeo="+f+"&locationid="+k,style:"s3 dg iapFlyout"},d);ta.store("iapOwnerFlyout",i)}},openSavesRegflow:function(){ta.widgets.Saves.openSavesRegflow()},openSavesHoverRegflow:function(){ta.widgets.Saves.openSavesHoverRegflow()},openMastheadRegflow:function(){ta.widgets.Saves.openMastheadRegflow()},createGuideOverlay:function(){ta.overlays.registration.connect({flow:"DESTINATION_GUIDE"},"SIGNUP")},createPostPhotosOverlay:function(){ta.overlays.registration.connect({flow:"POST_PHOTOS"},"SIGNUP")},relBelowOverlaySolidGreenBorder:function(e,d){d.onmouseover=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"s3 dg"},d)},createDropDown:function(l,e,h){e=ta.id(e);e.onmouseover=null;var d=ta.isFall2013MastheadRefresh()?"dropMenu_refresh":"dropMenu";var i=ta.isFall2013MastheadRefresh()?"sprite-arrow_dropdown_wht_refresh_show":"sprite-arrow_dropdown_wht_show";var f,k,j=ta.id("HEAD");if(j){k=j.getStyle("z-index")||204}else{k=204}try{f=new ta.overlays.RelativeOverlayBelow({content:h,style:d,fontSize:"12px",zIndex:k,activate:ta.overlays.ACTIVATE_HOVER,pinnable:ta.overlays.PINNABLE_CLICK,noPadding:ta.isFall2013MastheadRefresh(),onShow:function(){e.addClass("tabLinkShown");e.addClass("arwLinkShown");e.getParent().addClass("tabItemShown");e.getElement("img").addClass(i)},onHide:function(){e.removeClass("tabLinkShown");e.removeClass("arwLinkShown");e.getParent().removeClass("tabItemShown");e.getElement("img").removeClass(i);var m=h.getElements(".text");Array.each(m,function(n){var o=n.retrieve("typeAhead");if(o){o.hideChoices()}})}},e)}catch(g){return}f.pinAndSetUnpin=function(){f.pin();document.addEvent("click",f.unpinAndSetPin)};f.unpinAndSetPin=function(m){m=new Event(m);if(!f.container.containsEvent(m)&&!m.target.hasClass("dropSelect")){f.hide();f.unpin();document.removeEvent("click",f.unpinAndSetPin);f.container.addEvent("click",f.pinAndSetUnpin)}};f.container.addEvent("click",function(m){f.pinAndSetUnpin(m)})},createEmptyOverlay:function(h,e,g){e=ta.id(e);var d="";if(g){d="typeO"}try{new ta.overlays.RelativeOverlayBelow({noPadding:true,style:d,activate:ta.overlays.ACTIVATE_HOVER},e)}catch(f){return}},popConditionsOverlay:function(){var d=ta.id("CONDITIONS");if(d){ta.overlays.showInLightbox(d.innerHTML)}},cancelCreateWARList:function(e){e.stopPropagation();var d=ta.retrieve("war.todolist.showOverlay");if(d){window.clearTimeout(d);ta.store("war.todolist.showOverlay",false)}},createWARToDoListOverlay:function(e){ta.trackEventOnPageOnce("WAR","GLOBAL_NAV_WAR_HOVER");var g=ta.id("WAR_TODO_LOADING");if(g){var f=e?{d:e}:{};var d=ta.id("WAR_NOTIFICATION_FLAG")||ta.id("NO_WAR_NOTIFICATION_FLAG");g.removeClass("hidden");new Request({url:"/UserReviewToDoListAjax",data:f,method:"get",onSuccess:function(k){var j=new Element("div",{html:k});var h=j.getElement("#WAR_NOTIFICATION_FLAG_NEW");var l=j.getElement("#WAR_MORE_TO_DO_ITEMS");if(l){l.replaces(g)}if(d){if(h){h.replaces(d);h.setProperty("id","WAR_NOTIFICATION_FLAG")}else{var i=j.getElement("#NO_WAR_NOTIFICATION_FLAG");if(i){d.dispose()}}}}}).send()}},showCompareOverLay:function(d,h,e){var j=window.location.protocol+"//"+window.location.hostname;var g=j+"/CompareHotels?detail="+e;for(var f=0;f<3;f++){var k=ta.id("compare_hotels_"+f);if(k&&k.checked==true){g=g+"&compareHotelId="+k.value}}new Asset.css(compareHotelCSS);new Request({url:g,onSuccess:function(i){new ta.overlays.CenteredOverlay({activate:ta.overlays.ACTIVATE_CLICK,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"compareHotel",content:i})}}).send()},createNeighborhoodOverlay:function(i,g,d){if(ta.has("nbhdOverlay")){if(g){g.onclick=null}ta.retrieve("nbhdOverlay").show();return}var e=new ta.overlays.RelativeOverlayBelow({showCloseButton:true,permanent:true,zIndex:"997",style:"nbhdOverlay typeO",activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,onShow:function(){if(d){ta.servlet.HACSearch.filter.update()}},onHide:function(){if(d){ta.servlet.HACSearch.filter.update()}}},"NEIGHBORHOOD_OVERLAY");var f=e.inner;var h=ta.id("NEIGHBORHOOD_FORM");if(f&&h){h.inject(f,"top");h.removeClass("hidden");ta.store("neighborhoodOverlayForm",h)}ta.store("nbhdOverlay",e)},createHACProgressOverlay:function(){try{if(ta.has("ta.hac.progress.overlay")){return ta.retrieve("ta.hac.progress.overlay")}var h=ta.id("HAC_PROGRESS_CONTAINER").dispose();var d=h.get("html");var g=new ta.overlays.CenteredOverlay({style:"s3 dg rgba_gry",showCloseButton:false,permanent:true,content:d});ta.store("ta.hac.progress.overlay",g);return g}catch(f){ta.util.error.record(f,"createHACProgressOverlay")}},getFilterWaitOverlay:function(){var e=ta.retrieve("filters.waitDialog");if(!e){var d="mg s1 fatNotice";if(ta.isHotelsRedesign2011()||ta.has("hotels.redesignEnabled")){d=d+" fatNotice_2011"}e=new ta.overlays.CenteredOverlay({style:d,showCloseButton:false,autoShow:false,delayedPosition:true});e.inner.set("html","<b>"+JS_UpdatingYourResults+"</b>");ta.store("filters.waitDialog",e)}return e},showFilterWaitOverlay:function(e){var d=ta.overlays.Factory.getFilterWaitOverlay();if(d){if(e){d.show();d.position(false)}else{d.hide()}}},showUpdatingMessage:function(){var e=ta.overlays.Factory.getFilterWaitOverlay();e.show();if(ta.remove("filter.map")){e.container.setStyles({left:-9999,top:-9999});var f=ta.id(ta.retrieve("maps.container")).getCoordinates();var d=e.container.getCoordinates();e.container.setStyles({left:f.left+(f.width-d.width)/2,top:f.top+(f.height-d.height)/2})}if(ta.remove("filter.lockout")){e.enableBackdrop()}},createPhotoUploaderOverlay:function(d){var e=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,autoShow:false,style:"s2 dg",innerDivClass:"noPadMarg",attachCloseEvent:true,permanent:true,onLoad:ta.media.uploader.onLoadOverlayHandler,onClose:function(){if(ta.has("tipsOverlay")&&ta.retrieve("tipsOverlay").hide){ta.retrieve("tipsOverlay").hide();ta.remove("tipsOverlay")}}});e.loadRemoteContent(d,true);ta.store("ta.media.uploader.photoUploaderOverlay",e)},createIpDeauthOverlay:function(e,d){new Request({url:"/ActionRecordPlus?action=DEAUTH_IP&id="+e,onSuccess:function(f){new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,showCloseButton:false}).loadRemoteSuccess(f);if(d){ta.support.Facebook.ipRevoke(10000)}},onFailure:ta.util.error.ajaxFailure.partial("partials:ip_disable")}).send()},createHotelStyleCategoryDescriptionOverlayAbove:function(g,e,d){var f=ta.id(d);e.onmouseover=null;if(f){new ta.overlays.RelativeOverlayRight({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,style:"ryokanOverlay",showArrow:true,pointArrowToSource:true,allowRightArrowPos:true,arrowHeight:29,arrowClass:"ryokanArrow",fontSize:".7em",offsetRight:-14,offsetTop:-10,waitForCss:true,content:new Element("div",{style:"width:300px; padding:12px;",html:f.getChildren()[0].get("html")})},e)}},updateAllGuestsRoomsButtons:function(){var f=ta.widgets.calendar.getGuestsRoomsPickerData(),e=$$(".roomsButton .grp-rooms-value"),d=$$(".guestsButton .grp-guests-value");if(e&&e.length>0){e.each(function(g){g.set("html",f.rooms)})}if(d&&d.length>0){d.each(function(g){g.set("html",f.guests)})}},kinderOverlay:function(h,f){try{f.onclick=null;var g={style:"s4 dg kinder",showCloseButton:true,isChild:true,activate:ta.overlays.ACTIVATE_CLICK};var d=document.getElement(".overlay");if(d){g.onShow=function(){var e=d.overlay;if(!e.pinned){e.unpinOnHide=true;e.pin()}},g.onHide=function(){var e=d.overlay;if(e.unpinOnHide){e.unpinOnHide=false;e.unpin()}}}new ta.overlays.RelativeOverlayBelow(g,f)}catch(i){ta.util.error.record(i,"Error: kinderOverlay")}},loadBLSlideshowOverlay:function(g,f,e,d){if(window.t4bSlideshowCSS&&!ta.retrieve("ta.t4bSlideshowCSS")){ta.store("ta.t4bSlideshowCSS",new Asset.css(t4bSlideshowCSS))}new Request({url:"/BusinessListingsAjax",onSuccess:function(h){ta.overlays.showInLightbox(h,{backdrop:ta.overlays.BACKDROP_ALWAYS,style:"g s10px np"})},data:{act:"slideshow",detail:e,pid:d,servletName:pageServlet,flash:(Browser.Plugins.Flash.version>=10)},evalScripts:true,method:"get"}).send()},showPartnerAttributionTip:function(f,d,e){new ta.overlays.RelativeOverlayBelow({showCloseButton:true,style:"s3 dg update2012 rgba_gry partner_attrib",content:e},d)},accountMenuFlyout:function(j,f){try{f.removePropertyEvent("onmouseover","ta.overlays.Factory.accountMenuFlyout");f.removePropertyEvent("onclick","ta.overlays.Factory.accountMenuFlyout");j.stop();var d=ta.isFall2013MastheadRefresh()?"dropMenu dropMenu_refresh accountMenuFlyout":"dropMenu accountMenuFlyout";var g=ta.isFall2013MastheadRefresh()?ta.overlays.ACTIVATE_CLICK:ta.overlays.ACTIVATE_HOVER;var i=new ta.overlays.RelativeOverlayBelow({activate:g,style:d,noPadding:true,onShow:function(){if(!ta.isFall2013MastheadRefresh()){this.container.setStyle("margin-left","19px")}},onHide:function(){this.container.setStyle("margin-left","0")}},f);ta.store("accountMenuFlyout",i)}catch(h){ta.util.error.record(h,"Error: ta.overlays.Factory.accountMenuFlyout")}},messageMenuFlyout:function(g,d){if(g){g.stop()}try{new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,style:"messageMenuOverlay",innerDivClass:"",content:ta.id("MESSAGE_MENU").innerHTML,offsetLeft:23,offsetTop:2,showCloseButton:false},d)}catch(f){ta.util.error.record(f,"Error: ta.overlays.Factor.messageMenuFlyout")}},ratingMenuFlyout:function(h,d){d.onmouseover=null;try{var g=new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"dropMenu ja_ratingMenuFlyout"},d);ta.store("ratingMenuFlyout",g)}catch(f){ta.util.error.record(f,"Error: ta.overlays.Factory.ratingMenuFlyout")}},bizListingsMenuFlyout:function(j,f){f.onmouseover=null;try{var h=f.getNext("div"),g=ta.retrieve("accountMenuFlyout");if(h){h=h.get("html")}var d=ta.isFall2013MastheadRefresh()?"dropMenu dropMenu_refresh bizListingsMenuFlyout":"dropMenu bizListingsMenuFlyout";new ta.overlays.RelativeOverlayRight({content:h,zIndex:2000,style:d,offsetTop:ta.isFall2013MastheadRefresh()?-6:0,activate:ta.overlays.ACTIVATE_HOVER,onShow:function(){if(g){g.pin().show();var e=this;this.container.addEvent("mouseleave",function(k){if(!g.container.containsEvent(k)){g.hide();e.hide();e.container.onmouseleave=null}})}},onHide:function(){if(g){g.unpin()}}},f)}catch(i){ta.util.error.record(i,"Error: ta.overlays.Factory.bizListingsMenuFlyout")}},createDrop:function(h,d){d.onmouseover=null;try{var f=d.getNext().getElement(".subNav");ta.run("ta.overlays.Factory.createDropDown",{},h,d,f)}catch(g){ta.util.error.record(g,"Error: ta.overlays.Factory.createDrop")}},createFriendOfFriendOverlay:function(d,e){d.onclick=null;if(e){new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_CLICK,style:"s2 mg",showCloseButton:true,content:e},d)}if(lazyImgs!=null){window.setupLazyLoad()}},CLOSE_BTN_RIGHT_OFFSET:15,ratingsFlyout:function(n,d,g,j){if(n){n.stop()}try{var i=d.get("class").match("rating(\\d)")[1];var k=ta.id("ratingsFlyout"+i).get("html");var m=null;var f="";if(g){m=ta.servlet.Reviews.ratingFlyoutScroll}var h="ratingOverlay dg s3 rgba_gry";if(j){f=" fixedHeight";h=h+" overlayWithScroll"}new ta.overlays.RelativeOverlayAbove({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,content:k,innerDivClass:"ratingFlyout inner"+f,style:h,onscroll:m},d);new Request({url:"/ActionRecord?action=ratingsFlyout&pid=4304"}).send()}catch(l){ta.util.error.record(l,"showRatingsFlyout")}},getWhiteFlyout:function(l,f,i,j,e){if(l){l.stop()}if(!f||!i){return}var g="whiteFlyOut";var d=true;var h="flyout_white_arrow";var k="flyout_icon_close";new ta.overlays.RelativeOverlayRight({style:g,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:d,arrowClass:h,pointArrowToSource:true,showCloseButton:true,closeButtonClass:k,content:i,offsetRight:j,offsetLeft:-j,onRight:ta.util.i18n.isRtl()?false:true,offsetTop:e},f)},firstToReviewFlyout:function(k,d,j){try{var f=ta.id("locationId"+j);var g=f.getElement(".firstToReviewFlyout").innerHTML;var h=f.getElement(".propName");ta.overlays.Factory.getWhiteFlyout(k,h,g,-12,-20)}catch(i){ta.util.error.record(i,"ta.overlays.factory.firstToReviewFlyout")}},openTourismDescription:function(d){ta.servlet.Tourism.showGeoDescription(d)},memberPassportStampOverlay:function(f,d,e){if(!ta.has("passportStampsCSS")){ta.store("passportStampsCSS",new Asset.css(passportStampsCSS))}e.geos=e.geos.join(",");new ta.overlays.RelativeOverlayRight({style:"s3 dg rgba_gry memberPassportStamps",activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:true,onLoad:function(){this.show()},remoteContent:"/MemberPassportStamps",requestData:e},d);ta.trackEventOnPage("Reviews","reviews_in_cities");new Request({url:"/ActionRecord?action="+e.actionRecord}).send()},relRightLocalContent:function(f,d,e){d.onmouseover=null;new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_HOVER,style:"s2 og",content:ta.id(e).innerHTML},d)},relRightLocalContentSimple:function(k,e,i,f,h){var j=true;var d="flyout_arrow";var g="flyout_icon_close";new ta.overlays.RelativeOverlayRight({pinnable:ta.overlays.PINNABLE_CLICK,noPadding:false,style:"s5",offsetRight:-8,innerDivClass:"balloon_holder",showArrow:j,arrowClass:d,arrowClassRight:d,showCloseButton:true,closeButtonClass:g,content:ta.id(i).innerHTML,onClose:function(){f(h)}},e)},centerLocalAddress:function(f,d,e){new ta.overlays.CenteredOverlay({style:"s3 dg help_center",showCloseButton:true,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,content:ta.id(e).innerHTML},d)},cookieSettingsPanel:function(g,d){if(g){g.stop()}if(d&&d.onclick){d.onclick=null}var e={};e.en=451;e.en_UK=834;e.en_IE=835;e.en_ZA=2635;e.sv=720;e.no=721;e.da=1199;e.fr=1197;e.de=1201;e.de_AT=2719;e.el=1198;e.it=1202;e.es=1200;e.pl=1208;e.nl=1209;e.fi=2968;e.hu=3049;e.cs=3128;e.sk=3233;e["default"]=451;var f;if(posLocale in e){f="//info.evidon.com/pub_info/"+e[posLocale]+"?v=1&nt=0"}else{f="//info.evidon.com/pub_info/"+e["default"]+"?v=1&nt=0"}new ta.overlays.RelativeOverlayBelow({showCloseButton:true,noPadding:true,activate:ta.overlays.ACTIVATE_CLICK,content:new Element("iframe",{src:f,height:562,width:731,styles:{margin:"0"}})},d)},loadJFYHotelsFilter:function(o,v,m){if(o){o.stop()}var t=ta.retrieve("ta.p13n.filterOnHover");var H=ta.retrieve("ta.p13n.prodp13nIsTablet");if(typeof(t)!=="boolean"||typeof(H)!=="boolean"){return}function x(){var i;if(document.getElement(".horizontal_filters_wrap")){var M=document.getElement(".jfy_filter_bar_top");if(M){i=M.getElement(".options_size_limiter");if(i&&i.scrollHeight>95){var O=M.getElement(".resizer_footer.hidden");if(O){O.removeClass("hidden")}}}}else{if(ta.retrieve("ta.p13n.locationFilters")&&m==="neighborhood"){ta.overlays.Factory.fixLocationFilterFooter()}else{i=$$(".jfy_filter_bar .jfy_filter_bar_"+m+"_inner");if(i.length>0&&i[0].scrollHeight>95){var N=$$(".jfy_filter_bar .jfy_filter_"+m+"_footer.hidden");if(N.length>0){N[0].removeClass("hidden")}}}}}var q={};if(ta.retrieve("ta.p13n.jfyFilterSet")&&typeof ta.retrieve("ta.p13n.jfyFilterSet")==="object"){q=ta.retrieve("ta.p13n.jfyFilterSet")}var D=null;var K=(m==="price"&&!ta.widgets.calendar.hasPageDates()&&ta.retrieve("ta.p13n.priceFilterWithCalendar.isEnabled"));var f;if(K){f=ta.retrieve("ta.p13n.priceFilterWithCalender.content");if(!f){f=$("jfy_filter_bar_price_predates");ta.store("ta.p13n.priceFilterWithCalender.content",f);f.parentNode.removeChild(f)}}else{f=ta.id("jfy_filter_bar_"+m)}if(!f){return}var u=undefined;var B=ta.id("EATERY_FILTERS_CONT");if(B||m!=="sort"){var h=document.createElement("div");h.className="jfy_filter_bar_top_arrow";u=document.createElement("div");u.className="jfy_filter_bar_top_spacer";u.insertBefore(h,null)}var w=document.createElement("div");var p="jfy_filter_bar jfy_filter_bar_"+m;w.className=p;var r=f.getElements(".all");if(r&&r.length>0){r.removeClass("hidden")}var I=f.getElements(".less");if(I&&I.length>0){I.removeClass("hidden");I.addClass("hidden")}var z=f.getElements(".sprite-tag_list_expand");if(z&&z.length>0){z.removeClass("hidden")}var l=f.getElements(".sprite-tag_list_compress");if(l&&l.length>0){l.removeClass("hidden");l.addClass("hidden")}if(m!=="price"&&m!=="hotel_class"){var L=f.getElementsByTagName("DIV")[0];L=ta.id(L);if(m==="neighborhood"){L=f.getElements(".jfy_filter_bar_neighborhood_inner")[0]}var k=false;var s=false;var j=[];var e=0;var F;if(L){var g=L.getElements(".jfy_tag_style");if(g){for(F=0;F<g.length;F++){if(g[F].hasClass("selected")){if(s){k=true;break}}else{s=true}}if(k){for(F=0;F<g.length;F++){if(g[F].hasClass("selected")){g[F].dispose();j[e]=g[F];e++}}for(F=j.length;F>0;F--){L.insertBefore(j[F-1],L.firstChild)}}}}}w.innerHTML=f.get("html");var y=document.createElement("div");if(u){y.insertBefore(u,null)}y.insertBefore(w,null);if(!q[m]){var G=ta.overlays.ACTIVATE_CLICK_ALTERNATE;var C=true;var J=1500;if(t){G=ta.overlays.ACTIVATE_BOTH_DELAY;if(!H){C=false;J=250}else{if(m==="sort"){C=false}}}var A=(m==="price"&&ta.retrieve("ta.p13n.priceFilterWithCalendar.isEnabled"))?ta.overlays.PINNABLE_CLICK:ta.overlays.PINNABLE_NEVER;var d=function(){x();if(m==="price"){if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}}else{if(m==="sort"){if(ta&&ta.p13n&&ta.p13n.wizard&&typeof(ta.p13n.wizard.justifyRightSortOption)=="function"){ta.p13n.wizard.justifyRightSortOption()}}}};var E=undefined;if(m==="sort"){E=function(){var i=ta.retrieve("ta.p13n.jfyInformationFlyout");if(i){i.hideNow();ta.remove("ta.p13n.jfyInformationFlyout")}}}var n=ta.retrieve("ta.p13n.header_placement_overlay_class")||"";D=new ta.overlays.RelativeOverlayBelow({pinnable:A,style:"jfy_filter_bar_top dg jfy_filter_bar_top_"+m+(B?" restaurants_filter_overlay":"")+" "+n,activate:G,showCloseButton:C,noPadding:true,content:y.innerHTML,centered:true,allowFlip:false,closeOnDocumentClick:true,activateHoverDelayTime:150,hoverDelayTime:J,autoShow:false,ignoreFirstClickAfterHover:t,ignoreFirstClick:t,onShow:d,onHide:E},v);D.adjustEdge=function(Q,N){var P=ta.id("JFY_hotel_filters")||ta.id("EATERY_FILTERS_CONT");if(P&&P.getCoordinates){var O=P.getCoordinates();var M=Q;if(Q<O.left){M=O.left}else{if(Q+N>=O.right){var i=this._styleValueToPixel(this.container.getStyle("margin-right"));M=O.right-N-i-1}}var R=Q-M;this.setJfyArrowOffset=function(){this.inner.getElements(".jfy_filter_bar_top_arrow").setStyle("left",R+"px")};this.setJfyArrowOffset();return M}};if(t){D.showWithDelay()}else{D.show()}q[m]=D}else{D=q[m];D.inner.innerHTML=y.innerHTML;D.container.removeClass("expanded");if(D.visible){x();D.setJfyArrowOffset()}if(K){if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}}D.enable()}if(H){ta.id("PAGE").addEvent("click",D.hide)}ta.store("ta.p13n.jfyFilterSet",q);if(!ta.retrieve("ta.p13n.filterOnHover")){ta.trk(m,false,o.target?o.target:o.srcElement)}},fixLocationFilterFooter:function(){var i=$$(".jfy_filter_bar .location_popular .jfy_filter_bar_neighborhood_inner");if(i.length>0&&i[0].scrollHeight>95){var f=$$(".jfy_filter_bar .location_popular .jfy_filter_neighborhood_footer.hidden");if(f.length>0){f[0].removeClass("hidden");$$("#jfy_filter_bar_neighborhood .location_popular .jfy_filter_neighborhood_footer.hidden").removeClass("hidden")}}var g=$$(".jfy_filter_bar .location_neighborhood .jfy_filter_bar_neighborhood_inner");if(g.length>0){if(g[0].scrollHeight>95){var e=$$(".jfy_filter_bar .location_neighborhood .jfy_filter_neighborhood_footer.hidden");if(e.length>0){e.removeClass("hidden");$$("#jfy_filter_bar_neighborhood .location_neighborhood .jfy_filter_neighborhood_footer.hidden").removeClass("hidden")}}if(i.length>0){$$(".jfy_filter_bar .location_neighborhood").addClass("hidden")}}var d=$$(".jfy_filter_bar .location_attraction .jfy_filter_bar_neighborhood_inner");if(d.length>0){if(d[0].scrollHeight>95){var h=$$(".jfy_filter_bar .location_attraction .jfy_filter_neighborhood_footer.hidden");if(h.length>0){h.removeClass("hidden");$$("#jfy_filter_bar_neighborhood .location_attraction .jfy_filter_neighborhood_footer.hidden").removeClass("hidden")}}if(i.length>0&&g.length>0){$$(".jfy_filter_bar .location_attraction").addClass("hidden")}}},loadJFYInformationFlyout:function(l,g,f,e){if(l){l.stop()}if(e===undefined){e=ta.retrieve("ta.p13n.defaultJfyFlyoutContentId");if(!e){e="jfy_information"}}var d=function(){var m=ta.retrieve("ta.p13n.jfyFilterSet");if(m&&m.sort){m.sort.pin()}};var h=function(){var m=ta.retrieve("ta.p13n.jfyFilterSet");if(m&&m.sort){m.sort.unpin()}};var j=g;if(!j.hasClass("learnMore")&&!j.hasClass("jfy_sort")){j=g.getParent(".jfy_sort")}var k=ta.retrieve("ta.p13n.jfy_flyout_width");if(!k){k=650}var i=ta.retrieve("ta.p13n.jfyInformationFlyout");if(i&&f==="question_mark_click"){i.hideNow();ta.remove("ta.p13n.jfyInformationFlyout")}else{ta.trackEventOnPage("p13n_info_flyout","displayed",f);i=new ta.overlays.RelativeOverlayLeft({content:ta.id(e).innerHTML,closeOnDocumentClick:true,showArrow:true,pointArrowToSource:true,arrowWidth:20,arrowHeight:20,arrowClass:"jfy_info_arrow jfy_info_arrow_right",arrowClassLeft:"jfy_info_arrow jfy_info_arrow_left",arrowLeftForce:k,arrowRightForce:k,allowRightArrowPos:true,style:ta.overlays.Factory.getJFYInformationStyle(),showCloseButton:true,onShow:d,onHide:h,onRight:ta.util.i18n.isRtl()},j);ta.store("ta.p13n.jfyInformationFlyout",i)}},loadJFYInformationInline:function(l,f,k,e){var j=ta.retrieve("ta.p13n.prodp13nIsTablet");if(typeof(j)!=="boolean"){return}ta.trackEventOnPage("p13n_info_flyout","displayed",e);var g=[];if(ta.retrieve("ta.p13n.jfyInformationInline")&&typeof ta.retrieve("ta.p13n.jfyInformationInline")==="object"){g=ta.retrieve("ta.p13n.jfyInformationInline")}if(!g[k]){var h=undefined;if(f.getParent(".oneColJfyRanking")||f.getParent(".rtl")){if(j){h="left"}else{h="right"}}var d=ta.retrieve("ta.p13n.defaultJfyFlyoutContentId");if(!d){d="jfy_information"}var i=new ta.overlays.RelativeOverlayBelow({content:ta.id(d).innerHTML,activate:ta.overlays.ACTIVATE_CLICK_ALTERNATE,closeOnDocumentClick:true,hoverDelayTime:1500,autoShow:true,showArrow:true,pointArrowToSource:true,arrowWidth:20,arrowHeight:20,arrowClass:"jfy_info_arrow",justify:h,showCloseButton:true,style:ta.overlays.Factory.getJFYInformationStyle(),noPadding:true,offsetTop:-2,flipPadding:10},f);g[k]=i;ta.store("ta.p13n.jfyInformationInline",g)}},loadJFYFilterPulldown:function(g,e){if(!ta.retrieve("ta.p13n.jfyFilterPulldown")){var f="p13n_filter_pulldown";var d=new ta.overlays.RelativeOverlayBelow({content:ta.id(f).innerHTML,activate:ta.overlays.ACTIVATE_CLICK_ALTERNATE,closeOnDocumentClick:true,style:"",noPadding:true},e);ta.store("ta.p13n.jfyFilterPulldown",d)}},getJFYInformationStyle:function(){var d=ta.retrieve("ta.p13n.jfy_flyout_extra_style");if(!d){d=""}return"jfy_information_flyout"+(Browser.ie8?" ie8":"")+" "+d},adjustJFYOverlayPositions:function(){var f=ta.retrieve("ta.p13n.jfyFilterSet");var e=ta.retrieve("ta.p13n.jfyInformationFlyout");if(e&&e.visible){e.hideNow();if(f&&f.sort&&f.sort.visible){ta.store("ta.p13n.showBrandedSortFlyout",true)}}var d=Object.values(f||{});Object.each(d,function(g){if(g.visible){g.hideNow();g.show()}})},loadMetaHotelsFilter:function(g,d,e,f){ta.hac.filters.loadMetaHotelsFilter(g,d,e,f)},loadGuestsRoomsOverlay:function(h,f,g,i){var e=ta.retrieve("ta.overlay.guests_rooms_overlay");if(ta.has("guests_rooms_picker_3.enabled")){i.input=document.getElement(".calendar_wrapper .guests_rooms_picker_container")}else{i.input=document.getElement(".guests_rooms_picker_container")}i.findTargetFunction=function(j){if(ta.has("guests_rooms_picker_3.enabled")&&!ta.has("guests_rooms_picker_4.enabled")){return document.getElement(".date_picker_calendar.overlay .wrapper_header .roomsGuests")}else{if(j&&j.target){return ta.id(j.target).getParent(".roomsGuests")}}};var d={style:"date_picker_calendar guests_rooms_overlay",moreOptions:i};if(!e){e=new ta.overlays.GuestsRoomsOverlay(d,f);ta.store("ta.overlay.guests_rooms_overlay",e)}e.show(h)},updateMetaHotelsFiltersFromBreadcrumbs:function(g,e,d,f){ta.hac.filters.updateMetaHotelsFiltersFromBreadcrumbs(d,f)},closeAllActiveFilters:function(){ta.hac.filters.closeAllActiveFilters()},hideFilterOverlay:function(h,d,e){var f=ta.retrieve("ta.filters.overlaySet");if(f&&f[e]){var g=f[e];if(g.visible){g.hide()}}},simulateDatePickerClick:function(i,e,h,f,g,d){if(ta.retrieve("datepicker_autoadvance")&&document.getElement(".date_picker_calendar.overlay")){return false}ta.overlays.Factory.loadDatePicker(i,e,h,f,g,d);i.stopPropagation();i.preventDefault();return false},loadVRDatePicker:function(j,e,h,f,g,d){if(!d){d={}}var i=Object.merge({calendarOptions:{isVR:true}},d);ta.overlays.Factory.loadDatePicker(j,e,h,f,g,i)},loadDatePicker:function(n,f,h,d,j,o){if(!o){o={}}new Asset.image(CDNHOST+"/img2/generic/site/loading_anim_gry_sml.gif");if(ta.has("isHotelsLander")||ta.isMetaHomepageIntegration2013()||ta.has("widget.customHotel")||ta.has("isDaoDaoHomePageUnforkCalendar")){if(ta.has("isHotelsLander")||h==1||ta.has("isDaoDaoHomePageUnforkCalendar")){o=Object.merge({calendarOptions:{selectionStartClass:"start",selectionEndClass:"end",postContent:function(){var e=Elements.from('<div id="SKIP_DATES"><span class="skip_dates_text"><span class="taLnk">'+ta.retrieve("multiDP.skipDates")+"</span></span></div>")[0];e.getElement(".taLnk").addEvent("click",function(){var q=ta.overlays.getCurrent(),r=q&&q.calendar;r&&r.clear();var p=ta.id("SUBMIT_HOTELS");if(p){p.focus()}ta.widgets.calendar.clearSessionDates(null,function(){if(ta.has("widget.customHotel")){ta.widget.hotels.changeDates()}});if(ta.has("isHotelsLander")){ta.overlays.Factory.trackSkipDatesEvent("Hotels_Lander","Calendar","Skip dates",0)}else{ta.overlays.Factory.trackSkipDatesEvent("Meta_Homepage","Calendar","Skip dates",0)}});return e},onSelect:function(p){if(!p.oneSelected){var e=ta.id("SUBMIT_HOTELS");e&&e.focus()}}}},o)}if(h==1&&ta.has("widget.customHotel")){o.calendarOptions=o.calendarOptions||{};o.calendarOptions.wrapper=Elements.from('<div class="calendar_wrapper"><div class="wrapper_header">'+ta.retrieve("multiDP.header")+'</div><div class="wrapper_inner"></div><div class="wrapper_footer">'+ta.retrieve("multiDP.footer")+"</div>")[0]}if(h==1||h=="vr"){o.calendarOptions=o.calendarOptions||{};o.calendarOptions.submitOnEnter=ta.retrieve("widget.customHotel")?ta.widget.CustomHotelsWidget.validate:ta.pages.home.validate}}else{if(ta.retrieve("checkrates.meta_ui_sk_box_v3")){o=Object.merge({calendarOptions:{selectionStartClass:"start",selectionEndClass:"end"}},o)}}f=ta.id(f);if((ta.has("guests_rooms_picker_3.enabled")&&!ta.has("guests_rooms_picker_4.enabled"))&&f&&!f.getParent(".geoChkRates")&&(f.getParent(".jfy_header_dates_holder")||f.getParent(".filterControls")||f.getParent(".meta_chevron_module_2014")||f.getParent("#HotelDateSearch")||f.getParent(".HotelHighlight"))){try{ta.meta.update.clearDatesBumpedMessage();o.calendarOptions=o.calendarOptions||{};var l,i,g;if(ta.has("guests_rooms_picker_3.enabled")){i=ta.id(document.getElement(".guestsRoomsDatePickerHeaderForInject.hidden"));l=i?new Element("div").adopt(i.clone()).get("html"):""}i=ta.id(document.getElement(".showPricesForInject.hidden"));g=i?new Element("div").adopt(i.clone()).get("html"):"";o.calendarOptions.wrapper=Elements.from('<div class="calendar_wrapper"><div class="wrapper_header">'+l+'</div><div class="wrapper_inner"></div><div class="wrapper_footer">'+g+"</div>")[0];o.calendarOptions.isGuestsRoomsCalendar=true}catch(k){ta.util.error.record(k,"error building content for guests rooms datepicker wrapper")}}if(!o.calendarOptions){o.calendarOptions={}}if(ta.has("calendar.default.postcontent")&&!o.calendarOptions.postContent){o.calendarOptions.postContent=ta.retrieve("calendar.default.postcontent")}if(o.calendarOptions.isholidayEnable){o.calendarOptions.holidaysOnCalendar=ta.retrieve("calendar.holidays")}o.calendarOptions.classicStyling=true;window.fireEvent("onCalendarSelect",f);o.calendarOptions.onChangeDates=ta.widgets.calendar.onCalendarChangeDates;o.calendarOptions.onRangeSelect=ta.widgets.calendar.onCalendarRangeSelect;if(h=="vr"){var m=new Date();m.setMonth(m.getMonth()+18);m.setDate(1);o.calendarOptions.lastDate=m}ta.overlays.Factory.destroyAnimatedDateCTA();ta.overlays.Factory._loadAvailDateWidget(n,h,"calendar",d,j,o);if(ta.retrieve("load_date_picker_buttons")){return false}},destroyAnimatedDateCTA:function(){if(ta.isMetaHotels2013()||(ta.retrieve("hh_short_cell.enabled")&&ta.widgets.calendar.hasPageDates())){var d;if(ta.retrieve("animate_date_reformat")){d=ta.id("ANIMATED_DATE_CTA_REFORMAT")}else{d=ta.id("ANIMATED_DATE_CTA")}if(d){ta.servlet.HACSearch.destroyAnimatedDateCTA()}}},trackSkipDatesEvent:function(f,g,d,i){try{ta.trackEventOnPage(f,g,d,i,false)}catch(h){}},loadAdultsField:function(i,e,h,f,g,d){if(!d){d={}}if(!d.calendarOptions){d.calendarOptions={}}ta.overlays.Factory._loadAvailDateWidget(i,h,"adults",f,g,d)},_loadAvailDateWidget:function(m,g,f,d,i,n){var k="in",h,l;if(m){m=new Event(m)}if(m&&m.target&&ta.id(m.target).hasClass&&(ta.id(m.target).hasClass("out_date")||(ta.has("guests_rooms_picker_3.enabled")&&ta.id(m.target).hasClass("outDateTrigger")))){k="out"}n.calendarOptions.pickerOption=k;l=ta.widgets.calendar.getCalendarObjectKey(g,d,k);h=ta.retrieve(l);if(h&&h.calendar.positionElement&&ta.id(h.calendar.positionElement).getParent("#PAGE")){h.show(f)}else{try{h=new ta.commerce.AvailDataWidget(m,g,f,d,i,n)}catch(j){ta.util.error.record(j,"load availDateWidget init error")}}},onClickMetaCheckRatesOverlay_allProviders:function(g,e,f,d){ta.overlays.Factory.metaCheckRatesOverlay_allProviders(f,d)},metaCheckRatesOverlay_allProviders:function(j,e){ta.overlays.Factory._recordLBOpen();ta.commerce.meta.clearStoredMiniData();if(ta.retrieve("assisted_booking_desktop_entry.logTreePoll")&&ta.id(e).getParents){var n=ta.id(e).getParents();n.each(function(o){if(o.hasClass("premium_offers_area")){if(ta.meta&&ta.meta.treeTrack&&ta.meta.treeTrack.hasTrackingTree(o)){ta.trk("n_more_sites",false,o)}}else{if(o.hasClass("metaPriceInfo")||(o.hasClass("illisting")&&ta.retrieve("servlet.smartdeals"))){if(ta.meta&&ta.meta.treeTrack){ta.meta.treeTrack.logTreeImpression();ta.trk("n_more_sites",false,o)}}}})}if(ta.retrieve("metaCheckRatesOverlay")){ta.retrieve("metaCheckRatesOverlay").hide()}ta.remove("metaCheckRatesOverlay");if(!ta.has("metaCheckRatesCSS")){ta.store("metaCheckRatesCSS",new Asset.css(metaCheckRatesCSS))}var l=ta.retrieve("pcr.overlay");if(l&&l.visible){l.hide()}var d="";if(ta.meta&&ta.meta.update){d=ta.meta.update.buildUrl("MetaCheckRatesAjax",j,false)}else{d=ta.commerce.checkrates.buildMetaHacUrl_allProviders(j,false,"lb_allProviders",true)}var m="metaCheckRatesOverlay";if(ta.retrieve("meta_lightbox_v3.enabled")){m+=" meta_lightbox_v3"}m+=" metaLightBoxChevron marketingTextLightBox";var g=window.location.hash==="#MAPVIEW"||(ta.id("map0Div")&&ta.id("map0Div").innerHTML!=="");if(g&&ta.retrieve("meta_lightbox_v3.enabled")){m+=" wide"}var h={style:m,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:ta.retrieve("meta_lightbox_v3.enabled")?"closeOverlayLarge":"roundOuterClose",remoteContent:d,onLoad:function(){var t=false,p,s;ta.store("isLightboxOpen",true);try{if(!ta.meta||!ta.meta.update){var q="meta_lb_checkrates";t=new ta.commerce.CheckRatesData({type:q,evnt:null},j,j,true);ta.store("ta.commerce.MetaHacOverlay.crData."+t.vendorSetId,t);s=t.getVendorSet().getAllVendorIds();p=t.getVendorSet().getCheckedVendor();ta.commerce.checkrates.updateMetaProviders(t)}var o=document.getElement(".metaCheckRatesOverlay .roundOuterClose");if(o&&!o.hasClass("no_cpu")){o.className+=" no_cpu"}ta.util.element.makeSameWidth(".metaCheckRatesOverlay .priceBlock")}catch(r){ta.util.error.record(r,"meta all providers overlay load issue")}if(ta.meta&&ta.meta.update){ta.meta.update.overlayRequest(j)}else{ta.commerce.checkrates.metaHacRequest(t,s,p)}},evalScripts:true,onClose:function(){ta.store("isLightboxOpen",false);var u="meta_lightbox",t,q;u="meta_lightbox_chevron";ta.trackEventOnPage(u,"close","");if(ta.retrieve("checkrates.meta_ui_post_click_prices")){var x=ta.retrieve("meta.baseLocationId");if(x&&j==x){if(ta.meta&&ta.meta.update){ta.meta.update.request(j)}else{if(q){ta.commerce.meta.updateProvAreaFromLightBox(q.vendorSetId)}}if(ta.has("metaCheckRatesUpdateDivInline")){ta.commerce.meta.updateInlineMeta(j)}}else{if(x){if(ta.has("ta.meta.navArea")){t=ta.retrieve("ta.meta.navArea")}var p=ta.id("MetaPricesTab");var r=false;if(p!=null&&p.hasClass("sprite-tab-active")){r=true}var z=ta.id("LOC_PHOTOS"),y=ta.id("AMENITY_LIGHTBOX"),o=false;if(z||y){o=true}var w=false;if(ta.has("metaCheckRatesUpdateDivInline")){if(r){if(!o){ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(x);w=true}else{try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Inline")}catch(v){ta.util.error.record(v,"problem locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Inline")}try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Mini")}catch(v){ta.util.error.record(v,"problem locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Mini")}ta.commerce.meta.updateNavArea("QC_Meta_Mini");if(ta.meta&&ta.meta.update){ta.meta.update.request(j)}else{q=ta.retrieve("ta.commerce.MetaHacOverlay.crData."+x);if(q){ta.commerce.meta.miniMetaAjax(null,q,1000)}}w=true;ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Inline");ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Mini");ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(x);ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Inline");ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Mini");try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Inline")}catch(v){ta.util.error.record(v,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Inline")}try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Mini")}catch(v){ta.util.error.record(v,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Mini")}}}else{if(ta.meta&&ta.meta.update){ta.meta.update.request(x)}else{q=ta.retrieve("ta.commerce.MetaHacOverlay.crData."+x);if(q!=null){ta.commerce.meta.updateNavArea("QC_Meta_Mini");ta.commerce.meta.miniMetaAjax(null,q,1000);w=true}}}}if(!ta.meta||!ta.meta.update){q=ta.retrieve("ta.commerce.MetaHacOverlay.crData."+x);if(q!=null&&!w){ta.commerce.meta.updateNavArea("QC_Meta_Mini");ta.commerce.meta.miniMetaAjax(null,q,1000)}}ta.commerce.meta.updateNavArea(t)}}}if(ta.retrieve("metaCheckRatesOverlay")){ta.retrieve("metaCheckRatesOverlay").destroy()}ta.remove("metaCheckRatesOverlay");ta.widgets.calendar.removeMetaCalendarFromSync(j);ta.widgets.calendar.closeCalendarWidgets();if(!ta.retrieve("meta.isDeals")&&(!ta.servlet.hotelsMap||!ta.servlet.hotelsMap.isMapOpen())){if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldIssueAjax")){ta.remove("hotels.shouldIssueAjax");ta.commerce.minimeta.ajax.send()}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")){ta.commerce.minimeta.doMetaDateSearch()}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldHideClassicPrices")){var s=document.getElements(".classicPrice");s.each(function(A){A.hide()})}}}};if(ta.retrieve("checkrates.meta_ui_sk_box")||ta.retrieve("checkrates.meta_ui_sk_box_v2")||ta.retrieve("checkrates.meta_ui_sk_box_v3")){h.absoluteOffset=true;if(ta.retrieve("tablet_maps_v1")&&(window.innerHeight>window.innerWidth)){var k=72;var f=ta.find(".flexCard");if(f){k=f.clientHeight+80}h.yOffset=k+window.getScrollTop()}else{h.yOffset=72+window.getScrollTop()}}h.trigger=e;var i=new ta.overlays.CenteredOverlay(h,null);ta.store("metaCheckRatesOverlay",i);if(ta.has("locationPhotoAlbumOverlayResizeHack")){ta.retrieve("locationPhotoAlbumOverlayResizeHack")()}},metaCheckRatesOverlay:function(e,d,n,i){ta.overlays.Factory._recordLBOpen();ta.commerce.meta.clearStoredMiniData();ta.store("metaCheckRatesOverlay",null);if(!ta.has("metaCheckRatesCSS")){ta.store("metaCheckRatesCSS",new Asset.css(metaCheckRatesCSS))}var k=ta.retrieve("pcr.overlay");if(k&&k.visible){k.hide()}var m="";if(ta.meta&&ta.meta.update){if(!ta.has("ta.meta.request.locId")){return}m=ta.meta.update.buildUrl("MetaCheckRatesAjax",ta.retrieve("ta.meta.request.locId"),false)}else{m=ta.commerce.checkrates.buildMetaHacUrl(e,d,n,false)}var l="metaCheckRatesOverlay";if(ta.retrieve("meta_lightbox_v3.enabled")){l+=" meta_lightbox_v3"}l+=" metaLightBoxChevron";var f=window.location.hash==="#MAPVIEW"||(ta.id("map0Div")&&ta.id("map0Div").innerHTML!=="");if(f&&ta.retrieve("meta_lightbox_v3.enabled")){l+=" wide"}var g={style:l,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:ta.retrieve("meta_lightbox_v3.enabled")?"closeOverlayLarge":"roundOuterClose",remoteContent:m,onLoad:function(){if(ta.meta&&ta.meta.update){if(!ta.has("ta.meta.request.locId")){return}ta.meta.update.overlayRequest(ta.retrieve("ta.meta.request.locId"))}else{ta.commerce.checkrates.updateMetaProviders(e);ta.commerce.checkrates.metaHacRequest(e,d,n)}var o=document.getElement(".metaCheckRatesOverlay .roundOuterClose");if(o){o.className+=" no_cpu"}},evalScripts:true,onClose:function(){var p=this.source&&this.source.getParent(".gcrabLb");var o="meta_lightbox_chevron";ta.trackEventOnPage(o,"close","");if(!p){ta.overlays.Factory.updateMiniMetaPlacements(e)}h.destroy();if(!p){ta.store("metaCheckRatesOverlay",null);if(ta.meta&&ta.meta.update){if(!ta.has("ta.meta.request.locId")){return}ta.widgets.calendar.removeMetaCalendarFromSync(ta.retrieve("ta.meta.request.locId"))}else{ta.widgets.calendar.removeMetaCalendarFromSync(e.vendorSetId)}ta.widgets.calendar.closeCalendarWidgets();if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldIssueAjax")){ta.remove("hotels.shouldIssueAjax");ta.commerce.minimeta.ajax.send()}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")&&!ta.id("LOC_PHOTOS")&&pageServlet!="SmartDeals"){ta.commerce.minimeta.doMetaDateSearch();ta.remove("hotels.datesChanged")}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldHideClassicPrices")){var q=document.getElements(".classicPrice");q.each(function(r){r.hide()})}}}};if(!g.trigger){var j=ta.retrieve("ta.hlb_el");if(j){g.trigger=j}}if(ta.retrieve("checkrates.meta_ui_sk_box")||ta.retrieve("checkrates.meta_ui_sk_box_v2")||ta.retrieve("checkrates.meta_ui_sk_box_v3")){g.absoluteOffset=true;g.yOffset=72+window.getScrollTop()}var h=new ta.overlays.CenteredOverlay(g,i);ta.store("metaCheckRatesOverlay",h);if(ta.has("locationPhotoAlbumOverlayResizeHack")){ta.retrieve("locationPhotoAlbumOverlayResizeHack")()}},updateMiniMetaPlacements:function(h){var m=ta.retrieve("meta.baseLocationId"),j;if(!m&&ta.id("LOC_PHOTOS")){var q=ta.id("LOC_PHOTOS").getElement("#CHECK_RATE");if(q&&/id_(\d+)/.test(q.className)){m=RegExp.$1}}if(ta.has("ta.meta.navArea")){j=ta.retrieve("ta.meta.navArea")}if(m){var g=ta.id("MetaPricesTab");var i=false;if(g!=null&&g.hasClass("sprite-tab-active")){i=true}var r=ta.id("LOC_PHOTOS");var o=ta.id("AMENITY_LIGHTBOX");var f=ta.id("CHECK_RATES_LB");var d=false;if(r||o||f){d=true}var l=false;if(ta.has("metaCheckRatesUpdateDivInline")){if(i){if(d){try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Inline")}catch(k){ta.util.error.record(k,"problem locking timing in Factory.metaCheckRatesOverlay for QC_Meta_Inline")}try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Mini")}catch(k){ta.util.error.record(k,"problem locking timing in Factory.metaCheckRatesOverlay for QC_Meta_Mini")}ta.commerce.meta.updateNavArea("QC_Meta_Mini");if(ta.meta&&ta.meta.update){ta.meta.update.request(m)}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){dd.commerce.checkrates.checkRatesMiniMeta(null,document.getElementById("CHECK_RATE"),m,"checkrates")}}l=true;ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Inline");ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Mini");ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(m);ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Inline");ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Mini");try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Inline")}catch(k){ta.util.error.record(k,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Inline")}try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Mini")}catch(k){ta.util.error.record(k,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Mini")}}else{if(ta.retrieve("checkrates.meta_ui_post_click_prices")&&ta.widgets.calendar.datesExist()){ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(m);l=true}}}else{if(ta.retrieve("checkrates.meta_ui_post_click_prices")&&ta.widgets.calendar.datesExist()){ta.commerce.meta.updateNavArea("QC_Meta_Mini");if(ta.meta&&ta.meta.update){ta.meta.update.request(m)}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){dd.commerce.checkrates.checkRatesMiniMeta(null,document.getElementById("CHECK_RATE"),m,"checkrates")}}l=true}}}if((ta.retrieve("checkrates.meta_ui_post_click_prices")||r)&&ta.widgets.calendar.datesExist()&&!l){ta.commerce.meta.updateNavArea("QC_Meta_Mini");var n=document.getElementById("CHECK_RATE");if(!ta.retrieve("checkrates.meta_ui_post_click_prices")&&r){n=r.getElement("#CHECK_RATE");if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")){var p=r.getParent(".overlay");if(p&&p.overlay){p.overlay.addEvent("onHide",function(){ta.commerce.minimeta.doMetaDateSearch()})}}}if(ta.meta&&ta.meta.update){ta.meta.update.request(m)}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){dd.commerce.checkrates.checkRatesMiniMeta(null,n,m,"checkrates",true)}}}}else{if(h){ta.commerce.meta.updateInlineMeta(h.vendorSetId)}}ta.commerce.meta.updateNavArea(j)},createPersistentFilterOverlay:function(){var e=document.getElement(".filterControls");if(!e){return}var d={toWindow:false,autoShow:false,yOffset:-60,permanent:true,showCloseButton:false,style:"persistentFilterOverlay",positionType:"fixed",innerDivClass:e.className,onShow:function(){ta.util.element.moveContent(e,this.inner)},onHide:function(){ta.util.element.moveContent(this.inner,e)}};ta.store("persistentFiltersOverlay",new ta.overlays.AbsoluteOverlay(d));window.addEvent("scroll",ta.servlet.HACSearch.showPersistentFilters)},_recordLBOpen:function(){if(!ta.remove("skipLBGARecord")){var d=ta.remove("meta.lightboxOpener")||(ta.retrieve("meta.calendarCR")?"calendar":"button");var e="meta_lightbox_chevron";ta.trackEventOnPage(e,"open",d)}},createTAListingPolicyOverlay:function(e,d,g,f){var h=ta.id(g);if(h!=null){new ta.overlays.CenteredOverlay({style:"s3 dg rgba_gry",backdrop:ta.overlays.BACKDROP_ALWAYS,content:h.get("html"),isChild:f},null)}},greenLeaderTrack:function(j){var i=window.location.href.match(/\/\/.*?\/([^-?]+)/)[1];var h=j.target.className;var d=j.target.id;if(i){var f="GreenLeaders";var g;var e;if(i==="Hotels"||i==="HACSearch"){g="HOTELS"}else{if(i==="Hotel_Review"||i==="ShowUserReviews"){g="HR"}else{if(i==="UserReviewEdit"){g="REVIEW_FORM"}}}if(h.match("seeFullLnk")){e="SEE_ALL"}else{if(h.match("greenLeaderLabelLnk")){e="GREEN_LEADERS_BADGE"}else{if(d.match("ReportIAP")){e="REPORT_PROBLEM"}}}if(f&&g&&e){ta.trackEventOnPage(f,g,e)}}},greenLeaderOverlay:function(i,g,f,h){if(i||window.event){new Event(i||window.event).preventDefault()}ta.overlays.Factory.greenLeaderTrack(new Event(i));var d="/GreenLeaderAjax?locationId="+f+"&showSummary="+h;if(ta.retrieve("greenLeaderOverlay")){ta.retrieve("greenLeaderOverlay").loadRemoteContent(d,true)}else{var e=new ta.overlays.CenteredOverlay({style:"s3 dg nopadding rgba_gry",autoShow:false,delayedPosition:true,backdrop:(h?ta.overlays.BACKDROP_ALWAYS:ta.overlays.BACKDROP_NEVER),permanent:true,showCloseButton:true,zIndex:2001,onLoad:function(){if(ta.retrieve("greenLeaderOverlay")){this.show()}else{this.show.delay(200,this);ta.store("greenLeaderOverlay",this)}}},g);e.loadRemoteContent(d,true)}},miniMetaCrossSellMicroOverlay:function(q,h,l,g){try{h.onmouseover=null;h.onclick=null;var d;if(ta.meta&&ta.meta.update){d=ta.meta.update.buildUrl("MicroMetaAjax",l,true,false,"QC_Meta_Mini|Related_XSell")}else{var j=new ta.commerce.CheckRatesData({type:"checkrates",evnt:q},h,l,true);var i=j.getVendorSet().getCheckedContentID();var s=j.getVendorSet().getCheckedVendor();var r=ta.retrieve("meta.travelData");r=ta.commerce.checkrates.getTravelDataFromDOM();d=ta.commerce.checkrates.buildVarMetaHacUrl("MicroMetaAjax",j,i,s,true,null,"QC_Meta_Mini|Related_XSell",r)}d+="&lowContentID="+g;d+="&drop=true";var n=h.className.match(/noDelayFirst/);var p=h.className.match(/delayOpen/);var m=ta.retrieve("delayedFirst");var f=!p||(n&&!m);var k=new ta.overlays.RelativeOverlayBelow({style:"",allowFlip:false,activate:ta.overlays.ACTIVATE_HOVER_DELAY,autoShow:f,delayShow:p,offsetLeft:0,offsetTop:-20,showCloseButton:false},h);k.loadRemoteContent(d,false);ta.store("delayedFirst",true)}catch(o){ta.util.error.record(o,"ta.overlays.factory.miniMetaCrossSellMicroOverlay")}},helpCenterLB:function(d,f){try{if(d||window.event){new Event(d||window.event).preventDefault()}new ta.overlays.CenteredOverlay({style:"s3 dg help_center",showCloseButton:true,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,remoteContent:"/uvpages/helpCenterOverlay.html"},f)}catch(g){ta.util.error.record(g,"ta.overlays.factory.helpCenterLB")}return false},installmentRateTip:function(e,d){d=ta.id(d);new ta.overlays.RelativeOverlayAbove({style:"",innerDivClass:"installmentRateTipOverlay",activate:ta.overlays.ACTIVATE_HOVER,pinnable:ta.overlays.PINNABLE_CLICK,allowFlip:true,content:"<span>"+ta.retrieve("meta.paymentsTipText")+"</span>"},d)},jfyMoreTagOverlay:function(e,d,g){if(e){new Event(e).stop()}var f=ta.id(g);f=f.clone();new ta.overlays.RelativeOverlayAbove({style:"moreTagOverlay",activate:ta.overlays.ACTIVATE_HOVER,showCloseButton:false,content:f.innerHTML},d)},starAttributionOverlay:function(e,d){ta.common.flyout.starAttribution(e,d)},tripTypeSelectOverlay:function(f,d){if(!d||!f){return}d.onclick=null;f.stop();ta.trackEventOnPage("Reviews_Controls","filter_dropdown","");var e=document.getElement(".tripTypeOverlayContents");if(!e){return}e.show();new ta.overlays.RelativeOverlayBelow({style:"tripTypeSelectOverlay",activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:false,content:e,offsetTop:3},d)},languageFilterSelectOverlay:function(f,d){if(!d||!f){return}d.onclick=null;f.stop();var e=document.getElement(".languageList");if(!e){return}e.show();new ta.overlays.RelativeOverlayRight({style:"tripTypeSelectOverlay",activate:ta.overlays.ACTIVATE_HOVER,showCloseButton:false,content:e,offsetLeft:-13},d)},reviewLanguageOverlay:function(f,d){if(!d||!f){return}d.onclick=null;f.stop();var e=document.getElement(".languageList");if(!e){return}var g=d.getSize().x-16;new ta.overlays.RelativeOverlayBelow({style:"reviewLanguageOverlay",activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:false,content:e,offsetTop:1,offsetLeft:g},d)},reviewSeasonOverlay:function(f,d){if(!d||!f){return}d.onclick=null;f.stop();var e=document.getElement(".seasonList");if(!e){return}new ta.overlays.RelativeOverlayBelow({style:"reviewLanguageOverlay",activate:ta.overlays.ACTIVATE_CLICK_TOGGLE,showCloseButton:false,content:e,offsetTop:1},d)},topDestinationsOverlay:function(f,d){if(!d||!f){return}d.onclick=null;f.stop();var e=document.getElement(".topDestinationsList");if(!e){return}new ta.overlays.RelativeOverlayBelow({style:"topDestinationsOverlay",activate:ta.overlays.ACTIVATE_CLICK_TOGGLE,showCloseButton:false,content:e,offsetTop:1},d)},translationRatingsOverlay:function(g,d){if(!d||!g){return}d.onclick=null;g.stop();var f=d.getParent("form");if(f){var e=f.getElement(".ratingList");if(!e){return}new ta.overlays.RelativeOverlayBelow({style:"mtRatingOverlay",noPadding:true,activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:false,content:e},d)}},installExitInterrupter:function(){ta.servlet.HotelReview.installExitInterrupter()},ipLearnMoreMenu:function(e,d){if(!d||!e){return}d.onclick=null;e.stop();new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,style:"dropMenu dropMenu_refresh"},d);new Request({url:"/ActionRecord?action=FBIP-PersistentHeader-Flyout"}).send()},showHrRoomTipsSoftGateCta:function(e,o,m,d,n){if(!o||!e){return}var r=o.onclick;o.onclick=null;e.stop();var f=true,p=false,i,h,g,j;function l(s){s&&ta.util.error.record(null,s);if(f){i&&i.removeClass("blurred")}else{h&&h.removeClass("blurred")}if(!p){n()}o.onclick=r}h=o.getParent(".tipsContent");if(!h){l("Bailed soft gate due to rootElt");return}g=h.getElement(".softGateCta");if(!g){l("Bailed soft gate due to no content");return}var q=document.getElement(".tipsContent .page1");if(!q){l("Bailed soft gate due to no overlay origin");return}function k(){j=new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,zIndex:9996,backdrop:ta.overlays.BACKDROP_ALWAYS,backdropZIndex:"behindOverlay",backdropOpacity:0.3,pinnable:ta.overlays.PINNABLE_CLICK,content:g,yoffset:50,centered:true,autoShow:true,showCloseButton:true,closeButtonClass:"softGateCtaClose",noPadding:true,onShow:function(){ta.trackEventOnPage("hr_soft_gate_room_tips","show",m,0,false)},onClose:function(){ta.trackEventOnPage("hr_soft_gate_room_tips","closed",m,0,false);ta.call("ta.servlet.emailSignupRegistration.cancelRoomTipsSoftGate",new Event(),g,m,d)},onHide:function(){l()}},q)}if(f){i=n({isScrollIntoView:true,onScrollDone:k});p=true;if(!i){l();return}i.addClass("blurred")}else{h.addClass("blurred");k()}},logTrackingTree:function(){var d=document.getElement(".micro_meta_flyout");if(d){var e=d.getElement(".impressionTrackingTree");if(e){ta.trkImpTree(e)}}},loadDatePickerOverlay:function(f,e,d){ta.call("ta.p13n.wizard.loadDatePickerOverlay",f,e,d)},racLBDelegates:function(){function d(){}function e(){}return{onLoad:d,onClose:e}},racGeoSearchDelegates:function(d){return{onLoad:function(){ta.restaurantAvailabilitySearch.init(d)}}},createSearchPageScopeSelect:function(d,e){if(!d||!e){return}return new ta.overlays.RelativeOverlayBelow({style:"geo_select_flyout",closeOnDocumentClick:true,content:e},d)},rrBaselineSurveyOverlay:function(){var e=new ta.overlays.CenteredOverlay({showCloseButton:false,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"rrBaselineSurveyOverlay",onShow:function(){localStorage.setItem("rrBaselineSurveySeen",true);ta.trackEventOnPage("rrsat_survey","offered","")}});var f=new Element("h1").set("text",ta.retrieve("r_survey_title"));var k=new Element("p").set("text",ta.retrieve("rr_survey_p1"));var j=new Element("p").set("text",ta.retrieve("rr_survey_p2"));var d=new Element("div").set("text",ta.retrieve("rr_survey_yes")).addClass("rndBtn rndBtnGreen rndBtnLarge yesButton");d.addEvent("click",function(){var m="http://tripadvisor.fluidsurveys.com/s/rrsat/";var o=window.posLocale&&window.posLocale.substr(0,2);if(o==="en"||o==="el"){o="eng"}else{if(o==="iw"){o="he"}}if(o){m+="lang"+o+"/"}var n={};if(ta.has("rr_survey_session")){n.sid=ta.retrieve("rr_survey_session")}if(ta.has("rr_survey_pgps")){n.pgps=ta.retrieve("rr_survey_pgps")}m+="?"+Object.toQueryString(n);ta.trackEventOnPage("rrsat_survey","accepted","");window.open(m,"rr_baseline_survey","menubar=no,location=no,resizable=yes,scrollbars=yes,status=yes,width=800,height=500");e.hide()});var l=new Element("div").set("text",ta.retrieve("rr_survey_no")).addClass("rndBtn rndBtnLarge noButton");l.addEvent("click",function(){e.hide();ta.trackEventOnPage("rrsat_survey","declined","")});var i=new Element("div").addClass("buttons");i.adopt(d,l);var g=new Element("div");g.adopt(f,k,j,i);e.inner.setContent(g);e.show();var h=function(m){if(m.keyCode==27){e.hide();document.removeEvent("keyup",h)}};document.addEvent("keyup",h)},loadingMostRecentDraftOverlay:function(e,f){if(e){var d=new ta.overlays.CenteredOverlay({showCloseButton:false,backdrop:ta.overlays.BACKDROP_ALWAYS,content:e.innerHTML,backdropColor:"#FFF",backdropOpacity:0.8,style:"loadingMostRecentDraftOverlay"});f();setTimeout(function(){d.hide()},3000)}}}})();(function(a){Object.append(a,{injectReviewSummaryContentFromConcept:function(c){try{var b=ta.retrieve("topconcepts.rsContent")[c];if(!b){ta.util.error.record(null,"injectReviewSummaryContentFromConcept - no content")}ta.overlays.Factory.injectReviewSummaryContent(b)}catch(d){ta.util.error.record(d,"injectReviewSummaryContentFromConcept")}},injectReviewSummaryContent:function(c){try{var b=ta.retrieve("reviewSummaryOverlay");if(b){b.inner.setContent(c);b.show()}else{ta.util.error.record(null,"injectReviewSummaryContent - no overlay")}}catch(d){ta.util.error.record(d,"injectReviewSummaryContent")}},storeReviewSummaryContent:function(d,c){var b=ta.retrieve("topconcepts.rsContent");if(!b){b={}}b[d]=c;ta.store("topconcepts.rsContent",b)},addSummaryBoxContentAndShow:function(d,g){try{var h=ta.retrieve("reviewSummaryOverlay");ta.overlays.Factory.injectReviewSummaryContent(g);var c=null;var k=ta.id("TRAV_SAY_TERMS");if(typeof(k)!=undefined&&k!=null){var b=k.clone(true,false);b.addClass("col1of2");c=new Element("div",{"class":"wrap bx02 rd_concepts"});c.adopt(b)}else{c=ta.id("SUMMARYBOX").clone(true,false)}var j=h.inner;j.getElement(".title").adopt(c);var l="concept_"+d.replace(/ /g,"_");var i=document.getElement(".overlay .rd_concepts ."+l);if(i){i.removeClass("taLnk").removeClass("hvrIE6").addClass("conceptSelected").onClick=""}Array.each(j.getElements(".rd_concepts .snippetText"),function(e){var n=ta.id(e);n.removeClass("snippetText");n.removeClass("sprite-middot");n.removeClass("trip_type_snippet");n.addClass("conceptBullet");var m=n.getElement(".taLnk");if(m){m.setProperty("onclick","ta.util.cookie.setPIDCookie(25223);ta.call('ta.overlays.Factory.showReviewSummaryV2',event, this);")}});ta.overlays.Factory.storeReviewSummaryContent(d,j.get("html"));ta.overlays.Factory.injectReviewSummaryContentFromConcept(d)}catch(f){ta.util.error.record(f,"updateReviewSummaryContent - request.onSuccess")}},updateReviewSummaryContent:function(c,b){try{if(ta.has("reviewSummaryOverlay")&&ta.has("topconcepts.rsContent")&&ta.retrieve("topconcepts.rsContent")[c]){ta.overlays.Factory.injectReviewSummaryContentFromConcept(c);return}if(ta.has("reviewSummaryOverlay")){new Request({url:b,onSuccess:function(e){ta.overlays.Factory.addSummaryBoxContentAndShow(c,e)},evalScripts:true,method:"get"}).send();return}else{ta.util.error.record(null,"updateReviewSummaryContent - no overlay")}}catch(d){ta.util.error.record(d,"updateReviewSummaryContent")}},getReviewSummaryUrl:function(f,e,i,c){ta.store("topconcepts.lastconcept",f);if(typeof modelLocId=="undefined"||typeof modelGeoId=="undefined"){var h=(typeof modelLocId=="undefined")?"undefined":modelLocId;var d=(typeof modelGeoId=="undefined")?"undefined":modelGeoId;ta.util.error.record(null,"getReviewSummaryUrl",null,{locId:h,geoId:d})}if(i&&c){ta.util.cookie.setPIDCookie(16007);var g="/MachineTranslation?";if(e.id){var f;if(e.id.indexOf("trans_")!=-1){f=e.id.replace("trans_","").replace(/_/g," ")}else{f=e.id.replace("concept_","").replace(/_/g," ")}ta.store("topconcepts.lastconcept",f);g+="page=summary&";g+="d="+modelLocId+"&";g+="concept="+f;g+="&sl=en&tl="+i}return g}var b="/HotelSummary?d="+modelLocId+"&geo="+modelGeoId+"&concept="+f;if(i){b+="&autotrans=true"}return b},getReviewSummaryConcept:function(b){try{var c=b.id?b.id:b.className.match("(concept_[a-zA-Z0-9-_]+)")[1];return c.replace("concept_","").replace(/_/g," ")}catch(d){ta.util.error.record(d,"getReviewSummaryConcept",null,{id:b.id,"class":b.className})}return""},showReviewSummaryV2:function(h,e,g,c){if(h){h.stop()}var f=ta.overlays.Factory.getReviewSummaryConcept(e);var b=ta.overlays.Factory.getReviewSummaryUrl(f,e,g,c);if(ta.has("reviewSummaryOverlay")){ta.overlays.Factory.updateReviewSummaryContent(f,b);return}ta.overlays.Factory._loadSummaryCss();var d=new ta.overlays.CenteredOverlay({style:"s3 dg nopadding rgba_gry",autoShow:false,permanent:true,showCloseButton:true,remoteContent:b,onLoad:function(i){try{ta.store("topconcepts.overlay."+f,this);ta.overlays.Factory.addSummaryBoxContentAndShow(f,this.inner.innerHTML);this.show()}catch(j){ta.util.error.record(j,"showReviewSummary - overlay onload")}}},e);ta.store("reviewSummaryOverlay",d)}})})(ta.overlays.Factory);ta.overlays.CalendarOverlay=new Class({Extends:ta.overlays.RelativeOverlayBelow,options:{showCloseButton:true,activate:ta.overlays.ACTIVATE_FOCUS,style:"typeO ocal",autoShow:false,autoShowCal:false,calendarOptions:null,flipPadding:25,zIndex:999,extraShow:null},initialize:function(a,b){this.input=a.getElement("input[type=text]");this.parent(b,this.input);this.input.overlay=this;this.dayField=a.getElement("input.day");this.monthField=a.getElement("input.month");this.source.addEvent("click",this.show);this.icn=a.getElement("span.icn");if(this.icn){this.icn.onclick="";this.icn.addEvent("click",this.show)}var c=a.className.search("first")>=0;this.calendar=new ta.widgets.Calendar(Object.merge({dualCalendar:true,choiceLink:"ta.overlays.calendarSelect",prevAction:"ta.overlays.calendarPrev",nextAction:"ta.overlays.calendarNext",onSelect:this.select.bind(this),onClear:this.clear.bind(this),isFirstCal:c},this.options.calendarOptions));this.inner.adopt(this.calendar.container);this.parentOverlay=a.getParent(".overlay");if(this.parentOverlay){this.parentOverlay=this.parentOverlay.overlay;this.options.isChild=true}if(this.options.autoShowCal){this.show()}},destroy:function(){this.parent();this.input.overlay=null},show:function(c,a){if(this.options.extraShow){this.options.extraShow(this)}this.input.addClass("selected");var b=this.visible;this.parent(c);if(b&&!a){return}if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==ta.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}this.loadFields();this.calendar.update();this.calendar.reposition();return this},hide:function(a){if(!this.visible){return}this.parent(a);if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}},hideNow:function(a){this.input.removeClass("selected");if(!this.visible){return this}this.parent(a);if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}},select:function(a,b){if(b){new Event(b).preventDefault()}this.updateFields();if(!a.options.dontHideOnSelect){this.hide()}this.fireEvent("onSelect",this,!!b)},hover:function(b,a){this.fireEvent("onHover",[b,this,a])},mouseout:function(a){this.fireEvent("onMouseOutOnDate",[this,a])},clear:function(a,b){b&&new Event(b).preventDefault();this.clearFields();this.hide();this.fireEvent("onClear",this)},loadFields:function(){var b=parseInt(this.dayField.value.replace(/^0/,""));var a=this.monthField.value.split(/\//);if(a.length!=2){return}var c=parseInt(a[1]);if(ta.retrieve("thai_buddhist_era_year")&&c>=(new Date().getFullYear()+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET)){c-=ta.util.date.THAI_BUDDHIST_YEAR_OFFSET}a=parseInt(a[0].replace(/^0/,""));this.calendar.selectedDate=ta.util.date.create(c,a-1,b);return this},updateFields:function(){if(!this.calendar.selectedDate){this.loadFields()}if(!this.calendar.selectedDate){return}var a=this.calendar.selectedDate.getMonth()+1;if(a<10){a="0"+a}this.dayField.value=this.calendar.selectedDate.getDate();this.monthField.value=a+"/"+this.calendar.selectedDate.getFullYear();var b=this.calendar.selectedDate.getFullYear();if(ta.retrieve("thai_buddhist_era_year")){b=b+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET}this.input.value=formatDate(this.calendar.selectedDate.getDate(),this.calendar.selectedDate.getMonth(),b)},clearFields:function(){if(this.options.calendarOptions&&!this.options.calendarOptions.clearToBlank){this.input.value=JS_DateFormat}else{if(this.input.value==this.input.defaultValue){this.input.value=""}}},clearDateFields:function(){this.calendar.selectedDate=null;this.dayField.value="";this.monthField.value="";this.clearFields()},resetFieldsIfBlank:function(){if(this.input.value==""){this.input.value=this.input.defaultValue}},validate:function(){var b=this.input.value.match(DATE_FORMAT.pattern);if(b){var c=parseInt(b[DATE_FORMAT.date].replace(/^0/,""));var a=parseInt(b[DATE_FORMAT.month].replace(/^0/,""));var d=parseInt(b[DATE_FORMAT.year].replace(/^0/,""));if(c>0&&c<32&&a>0&&a<13){if(c<10){c="0"+c}if(a<10){a="0"+a}if(d<100){d+=2000}this.dayField.value=c;this.monthField.value=a+"/"+d;this.loadFields();if(!this.calendar.isValid()){return sInvalidDates}}else{return sInvalidDates}}else{return sInvalidDates}return null}});ta.overlays.createCalendar=function(b,a){new Event(b).preventDefault();a.onfocus="";new ta.overlays.CalendarOverlay($(a).getParent(".cal"),{autoShowCal:true})};ta.overlays.createCustomCalendar=function(c,b,a){new Event(c).preventDefault();b.onfocus="";new ta.overlays.CalendarOverlay($(b).getParent(".cal"),{autoShowCal:true,calendarOptions:a})};ta.overlays.calendarSelect=function(f,e,a,c,b){if(ta.has("checkrates.calendarActionRecord")){ta.util.cookie.removePIDCookie();ta.meta.linkTracking.actionRecord(ta.retrieve("checkrates.calendarActionRecord"))}if(ta.has("rac.calendarEventRecord")){ta.trackEventOnPage(ta.retrieve("rac.calendarEventRecord"),"rac_picker_click","date",1)}ta.id(b).getParent(".overlay").overlay.calendar.select(f,ta.util.date.create(e,a,c));if(ta.has("checkrates.meta_calendar_style_on_classic")&&(Browser.ie||Browser.chrome)){ta.popups.PopUtil.attemptHoldingWindow(ta.meta.cr.getPropIdFromCRElement(ta.id(b).getParent(".overlay").overlay.input))}};ta.overlays.calendarPrev=function(b,a){ta.id(a).getParent(".overlay").overlay.calendar.prev()};ta.overlays.calendarNext=function(b,a){ta.id(a).getParent(".overlay").overlay.calendar.next()};ta.overlays.PairedCalendar=new Class({Implements:[Options,Events],options:{validate:false,validateFun:function(){},allowSameDay:false,calendarOptions:null,defaultSpan:1,keepDelta:false,clearDatesId:"clearDates",overlayOptions:{},overlayFirstOptions:null,disallowChars:false,disableInvalidEndDates:false,showCalIfInvalid:false,clearOnRestart:false,allowReverse:false},initialize:function(b,a){this.setOptions(a);b=ta.id(b);this.form=b.get("tag")=="form"?b:b.getParent("form");var c=Object.merge({onSelect:this.adjustRange.bind(this)},this.options.overlayOptions);if(this.options.calendarOptions){c.calendarOptions=this.options.calendarOptions}this.form.getElements(".cal").each(function(d){var f;if(d.hasClass("first")&&this.options.overlayFirstOptions){f=new ta.overlays.CalendarOverlay(d,Object.merge(Object.clone(c),this.options.overlayFirstOptions))}else{f=new ta.overlays.CalendarOverlay(d,c)}f.input.onfocus="";if(this.options.disallowChars){f.input.addEvent("keypress",this.validateInput.bind(this))}if(d.hasClass("first")){this.before=f}else{this.after=f;if(ta.has("isDaoDaoCRRedesign")){var e=this.form.get("qc_area");this.after.qcArea=e;this.before.qcArea=e}}},this);if(ta.retrieve("isDaoDao")){ta.store("cal_in",this.before);ta.store("cal_out",this.after)}this.after.theOtherCal=this.before;this.before.theOtherCal=this.after;this.after.calendar.theOtherCal=this.before.calendar;this.before.calendar.theOtherCal=this.after.calendar;if(b===this.before.input||b===this.before.icn){this.after.loadFields();if(this.before.options.autoShowCal){this.before.show()}}else{if(b===this.after.input||b===this.after.icn){this.before.loadFields();if(this.after.options.autoShowCal){this.after.show()}}}if(this.form){this.form.calendar=this;if(this.options.validate){this.form.addEvent("submit",this.validate.bind(this));this.errorDiv=this.form.getElement(".error_msg")}}},getOverlayForCalendar:function(a){if(this.before.calendar==a){return this.before}if(this.after.calendar==a){return this.after}return null},adjustRange:function(c){this.requireFullLoad();if(this.form.searchAll){if(this.form.searchAll.type=="checkbox"){this.form.searchAll.checked=false}else{if(this.form.searchAll.type=="hidden"){this.form.searchAll.value="false"}}}var b=ta.id(this.options.clearDatesId);if(b){b.style.visibility="visible"}var h=false;if(this.options.clearOnRestart&&c===this.before){this.after.clearDateFields()}else{if(this.options.allowReverse&&c===this.after&&this.before.calendar.selectedDate&&this.after.calendar.selectedDate.getTime()<this.before.calendar.selectedDate.getTime()){var k=this.before.calendar.selectedDate;this.before.calendar.selectedDate=this.after.calendar.selectedDate;this.after.calendar.selectedDate=k;this.before.updateFields();this.after.updateFields()}else{if(!this.sameDayEnabled()&&!this.options.disableInvalidEndDates&&this.after.calendar.selectedDate&&this.after.calendar.selectedDate.getTime()==this.after.calendar.options.firstDate.getTime()){this.before.calendar.selectedDate=new Date(this.before.calendar.options.firstDate);if(this.options.keepDelta){this.options.defaultSpan=1}var k=new Date(this.after.calendar.options.firstDate);k.setDate(k.getDate()+this.options.defaultSpan);this.after.calendar.selectedDate=k;this.before.updateFields();this.after.updateFields()}else{if(c==this.before){if(this.options.keepDelta||!this.isBeforeValid()){var k=new Date(this.before.calendar.selectedDate);k.setDate(k.getDate()+this.options.defaultSpan);this.after.calendar.selectedDate=k;h=true}this.after.updateFields()}else{if(c==this.after){if(!this.isAfterValid()){var k=new Date(this.after.calendar.selectedDate);k.setDate(k.getDate()-this.options.defaultSpan);if(k.getTime()<this.before.calendar.options.firstDate.getTime()){k=new Date(this.before.calendar.options.firstDate.getTime())}this.before.calendar.selectedDate=k}this.before.updateFields()}}}if(this.options.keepDelta&&this.before.calendar.selectedDate){this.options.defaultSpan=ta.util.date.getDaysInRange(this.before.calendar.selectedDate,this.after.calendar.selectedDate)-1;if(this.sameDayEnabled()){if(this.options.defaultSpan<0){this.options.defaultSpan=0}}else{if(this.options.defaultSpan<1){this.options.defaultSpan=1}}}}}this.fireEvent("onUpdate",this);var g=ta.retrieve("calendar.onUpdateCallback");if(g){for(var f=0;f<g.length;f++){if(window[g[f]]){window[g[f]](this,c)}}}this.updateMinStay(this.before.calendar.selectedDate,this.after.calendar.selectedDate);try{var a="before";if(c==this.after){a="after"}}catch(j){ta.util.error.record(j,"availability check - paired cal")}if(this.options.disableInvalidEndDates){if(c==this.before){var k=new Date(this.before.calendar.selectedDate);k.setDate(k.getDate()+1);this.after.calendar.options.firstDate=k;if(h){this.after.show()}}}},updateMinStay:function(a,c){var b=ta.id("minStay");if(b&&a&&c){b.disabled=true;b.selectedIndex=this.getMinStayIndex(a,c)}},getMinStayIndex:function(a,c){var b=ta.util.date.getDaysInRange(a,c)-1;if(b<7){return b}else{if(b<28){return 7}else{return 8}}},isOneWay:function(){return this.form.oneWay&&this.form.oneWay.checked},sameDayEnabled:function(){return this.options.allowSameDay||this.isOneWay()},searchAllEnabled:function(){return this.form.searchAll&&(this.form.searchAll.checked||(this.form.searchAll.type=="hidden"&&this.form.searchAll.value=="true"))},updateFields:function(){this.before.updateFields();this.after.updateFields()},clearFields:function(){this.before.clearDateFields();this.after.clearDateFields()},resetFieldsIfBlank:function(){this.before.resetFieldsIfBlank();this.after.resetFieldsIfBlank()},requireFullLoad:function(){if(!this.before.calendar.selectedDate){this.before.loadFields()}if(!this.after.calendar.selectedDate){this.after.loadFields()}},isBeforeValid:function(){this.requireFullLoad();if(!this.after.calendar.selectedDate){return true}return(this.before.calendar.selectedDate<this.after.calendar.selectedDate)||(this.sameDayEnabled()&&this.before.calendar.selectedDate.getTime()<=this.after.calendar.selectedDate.getTime())},isAfterValid:function(){this.requireFullLoad();if(!this.before.calendar.selectedDate){return true}return(this.after.calendar.selectedDate>this.before.calendar.selectedDate)||(this.sameDayEnabled()&&this.after.calendar.selectedDate.getTime()>=this.before.calendar.selectedDate.getTime())},validateInput:function(a){if(a.key.match(/^[a-zA-Z]$/)){a.preventDefault()}},validate:function(g){if(this.searchAllEnabled()){return true}var a=this.before.validate();var b=this.after.validate();var d=true;if(this.isOneWay()){if(a!=null){d=false;this.setError(a)}}else{if(a!=null||b!=null){d=false;this.setError(a||b)}else{if(!this.isAfterValid()){d=false;this.setError(sInvalidDates)}}}if(!d&&g){new Event(g).stop()}if(this.options.showCalIfInvalid){var f;if(a!=null){f=this.before}else{if(b!=null||!d){f=this.after}}if(f){f.input.value="";f.selectedDate=new Date();f.updateFields();f.show()}}if(d&&this.options.validateFun&&typeof this.options.validateFun==="function"){try{return this.options.validateFun(g)}catch(c){ta.util.error.record(c,"post-validation callback function failed in PairedCalendar",g);return d}}else{return d}},setError:function(a){if(!this.errorDiv){return}this.errorDiv.setContent(a).show()},toggleSearchAll:function(){if(this.searchAllEnabled()){this.before.clearFields();this.after.clearFields()}else{this.requireFullLoad();this.before.updateFields();this.after.updateFields()}}});ta.overlays.createSimplePairedCalendar=function(b,a){new Event(b).stop();new ta.overlays.PairedCalendar(a)};ta.overlays.createPairedCalendar=function(f,c,b){if(!b){b={validate:true}}new Event(f).preventDefault();var e;if(ta.isMetaHomepageIntegration2013()||ta.isMetaHotel2013()||ta.isMetaHotels2013()){var d=b.inline;var a=typeof b.skipHAC!=="undefined"&&b.skipHAC!=null&&b.skipHAC;b.clearOnRestart=true;b.allowReverse=true;b.overlayOptions={showCloseButton:false,style:"date_picker_calendar paired",noPadding:true,noCpu:true};b.calendarOptions={prevStyle:"sprite-date_picker-btnLeftIdle",nextStyle:"sprite-date_picker-btnRightIdle",showRange:true};b.onUpdate=function(g){ta.widgets.calendar.setPageInDate(g.before.calendar.selectedDate);ta.widgets.calendar.setPageOutDate(g.after.calendar.selectedDate);if(g.before.calendar.selectedDate&&g.after.calendar.selectedDate){if(ta.isMetaHotels2013()&&!a){ta.servlet.HACSearch.doMetaDateSearch()}else{if(d){ta.widgets.calendar.launchInlineMeta(f)}}}};if(b.clearDates){delete b.clearDates;b.calendarOptions.postContent=function(){var g=Elements.from('<div id="SKIP_DATES"><span class="skip_dates_text"><span class="taLnk">'+ta.retrieve("multiDP.skipDates")+"</span></span></div>")[0];g.getElement(".taLnk").addEvent("click",function(){var i=ta.overlays.getCurrent();if(i){i.clearDateFields();i.theOtherCal&&i.theOtherCal.clearDateFields();i.hide()}var h=ta.id("SUBMIT_HOTELS");if(h){h.focus()}ta.widgets.calendar.clearPageDates();ta.widgets.calendar.clearSessionDates();ta.overlays.Factory.trackSkipDatesEvent("Meta_Homepage","Calendar","Skip dates",0)});return g}}e=new ta.overlays.PairedCalendar(c,b);e.before.addEvent("onSelect",function(h,g){e.after.input.focus()})}else{e=new ta.overlays.PairedCalendar(c,b)}return e};ta.overlays.clearFields=function(a){if(a.calendar){a.calendar.clearFields()}};ta.overlays.resetFieldsIfBlank=function(a){if(a.calendar){a.calendar.resetFieldsIfBlank()}};ta.overlays.toggleOffSearchAll=function(a){if(a.calendar&&a.searchAll){if(a.searchAll.type=="checkbox"){a.searchAll.checked=false}else{if(a.searchAll.type=="hidden"){a.searchAll.value="false"}}a.calendar.toggleSearchAll()}};ta.overlays.toggleOnSearchAll=function(a){a=ta.id(a);var b=a.getParent("form");if(!b.calendar){new ta.overlays.PairedCalendar(a,{validate:true,clearDatesId:a})}if(b.calendar&&b.searchAll){if(b.searchAll.type=="checkbox"){b.searchAll.checked=true}else{if(b.searchAll.type=="hidden"){b.searchAll.value="true"}}b.calendar.toggleSearchAll()}};ta.overlays.toggleSearchAll=function(d,b,a){b=ta.id(b);b.onclick="";var c=b.getParent("form");if(!a){a={validate:true}}if(!c.calendar){new ta.overlays.PairedCalendar(b,a)}c.calendar.toggleSearchAll(b);b.addEvent("click",c.calendar.toggleSearchAll.bind(c.calendar))};ta.overlays.clearDates=function(c,a){ta.overlays.toggleOnSearchAll(a);ta.id(a).style.visibility="hidden";var b=ta.id("minStay");if(b!==null){b.disabled=false;b.selectedIndex=0;filtersChanged(c)}};ta.overlays.PermanentOverlay=new Class({Extends:ta.overlays.AbsoluteOverlay,initialize:function(a,b){this.parent(Object.merge({permanent:true},a),b)}});ta.overlays.SkinnyOverlay=new Class({Extends:ta.overlays.RelativeOverlayBelow,initialize:function(a,b){this.parent(a,b);this.container.setStyle("max-width","120px");if(Browser.ie6){this.shim.setStyle("max-width","120px")}if(this.transparentOverlayPadding){this.transparentOverlayPadding.setStyle("max-width","120px")}}});ta.overlays.Registration=new Class({Implements:[Options,Events],Binds:["response","failure"],options:{flow:null,url:"/Registration",isOverlay:true,pageTarget:null,responseCallback:null,completeCallback:null,customOverlayOptions:{},noreload:false,failureCloseHandler:null},initialize:function(a){this.setOptions(a);if(this.options.isOverlay){this.overlay=new ta.overlays.CenteredOverlay(Object.merge({backdrop:ta.overlays.BACKDROP_ALWAYS,autoShow:false,style:"s4 dg",attachCloseEvent:false},this.options.customOverlayOptions));if(this.overlay.closeBtn){this.overlay.closeBtn.addEvent("click",this.cancel.bind(this))}}},getRequestData:function(){var b={flow:this.options.flow};if(ta.has("registration.data")){b=Object.merge(b,ta.retrieve("registration.data"))}if(ta.has("page.geo")){b.geo=ta.retrieve("page.geo")}b.source=pageServlet;b=[b];Array.from(arguments).each(function(c){b.push(c)});if(ta.has("rsa")){b.push({encrypted:ta.retrieve("rsaVersion")});var a=ta.retrieve("rsa");b.forEach(function(c){if(c.pass){try{b.push({epass:a.encrypt(c.pass.value)})}catch(d){ta.util.error.record(d,"Encrypted Signin - encrypting sign-in/sign-up form parameters")}}})}return b},request:function(c,b){ta.store("registration.method","request");var a={url:ta.util.URL.https(this.options.url),method:"get",withCredentials:ta.retrieve("access_control_headers"),evalScripts:true,data:this.getRequestData(b,{action:c}),onSuccess:this.response,onFailure:this.failure};if(ta.has("registration.ga_module")){a.trackEvent={module:ta.retrieve("registration.ga_module"),action:c+"_Show",context:this.options.flow}}new Request(a).send();return this},post:function(b){var a=this;if(ta.has("registration.ga_module")){ta.trackEventOnPage(ta.retrieve("registration.ga_module"),b.action.value+"_Submit",a.options.flow,1,false)}ta.util.pending.waitFor(function(){return !ta.has("rsaLoading")},function(){if(ta.has("facebook.authcode.param")){b=Object.merge(b,{FBAuthCode:ta.remove("facebook.authcode.param")})}ta.store("registration.method","post");new Request({url:ta.util.URL.https(a.options.url),method:"post",withCredentials:ta.retrieve("access_control_headers"),evalScripts:true,data:a.getRequestData(b,{noreload:a.options.noreload}),onSuccess:a.response,onFailure:a.failure}).send()},100);return this},cancel:function(){ta.store("registration.method","cancel");new Request({url:ta.util.URL.https(this.options.url),method:"get",withCredentials:ta.retrieve("access_control_headers"),evalScripts:true,data:this.getRequestData({CANCEL:"y",action:ta.retrieve("registration.action"),noreload:this.options.noreload}),onSuccess:this.response,onFailure:this.failure}).send();return this},log:function(a){new Request({url:ta.util.URL.https(this.options.url),method:"get",withCredentials:ta.retrieve("access_control_headers"),evalScripts:false,data:this.getRequestData({action:"LOG",pageAction:a})}).send();return this},response:function(a){if(!ta.remove("registration.noop")){if(this.options.isOverlay){this.overlay.loadRemoteSuccess(a);if(this.overlay.visible){this.overlay.position()}else{this.overlay.show()}}else{this.options.pageTarget.setContent(a)}}if(this.options.responseCallback){setTimeout(this.options.responseCallback,1)}if(ta.has("registration.afterUpdate")){ta.remove("registration.afterUpdate").each(function(b){setTimeout(b,1)})}},close:function(){if(this.options.isOverlay){this.overlay.hide()}this.fireEvent("onComplete");if(this.options.completeCallback){this.options.completeCallback()}},failure:function(c){var a=0;var d=ta.remove("registration.method");try{a=c.status}catch(b){}if(a==503){this.overlay.loadRemoteSuccess('<div style="padding:6px;">'+JS_maintenance+"</div>");if(!this.overlay.closeBtn&&this.options.failureCloseHandler){this.overlay.addCloseButton()}if(this.overlay.closeBtn){this.overlay.closeBtn.removeEvents("click");this.overlay.closeBtn.addEvent("click",this.options.failureCloseHandler||ta.overlays.registration.close)}if(this.overlay.visible){this.overlay.position()}else{this.overlay.show()}}else{if(d=="cancel"){ta.overlays.registration.close()}ta.util.error.ajaxFailure.partial("Registration:"+d)}}});ta.overlays.registration={getInstance:function(a){var b=ta.retrieve("registration.instance");if(!b){if(typeof(regflowCss)!="undefined"&&!ta.retrieve("ta.regflowCss")){ta.store("ta.regflowCssAsset",Asset.css(regflowCss))}b=new ta.overlays.Registration(a);ta.store("registration.instance",b)}return b},connect:function(a,d,c){if(typeof(regflowCss)!="undefined"&&!ta.retrieve("ta.regflowCss")){ta.store("ta.regflowCssAsset",Asset.css(regflowCss))}if(ta.has("facebook.available")&&ta.retrieve("facebook.available")){var e={fbAvailable:true}}else{if(ta.has("registration.forceFBAvailable")){var e={fbAvailableForce:ta.remove("registration.forceFBAvailable")}}}var b="SIGNIN";ta.remove("registration.data");ta.overlays.registration.getInstance(a).request(d||b,Object.merge({},c,e))},post:function(b,a){var c=a||window.event;if(c){new Event(c).stop()}ta.overlays.registration.getInstance().post(b)},request:function(c,b,a){if(c=="SIGNUP"||c=="SIGNIN"){b=Object.merge({fbAvailable:ta.has("facebook.available")&&ta.retrieve("facebook.available")},b)}ta.overlays.registration.getInstance(a).request(c,b)},deferredRequest:function(d,b,e,c,a){ta.overlays.registration.getInstance(a).request(e,c,a)},cancel:function(){ta.overlays.registration.getInstance().cancel(false)},log:function(a){ta.overlays.registration.getInstance().log(a)},close:function(){var a=ta.remove("registration.instance");if(a){a.close()}},switchFlow:function(a){ta.overlays.registration.getInstance().options.flow=a},logAndPost:function(a,c,b){ta.overlays.registration.getInstance(a).log(c).post(b)},postSignupForm:function(d,c){var f=c||window.event;if(f){new Event(f).stop()}if(ta.has("checkPasswordReqs")){var a=ta.id("pass");var b=new RegExp("(?=^.{8,}$)(?=.*\\d)(?=.*[A-Z]).*$");if(b.test(a.value)==false){ta.id("passError").show();ta.id("passInfo").hide();return}}ta.overlays.registration.getInstance().post(d)}};ta.servlet.Registration={realNameDone:function(a){if(ta.id("use_real_name")&&ta.id("use_real_name").getProperty("checked")||ta.id("chooseNameFB")||ta.id("chooseNameGoogle")){ta.overlays.registration.post(ta.id("RealName"),a)}else{ta.overlays.registration.cancel()}},screenEdit:function(a){ta.id("screen").set("value","");ta.id("screen").focus();ta.id(a).hide()},displayLoading:function(){if(window.CDNHOST!=null){ta.id("buttonArea").innerHTML='<img class="loadingGif" src="'+CDNHOST+'/img2/generic/site/loading_anim_gry_sml.gif" />'}else{ta.id("submitButton").set("disabled",true)}},trackEmailOpt:function(a,b){if(a){if(!a.checked){ta.trackEventOnPage("register","sign_up_"+b,"email_opt_out")}}},toggleProgressCircle:function(b){var a=ta.id("circleContainer_"+b);if(a){if(a.hasClass("progressCircleChecked")){a.removeClass("progressCircleChecked");a.addClass("progressCircle");a.innerHTML=b}else{a.removeClass("progressCircle");a.addClass("progressCircleChecked")}}},toggleProgressBar:function(a){var b=ta.id("barContainer_"+a);if(b){if(b.hasClass("filled")){b.removeClass("filled")}else{b.addClass("filled")}}},toggleProgressElement:function(a,b,c){if(a&&a<=b){if(c=="Bar"){this.toggleProgressBar(a)}else{if(c=="Circle"){this.toggleProgressCircle(a)}}}},toggleTagged:function(c,b,f,e){if(c&&ta.id("tagContainer_"+c)){var a=ta.select(".tagSelection:checked").length;var d=ta.id("tagContainer_"+c);if(d.hasClass("tagged")){d.removeClass("tagged");this.toggleProgressElement(a,b,e);if(ta.id("tag_"+c).checked){ta.id("tag_"+c).checked=false;this.activateMemberTagSubmit(f)}}else{d.addClass("tagged");this.toggleProgressElement(a+1,b,e);if(!ta.id("tag_"+c).checked){ta.id("tag_"+c).checked=true;this.activateMemberTagSubmit(f)}}}},activateMemberTagSubmit:function(c){var b=1;var a=ta.id("submitBtn");if(c){b=0}if(a&&ta.select(".tagSelection:checked").length>=b){a.addClass("active")}else{if(a){a.removeClass("active")}}},submitMemberTags:function(j,c){var b;var a=(b=ta.select(".tagSelection:checked"))?b.length:0;var i=(b=ta.id("memberTagsPlacementPid"))?b.value:0;var m=(b=ta.id("memberTagsIsSecure"))&&(b.value=="true");var d=(b=ta.id("memberTagsIsEditFlow"))&&(b.value=="true");var n=(b=ta.id("memberTagsForceAjax"))&&(b.value=="true");var l=(b=ta.id("memberTagsOnSuccess"))?b.value:"";var p=ta.servlet.Registration[l];var h=$(j);if(!h||!h.hasClass("active")){return}var f=h.hasClass("skipBtn");var k=ta.id("submitBtn");if(k){k.removeClass("active")}var o=ta.id("skipBtn");if(o){o.removeClass("active")}ta.trackEventOnPage("self_tags",c,i,a);if(d&&f&&("undefined"!==typeof(oxapp))&&oxapp.getSubview("modules.membercenter.MemberTag")){if(k){k.addClass("active")}if(o){o.addClass("active")}var g=oxapp.getSubview("modules.membercenter.MemberTag");if(g.context&&g.context.get("MemberCenter_MemberTags")&&g.context.get("MemberCenter_MemberTags")._items&&g.context.get("MemberCenter_MemberTags")._items.length==0){g.taggedItems=[]}g.taggingOverlay.hide();return}if(f){var q=ta.id("tagCancel");if(q){q.value=true}}if(m&&!n){ta.overlays.registration.getInstance().post(ta.id("SELF_TAG_FORM")).response(function(){if(k){k.addClass("active")}if(o){o.addClass("active")}})}else{new Request({url:"/MemberTagsAjax",method:"post",data:ta.id("SELF_TAG_FORM"),onSuccess:function(e){if(k){k.addClass("active")}if(o){o.addClass("active")}if("function"===typeof(p)){p(e)}},onFailure:function(e){if(k){k.addClass("active")}if(o){o.addClass("active")}if(("undefined"!==typeof(oxapp))&&oxapp.getSubview("modules.membercenter.MemberTag")){oxapp.getSubview("modules.membercenter.MemberTag").taggingOverlay.hide()}}}).send()}var q=ta.id("tagCancel");if(q){q.value=""}},memberTagsSuccessMemberCenter:function(c){if(("undefined"===typeof(oxapp))||!oxapp||!c){return}var a,b=(a=ta.id("memberTagsIsEditFlow"))&&(a.value=="true");if(b&&oxapp.context&&oxapp.context.get("MemberCenter_MemberTags")){oxapp.context.get("MemberCenter_MemberTags").fetch().always(function(){if(oxapp.getSubview("modules.membercenter.MemberTag")){oxapp.getSubview("modules.membercenter.MemberTag").render()}})}if(oxapp.getSubview("modules.membercenter.MemberTag")){oxapp.getSubview("modules.membercenter.MemberTag").taggingOverlay.hide()}},memberTagsRedirectCompletionUrl:function(b){var a=ta.id("memberTagsCompletionUrl");if(a&&a.value){window.location.href=a.value}}};ta.overlays.PopoutOverlay=new Class({Extends:ta.overlays.Overlay,options:{backdrop:ta.overlays.BACKDROP_ALWAYS,showCloseButton:true},initialize:function(a,b){this.parent(a,b);this.placeholder=new Element("div").inject(this.source,"before").adopt(this.source);this.placeholder.setStyles({marginBottom:this.source.style.marginBottom,marginTop:this.source.style.marginTop});this.source.setStyles({marginBottom:0,marginTop:0});if(this.options.showCloseButton){this.closeBtn.addEvent("click",this.hide)}this.show()},show:function(a){this.sourceCoords=this.source.getCoordinates();this.placeholder.setStyles({width:this.sourceCoords.width,height:this.sourceCoords.height});this.inner.adopt(this.source);this.parent(a)},hide:function(a){this.parent(a);this.placeholder.adopt(this.source).setStyles({width:"auto",height:"auto"})},position:function(){var b=parseInt(this.container.getStyle("borderTopWidth").replace(/px/,""));var a=parseInt(this.container.getStyle("borderLeftWidth").replace(/px/,""));this.container.setStyles({left:this.sourceCoords.left-a,top:this.sourceCoords.top-b,width:this.sourceCoords.width,display:"block"});this.parent()}});ta.overlays.PopoutWithOverlay=new Class({Extends:ta.overlays.Overlay,options:{position:"topleft",edge:"topright",offset:{x:-10,y:0},scrollOffset:-20,backdrop:ta.overlays.BACKDROP_ALWAYS,showCloseButton:true},initialize:function(a,b){this.parent(a,b);this.placeholder=new Element("div").inject(this.source,"before").adopt(this.source);this.popout=new Element("div",{styles:{position:"absolute",zIndex:"10002",fontSize:"0.75em",display:"none"}}).inject(document.body);if(this.options.showCloseButton){this.closeBtn.addEvent("click",this.hide)}this.show()},show:function(b){this.parent(b);var a=this.source.getCoordinates();this.placeholder.setStyles({width:a.width,height:a.height,marginBottom:this.source.style.marginBottom,marginTop:this.source.style.marginTop});this.popout.setStyles({left:a.left,top:a.top,width:a.width,display:"block"}).adopt(this.source)},hide:function(a){this.parent(a);this.placeholder.adopt(this.source).setStyles({width:"auto",height:"auto"});this.popout.setStyle("display","none")},position:function(){var a=this.source.getCoordinates();this.container.setStyles({left:null,top:a.top+this.options.offset.y,right:window.getWidth()-(a.left+this.options.offset.x)});this.parent();window.scrollTo(0,a.top+this.options.offset.y+this.options.scrollOffset)}});ta.overlays.CoverOverlay=new Class({Extends:ta.overlays.Overlay,options:{autoShow:true,xOff:0,yOff:0},initialize:function(a,b){this.parent(a,b);if(this.options.showCloseButton){this.closeBtn.addEvent("click",this.hide)}if(this.options.autoShow){this.show()}},position:function(){var b=this.source.getCoordinates();var a=this.container.getCoordinates();this.container.setStyles({left:b.left+(b.width/2-a.width/2)+this.options.xOff,top:b.top+(b.height/2-a.height/2)+this.options.yOff})},updateBackdrop:function(){var a=this.source.getCoordinates();this.backdrop.setStyles({left:a.left,top:a.top,width:a.width,height:a.height})}});ta.overlays.SpecialDropDownWithRangeOverLay=new Class({Extends:ta.overlays.RelativeOverlayBelow,options:{onClose:false,onShow:false},initialize:function(a,b){var c="";if(b.id&&(b.id==="vrPriceMinDropDown"||b.id==="vrPriceMaxDropDown"||b.id==="vrPricePeriodDropDown")){c="vrPriceDropDown"}this.parent(Object.merge({below:true,innerDivClass:"",style:c,autoShow:false},a),b);this.container.removeClass("relative");if(a.onClose){this.options.onClose=a.onClose}if(a.onShow){this.options.onShow=a.onShow}},show:function(h){if(this.visible){this.hide();return}try{this.options.onShow()}catch(g){}var b=h.srcElement?h.srcElement:h.target;if(b){this.source=b}if(this.options.sourceId){this.source=ta.id(this.options.sourceId);this.source.addClass("selected")}var d=ta.select(".overlay");for(var f=0;f<d.length;f++){var c=d[f];if(c.contains(this.source)){var a=c}}if(a){this.container.setStyle("z-index",a.getStyle("z-index")+1)}document.addEvent("click",this.hide);this.parent(h)},hide:function(b){if(this.options.onClose){try{this.options.onClose()}catch(a){}}if(this.options.rangeInputClass){try{if(this.options.closeOnlyIfClick&&!b){return}if(this.container.getElements("."+this.options.rangeInputClass)[0].contains(b.target)){return}}catch(a){}}this.hideNow()},hideNow:function(a){if(this.options.sourceId){this.source.removeClass("selected")}document.removeEvent("click",this.hide);this.parent()},position:function(){var a=this.source.getPosition();this.container.setStyles({left:a.x+this.options.xOffset?this.options.xOffset:0,top:a.y+this.options.yOffset?this.options.yOffset:0});this.parent()}});ta.overlays.FooterPocketWithInsertOverlay=new Class({Extends:ta.overlays.PermanentOverlay,Binds:["_handleResize","_hide","show","hide","destroy"],_closeButtonClass:"closeOverlayLarge",_hideOverflow:true,initialize:function(d,e,f){var c="np footerPocketWithInsert";if(d.style){c=c+" "+d.style}if(d.dontHideOverflow){this._hideOverflow=false}var a=Object.merge({draggable:false,permanent:true,toWindow:false,xOffset:f,yOffset:f,closeButtonClass:this._closeButtonClass,backdrop:d.tabletFullScreen?ta.overlays.BACKDROP_NEVER:ta.overlays.BACKDROP_ALWAYS},d);a.style=c;this.parent(a,e);var b=this;this.addEvent("onClose",function(){b._removeEvents()})},_loadEvents:function(){window.addEvent("resize",this._handleResize);window.addEvent("load",this._handleResize)},_removeEvents:function(){window.removeEvent("resize",this._handleResize);window.removeEvent("load",this._handleResize)},hide:function(){this._removeEvents();this.parent();if(this._hideOverflow){document.body.style.overflow="auto"}},show:function(){if(this._hideOverflow){document.body.style.overflow="hidden"}this.parent();this._loadEvents();this.footerPocket=this.container.getElement(".js_footerPocket");this._handleResize()},toggleCloseButton:function(a){var b=this.container.getElement("."+this._closeButtonClass);if(b){b.setStyle("visibility",a?"visible":"hidden")}},_handleResize:function(){var b,c;if(this.options.tabletFullScreen){b="100%";c="100%"}else{b=window.getSize().x;var e=this.options.xOffset*2;c=b-e;var a=parseInt(this.footerPocket.getStyle("min-width"))||0;var d=a-e;if(c<d){c=d}}this.container.setStyle("width",c);this.container.setStyle("top",this.options.yOffset);if(this.backdrop){this.backdrop.setStyle("width",b);this.backdrop.setStyle("min-width",a+3)}this.footerPocket.setStyle("width",b)}});ta.overlays.StaticOverlay=new Class({Extends:ta.overlays.RelativeOverlay,initialize:function(a,b){this.parent(Object.merge({autoShow:false},a),b);this.container.removeClass("relative")},position:function(a){this.container.position({position:"center",offset:{x:this.options.offsetX||0,y:this.options.offsetY||0}});this.parent()},hide:function(d){if(d==null){return}var a=d.srcElement?d.srcElement:d.target;if(this.container.contains(a)){return}if(this.options.childrenOverlays){for(var c=0;c<this.options.childrenOverlays.length;c++){var b=this.options.childrenOverlays[c];if(b.container.contains(a)){return}}}this.parent()}});if(!ta.overlays.filters){ta.overlays.filters={}}ta.overlays.filters.CheckboxOverlay=new Class({Extends:ta.overlays.RelativeOverlayBelow,Binds:["nonSourceHide","doOnInit","buildContent"],options:{showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,style:"date_picker_calendar",multiSelect:true,autoShow:false,delayShow:true,noPadding:true,keepElementInDocument:true,filterType:"",closeOnSelect:true},initialize:function(c,b){var a=Object.merge(this.options,c);this.input=document.getElement(".hotel_filter_wrap ."+a.filterType);this.parent(a,this.input);this.source.removeEvent("click",this.show);this.setupStandardBehavior();this.doOnInit()},setupStandardBehavior:function(){this.input.overlay=this;if(this.container){this.parentOverlay=this.container.getParent(".overlay");if(this.parentOverlay){this.parentOverlay=this.parentOverlay.overlay;this.options.isChild=true}}},doOnInit:function(){this.buildContent(this.inner.getElement(".hotelFilterContent"),this.options.filterType)},buildContent:function(b,e){var a=ta.retrieve("hac.data.object");var h=document.createDocumentFragment();if(a&&a.filters){var d=a.filters[e];if(d){var f=document.createElement("ul");var g=d.options.length;f.className="hacFilterItems "+d.hacName;if(g>8){f.className=f.className+" manyItems"}h.appendChild(f);var c=this;Array.each(d.options,function(i){c.addCheckboxItem(d,e,i,f,c,a)})}b.empty().appendChild(h)}},addCheckboxItem:function(g,b,c,e,h,d){var n="";if(h.isItemDisabled(c)){n="disabled"}var p="";if(n!=""){p="disabled=''"}var l=new Element("li");l.className="hacFilterItem";var j="";var a=b=="showUnavailable";if(a){j="showUnavailable"}if(n||a){l.className=l.className+" "+n+" "+j}if(c.value==0&&!a){l.className=l.className+" default"}var i=b;if(!h.isItemDisabled(c)){l.addEvent("click",function(r){(function(){h.dataItemClick.call(h,l,g.hacName,i,ta.hac.filters.getItemValue(c,b))}).delay(10);return false})}if(a){var k=new Element("hr");e.appendChild(k)}e.appendChild(l);var f="";if(a){if(c.value==1){f="checked=checked"}}else{if(h.isCheckboxItemSelected(d.selected,g.hacName,c.value)){f="checked=checked"}}var m=h.getItemDisplayFragment(c,b);var q=g.hacName+"_"+c.value;var o="";if(!a){o="<span class='itemCount'>("+c.count+")</span>"}else{q=g.hacName}l.innerHTML="<input type='checkbox' id='"+q+"' class='"+q+" "+n+"' "+f+" "+n+" /><span class='dataItem "+n+"'>"+m+o+"</span>"},dataItemClick:function(g,b,a,f){var h;if(ta.has("hac.filter.click.timeout")){ta.remove(ta.hac.filters.getHacFilterTimeoutKey());clearTimeout(ta.remove("hac.filter.click.timeout"))}this.fixCheckboxesInFilter(g);h=ta.hac.filters.updateFilterHash(b,this.getFilterSelections(b));var c=ta.has("persistentFilters.showing")?a+"|persistent_bar":a;if(h){try{var d="click";if(g&&g.getElement("input")&&!g.getElement("input").checked){d="unclick"}if(typeof pageServlet!="undefined"&&pageServlet=="Hotels"&&!ta.isMetaHotelsRequest()){ta.setEvtCookie(ta.hac.filters.getModuleString(this.options.filterType),d,c,f,"/HACSearch")}else{ta.trackEventOnPage(ta.hac.filters.getModuleString(this.options.filterType),d,c,f)}}catch(j){}var i=this;ta.store("hac.filter.click.timeout",setTimeout(function(){ta.remove("hac.updates.running");if(window.pageServlet=="Hotels"){ta.hac.filters.closeAllActiveFilters()}i.updateHACResults.call(i);ta.remove(ta.hac.filters.getHacFilterTimeoutKey())},2000));ta.store(ta.hac.filters.getHacFilterTimeoutKey(),ta.retrieve("hac.filter.changed"))}},updateHACResults:function(){if(this.options&&this.options.closeOnSelect){this.hide()}ta.hac.filters.updateResultsFromFilters()},setCloseOnSelect:function(a){if(this.options&&this.options.closeOnSelect){this.options.closeOnSelect=a}},fixCheckboxesInFilter:function(d){var d=ta.id(d);if(!d||d.hasClass("disabled")){return}if(d.hasClass("hacFilterItem")){d.getElement("input").checked=!d.getElement("input").checked}if(d.hasClass("default")){var e=d.getParent(".hacFilterItems");if(e){Array.each(e.getElements(".hacFilterItem"),function(f){f=ta.id(f);if(!f.hasClass("default")){f.getElement("input").checked=false}else{f.getElement("input").checked=true}})}}else{var b=false;var e=d.getParent(".hacFilterItems");if(!d.getElement("input").checked){var a=e&&document.getElements(".hacFilterItems input:checked");if(!a||!a.length){b=true}}if(e){var c=e.getElement(".default");if(c){c.getElement("input").checked=b}}}},getFilterSelections:function(c){var a=[];if(c=="showUnavailable"){a=document.getElements(".hacFilterItem."+c+" input:checked")}else{if(c){a=document.getElements(".hacFilterItems."+c+" input:checked")}else{a=document.getElements(".hacFilterItems input:checked")}}var b=[];Array.each(a,function(d){if(d.id!=c+"_0"){b.push(d.id)}else{if(c=="showUnavailable"){b.push("showUnavailable")}}});return b},addExpandableItem:function(c,d){var g=document.createDocumentFragment();var e=new Element("li");e.className=c+" expandFilterItem";g.appendChild(e);var f=document.createElement("div");f.className="nameItem sprite-filter-expand";if(ta.has("filterNames."+c)){f.innerHTML=ta.retrieve("filterNames."+c)}else{if(ta.has("hotels.currencies")&&"currencies"==c){f.innerHTML=ta.retrieve("hotels.currencies")[0]}else{f.innerHTML=c}}var b=new Element("div");b.className="toggleItem";e.appendChild(f);e.appendChild(b);var a=this;e.addEvent("click",function(){a.expandableClick.call(a,c,e)});d.appendChild(g)},expandableClick:function(){return},getItemDisplayFragment:function(a,b){return ta.hac.filters.getItemDisplayFragment(a,b,this.isItemDisabled(a))},isCheckboxItemSelected:function(c,a,f){if(!c){return false}var d=a+"_"+f;var b=c.cb;if(f!=0){if(b&&b.contains(d)){return true}}else{var e=false;if(b){Array.each(b,function(g){if(g.indexOf(a)!=-1){e=true}})}if(!e){return true}}return false},isItemDisabled:function(a){if(a&&a.count>0){return false}return true},destroy:function(){this.parent();this.input.overlay=null},nonSourceHide:function(a){if(!this.source.containsEvent(a)){this.hide()}},show:function(g){var d=this.visible;this.parent(g);document.removeEvent("click",this.hide);document.addEvent("click",this.nonSourceHide);if(this.options.filterType!="more"){this.buildContent(this.inner.getElement(".hotelFilterContent"),this.options.filterType)}if(d){return}if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==ta.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}if(ta.has("persistentFilters.showing")&&tabletOnFullSite&&this.container){this.container.setStyle("position","fixed")}var c=document.getElement(".hotel_filter."+this.options.filterType);var f=document.getElement(".date_picker_calendar."+this.options.filterType);if(ta.util.i18n.isRtl()){var b=c.getCoordinates().width;var a=f.getCoordinates().width;this.options.offsetLeft=a-b}else{this.options.offsetLeft=0}this.position();return this},hide:function(a){if(!this.visible){return}document.removeEvent("click",this.nonSourceHide);this.parent(a);if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}}});ta.overlays.filters.ClassOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"hotel_class"},initialize:function(b,a){this.parent(b,a)}});ta.overlays.filters.RatingOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"traveler_rating"},initialize:function(b,a){this.parent(b,a)}});ta.overlays.filters.PriceOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"price"},initialize:function(b,a){this.parent(b,a)},doOnInit:function(){this.buildContent(this.inner.getElement(".hotelFilterContent"),this.options.filterType);if(ta.has("hotels.currencies")){this.addExpandableItem("currencies",this.inner.getElement(".hotelFilterContent"))}this.addShowUnavailableCheckbox(this.inner.getElement(".hotelFilterContent"))},expandableClick:function(b,c){var a=c.getElement(".toggleItem");if(a&&a.innerHTML!=""){a.innerHTML="";if(ta.id(c).getElement(".nameItem")){ta.id(c).getElement(".nameItem").removeClass("sprite-filter-collapse").addClass("sprite-filter-expand")}}else{this.buildCurrencyContent(c.getElement(".toggleItem"),"currencies");var d=ta.id(c).getParent(".expandFilterItems");if(d){var e=d.getElements("li");if(e){Array.each(e,function(g){g=ta.id(g);var f=g.getElement(".nameItem");if(!g.hasClass("currencies")&&f&&f.hasClass("sprite-filter-collapse")){var h=g.getElement(".toggleItem");if(h){h.innerHTML=""}f.removeClass("sprite-filter-collapse").addClass("sprite-filter-expand")}})}}if(ta.id(c).getElement(".nameItem")){ta.id(c).getElement(".nameItem").removeClass("sprite-filter-expand").addClass("sprite-filter-collapse")}}},show:function(){if(ta.has("ta.calendar.isPriceOverlayCalendar")){return}this.parent();if(ta.has("hotels.currencies")){this.addExpandableItem("currencies",this.inner.getElement(".hotelFilterContent"))}this.addShowUnavailableCheckbox(this.inner.getElement(".hotelFilterContent"))},nonSourceHide:function(a){if(!this.source.containsEvent(a)&&!this.inner.containsEvent(a)){this.hide()}},addShowUnavailableCheckbox:function(d){var a=ta.retrieve("hac.data.object");if(a&&a.filters){var f={hacName:"showUnavailable"};var e=this;var g=a.selected.showUnavailable;var c=ta.retrieve("filterNames.showUnavailable");var b={label:c,count:1,value:g?1:0};e.addCheckboxItem(f,"showUnavailable",b,d,e,a)}},buildCurrencyContent:function(a){var d="";var g=document.createDocumentFragment();var e=document.createElement("ul");var c=ta.retrieve("hotels.currencies");if(c){var f=c.length;e.className="hacFilterItems currency";if(f>8){e.className=e.className+" manyItems"}g.appendChild(e);var b=this;Array.each(c,function(j,i){var m=new Element("li");m.className="hacFilterItem";m.addEvent("click",function(n){(function(){b.currencyItemClick.call(b,j)}).delay(10);return false});e.appendChild(m);var l="";var k=b.getItemDisplayFragment(j,"currencies");var h="currency_"+j;m.innerHTML="<span class='dataItem'>"+k+"</span>"})}a.innerHTML="";a.appendChild(g)},currencyItemClick:function(a){ta.commerce.meta.clearStoredMiniData();if(a.test(/[A-Z]{3}/)){ta.store("ta.commerce.MetaHacOverlay.currency",a);new Request({url:"/ActionRecord?action=MetaCurrencyPicker"}).send();ta.trackEventOnPage("MetaCurrencyPicker","selected",a,1);ta.hac.filters.changeCurrency()}if(this.hide){this.hide()}},showCalendarLightbox:function(d){var c=ta.hac.filters.getModuleString(this.options.filterType);var e="open_calendar";var b="price";ta.trackEventOnPage(c,e,b,0,false);var a=ta.retrieve("ta.overlays.filters.PriceOverlay.showCalendarLightbox");if(typeof(a)=="function"){a()}else{this.buildCalendarLightbox(d)}},calendarLightBoxOverlay:null,buildCalendarLightbox:function(e,a){var d;d=ta.id("PriceFilterCalendarOverlayContent");if(!d){return}d.show();var c={style:"priceFilterCalendarOverlay",innerDiv:"skv3",content:d,autoShow:false,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:"roundOuterClose",onShow:function(){ta.remove("ta.calendar.isOutDateTrigger");ta.store("ta.calendar.isPriceOverlayCalendar",true);var h=null;var g=document.getElement("date_picker_in_PriceFilterCalendar");setTimeout(function(){ta.overlays.Factory.loadDatePicker(h,g,"PriceFilterCalendar","",ta.servlet.HACSearch.doMetaDateSearch)},100);if(this.calendar){this.calendar.reposition()}},onClose:function(){ta.remove("ta.calendar.isOutDateTrigger");ta.remove("ta.calendar.isPriceOverlayCalendar")},onHide:function(){ta.remove("ta.calendar.isOutDateTrigger");ta.remove("ta.calendar.isPriceOverlayCalendar")}};var f=ta.id("HEADING");var b=new ta.overlays.CenteredOverlay(c,f);ta.store("ta.overlays.filters.PriceOverlay.showCalendarLightbox",function(){b.show()})},buildContent:function(a,b){if(ta.retrieve("meta.hotels_no_prices")&&!ta.widgets.calendar.hasPageDates()){this.showCalendarLightbox(a)}else{this.parent(a,b)}}});ta.overlays.filters.NeighborhoodOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"neighborhood"},initialize:function(b,a){this.parent(b,a)}});ta.overlays.filters.AmenitiesOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"amenities"},initialize:function(b,a){this.parent(b,a)}});ta.overlays.filters.BrandOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"hotel_brand"},initialize:function(b,a){this.parent(b,a)},getItemDisplayFragment:function(a){if(typeof brandMappings!="undefined"){return"<span class='itemLabel'>"+brandMappings[a.value]+"</span>"}return""}});ta.overlays.filters.MoreOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"more",moreOptions:""},initialize:function(b,a){if(b.moreOptions){this.displayFilters=b.moreOptions.split(" ")}this.parent(b,a)},doOnInit:function(){var b=document.createDocumentFragment();var a=new Element("ul");a.className="expandFilterItems more";b.appendChild(a);this.inner.getElement(".hotelFilterContent").innerHTML="";this.inner.getElement(".hotelFilterContent").appendChild(b);moreOvly=this;Array.each(this.displayFilters,function(c){var d=ta.retrieve("hac.data.object");if(d&&d.filters){var e=d.filters[c];if(e&&e.options.length>0){moreOvly.addExpandableItem.call(moreOvly,c,a)}}})},nonSourceHide:function(a){if(!this.source.containsEvent(a)&&!this.inner.containsEvent(a)){this.hide()}},expandableClick:function(c,b){var f=ta.has("persistentFilters.showing")?c+"|persistent_bar":c;var a=b.getElement(".toggleItem");if(a&&a.innerHTML!=""){a.innerHTML="";if(ta.id(b).getElement(".nameItem")){ta.id(b).getElement(".nameItem").removeClass("sprite-filter-collapse").addClass("sprite-filter-expand")}ta.trackEventOnPage(ta.hac.filters.getModuleString(this.options.filterType),"close",f)}else{this.buildContent(b.getElement(".toggleItem"),c);var d=ta.id(b).getParent(".expandFilterItems");if(d){var e=d.getElements("li");if(e){Array.each(e,function(h){h=ta.id(h);var g=h.getElement(".nameItem");if(!h.hasClass(c)&&g&&g.hasClass("sprite-filter-collapse")){var i=h.getElement(".toggleItem");if(i){i.innerHTML=""}g.removeClass("sprite-filter-collapse").addClass("sprite-filter-expand")}})}}if(ta.id(b).getElement(".nameItem")){ta.id(b).getElement(".nameItem").removeClass("sprite-filter-expand").addClass("sprite-filter-collapse")}ta.trackEventOnPage(ta.hac.filters.getModuleString(this.options.filterType),"open",f)}}});ta.overlays.filters.SortOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"sort"},initialize:function(b,a){this.parent(b,a)},addCheckboxItem:function(e,a,b,d,f,c){var h=new Element("li");h.className="hacFilterItem";if(b.value==0){h.className=h.className+" default"}var g=this;h.addEvent("click",function(k){if(window.pageServlet=="WidgetEmbed"){ta.hac.filters.changeSort(b.value);ta.trackEventOnPage(ta.hac.filters.getModuleString(g.options.filterType),"click",b.value)}else{ta.pages.hac.hacSortChangedToValue(b.value)}g.hide();return false});d.appendChild(h);var i=f.getItemDisplayFragment(b,a);var j=b.value;h.innerHTML="<span class='dataItem'>"+i+"</span>"}});(function(j,h,d,b){var f="GuestRoomSelector",i="grp-rooms",e="grp-guests",q="grp-update",c="-value",p="singular_room_da",l="plural_rooms_da",g="singular_guest_da",k="plural_guests_da",o="rooms_guests_picker_update_da",a=function(s,r,v){var u=s.replace("grp-",""),t=r+"_"+u;d.trackEventOnPage(f,t,null,v)},n=function(){d.trackEventOnPage(f,"update_click")},m=function(r){var s=r&&r.target&&$(r.target).getParent(".date_picker_calendar");return(s!=null)};d.overlays.GuestsRoomsOverlay=new Class({Extends:d.overlays.RelativeOverlayBelow,Binds:["nonSourceHide","hideByClickOnDocument"],options:{showCloseButton:false,activate:d.overlays.ACTIVATE_CLICK,multiSelect:true,autoShow:false,delayShow:true,noPadding:true,keepElementInDocument:true,closeOnSelect:false},callback:null,selectionModified:false,findTargetFunction:false,initialize:function(t,s){this.callback=t.moreOptions.callback;if(t.guestsRoomsData){this.saveData(t.guestsRoomsData)}this.buildContent(t);this.input=t.moreOptions.input;this.findTargetFunction=t.moreOptions.findTargetFunction;var r=Object.merge(this.options,t);this.parent(r,this.input);this.source.removeEvent("click",this.show);this.setupStandardBehavior()},setupStandardBehavior:function(){if(this.input.getParent(".overlay")){this.parentOverlay=this.input.getParent(".overlay").overlay;this.options.isChild=true}},getData:function(){return d.widgets.calendar.getGuestsRoomsPickerData()},saveData:function(r){d.store("guests.rooms.object",r)},resetData:function(){var r={rooms:1,guests:2};this.saveData(r);return r},updateSessionGuestsRooms:function(t){var s;if(d.widgets.calendar.hasPageDates()){s=d.widgets.calendar.getCheckRatesData()}else{var u=this.getData();s={rooms:u.rooms,adults:u.guests}}var r=this;new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString(s),method:"post",onSuccess:function(){r.runCallback(t)}}).send()},runCallback:function(r){if(this.callback&&typeof(this.callback)==="function"&&d.widgets.calendar.hasPageDates()){this.callback(r)}},resetOverlay:function(){this.resetData();this.updateOverlay(i);this.updateOverlay(e)},getTranslationString:function(s){var t=this.getData();var r;if(s===i){r=t.rooms;if(r===1){return d.retrieve(p)}else{return d.retrieve(l)}}else{if(s===e){r=t.guests;if(r===1){return d.retrieve(g)}else{return d.retrieve(k)}}else{if(s===q){return d.retrieve(o)}}}},getCounter:function(s){var t=this.getData();var r;if(s==i){r=t.rooms}else{if(s===e){r=t.guests}}return r},buildContent:function(s){var t=new Element("ul");t.className="guests_rooms_overlay";var v=this.buildButtonLine(i);t.appendChild(v);var u=this.buildButtonLine(e);t.appendChild(u);var r=this.buildUpdateLine();t.appendChild(r);s.content=t},buildButtonLine:function(x){var t=this.getCounter(x);var v=this.getTranslationString(x);var s=new Element("li");s.className="line";s.id=x;var y=new Element("div");y.className="signButton minusButton";if(t===1){y.className+=" disabled"}y.setContent("-");var u=this;y.addEvent("click",function(z){u.processDecrementCounter(x,true)});var r=new Element("div");r.className="numberLabelText";r.setContent(t+" "+v);var w=new Element("div");w.className="signButton plusButton";if(x===i&&t>7){w.className+=" disabled"}else{if(x===e&&t>31){w.className+=" disabled"}}w.setContent("+");w.addEvent("click",function(z){u.processIncrementCounter(x,true);z.stopPropagation()});s.appendChild(y);s.appendChild(r);s.appendChild(w);return s},processDecrementCounter:function(t,r){var u=this.getData(),v;if(t===i){if(u.rooms<=1){return}u.rooms-=1;v=u.rooms;this.saveData(u);this.updateOverlay(t);while((u.guests/4)>u.rooms){this.processDecrementCounter(e)}}else{if(t===e){if(u.guests<=1){return}u.guests-=1;v=u.guests;this.saveData(u);this.updateOverlay(t);var s=(u.guests<u.rooms);if(s){this.processDecrementCounter(i)}}}if(r){a(t,"subtract",v)}},processIncrementCounter:function(s,r){var u=this.getData(),v;if(s===i){if(u.rooms>7){return}u.rooms+=1;v=u.rooms;this.saveData(u);this.updateOverlay(s);var t=(u.rooms>u.guests);if(t){this.processIncrementCounter(e)}}else{if(s===e){if(u.guests>31){return}u.guests+=1;v=u.guests;this.saveData(u);this.updateOverlay(s);var t=((u.guests/4)>u.rooms);if(t){this.processIncrementCounter(i)}}}if(r){a(s,"add",v)}},updateOverlay:function(r){var t=this.buildButtonLine(r);var s=d.id(r);s.parentNode.replaceChild(t,s);this.selectionModified=true;this.updateCounterElement(r)},updateCounterElement:function(s){var t=this.getCounter(s);var r=$$("."+s+c);r.each(function(u){u.innerHTML=t});if(s===i){d.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".roomsGuestsButton.roomsButton",t);d.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".stayInfoContainer.rooms",t)}else{if(s===e){d.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".roomsGuestsButton.guestsButton",t);d.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".stayInfoContainer.guests",t)}}},buildUpdateLine:function(){var v=this.getTranslationString(q);var r=new Element("li");r.className="line update";r.id=q;var t=new Element("div");t.className="updateButton rndBtn rndBtnGreen";var s=this;t.addEvent("click",function(x){s.processUpdate(x);s.hide();n()});var u=new Element("div");u.className="ui-btn-inner";var w=new Element("div");w.className="ui-btn-text";w.setContent(v);u.setContent(w);t.setContent(u);r.setContent(t);return r},processUpdate:function(r){if(!this.selectionModified){if(this&&this.parentOverlay&&this.parentOverlay.visible&&d.widgets.calendar.hasPageDates()){this.parentOverlay.hide()}return}this.selectionModified=false;this.updateSessionGuestsRooms(r)},destroy:function(){this.parent();this.input.overlay=null},nonSourceHide:function(r){if(!this.source.containsEvent(r)&&!(r.target.className.contains("signButton"))){this.hide(r)}},hideByClickOnDocument:function(r){if(this.parentOverlay&&this.parentOverlay.visible){return}else{this.hide(r)}},show:function(s){var t=this.visible,u;this.parent(s);j.removeEvent("click",this.hide);j.addEvent("click",this.nonSourceHide);j.removeEvent("click",this.hideByClickOnDocument);$$(".date_picker_calendar").addEvent("click",this.nonSourceHide);u=this.findTargetFunction(s);if(u){this.source=u}d.widgets.calendar.syncAllDatePickers();if(t){this.hide(s);return}if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==d.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}this.position();var r=$$(".roomsGuestsButtonWrap .roomsGuests");if(r){r.addClass("disabled")}return this},hide:function(s){if(!this.visible){return}j.removeEvent("click",this.nonSourceHide);$$(".date_picker_calendar").removeEvent("click",this.nonSourceHide);this.parent(s);if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}var r=$$(".roomsGuestsButtonWrap .roomsGuests");if(r){r.removeClass("disabled")}this.processUpdate(s)}});d.overlays.GuestsRoomsOverlay.trackPickerClick=function(r){if(m(r)){d.trackEventOnPage(f,"select_guest_room_calendar")}else{d.trackEventOnPage(f,"select_guest_room")}}})(document,window,ta);(function(j,i,h,d){var e={rooms:{max:8,singularKey:"singular_room_da",pluralKey:"plural_rooms_da",tracking:"RoomSelector"},guests:{max:32,singularKey:"singular_guest_da",pluralKey:"plural_guests_da",tracking:"GuestSelector"}},a=4,c=function(r,s,n){var q=e[n],p={type:n,singular:h.retrieve(q.singularKey),plural:h.retrieve(q.pluralKey),maxValue:q.max,target:s,tracking:q.tracking},m=k(n),o=h.retrieve(m)||new h.overlays.NumberPickerOverlay(p,s);h.store(m,o);o.show(r)},k=function(m){return"numberPickerOverlay_"+m},l=function(o,n,m){return o+" "+((o===1)?n:m)},g=function(){return h.widgets.calendar.getGuestsRoomsPickerData()},f=function(m){h.store("guests.rooms.object",m)},b=function(o,q){var p=g(),m=function(s){var r=s.guests/Math.max(s.rooms,1);if(r>a){s.rooms=Math.ceil(s.guests/a)}else{if(s.rooms>s.guests){s.rooms=s.guests}}},n=function(s){var r=s.guests/Math.max(s.rooms,1);if(r>a){s.guests=s.rooms*a}else{if(s.rooms>s.guests){s.guests=s.rooms}}};if(p[o]===q){return false}p[o]=q;if(o==="rooms"){n(p)}else{if(o==="guests"){m(p)}}f(p);return true};h.overlays.NumberPickerOverlay=new Class({Extends:h.overlays.RelativeOverlayBelow,Binds:["nonSourceHide","hideByClickOnDocument"],options:{activate:h.overlays.ACTIVATE_CLICK,style:"numberPickerOverlay",multiSelect:false,autoShow:false,delayShow:false,noPadding:true,keepElementInDocument:true,closeOnSelect:true,waitForCss:true},callback:function(){if(h.retrieve("hh_short_cell.enabled")){if(this.source&&this.source.className&&this.source.className.indexOf("placement_hh")!=-1&&h.commerce.metajson){h.commerce.metajson.refetchAll()}}else{var m=h.retrieve("meta.baseLocationId");h.widgets.calendar.checkDatesMakeHacCallHR(m)}},initialize:function(o,n){this.input=o.target;this.buildContent(o);var m=Object.merge(this.options,o);this.parent(m,this.input)},buildContent:function(m){var n=new Element("div");n.appendChild(this.buildSelectorRows(m));m.content=n},buildSelectorRows:function(n){var m=this,o=new Element("ul"),q,p,r=function(t,s){t.addEvent("click",function(v){var u=b(n.type,s);m.hide();h.trackEventOnPage(n.tracking,"Select",null,s);if(u){m.callback()}})};o.className="list";for(p=1;p<=n.maxValue;p++){q=new Element("li");q.setContent(l(p,n.singular,n.plural));q.className="item";r(q,p);o.appendChild(q)}return o},resetOverlays:function(){h.remove(k("rooms"));h.remove(k("guests"))},show:function(m){if(this.visible){this.hide(m)}else{if(this.parent){this.parent(m);this.position();h.trackEventOnPage(this.options.tracking,"Open")}}return this},hide:function(m){this.resetOverlays();this.parent(m)}});h.overlays.NumberPickerOverlay.roomsPicker=function(m,n){return c(m,n,"rooms")};h.overlays.NumberPickerOverlay.guestsPicker=function(m,n){return c(m,n,"guests")};h.overlays.NumberPickerOverlay.updateHeaderMsg=function(m){var r=g(),t=$$(m+" .roomsChange"),o=l(r.rooms,h.retrieve("singular_room_da"),h.retrieve("plural_rooms_da")),s=$$(m+" .guestsChange"),q=l(r.guests,h.retrieve("singular_guest_da"),h.retrieve("plural_guests_da")),n=t.getElement("img"),p=n.length&&n[0].outerHTML;t.set("html",o+" "+p);s.set("html",q+" "+p)};h.overlays.NumberPickerOverlay.unhideDropdowns=function(m){var n=$$(m);if(n&&h.widgets.calendar.hasPageDates()){n.removeClass("hidden")}}})(document,window,ta);